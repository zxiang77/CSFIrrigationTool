!function(a){var b=null,c=function(a){var b=/^[0-9a-zA-Z_]+$/;return b.test(a)},d={changed:!1,default_location:{address:"Cornell University, Ithaca, NY",lat:42.45,lng:-76.48,id:"default"},hidden_location_attrs:["infowindow","marker"],initialized:!1,initial_location:null,locations:{},selected_location:"default",baseLocation:function(b){var b=b;if("string"==typeof b&&(b="initial"==b?this.locations[this.initial_location]:"selected"==b?this.locations[this.selected_location]:this.locations[b]),b){var c={},d=this.hidden_location_attrs;return a.each(b,function(a,b){d.indexOf(a)<0&&(c[a]=b)}),c}},deleteLocation:function(a){var a=this.locations[a.id];if("undefined"!=typeof a){var b;console.log("request to delete location : "+a.address),a.marker.setMap(null),b=a.infowindow,delete b,a.infowindow=null,b=a.marker,delete b,a.marker=null,b=a,delete this.locations[a.id],delete b,this.changed=!0}},getLocation:function(a){var a=a;return"string"==typeof a?"initial"==a?this.locations[this.initial_location]:"selected"==a?this.locations[this.selected_location]:this.locations[a]:"undefined"!=typeof a?this.locations[a.id]:null!=this.selected_location?this.locations[this.selected_location]:this.locations.default},initializeDialogs:function(b){var c=e;return console.log("TheDialogContext.initializeDialogs() was called"),a(b).html(c.dialog_html),c.container=b,console.log("dialog root html installed in : "+c.container),i.initializeDialog(c.map_anchor),f.initializeDialog(c.editor_anchor),this.initialized=!0,this},locationExists:function(a){return"undefined"!=typeof this.locations[a.id]},publicContext:function(){return{initial_location:this.baseLocation("initial"),all_locations:this.publicLocations(),selected_location:this.baseLocation("selected")}},publicLocation:function(a){return this.baseLocation(this.getLocation(a))},publicLocations:function(){var b={};return a.each(this.locations,function(a,c){b[a]={address:c.address,id:c.id,lat:c.lat,lng:c.lng}}),b},saveLocation:function(b,c){console.log("request to save location : "+b.address),this.locations[b.id]=a.extend({},b),"undefined"==typeof c?this.changed=!1:this.changed=c},selectLocation:function(a){"string"==typeof a?this.selected_location=a:this.selected_location=a.id,this.changed=!0}},e={center_loc_on:".csf-map-dialog",center_map_on:"#csftool-content",container:null,dialog_html:['<div id="csftool-location-dialogs">','<div id="csftool-map-dialog-anchor">',"</div> <!-- end of csftool-map-dialog-anchor -->",'<div id="csftool-location-editor-anchor">',"</div> <!-- close csftool-location-editor-anchor -->","</div> <!-- end of csftool-location-dialogs -->"].join(""),editor_anchor:"#csftool-location-editor-anchor",editor_content:"#csftool-location-editor-content",editor_default_id:"Enter unique id",editor_dialog_html:['<div id="csftool-location-editor-content">','<div id="csftool-location-idcont"><span class="dialog-label dialog-coord">ID :</span>','<span id="csftool-location-id" class="dialog-text dialog-coord"> </span> </div>','<div id="csftool-location-place">','<input type="text" id="csftool-location-address" class="dialog-text location-address" readonly> </div>',"</div>",'<div id="csftool-location-coords">',"</div> <!--close csftool-location-coords -->","</div> <!-- close csftool-location-editor-content -->"].join(""),editor_dom:{id:"#csftool-location-id",address:"#csftool-location-address",lat:"#csftool-location-lat",lng:"#csftool-location-lng"},infoaddress:'<span class="loc-address">${address_component}</span>',infobubble:['<div class="locationInfobubble">',"${loc_obj_address}",'</br><span class="loc-coords">${loc_obj_lat} , ${loc_obj_lng}</span>',"</div>"].join(""),map_anchor:"#csftool-map-dialog-anchor",map_content:"#csftool-map-dialog-content",map_dialog_html:['<div id="csftool-map-dialog-content">','<div id="csftool-map-dialog-map" class="map-container"> </div>',"</div> <!-- end of csftool-map-dialog-content -->"].join(""),map_element:"csftool-map-dialog-map"},f={callbacks:{},container:null,editor_location:null,initialized:!1,isopen:!1,supported_events:["cancel","close","delete","save","select"],clear:function(){var b=e.editor_dom,c=this.editor_location;this.editor_location=null,delete c,a(b.id).val(""),a(b.address).val(""),a(b.lat).text(""),a(b.lng).text("")},close:function(){a(this.container).dialog("close"),this.clear(),this.isopen=!1,i.zoomToMarkers()},oneLocationLeftMessage:function(){a(this.container).dialog("option","title","At least one location is required."),a(".csf-editor-dialog").css("background-color","#FFBABA"),a(".csf-editor-dialog .ui-dialog-titlebar").css("background-color","#D8000C"),a(".csf-editor-dialog .ui-button").css("background-color","#D8000C"),a(".csf-editor-dialog .ui-dialog-buttonpane").css("background-color","#FFBABA"),this.setButtons("Error")},redifyEditor:function(){a(this.container).dialog("option","title","Outside Available Area"),a(".csf-editor-dialog").css("background-color","#FFBABA"),a(".csf-editor-dialog .ui-dialog-titlebar").css("background-color","#D8000C"),a(".csf-editor-dialog .ui-button").css("background-color","#D8000C"),a(".csf-editor-dialog .ui-dialog-buttonpane").css("background-color","#FFBABA")},greenifyEditor:function(){a(this.container).dialog("option","title","Confirm Location Information"),a(".csf-editor-dialog").css("background-color","#C8E5BE"),a(".csf-editor-dialog .ui-dialog-titlebar").css("background-color","#228b22"),a(".csf-editor-dialog .ui-button").css("background-color","#228b22"),a(".csf-editor-dialog .ui-dialog-buttonpane").css("background-color","#C8E5BE")},execCallback:function(b,c){if(b in this.callbacks)if(console.log("executing call back for "+b+" event"),"undefined"!=typeof c)this.callbacks[b](b,c);else{var d=e.editor_dom,f={id:a(d.id).val(),address:a(d.address).val(),lat:a(d.lat).val(),lng:a(d.lng).val()};this.callbacks[b](b,f)}},changes:function(){var b=this.getLocation(),c=this.getLocationBeforeEdit(),d=!1,e=a.extend({},c);return b.address!=c.address&&(e.address=b.address,d=!0),b.lat!=c.lat&&(e.lat=b.lat,d=!0),b.lng!=c.lng&&(e.lng=b.lng,d=!0),b.id!=c.id&&(e.id=b.id,d=!0),[d,e]},getLocation:function(){var b=e.editor_dom,c={address:a(b.address).val(),lat:this.editor_location.lat,lng:this.editor_location.lng,id:a(b.id).val()};return c},getLocationBeforeEdit:function(){e.editor_dom;return{address:this.editor_location.address,lat:this.editor_location.lat,lng:this.editor_location.lng,id:this.editor_location.id}},initializeDialog:function(b){var c=e;this.container=c.editor_content,console.log("EditorDialog.initializeDialog() was called");var d=c.editor_dialog_html.replace("${editor-default-id}",c.editor_default_id);a(b).html(d),console.log("location editor html installed in : "+b);var f=a.extend({},g);return a(this.container).dialog(f),this.initialized=!0,this},open:function(c){console.log("EditorDialog.open() was called");var e=c.id;null==e&&(c.id=this.createID());var f=c.address.indexOf(", USA");return null!=e||f>0?(c.address=c.address.replace(", USA",""),this.setLocation(c),console.log("attempting to open dialog at "+this.container),a(this.container).dialog("open"),a("#csftool-location-idcont:visible").hide(),a("#csftool-location-coords:visible").hide(),this.setButtons(e),this.greenifyEditor(),null!=b&&(a.inArray(b.id,Object.keys(d.locations))==-1&&b.marker.setMap(null),b=null),i.mappableLocation(c)):(c.address="This location cannot be processed.",this.setLocation(c),a(this.container).dialog("open"),a("#csftool-location-idcont:visible").hide(),a("#csftool-location-coords:visible").hide(),this.setButtons("Error"),this.redifyEditor(),null!=b&&(a.inArray(b.id,Object.keys(d.locations))==-1&&b.marker.setMap(null),b=null)),this.isopen=!0,!1},setLocation:function(b){var c=e.editor_dom,b=b;console.log("EditorDialog.setLocation() was called"),"undefined"!=typeof b.id?a(c.id).val(b.id):a(c.id).val(""),"undefined"!=typeof b.address?a(c.address).val(b.address):a(c.address).val(""),"undefined"!=typeof b.lat?a(c.lat).text(b.lat.toFixed(6)):a(c.lat).text(""),"undefined"!=typeof b.lng?a(c.lng).text(b.lng.toFixed(6)):a(c.lng).text(""),this.editor_location=a.extend({},b),console.log(this.editor_location)},setButtons:function(b){console.log("EditorDialog.setButtons() was called"),null===b?(a(".csftool-loc-dialog-cancel:hidden").show(),a(".csftool-loc-dialog-delete:visible").hide(),a(".csftool-loc-dialog-save:hidden").show(),a(".csftool-loc-dialog-select:visible").hide(),a(".csftool-loc-dialog-saveselect:hidden").show(),a(".csftool-loc-dialog-close:visible").hide()):"Error"===b?(a(".csftool-loc-dialog-cancel:visible").hide(),a(".csftool-loc-dialog-delete:visible").hide(),a(".csftool-loc-dialog-save:visible").hide(),a(".csftool-loc-dialog-select:visible").hide(),a(".csftool-loc-dialog-saveselect:visible").hide(),a(".csftool-loc-dialog-close:hidden").show()):(a(".csftool-loc-dialog-cancel:hidden").show(),a(".csftool-loc-dialog-delete:hidden").show(),a(".csftool-loc-dialog-save:visible").hide(),a(".csftool-loc-dialog-select:hidden").show(),a(".csftool-loc-dialog-saveselect:visible").hide(),a(".csftool-loc-dialog-close:visible").hide())},createID:function(){var a=new Date,b=[a.getYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()],c=b.join("");return c}},g={appendTo:e.editor_anchor,autoOpen:!1,buttons:{Cancel:{class:"csftool-loc-dialog-cancel",text:"Cancel",click:function(){console.log("EditorDialog CANCEL button clicked");var c=f.getLocation();a.inArray(c.id,Object.keys(d.locations))==-1&&(b.marker.setMap(null),b=null),f.close()}},Delete:{class:"csftool-loc-dialog-delete",text:"Delete",click:function(){console.log("EditorDialog DELETE button clicked");var b=f.getLocation();if(c(b.id))if(Object.keys(d.locations).length>1)if(d.selected_location!=b.id)console.log("attempting to delete location "+b.id),d.deleteLocation(b),f.close();else{var e=Object.keys(d.locations);a.each(e,function(a,b){if(b!=d.selected_location)return d.selectLocation(b),d.locations[b].marker.setIcon("http://maps.google.com/mapfiles/ms/icons/red-dot.png"),!1}),d.deleteLocation(b),f.close()}else f.oneLocationLeftMessage();else delete b}},Save:{class:"csftool-loc-dialog-save",text:"Save",click:function(){console.log("EditorDialog SAVE button clicked");var e=f.getLocation();c(e.id)?(f.close(),null!=b&&(b.marker.setMap(null),b=null),n.addLocation(e),d.locations[e.id].marker.setIcon("http://maps.google.com/mapfiles/ms/icons/blue-dot.png"),f.execCallback("save",e)):a("p.invalid-location-id").show()}},Select:{class:"csftool-loc-dialog-select",text:"Select",click:function(){console.log("EditorDialog SELECT button clicked");var b=f.changes(),e=b[1];c(e.id)?(b[0]?n.addLocation(e):d.locationExists(e)||n.addLocation(e),d.selectLocation(e),f.execCallback("select",e),f.close(),i.close()):a("p.invalid-location-id").show()}},SaveSelect:{class:"csftool-loc-dialog-saveselect",text:"Save & Select",click:function(){console.log("EditorDialog SAVE & SELECT button clicked");var b=f.changes(),e=b[1];c(e.id)?(b[0]?n.addLocation(e):d.locationExists(e)||n.addLocation(e),d.selectLocation(e),f.execCallback("select",e),f.close(),i.close()):a("p.invalid-location-id").show()}},Close:{class:"csftool-loc-dialog-close",text:"Close",click:function(){console.log("EditorDialog CLOSE button clicked"),f.close()}}},close:function(c,e){console.log("trying to close LOCATION dialog"),null!=b&&(a.inArray(b.id,Object.keys(d.locations))==-1&&b.marker.setMap(null),b=null),i.zoomToMarkers(),f.execCallback("close")},draggable:!0,minHeight:50,minWidth:450,modal:!0,show:"slideDown",hide:"slideUp",position:{my:"top top",at:"center top",of:e.center_loc_on},title:"Confirm Location Information",dialogClass:"csf-editor-dialog"},h=function(){var a=i.map_bounds;if(null!=a){var b=null,c=null,d=i.map,e=d.getBounds(),f=e.getCenter(),g=a.getNorthEast(),h=a.getSouthWest(),j=e.getNorthEast(),k=e.getSouthWest();k.lng()<h.lng()?c=h.lng()+(k.lng()-j.lng())/2:j.lng()>g.lng()&&(c=g.lng()-(k.lng()-j.lng())/2),k.lat()<h.lat()?b=h.lat()+(j.lat()-k.lat())/2:j.lat()>g.lat()&&(b=g.lat()-(j.lat()-k.lat())/2),null!=b?(null!=c?d.setCenter(new google.maps.LatLng(b,c)):d.setCenter(new google.maps.LatLng(b,f.lng())),console.log("GOOGLE MAPS :: map bounds restricted : "+d.getBounds())):null!=c&&(d.setCenter(new google.maps.LatLng(f.lat(),c)),console.log("GOOGLE MAPS :: map bounds restricted : "+d.getBounds()))}},i={callbacks:{},changed:!1,container:null,current_marker:null,default_center:{lat:43.2,lng:-74.17},geocoder:null,google:null,height:null,icons:{},initialized:!1,isopen:!1,map:null,map_bounds:null,map_center:null,root_element:null,supported_events:["close"],width:null,zoom:null,afterClose:function(){console.log("     afterClose function called"),this.isopen=!1,this.execCloseCallback()},beforeClose:function(){console.log("     beforeClose function called"),f.isopen&&(console.log("an editor dialog is open"),f.close())},centerMap:function(a){var b;b="undefined"!=typeof a?this.locAsLatLng(a):this.locAsLatLng(),this.map.panTo(b)},close:function(){console.log("LOCATION DIALOG :: trying to close locaiton dialog"),this.beforeClose(),console.log("     telling jQuery to close the dialog"),a(this.container).dialog("close"),this.afterClose()},execCloseCallback:function(a){if(console.log("     execCloseCallback function called : callback exists : "+("close"in this.callbacks)),"close"in this.callbacks){var b=d.publicContext();b.changed=d.changed,this.callbacks.close("close",b)}},geocodeAddress:function(b){var c=a.extend({},l),d=a("#over_map").find('input[id="csftool-address-form-text"]').val(),e=function(c){var c=c;return function(d,e){if(e===i.google.maps.GeocoderStatus.OK&&d.length>0){if(c.address=d[0].formatted_address,c.lat=d[0].geometry.location.lat(),c.lng=d[0].geometry.location.lng(),a("#over_map").find('input[id="csftool-address-form-text"]').val(""),i.map.setCenter(d[0].geometry.location),i.map.setZoom(14),i.google.maps.geometry.poly.containsLocation(d[0].geometry.location,b)){c.id=null,c.address="This location cannot be processed.";var g=new i.google.maps.InfoWindow({size:new i.google.maps.Size(150,50)}),h="No data for this location";g.setContent(h),g.setPosition(d[0].geometry.location),g.open(i.map)}f.open(c)}}}(c);i.geocoder.geocode({address:d},e)},initializeDialog:function(b){var c=e;console.log("MAP DIALIG :: initializeDialog() was called"),a(b).html(c.map_dialog_html),this.root_element=b,console.log("MAP DIALOG :: html installed in : "+this.root_element);var d=a.extend({},j);this.height&&(d.minHeight=this.height),this.width&&(d.minWidth=this.width),this.container=c.map_content,a(this.container).dialog(d);var f=['<div id="over_map">',"<form>",'<input id="csftool-address-form-submit" type="button" value="GO">','<input id="csftool-address-form-text" type="text" placeholder="Enter County, State, Zip Code, or Address">',"</form>","</div>"].join("");return a(".csf-map-dialog").children(".ui-dialog-titlebar").after(f),this.zoom=k.zoom,this.initialized=!0,this},initializeGoogle:function(a){console.log("MAP DIALOG :: initializing Google : "+a),this.google=a,k.mapTypeControlOptions={style:this.google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:this.google.maps.ControlPosition.TOP_RIGHT},k.mapTypeId=this.google.maps.MapTypeId.ROADMAP,k.zoomControlOptions={style:this.google.maps.ZoomControlStyle.SMALL,position:this.google.maps.ControlPosition.TOP_LEFT},this.map_center=new this.google.maps.LatLng(this.default_center)},initializeMap:function(b){"string"!=typeof b&&a.inArray("key",Object.keys(b))!=-1&&a.inArray("id",Object.keys(b))==-1&&(b.id=b.key);var c,f=a.extend({},k);this.height&&(f.minHeight=this.height),this.width&&(f.minWidth=this.width),f.zoom=this.zoom;var g=new google.maps.InfoWindow({size:new google.maps.Size(150,50)}),j=d;c=b?"string"==typeof b?j.getLocation(b):j.locationExists(b)?j.getLocation(b):n.createLocation(b):void 0,"undefined"==typeof c&&(console.log("NO LOCATION PASSED"),c=j.locationExists("default")?j.getLocation("default"):n.createDefaultLocation()),console.log("    initial location "+c.address),console.log("            marker : "+c.marker),j.initial_location=c.id,j.selected_location=c.id,f.center=this.map_center,this.map=new this.google.maps.Map(document.getElementById(e.map_element),f),console.log("    added map : "+this.map);var l=this;a.each(j.locations,function(a,b){console.log("    setting map for "+b.id),l.mappableLocation(b)}),this.google.maps.event.clearListeners(this.map,"url_changed"),console.log("    adding map click event listener to "+this.map),this.google.maps.event.addListener(this.map,"click",function(a){console.log("click event callback : "+a.toString()),g.close(),n.createLocation(a.latLng)}),this.google.maps.event.addListenerOnce(this.map,"tilesloaded",function(){i.zoomToMarkers(),i.createLegend()}),null!=this.map_bounds?(this.google.maps.event.addListener(this.map,"dragstart",function(){console.log("    adding 'center_changed' listener to "+i.map),i.google.maps.event.addListener(i.map,"center_changed",h)}),this.google.maps.event.addListener(this.map,"dragend",function(){console.log("    removing 'center_changed' listeners from "+i.map),i.google.maps.event.clearListeners(i.map,"center_changed")})):this.google.maps.event.addListener(this.map,"dragend",function(){i.map_center=i.map.getBounds().getCenter()}),this.google.maps.event.addListener(this.map,"zoom_changed",function(){i.map_center=i.map.getBounds().getCenter(),i.zoom=i.map.getZoom()});var m=[{lat:90,lng:-180},{lat:90,lng:-90},{lat:90,lng:0},{lat:90,lng:90},{lat:90,lng:180},{lat:45,lng:180},{lat:0,lng:180},{lat:-45,lng:180},{lat:-90,lng:180},{lat:-90,lng:90},{lat:-90,lng:0},{lat:-90,lng:-90},{lat:-90,lng:-180},{lat:-45,lng:-180},{lat:0,lng:-180},{lat:45,lng:-180},{lat:90,lng:-180}],o=[{lat:37.125,lng:-82.75},{lat:37.125,lng:-76.26},{lat:37.917945,lng:-76.30162},{lat:38.239992,lng:-76.989998},{lat:38.08326,lng:-76.32933},{lat:38.717615,lng:-76.542725},{lat:39.15,lng:-76.35},{lat:38.319215,lng:-76.23287},{lat:37.93705,lng:-75.72205},{lat:37.2566,lng:-76.03127},{lat:37.21689,lng:-75.94023},{lat:38.01551,lng:-75.37747},{lat:38.40412,lng:-75.05673},{lat:38.782032,lng:-75.071835},{lat:38.96,lng:-75.32},{lat:39.4985,lng:-75.52805},{lat:39.24845,lng:-75.20002},{lat:39.1964,lng:-74.98041},{lat:38.93954,lng:-74.90604},{lat:39.70926,lng:-74.17838},{lat:40.42763,lng:-73.96244},{lat:40.47351,lng:-74.25671},{lat:40.75075,lng:-73.952325},{lat:40.628,lng:-73.982},{lat:40.63,lng:-73.345},{lat:40.93,lng:-71.945},{lat:41.11948,lng:-72.24126},{lat:40.931102,lng:-73.71},{lat:41.22065,lng:-72.87643},{lat:41.27,lng:-72.295},{lat:41.32,lng:-71.86},{lat:41.49445,lng:-71.12039},{lat:41.475,lng:-70.64},{lat:41.63717,lng:-69.96503},{lat:41.92283,lng:-69.88497},{lat:42.145,lng:-70.185},{lat:41.78,lng:-70.08},{lat:41.805,lng:-70.495},{lat:42.335,lng:-70.82},{lat:42.8653,lng:-70.81489},{lat:43.090238,lng:-70.645476},{lat:43.68405,lng:-70.11617},{lat:43.98,lng:-69.06},{lat:44.3252,lng:-68.03252},{lat:44.8097,lng:-66.96466},{lat:45.13753,lng:-67.13741},{lat:45.70281,lng:-67.79134},{lat:47.06636,lng:-67.79046},{lat:47.35486,lng:-68.23444},{lat:47.185,lng:-68.905},{lat:47.447781,lng:-69.237216},{lat:46.69307,lng:-69.99997},{lat:45.915,lng:-70.305},{lat:45.46,lng:-70.66},{lat:45.30524,lng:-71.08482},{lat:45.255,lng:-71.405},{lat:45.0082,lng:-71.50506},{lat:45.00738,lng:-73.34783},{lat:45.00048,lng:-74.867},{lat:44.81645,lng:-75.31821},{lat:44.09631,lng:-76.375},{lat:44.018459,lng:-76.5},{lat:43.628784,lng:-76.820034},{lat:43.629056,lng:-77.737885},{lat:43.625089,lng:-78.72028},{lat:43.466339,lng:-79.171674},{lat:43.27,lng:-79.01},{lat:42.965,lng:-78.92},{lat:42.863611,lng:-78.939362},{lat:42.3662,lng:-80.247448},{lat:42.209026,lng:-81.277747},{lat:41.675105,lng:-82.439278},{lat:41.675105,lng:-82.690089}],p=new google.maps.Polygon({paths:[m,o],strokeColor:"#A9A9A9",strokeOpacity:.8,strokeWeight:2,fillColor:"#A9A9A9",fillOpacity:.35});p.setMap(i.map),this.google.maps.event.addListener(p,"click",function(a){g.close();var b="No data for this location";g.setContent(b),g.setPosition(a.latLng),g.open(i.map)}),this.createLegend(),console.log("    google map created ... "+this.map),null==this.geocoder&&(this.geocoder=new this.google.maps.Geocoder,console.log("    gecoder created")),a("#csftool-address-form-submit").on("click",function(){i.geocodeAddress(p)}),a("#csftool-address-form-text").keypress(function(a){if(13==a.which)return i.geocodeAddress(p),!1})},locAsLatLng:function(a){var b,c=d;return b="undefined"!=typeof a?a:null==c.selected_location?c.default_location:c.selected_location,new this.google.maps.LatLng(b.lat,b.lng)},mappableLocation:function(a){null==a.marker?n.createMarker(a):a.marker.setMap(i.map),null==a.infowindow&&n.createInfoWindow(a)},createLegend:function(){var b=a("#csftool-map-dialog-legend");b.length||(b=a('<div id="csftool-map-dialog-legend"></div>').appendTo(e.map_content));var c=['<div><img src="http://maps.google.com/mapfiles/ms/icons/red-dot.png">Selected</div>','<div><img src="http://maps.google.com/mapfiles/ms/icons/blue-dot.png">Saved</div>','<div><img src="http://maps.google.com/mapfiles/ms/icons/yellow-dot.png">Unsaved</div>'].join("");a("#csftool-map-dialog-legend").html(c),this.map.controls[this.google.maps.ControlPosition.RIGHT_BOTTOM].push(document.getElementById("csftool-map-dialog-legend"))},centerOnSelected:function(){i.map.setZoom(9);var a={lat:d.locations[d.selected_location].lat,lng:d.locations[d.selected_location].lng};i.map.setCenter(a)},zoomToMarkers:function(){var b=d,c=new this.google.maps.LatLngBounds;a.each(b.locations,function(a,b){c.extend(b.marker.getPosition())}),Object.keys(b.locations).length>1?(this.map.setCenter(c.getCenter()),this.google.maps.event.addListenerOnce(this.map,"bounds_changed",function(a){this.setZoom(this.getZoom()-1),this.getZoom()>k.maxZoom&&this.setZoom(k.maxZoom),this.getZoom()<k.minZoom&&this.setZoom(k.minZoom)}),this.map.fitBounds(c)):a.inArray(b.default_location.id,Object.keys(b.locations))==-1&&this.centerOnSelected()},open:function(b){return console.log("MAP DIALOG :: attempting to open MAP dialog"),this.isopen&&this.close(),1!=this.initialized&&this.initializeDialog(this.root_element),a(this.container).dialog("open"),this.initializeMap(b),this.isopen=!0,d.changed=!1,!1},removeCallback:function(a){a in this.callbacks&&delete this.callbacks[a]},setBounds:function(a,b,c,d){console.log("LOCATION DIALOG :: setting map bounds : "+a+","+b+" : "+c+","+d);var e=new this.google.maps.LatLng(a,b),f=new this.google.maps.LatLng(c,d);this.map_bounds=new this.google.maps.LatLngBounds(e,f),console.log("    bounds object : "+this.map_bounds)},setCallback:function(a,b){var c=this.supported_events.indexOf(a);c>=0&&(this.callbacks[a]=b)},setDimension:function(a,b){"height"==a?this.height=b:"width"==a&&(this.width=b)}},j={appendTo:e.map_anchor,autoOpen:!1,beforeClose:function(a,b){i.beforeClose()},close:function(a,b){i.afterClose()},draggable:!0,minHeight:400,minWidth:400,modal:!0,position:{my:"center center",at:"center center",of:e.center_map_on},resizable:!1,title:null,dialogClass:"csf-map-dialog"},k={backgroundColor:"white",center:null,disableDefaultUI:!0,disableDoubleClickZoom:!0,draggable:!0,enableAutocomplete:!1,mapTypeControl:!0,mapTypeControlOptions:null,mapTypeId:null,maxZoom:18,minZoom:6,scaleControl:!1,scrollwheel:!0,streetViewControl:!1,zoom:6,zoomControl:!0,zoomControlOptions:null},l={id:null,address:null,infowindow:null,lat:null,lng:null,marker:null},m={clickable:!0,draggable:!1,icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png",map:null,position:null,title:null},n={addLocation:function(b){var b=a.extend({},l,b);return b=this.createMarker(b),b=this.createInfoWindow(b),console.log("NEW LOCATION : "+b.address),d.saveLocation(b),b},addLocations:function(b){a.each(b,function(b,c){d.locations[b]=a.extend({},l,c)})},createDefaultLocation:function(){return this.createLocation(d.default_location)},createInfoWindow:function(a){var b,c;"undefined"!=typeof a.infowindow&&(c=a.infowindow,delete c,a.infowindow=null),b=function(a){console.log("for infowindow "+a.lat),console.log("for infowindow "+a.lng);var b=e.infobubble;b=b.replace("${loc_obj_lat}",a.lat.toFixed(5)),b=b.replace("${loc_obj_lng}",a.lng.toFixed(5));var c=a.address.indexOf(", USA");c>0&&(a.address=a.address.replace(", USA",""));var d=a.address.split(", ");if(d.length>1){var f;return f=e.infoaddress.replace("${address_component}",d[0]),f=f+"</br>"+e.infoaddress.replace("${address_component}",d.slice(1).join(", ")),b.replace("${loc_obj_address}",f)}return b.replace("${loc_obj_address}",a.address)}(a),c=new i.google.maps.InfoWindow({content:b}),a.infowindow=c;var d=a.marker;return d.addListener("mouseover",function(){c.open(i.map,d)}),d.addListener("mouseout",function(){c.close()}),a},createLocation:function(b){var c=a.extend({},l);if(!(b instanceof i.google.maps.LatLng)){var g=a.extend(c,b);return g=this.createMarker(g),g=this.createInfoWindow(g),d.saveLocation(g,!0),console.log("NEW LOCATION : "+g.address),g}console.log("creating map location from google.maps.LatLng"),c.lat=b.lat(),c.lng=b.lng();var e=function(a){var a=a;return function(b,c){c===i.google.maps.GeocoderStatus.OK&&b.length>0?a.address=b[0].formatted_address:a.address="Unable to decode lat/lng to physical address.",f.open(a)}}(c);i.geocoder.geocode({latLng:b},e)},createMarker:function(c){var g,h,e=i;return h=a.extend({},m),h.map=e.map,h.position=e.locAsLatLng(c),a.inArray(c.id,Object.keys(d.locations))==-1&&(h.icon="http://maps.google.com/mapfiles/ms/icons/yellow-dot.png"),d.selected_location==c.id&&(h.icon="http://maps.google.com/mapfiles/ms/icons/red-dot.png"),g=new e.google.maps.Marker(h),g.addListener("click",function(){f.open(c)}),c.marker=g,a.inArray(c.id,Object.keys(d.locations))==-1&&(b=a.extend({},c)),c}},o=function(){if(1==arguments.length){var b=arguments[0];switch(b){case"close":i.close();break;case"context":return d.publicContext();case"locations":return d.publicLocations();case"open":i.open();break;case"selected":return d.baseLocation("selected")}}else if(2==arguments.length){var c=arguments[0],e=arguments[1];switch(c){case"bind":var f=e;a.each(f,function(a,b){i.setCallback(a,b)});break;case"bounds":i.setBounds(e[0],e[1],e[2],e[3]);break;case"default":d.default_location=e;break;case"height":case"width":i.setDimension(c,e);break;case"google":console.log("OPTION :: setting Google API"),i.initializeGoogle(e);break;case"location":if("string"==typeof e)return d.getLocation(e);d.selectLocation(e);break;case"locations":return n.addLocations(e);case"open":i.open(e);break;case"title":i.setTitle(e)}}else if(3==arguments.length){if("bind"==arguments[0])i.setCallback(arguments[1],arguments[2]);else if("bounds"==arguments[0]){var g=arguments[1],h=arguments[2];i.setBounds(g[0],g[1],h[0],h[1])}}else 5==arguments.length&&"bounds"==arguments[0]&&i.setBounds(arguments[1],arguments[2],arguments[3],arguments[4])};a.fn.CsfToolLocationDialog=function(b){if("undefined"==typeof b){console.log("jQuery.fn.CsfToolLocationDialog :: initializing map dialog");var c=this.get(0);return d.initializeDialogs(c),o}a.each(b,function(a,b){o(a,b)})}}(jQuery);
