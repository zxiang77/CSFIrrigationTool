(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.reactVis=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){"use strict";function compare(a,b){if(a===b){return 0}var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y){return-1}if(y<x){return 1}return 0}function isBuffer(b){if(global.Buffer&&typeof global.Buffer.isBuffer==="function"){return global.Buffer.isBuffer(b)}return!!(b!=null&&b._isBuffer)}var util=require("util/");var hasOwn=Object.prototype.hasOwnProperty;var pSlice=Array.prototype.slice;var functionsHaveNames=function(){return function foo(){}.name==="foo"}();function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){if(isBuffer(arrbuf)){return false}if(typeof global.ArrayBuffer!=="function"){return false}if(typeof ArrayBuffer.isView==="function"){return ArrayBuffer.isView(arrbuf)}if(!arrbuf){return false}if(arrbuf instanceof DataView){return true}if(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer){return true}return false}var assert=module.exports=ok;var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(!util.isFunction(func)){return}if(functionsHaveNames){return func.name}var str=func.toString();var match=str.match(regex);return match&&match[1]}assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=getName(stackStartFunction);var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function truncate(s,n){if(typeof s==="string"){return s.length<n?s:s.slice(0,n)}else{return s}}function inspect(something){if(functionsHaveNames||!util.isFunction(something)){return util.inspect(something)}var rawname=getName(something);var name=rawname?": "+rawname:"";return"[Function"+name+"]"}function getMessage(self){return truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected,false)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};assert.deepStrictEqual=function deepStrictEqual(actual,expected,message){if(!_deepEqual(actual,expected,true)){fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)}};function _deepEqual(actual,expected,strict,memos){if(actual===expected){return true}else if(isBuffer(actual)&&isBuffer(expected)){return compare(actual,expected)===0}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if((actual===null||typeof actual!=="object")&&(expected===null||typeof expected!=="object")){return strict?actual===expected:actual==expected}else if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array)){return compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer))===0}else if(isBuffer(actual)!==isBuffer(expected)){return false}else{memos=memos||{actual:[],expected:[]};var actualIndex=memos.actual.indexOf(actual);if(actualIndex!==-1){if(actualIndex===memos.expected.indexOf(expected)){return true}}memos.actual.push(actual);memos.expected.push(expected);return objEquiv(actual,expected,strict,memos)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b,strict,actualVisitedObjects){if(a===null||a===undefined||b===null||b===undefined)return false;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return false;var aIsArgs=isArguments(a);var bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return false;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b,strict)}var ka=objectKeys(a);var kb=objectKeys(b);var key,i;if(ka.length!==kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!==kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected,false)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.notDeepStrictEqual=notDeepStrictEqual;function notDeepStrictEqual(actual,expected,message){if(_deepEqual(actual,expected,true)){fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)}}assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}try{if(actual instanceof expected){return true}}catch(e){}if(Error.isPrototypeOf(expected)){return false}return expected.call({},actual)===true}function _tryBlock(block){var error;try{block()}catch(e){error=e}return error}function _throws(shouldThrow,block,expected,message){var actual;if(typeof block!=="function"){throw new TypeError('"block" argument must be a function')}if(typeof expected==="string"){message=expected;expected=null}actual=_tryBlock(block);message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}var userProvidedMessage=typeof message==="string";var isUnwantedException=!shouldThrow&&util.isError(actual);var isUnexpectedException=!shouldThrow&&actual&&!expected;if(isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws(true,block,error,message)};assert.doesNotThrow=function(block,error,message){_throws(false,block,error,message)};assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}return keys}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"util/":300}],2:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],3:[function(require,module,exports){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError("Invalid typed array length")}var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(value instanceof ArrayBuffer){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(value,encodingOrOffset)}return fromObject(value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj){if(isArrayBufferView(obj)||"length"in obj){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(isArrayBufferView(string)||string instanceof ArrayBuffer){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds')
;if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:new Buffer(val,encoding);var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isArrayBufferView(obj){return typeof ArrayBuffer.isView==="function"&&ArrayBuffer.isView(obj)}function numberIsNaN(obj){return obj!==obj}},{"base64-js":2,ieee754:155}],4:[function(require,module,exports){(function(process){"use strict";var _assign=require("object-assign");var emptyObject=require("fbjs/lib/emptyObject");var _invariant=require("fbjs/lib/invariant");if(process.env.NODE_ENV!=="production"){var warning=require("fbjs/lib/warning")}var MIXINS_KEY="mixins";function identity(fn){return fn}var ReactPropTypeLocationNames;if(process.env.NODE_ENV!=="production"){ReactPropTypeLocationNames={prop:"prop",context:"context",childContext:"child context"}}else{ReactPropTypeLocationNames={}}function factory(ReactComponent,isValidElement,ReactNoopUpdateQueue){var injectedMixins=[];var ReactClassInterface={mixins:"DEFINE_MANY",statics:"DEFINE_MANY",propTypes:"DEFINE_MANY",contextTypes:"DEFINE_MANY",childContextTypes:"DEFINE_MANY",getDefaultProps:"DEFINE_MANY_MERGED",getInitialState:"DEFINE_MANY_MERGED",getChildContext:"DEFINE_MANY_MERGED",render:"DEFINE_ONCE",componentWillMount:"DEFINE_MANY",componentDidMount:"DEFINE_MANY",componentWillReceiveProps:"DEFINE_MANY",shouldComponentUpdate:"DEFINE_ONCE",componentWillUpdate:"DEFINE_MANY",componentDidUpdate:"DEFINE_MANY",componentWillUnmount:"DEFINE_MANY",updateComponent:"OVERRIDE_BASE"};var RESERVED_SPEC_KEYS={displayName:function(Constructor,displayName){Constructor.displayName=displayName},mixins:function(Constructor,mixins){if(mixins){for(var i=0;i<mixins.length;i++){mixSpecIntoComponent(Constructor,mixins[i])}}},childContextTypes:function(Constructor,childContextTypes){if(process.env.NODE_ENV!=="production"){validateTypeDef(Constructor,childContextTypes,"childContext")}Constructor.childContextTypes=_assign({},Constructor.childContextTypes,childContextTypes)},contextTypes:function(Constructor,contextTypes){if(process.env.NODE_ENV!=="production"){validateTypeDef(Constructor,contextTypes,"context")}Constructor.contextTypes=_assign({},Constructor.contextTypes,contextTypes)},getDefaultProps:function(Constructor,getDefaultProps){if(Constructor.getDefaultProps){Constructor.getDefaultProps=createMergedResultFunction(Constructor.getDefaultProps,getDefaultProps)}else{Constructor.getDefaultProps=getDefaultProps}},propTypes:function(Constructor,propTypes){if(process.env.NODE_ENV!=="production"){validateTypeDef(Constructor,propTypes,"prop")}Constructor.propTypes=_assign({},Constructor.propTypes,propTypes)},statics:function(Constructor,statics){mixStaticSpecIntoComponent(Constructor,statics)},autobind:function(){}};function validateTypeDef(Constructor,typeDef,location){for(var propName in typeDef){if(typeDef.hasOwnProperty(propName)){process.env.NODE_ENV!=="production"?warning(typeof typeDef[propName]==="function","%s: %s type `%s` is invalid; it must be a function, usually from "+"React.PropTypes.",Constructor.displayName||"ReactClass",ReactPropTypeLocationNames[location],propName):void 0}}}function validateMethodOverride(isAlreadyDefined,name){var specPolicy=ReactClassInterface.hasOwnProperty(name)?ReactClassInterface[name]:null;if(ReactClassMixin.hasOwnProperty(name)){_invariant(specPolicy==="OVERRIDE_BASE","ReactClassInterface: You are attempting to override "+"`%s` from your class specification. Ensure that your method names "+"do not overlap with React methods.",name)}if(isAlreadyDefined){_invariant(specPolicy==="DEFINE_MANY"||specPolicy==="DEFINE_MANY_MERGED","ReactClassInterface: You are attempting to define "+"`%s` on your component more than once. This conflict may be due "+"to a mixin.",name)}}function mixSpecIntoComponent(Constructor,spec){if(!spec){if(process.env.NODE_ENV!=="production"){var typeofSpec=typeof spec;var isMixinValid=typeofSpec==="object"&&spec!==null;process.env.NODE_ENV!=="production"?warning(isMixinValid,"%s: You're attempting to include a mixin that is either null "+"or not an object. Check the mixins included by the component, "+"as well as any mixins they include themselves. "+"Expected object but got %s.",Constructor.displayName||"ReactClass",spec===null?null:typeofSpec):void 0}return}_invariant(typeof spec!=="function","ReactClass: You're attempting to "+"use a component class or function as a mixin. Instead, just use a "+"regular object.");_invariant(!isValidElement(spec),"ReactClass: You're attempting to "+"use a component as a mixin. Instead, just use a regular object.");var proto=Constructor.prototype;var autoBindPairs=proto.__reactAutoBindPairs;if(spec.hasOwnProperty(MIXINS_KEY)){RESERVED_SPEC_KEYS.mixins(Constructor,spec.mixins)}for(var name in spec){if(!spec.hasOwnProperty(name)){continue}if(name===MIXINS_KEY){continue}var property=spec[name];var isAlreadyDefined=proto.hasOwnProperty(name);validateMethodOverride(isAlreadyDefined,name);if(RESERVED_SPEC_KEYS.hasOwnProperty(name)){RESERVED_SPEC_KEYS[name](Constructor,property)}else{var isReactClassMethod=ReactClassInterface.hasOwnProperty(name);var isFunction=typeof property==="function";var shouldAutoBind=isFunction&&!isReactClassMethod&&!isAlreadyDefined&&spec.autobind!==false;if(shouldAutoBind){autoBindPairs.push(name,property);proto[name]=property}else{if(isAlreadyDefined){var specPolicy=ReactClassInterface[name];_invariant(isReactClassMethod&&(specPolicy==="DEFINE_MANY_MERGED"||specPolicy==="DEFINE_MANY"),"ReactClass: Unexpected spec policy %s for key %s "+"when mixing in component specs.",specPolicy,name);if(specPolicy==="DEFINE_MANY_MERGED"){proto[name]=createMergedResultFunction(proto[name],property)}else if(specPolicy==="DEFINE_MANY"){proto[name]=createChainedFunction(proto[name],property)}}else{proto[name]=property;if(process.env.NODE_ENV!=="production"){if(typeof property==="function"&&spec.displayName){proto[name].displayName=spec.displayName+"_"+name}}}}}}}function mixStaticSpecIntoComponent(Constructor,statics){if(!statics){return}for(var name in statics){var property=statics[name];if(!statics.hasOwnProperty(name)){continue}var isReserved=name in RESERVED_SPEC_KEYS;_invariant(!isReserved,"ReactClass: You are attempting to define a reserved "+'property, `%s`, that shouldn\'t be on the "statics" key. Define it '+"as an instance property instead; it will still be accessible on the "+"constructor.",name);var isInherited=name in Constructor;_invariant(!isInherited,"ReactClass: You are attempting to define "+"`%s` on your component more than once. This conflict may be "+"due to a mixin.",name);Constructor[name]=property}}function mergeIntoWithNoDuplicateKeys(one,two){_invariant(one&&two&&typeof one==="object"&&typeof two==="object","mergeIntoWithNoDuplicateKeys(): Cannot merge non-objects.");for(var key in two){if(two.hasOwnProperty(key)){_invariant(one[key]===undefined,"mergeIntoWithNoDuplicateKeys(): "+"Tried to merge two objects with the same key: `%s`. This conflict "+"may be due to a mixin; in particular, this may be caused by two "+"getInitialState() or getDefaultProps() methods returning objects "+"with clashing keys.",key);one[key]=two[key]}}return one}function createMergedResultFunction(one,two){return function mergedResult(){var a=one.apply(this,arguments);var b=two.apply(this,arguments);if(a==null){return b}else if(b==null){return a}var c={};mergeIntoWithNoDuplicateKeys(c,a);mergeIntoWithNoDuplicateKeys(c,b);return c}}function createChainedFunction(one,two){return function chainedFunction(){one.apply(this,arguments);two.apply(this,arguments)}}function bindAutoBindMethod(component,method){var boundMethod=method.bind(component);if(process.env.NODE_ENV!=="production"){boundMethod.__reactBoundContext=component;boundMethod.__reactBoundMethod=method;boundMethod.__reactBoundArguments=null;var componentName=component.constructor.displayName;var _bind=boundMethod.bind;boundMethod.bind=function(newThis){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}if(newThis!==component&&newThis!==null){process.env.NODE_ENV!=="production"?warning(false,"bind(): React component methods may only be bound to the "+"component instance. See %s",componentName):void 0}else if(!args.length){process.env.NODE_ENV!=="production"?warning(false,"bind(): You are binding a component method to the component. "+"React does this for you automatically in a high-performance "+"way, so you can safely remove this call. See %s",componentName):void 0;return boundMethod}var reboundMethod=_bind.apply(boundMethod,arguments);reboundMethod.__reactBoundContext=component;reboundMethod.__reactBoundMethod=method;reboundMethod.__reactBoundArguments=args;return reboundMethod}}return boundMethod}function bindAutoBindMethods(component){var pairs=component.__reactAutoBindPairs;for(var i=0;i<pairs.length;i+=2){var autoBindKey=pairs[i];var method=pairs[i+1];component[autoBindKey]=bindAutoBindMethod(component,method)}}var IsMountedMixin={componentDidMount:function(){this.__isMounted=true},componentWillUnmount:function(){this.__isMounted=false}};var ReactClassMixin={replaceState:function(newState,callback){this.updater.enqueueReplaceState(this,newState,callback)},isMounted:function(){if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(this.__didWarnIsMounted,"%s: isMounted is deprecated. Instead, make sure to clean up "+"subscriptions and pending requests in componentWillUnmount to "+"prevent memory leaks.",this.constructor&&this.constructor.displayName||this.name||"Component"):void 0;this.__didWarnIsMounted=true}return!!this.__isMounted}};var ReactClassComponent=function(){};_assign(ReactClassComponent.prototype,ReactComponent.prototype,ReactClassMixin);function createClass(spec){var Constructor=identity(function(props,context,updater){if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(this instanceof Constructor,"Something is calling a React component directly. Use a factory or "+"JSX instead. See: https://fb.me/react-legacyfactory"):void 0}if(this.__reactAutoBindPairs.length){bindAutoBindMethods(this)}this.props=props;this.context=context;this.refs=emptyObject;this.updater=updater||ReactNoopUpdateQueue;this.state=null;var initialState=this.getInitialState?this.getInitialState():null;if(process.env.NODE_ENV!=="production"){if(initialState===undefined&&this.getInitialState._isMockFunction){initialState=null}}_invariant(typeof initialState==="object"&&!Array.isArray(initialState),"%s.getInitialState(): must return an object or null",Constructor.displayName||"ReactCompositeComponent");this.state=initialState});Constructor.prototype=new ReactClassComponent;Constructor.prototype.constructor=Constructor;Constructor.prototype.__reactAutoBindPairs=[];injectedMixins.forEach(mixSpecIntoComponent.bind(null,Constructor));mixSpecIntoComponent(Constructor,IsMountedMixin);mixSpecIntoComponent(Constructor,spec);if(Constructor.getDefaultProps){Constructor.defaultProps=Constructor.getDefaultProps()}if(process.env.NODE_ENV!=="production"){if(Constructor.getDefaultProps){Constructor.getDefaultProps.isReactClassApproved={}}if(Constructor.prototype.getInitialState){Constructor.prototype.getInitialState.isReactClassApproved={}}}_invariant(Constructor.prototype.render,"createClass(...): Class specification must implement a `render` method.");if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(!Constructor.prototype.componentShouldUpdate,"%s has a method called "+"componentShouldUpdate(). Did you mean shouldComponentUpdate()? "+"The name is phrased as a question because the function is "+"expected to return a value.",spec.displayName||"A component"):void 0;process.env.NODE_ENV!=="production"?warning(!Constructor.prototype.componentWillRecieveProps,"%s has a method called "+"componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",spec.displayName||"A component"):void 0}for(var methodName in ReactClassInterface){if(!Constructor.prototype[methodName]){Constructor.prototype[methodName]=null}}return Constructor}return createClass}module.exports=factory}).call(this,require("_process"))},{_process:252,"fbjs/lib/emptyObject":139,"fbjs/lib/invariant":140,"fbjs/lib/warning":142,"object-assign":249}],5:[function(require,module,exports){"use strict";var React=require("react");var factory=require("./factory");var ReactNoopUpdateQueue=(new React.Component).updater;module.exports=factory(React.Component,React.isValidElement,ReactNoopUpdateQueue)},{"./factory":4,react:297}],6:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var ascending=function(a,b){return a<b?-1:a>b?1:a>=b?0:NaN};var bisector=function(compare){if(compare.length===1)compare=ascendingComparator(compare);return{left:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid}return lo},right:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1}return lo}}};function ascendingComparator(f){return function(d,x){return ascending(f(d),x)}}var ascendingBisect=bisector(ascending);var bisectRight=ascendingBisect.right;var bisectLeft=ascendingBisect.left;var pairs=function(array,f){if(f==null)f=pair;var i=0,n=array.length-1,p=array[0],pairs=new Array(n<0?0:n);while(i<n)pairs[i]=f(p,p=array[++i]);return pairs};function pair(a,b){return[a,b]}var cross=function(values0,values1,reduce){var n0=values0.length,n1=values1.length,values=new Array(n0*n1),i0,i1,i,value0;if(reduce==null)reduce=pair;for(i0=i=0;i0<n0;++i0){for(value0=values0[i0],i1=0;i1<n1;++i1,++i){values[i]=reduce(value0,values1[i1])}}return values};var descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN};var number=function(x){return x===null?NaN:+x};var variance=function(values,valueof){var n=values.length,m=0,i=-1,mean=0,value,delta,sum=0;if(valueof==null){while(++i<n){if(!isNaN(value=number(values[i]))){delta=value-mean;mean+=delta/++m;sum+=delta*(value-mean)}}}else{while(++i<n){if(!isNaN(value=number(valueof(values[i],i,values)))){delta=value-mean;mean+=delta/++m;sum+=delta*(value-mean)}}}if(m>1)return sum/(m-1)};var deviation=function(array,f){var v=variance(array,f);return v?Math.sqrt(v):v};var extent=function(values,valueof){var n=values.length,i=-1,value,min,max;if(valueof==null){while(++i<n){if((value=values[i])!=null&&value>=value){min=max=value;while(++i<n){if((value=values[i])!=null){if(min>value)min=value;if(max<value)max=value}}}}}else{while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>=value){min=max=value;while(++i<n){if((value=valueof(values[i],i,values))!=null){if(min>value)min=value;if(max<value)max=value}}}}}return[min,max]};var array=Array.prototype;var slice=array.slice;var map=array.map;var constant=function(x){return function(){return x}};var identity=function(x){return x};var range=function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;var i=-1,n=Math.max(0,Math.ceil((stop-start)/step))|0,range=new Array(n);while(++i<n){range[i]=start+i*step}return range};var e10=Math.sqrt(50);var e5=Math.sqrt(10);var e2=Math.sqrt(2);var ticks=function(start,stop,count){var reverse=stop<start,i=-1,n,ticks,step;if(reverse)n=start,start=stop,stop=n;if((step=tickIncrement(start,stop,count))===0||!isFinite(step))return[];if(step>0){start=Math.ceil(start/step);stop=Math.floor(stop/step);ticks=new Array(n=Math.ceil(stop-start+1));while(++i<n)ticks[i]=(start+i)*step}else{start=Math.floor(start*step);stop=Math.ceil(stop*step);ticks=new Array(n=Math.ceil(start-stop+1));while(++i<n)ticks[i]=(start-i)/step}if(reverse)ticks.reverse();return ticks};function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function tickStep(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;if(error>=e10)step1*=10;else if(error>=e5)step1*=5;else if(error>=e2)step1*=2;return stop<start?-step1:step1}var sturges=function(values){return Math.ceil(Math.log(values.length)/Math.LN2)+1};var histogram=function(){var value=identity,domain=extent,threshold=sturges;function histogram(data){var i,n=data.length,x,values=new Array(n);for(i=0;i<n;++i){values[i]=value(data[i],i,data)}var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);if(!Array.isArray(tz)){tz=tickStep(x0,x1,tz);tz=range(Math.ceil(x0/tz)*tz,Math.floor(x1/tz)*tz,tz)}var m=tz.length;while(tz[0]<=x0)tz.shift(),--m;while(tz[m-1]>x1)tz.pop(),--m;var bins=new Array(m+1),bin;for(i=0;i<=m;++i){bin=bins[i]=[];bin.x0=i>0?tz[i-1]:x0;bin.x1=i<m?tz[i]:x1}for(i=0;i<n;++i){x=values[i];if(x0<=x&&x<=x1){bins[bisectRight(tz,x,0,m)].push(data[i])}}return bins}histogram.value=function(_){return arguments.length?(value=typeof _==="function"?_:constant(_),histogram):value};histogram.domain=function(_){return arguments.length?(domain=typeof _==="function"?_:constant([_[0],_[1]]),histogram):domain};histogram.thresholds=function(_){return arguments.length?(threshold=typeof _==="function"?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold};return histogram};var quantile=function(values,p,valueof){if(valueof==null)valueof=number;if(!(n=values.length))return;if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values),value1=+valueof(values[i0+1],i0+1,values);return value0+(value1-value0)*(i-i0)};var freedmanDiaconis=function(values,min,max){values=map.call(values,number).sort(ascending);return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(values.length,-1/3)))};var scott=function(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(values.length,-1/3)))};var max=function(values,valueof){var n=values.length,i=-1,value,max;if(valueof==null){while(++i<n){if((value=values[i])!=null&&value>=value){max=value;while(++i<n){if((value=values[i])!=null&&value>max){max=value}}}}}else{while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>=value){max=value;while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>max){max=value}}}}}return max};var mean=function(values,valueof){var n=values.length,m=n,i=-1,value,sum=0;if(valueof==null){while(++i<n){if(!isNaN(value=number(values[i])))sum+=value;else--m}}else{while(++i<n){if(!isNaN(value=number(valueof(values[i],i,values))))sum+=value;else--m}}if(m)return sum/m};var median=function(values,valueof){var n=values.length,i=-1,value,numbers=[];if(valueof==null){while(++i<n){if(!isNaN(value=number(values[i]))){numbers.push(value)}}}else{while(++i<n){if(!isNaN(value=number(valueof(values[i],i,values)))){numbers.push(value)}}}return quantile(numbers.sort(ascending),.5)};var merge=function(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m]}}return merged};var min=function(values,valueof){var n=values.length,i=-1,value,min;if(valueof==null){while(++i<n){if((value=values[i])!=null&&value>=value){min=value;while(++i<n){if((value=values[i])!=null&&min>value){min=value}}}}}else{while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>=value){min=value;while(++i<n){if((value=valueof(values[i],i,values))!=null&&min>value){min=value}}}}}return min};var permute=function(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes};var scan=function(values,compare){if(!(n=values.length))return;var n,i=0,j=0,xi,xj=values[j];if(compare==null)compare=ascending;while(++i<n){if(compare(xi=values[i],xj)<0||compare(xj,xj)!==0){xj=xi,j=i}}if(compare(xj,xj)===0)return j};var shuffle=function(array,i0,i1){var m=(i1==null?array.length:i1)-(i0=i0==null?0:+i0),t,i;while(m){i=Math.random()*m--|0;t=array[m+i0];array[m+i0]=array[i+i0];array[i+i0]=t}return array};var sum=function(values,valueof){var n=values.length,i=-1,value,sum=0;if(valueof==null){while(++i<n){if(value=+values[i])sum+=value}}else{while(++i<n){if(value=+valueof(values[i],i,values))sum+=value}}return sum};var transpose=function(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length),transpose=new Array(m);++i<m;){for(var j=-1,n,row=transpose[i]=new Array(n);++j<n;){row[j]=matrix[j][i]}}return transpose};function length(d){return d.length}var zip=function(){return transpose(arguments)};exports.bisect=bisectRight;exports.bisectRight=bisectRight;exports.bisectLeft=bisectLeft;exports.ascending=ascending;exports.bisector=bisector;exports.cross=cross;exports.descending=descending;exports.deviation=deviation;exports.extent=extent;exports.histogram=histogram;exports.thresholdFreedmanDiaconis=freedmanDiaconis;exports.thresholdScott=scott;exports.thresholdSturges=sturges;exports.max=max;exports.mean=mean;exports.median=median;exports.merge=merge;exports.min=min;exports.pairs=pairs;exports.permute=permute;exports.quantile=quantile;exports.range=range;exports.scan=scan;exports.shuffle=shuffle;exports.sum=sum;exports.ticks=ticks;exports.tickIncrement=tickIncrement;exports.tickStep=tickStep;exports.transpose=transpose;exports.variance=variance;exports.zip=zip;Object.defineProperty(exports,"__esModule",{value:true})})},{}],7:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var prefix="$";function Map(){}Map.prototype=map.prototype={constructor:Map,has:function(key){return prefix+key in this},get:function(key){return this[prefix+key]},set:function(key,value){this[prefix+key]=value;return this},remove:function(key){var property=prefix+key;return property in this&&delete this[property]},clear:function(){for(var property in this)if(property[0]===prefix)delete this[property]},keys:function(){var keys=[];for(var property in this)if(property[0]===prefix)keys.push(property.slice(1));return keys},values:function(){var values=[];for(var property in this)if(property[0]===prefix)values.push(this[property]);return values},entries:function(){var entries=[];for(var property in this)if(property[0]===prefix)entries.push({key:property.slice(1),value:this[property]});return entries},size:function(){var size=0
;for(var property in this)if(property[0]===prefix)++size;return size},empty:function(){for(var property in this)if(property[0]===prefix)return false;return true},each:function(f){for(var property in this)if(property[0]===prefix)f(this[property],property.slice(1),this)}};function map(object,f){var map=new Map;if(object instanceof Map)object.each(function(value,key){map.set(key,value)});else if(Array.isArray(object)){var i=-1,n=object.length,o;if(f==null)while(++i<n)map.set(i,object[i]);else while(++i<n)map.set(f(o=object[i],i,object),o)}else if(object)for(var key in object)map.set(key,object[key]);return map}var nest=function(){var keys=[],sortKeys=[],sortValues,rollup,nest;function apply(array,depth,createResult,setResult){if(depth>=keys.length)return rollup!=null?rollup(array):sortValues!=null?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,value,valuesByKey=map(),values,result=createResult();while(++i<n){if(values=valuesByKey.get(keyValue=key(value=array[i])+"")){values.push(value)}else{valuesByKey.set(keyValue,[value])}}valuesByKey.each(function(values,key){setResult(result,key,apply(values,depth,createResult,setResult))});return result}function entries(map$$1,depth){if(++depth>keys.length)return map$$1;var array,sortKey=sortKeys[depth-1];if(rollup!=null&&depth>=keys.length)array=map$$1.entries();else array=[],map$$1.each(function(v,k){array.push({key:k,values:entries(v,depth)})});return sortKey!=null?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}return nest={object:function(array){return apply(array,0,createObject,setObject)},map:function(array){return apply(array,0,createMap,setMap)},entries:function(array){return entries(apply(array,0,createMap,setMap),0)},key:function(d){keys.push(d);return nest},sortKeys:function(order){sortKeys[keys.length-1]=order;return nest},sortValues:function(order){sortValues=order;return nest},rollup:function(f){rollup=f;return nest}}};function createObject(){return{}}function setObject(object,key,value){object[key]=value}function createMap(){return map()}function setMap(map$$1,key,value){map$$1.set(key,value)}function Set(){}var proto=map.prototype;Set.prototype=set.prototype={constructor:Set,has:proto.has,add:function(value){value+="";this[prefix+value]=value;return this},remove:proto.remove,clear:proto.clear,values:proto.keys,size:proto.size,empty:proto.empty,each:proto.each};function set(object,f){var set=new Set;if(object instanceof Set)object.each(function(value){set.add(value)});else if(object){var i=-1,n=object.length;if(f==null)while(++i<n)set.add(object[i]);else while(++i<n)set.add(f(object[i],i,object))}return set}var keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys};var values=function(map){var values=[];for(var key in map)values.push(map[key]);return values};var entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries};exports.nest=nest;exports.set=set;exports.map=map;exports.keys=keys;exports.values=values;exports.entries=entries;Object.defineProperty(exports,"__esModule",{value:true})})},{}],8:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var define=function(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype;prototype.constructor=constructor};function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}var darker=.7;var brighter=1/darker;var reI="\\s*([+-]?\\d+)\\s*";var reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*";var reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*";var reHex3=/^#([0-9a-f]{3})$/;var reHex6=/^#([0-9a-f]{6})$/;var reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$");var reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$");var reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$");var reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$");var reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$");var reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$");var named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color,color,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}});function color(format){var m;format=(format+"").trim().toLowerCase();return(m=reHex3.exec(format))?(m=parseInt(m[1],16),new Rgb(m>>8&15|m>>4&240,m>>4&15|m&240,(m&15)<<4|m&15,1)):(m=reHex6.exec(format))?rgbn(parseInt(m[1],16)):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(m[1]*255/100,m[2]*255/100,m[3]*255/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(m[1]*255/100,m[2]*255/100,m[3]*255/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):format==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,n&255,1)}function rgba(r,g,b,a){if(a<=0)r=g=b=NaN;return new Rgb(r,g,b,a)}function rgbConvert(o){if(!(o instanceof Color))o=color(o);if(!o)return new Rgb;o=o.rgb();return new Rgb(o.r,o.g,o.b,o.opacity)}function rgb(r,g,b,opacity){return arguments.length===1?rgbConvert(r):new Rgb(r,g,b,opacity==null?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r;this.g=+g;this.b=+b;this.opacity=+opacity}define(Rgb,rgb,extend(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&(0<=this.g&&this.g<=255)&&(0<=this.b&&this.b<=255)&&(0<=this.opacity&&this.opacity<=1)},toString:function(){var a=this.opacity;a=isNaN(a)?1:Math.max(0,Math.min(1,a));return(a===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(a===1?")":", "+a+")")}}));function hsla(h,s,l,a){if(a<=0)h=s=l=NaN;else if(l<=0||l>=1)h=s=NaN;else if(s<=0)h=NaN;return new Hsl(h,s,l,a)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(!(o instanceof Color))o=color(o);if(!o)return new Hsl;if(o instanceof Hsl)return o;o=o.rgb();var r=o.r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;if(s){if(r===max)h=(g-b)/s+(g<b)*6;else if(g===max)h=(b-r)/s+2;else h=(r-g)/s+4;s/=l<.5?max+min:2-max-min;h*=60}else{s=l>0&&l<1?0:h}return new Hsl(h,s,l,o.opacity)}function hsl(h,s,l,opacity){return arguments.length===1?hslConvert(h):new Hsl(h,s,l,opacity==null?1:opacity)}function Hsl(h,s,l,opacity){this.h=+h;this.s=+s;this.l=+l;this.opacity=+opacity}define(Hsl,hsl,extend(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=this.h%360+(this.h<0)*360,s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&(0<=this.l&&this.l<=1)&&(0<=this.opacity&&this.opacity<=1)}}));function hsl2rgb(h,m1,m2){return(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)*255}var deg2rad=Math.PI/180;var rad2deg=180/Math.PI;var Kn=18;var Xn=.95047;var Yn=1;var Zn=1.08883;var t0=4/29;var t1=6/29;var t2=3*t1*t1;var t3=t1*t1*t1;function labConvert(o){if(o instanceof Lab)return new Lab(o.l,o.a,o.b,o.opacity);if(o instanceof Hcl){var h=o.h*deg2rad;return new Lab(o.l,Math.cos(h)*o.c,Math.sin(h)*o.c,o.opacity)}if(!(o instanceof Rgb))o=rgbConvert(o);var b=rgb2xyz(o.r),a=rgb2xyz(o.g),l=rgb2xyz(o.b),x=xyz2lab((.4124564*b+.3575761*a+.1804375*l)/Xn),y=xyz2lab((.2126729*b+.7151522*a+.072175*l)/Yn),z=xyz2lab((.0193339*b+.119192*a+.9503041*l)/Zn);return new Lab(116*y-16,500*(x-y),200*(y-z),o.opacity)}function lab(l,a,b,opacity){return arguments.length===1?labConvert(l):new Lab(l,a,b,opacity==null?1:opacity)}function Lab(l,a,b,opacity){this.l=+l;this.a=+a;this.b=+b;this.opacity=+opacity}define(Lab,lab,extend(Color,{brighter:function(k){return new Lab(this.l+Kn*(k==null?1:k),this.a,this.b,this.opacity)},darker:function(k){return new Lab(this.l-Kn*(k==null?1:k),this.a,this.b,this.opacity)},rgb:function(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;y=Yn*lab2xyz(y);x=Xn*lab2xyz(x);z=Zn*lab2xyz(z);return new Rgb(xyz2rgb(3.2404542*x-1.5371385*y-.4985314*z),xyz2rgb(-.969266*x+1.8760108*y+.041556*z),xyz2rgb(.0556434*x-.2040259*y+1.0572252*z),this.opacity)}}));function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+t0}function lab2xyz(t){return t>t1?t*t*t:t2*(t-t0)}function xyz2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2xyz(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hclConvert(o){if(o instanceof Hcl)return new Hcl(o.h,o.c,o.l,o.opacity);if(!(o instanceof Lab))o=labConvert(o);var h=Math.atan2(o.b,o.a)*rad2deg;return new Hcl(h<0?h+360:h,Math.sqrt(o.a*o.a+o.b*o.b),o.l,o.opacity)}function hcl(h,c,l,opacity){return arguments.length===1?hclConvert(h):new Hcl(h,c,l,opacity==null?1:opacity)}function Hcl(h,c,l,opacity){this.h=+h;this.c=+c;this.l=+l;this.opacity=+opacity}define(Hcl,hcl,extend(Color,{brighter:function(k){return new Hcl(this.h,this.c,this.l+Kn*(k==null?1:k),this.opacity)},darker:function(k){return new Hcl(this.h,this.c,this.l-Kn*(k==null?1:k),this.opacity)},rgb:function(){return labConvert(this).rgb()}}));var A=-.14861;var B=+1.78277;var C=-.29227;var D=-.90649;var E=+1.97294;var ED=E*D;var EB=E*B;var BC_DA=B*C-D*A;function cubehelixConvert(o){if(o instanceof Cubehelix)return new Cubehelix(o.h,o.s,o.l,o.opacity);if(!(o instanceof Rgb))o=rgbConvert(o);var r=o.r/255,g=o.g/255,b=o.b/255,l=(BC_DA*b+ED*r-EB*g)/(BC_DA+ED-EB),bl=b-l,k=(E*(g-l)-C*bl)/D,s=Math.sqrt(k*k+bl*bl)/(E*l*(1-l)),h=s?Math.atan2(k,bl)*rad2deg-120:NaN;return new Cubehelix(h<0?h+360:h,s,l,o.opacity)}function cubehelix(h,s,l,opacity){return arguments.length===1?cubehelixConvert(h):new Cubehelix(h,s,l,opacity==null?1:opacity)}function Cubehelix(h,s,l,opacity){this.h=+h;this.s=+s;this.l=+l;this.opacity=+opacity}define(Cubehelix,cubehelix,extend(Color,{brighter:function(k){k=k==null?brighter:Math.pow(brighter,k);return new Cubehelix(this.h,this.s,this.l*k,this.opacity)},darker:function(k){k=k==null?darker:Math.pow(darker,k);return new Cubehelix(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=isNaN(this.h)?0:(this.h+120)*deg2rad,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(h),sinh=Math.sin(h);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+D*sinh)),255*(l+a*(E*cosh)),this.opacity)}}));exports.color=color;exports.rgb=rgb;exports.hsl=hsl;exports.lab=lab;exports.hcl=hcl;exports.cubehelix=cubehelix;Object.defineProperty(exports,"__esModule",{value:true})})},{}],9:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var formatDecimal=function(x,p){if((i=(x=p?x.toExponential(p-1):x.toExponential()).indexOf("e"))<0)return null;var i,coefficient=x.slice(0,i);return[coefficient.length>1?coefficient[0]+coefficient.slice(2):coefficient,+x.slice(i+1)]};var exponent=function(x){return x=formatDecimal(Math.abs(x)),x?x[1]:NaN};var formatGroup=function(grouping,thousands){return function(value,width){var i=value.length,t=[],j=0,g=grouping[0],length=0;while(i>0&&g>0){if(length+g+1>width)g=Math.max(1,width-length);t.push(value.substring(i-=g,i+g));if((length+=g+1)>width)break;g=grouping[j=(j+1)%grouping.length]}return t.reverse().join(thousands)}};var formatNumerals=function(numerals){return function(value){return value.replace(/[0-9]/g,function(i){return numerals[+i]})}};var formatDefault=function(x,p){x=x.toPrecision(p);out:for(var n=x.length,i=1,i0=-1,i1;i<n;++i){switch(x[i]){case".":i0=i1=i;break;case"0":if(i0===0)i0=i;i1=i;break;case"e":break out;default:if(i0>0)i0=0;break}}return i0>0?x.slice(0,i0)+x.slice(i1+1):x};var prefixExponent;var formatPrefixAuto=function(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1],i=exponent-(prefixExponent=Math.max(-8,Math.min(8,Math.floor(exponent/3)))*3)+1,n=coefficient.length;return i===n?coefficient:i>n?coefficient+new Array(i-n+1).join("0"):i>0?coefficient.slice(0,i)+"."+coefficient.slice(i):"0."+new Array(1-i).join("0")+formatDecimal(x,Math.max(0,p+i-1))[0]};var formatRounded=function(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1];return exponent<0?"0."+new Array(-exponent).join("0")+coefficient:coefficient.length>exponent+1?coefficient.slice(0,exponent+1)+"."+coefficient.slice(exponent+1):coefficient+new Array(exponent-coefficient.length+2).join("0")};var formatTypes={"":formatDefault,"%":function(x,p){return(x*100).toFixed(p)},b:function(x){return Math.round(x).toString(2)},c:function(x){return x+""},d:function(x){return Math.round(x).toString(10)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},g:function(x,p){return x.toPrecision(p)},o:function(x){return Math.round(x).toString(8)},p:function(x,p){return formatRounded(x*100,p)},r:formatRounded,s:formatPrefixAuto,X:function(x){return Math.round(x).toString(16).toUpperCase()},x:function(x){return Math.round(x).toString(16)}};var re=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i;function formatSpecifier(specifier){return new FormatSpecifier(specifier)}formatSpecifier.prototype=FormatSpecifier.prototype;function FormatSpecifier(specifier){if(!(match=re.exec(specifier)))throw new Error("invalid format: "+specifier);var match,fill=match[1]||" ",align=match[2]||">",sign=match[3]||"-",symbol=match[4]||"",zero=!!match[5],width=match[6]&&+match[6],comma=!!match[7],precision=match[8]&&+match[8].slice(1),type=match[9]||"";if(type==="n")comma=true,type="g";else if(!formatTypes[type])type="";if(zero||fill==="0"&&align==="=")zero=true,fill="0",align="=";this.fill=fill;this.align=align;this.sign=sign;this.symbol=symbol;this.zero=zero;this.width=width;this.comma=comma;this.precision=precision;this.type=type}FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+this.type};var identity=function(x){return x};var prefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];var formatLocale=function(locale){var group=locale.grouping&&locale.thousands?formatGroup(locale.grouping,locale.thousands):identity,currency=locale.currency,decimal=locale.decimal,numerals=locale.numerals?formatNumerals(locale.numerals):identity,percent=locale.percent||"%";function newFormat(specifier){specifier=formatSpecifier(specifier);var fill=specifier.fill,align=specifier.align,sign=specifier.sign,symbol=specifier.symbol,zero=specifier.zero,width=specifier.width,comma=specifier.comma,precision=specifier.precision,type=specifier.type;var prefix=symbol==="$"?currency[0]:symbol==="#"&&/[boxX]/.test(type)?"0"+type.toLowerCase():"",suffix=symbol==="$"?currency[1]:/[%p]/.test(type)?percent:"";var formatType=formatTypes[type],maybeSuffix=!type||/[defgprs%]/.test(type);precision=precision==null?type?6:12:/[gprs]/.test(type)?Math.max(1,Math.min(21,precision)):Math.max(0,Math.min(20,precision));function format(value){var valuePrefix=prefix,valueSuffix=suffix,i,n,c;if(type==="c"){valueSuffix=formatType(value)+valueSuffix;value=""}else{value=+value;var valueNegative=value<0;value=formatType(Math.abs(value),precision);if(valueNegative&&+value===0)valueNegative=false;valuePrefix=(valueNegative?sign==="("?sign:"-":sign==="-"||sign==="("?"":sign)+valuePrefix;valueSuffix=valueSuffix+(type==="s"?prefixes[8+prefixExponent/3]:"")+(valueNegative&&sign==="("?")":"");if(maybeSuffix){i=-1,n=value.length;while(++i<n){if(c=value.charCodeAt(i),48>c||c>57){valueSuffix=(c===46?decimal+value.slice(i+1):value.slice(i))+valueSuffix;value=value.slice(0,i);break}}}}if(comma&&!zero)value=group(value,Infinity);var length=valuePrefix.length+value.length+valueSuffix.length,padding=length<width?new Array(width-length+1).join(fill):"";if(comma&&zero)value=group(padding+value,padding.length?width-valueSuffix.length:Infinity),padding="";switch(align){case"<":value=valuePrefix+value+valueSuffix+padding;break;case"=":value=valuePrefix+padding+value+valueSuffix;break;case"^":value=padding.slice(0,length=padding.length>>1)+valuePrefix+value+valueSuffix+padding.slice(length);break;default:value=padding+valuePrefix+value+valueSuffix;break}return numerals(value)}format.toString=function(){return specifier+""};return format}function formatPrefix(specifier,value){var f=newFormat((specifier=formatSpecifier(specifier),specifier.type="f",specifier)),e=Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))*3,k=Math.pow(10,-e),prefix=prefixes[8+e/3];return function(value){return f(k*value)+prefix}}return{format:newFormat,formatPrefix:formatPrefix}};var locale;defaultLocale({decimal:".",thousands:",",grouping:[3],currency:["$",""]});function defaultLocale(definition){locale=formatLocale(definition);exports.format=locale.format;exports.formatPrefix=locale.formatPrefix;return locale}var precisionFixed=function(step){return Math.max(0,-exponent(Math.abs(step)))};var precisionPrefix=function(step,value){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))*3-exponent(Math.abs(step)))};var precisionRound=function(step,max){step=Math.abs(step),max=Math.abs(max)-step;return Math.max(0,exponent(max)-exponent(step))+1};exports.formatDefaultLocale=defaultLocale;exports.formatLocale=formatLocale;exports.formatSpecifier=formatSpecifier;exports.precisionFixed=precisionFixed;exports.precisionPrefix=precisionPrefix;exports.precisionRound=precisionRound;Object.defineProperty(exports,"__esModule",{value:true})})},{}],10:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var thirdPi=Math.PI/3;var angles=[0,thirdPi,2*thirdPi,3*thirdPi,4*thirdPi,5*thirdPi];function pointX(d){return d[0]}function pointY(d){return d[1]}var hexbin=function(){var x0=0,y0=0,x1=1,y1=1,x=pointX,y=pointY,r,dx,dy;function hexbin(points){var binsById={},bins=[],i,n=points.length;for(i=0;i<n;++i){if(isNaN(px=+x.call(null,point=points[i],i,points))||isNaN(py=+y.call(null,point,i,points)))continue;var point,px,py,pj=Math.round(py=py/dy),pi=Math.round(px=px/dx-(pj&1)/2),py1=py-pj;if(Math.abs(py1)*3>1){var px1=px-pi,pi2=pi+(px<pi?-1:1)/2,pj2=pj+(py<pj?-1:1),px2=px-pi2,py2=py-pj2;if(px1*px1+py1*py1>px2*px2+py2*py2)pi=pi2+(pj&1?1:-1)/2,pj=pj2}var id=pi+"-"+pj,bin=binsById[id];if(bin)bin.push(point);else{bins.push(bin=binsById[id]=[point]);bin.x=(pi+(pj&1)/2)*dx;bin.y=pj*dy}}return bins}function hexagon(radius){var x0=0,y0=0;return angles.map(function(angle){var x1=Math.sin(angle)*radius,y1=-Math.cos(angle)*radius,dx=x1-x0,dy=y1-y0;x0=x1,y0=y1;return[dx,dy]})}hexbin.hexagon=function(radius){return"m"+hexagon(radius==null?r:+radius).join("l")+"z"};hexbin.centers=function(){var centers=[],j=Math.round(y0/dy),i=Math.round(x0/dx);for(var y=j*dy;y<y1+r;y+=dy,++j){for(var x=i*dx+(j&1)*dx/2;x<x1+dx/2;x+=dx){centers.push([x,y])}}return centers};hexbin.mesh=function(){var fragment=hexagon(r).slice(0,4).join("l");return hexbin.centers().map(function(p){return"M"+p+"m"+fragment}).join("")};hexbin.x=function(_){return arguments.length?(x=_,hexbin):x};hexbin.y=function(_){return arguments.length?(y=_,hexbin):y};hexbin.radius=function(_){return arguments.length?(r=+_,dx=r*2*Math.sin(thirdPi),dy=r*1.5,hexbin):r};hexbin.size=function(_){return arguments.length?(x0=y0=0,x1=+_[0],y1=+_[1],hexbin):[x1-x0,y1-y0]};hexbin.extent=function(_){return arguments.length?(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1],hexbin):[[x0,y0],[x1,y1]]};return hexbin.radius(1)};exports.hexbin=hexbin;Object.defineProperty(exports,"__esModule",{value:true})})},{}],11:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";function defaultSeparation(a,b){return a.parent===b.parent?1:2}function meanX(children){return children.reduce(meanXReduce,0)/children.length}function meanXReduce(x,c){return x+c.x}function maxY(children){return 1+children.reduce(maxYReduce,0)}function maxYReduce(y,c){return Math.max(y,c.y)}function leafLeft(node){var children;while(children=node.children)node=children[0];return node}function leafRight(node){var children;while(children=node.children)node=children[children.length-1];return node}var cluster=function(){var separation=defaultSeparation,dx=1,dy=1,nodeSize=false;function cluster(root){var previousNode,x=0;root.eachAfter(function(node){var children=node.children;if(children){node.x=meanX(children);node.y=maxY(children)}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node}});var left=leafLeft(root),right=leafRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;return root.eachAfter(nodeSize?function(node){node.x=(node.x-root.x)*dx;node.y=(root.y-node.y)*dy}:function(node){node.x=(node.x-x0)/(x1-x0)*dx;node.y=(1-(root.y?node.y/root.y:1))*dy})}cluster.separation=function(x){return arguments.length?(separation=x,cluster):separation};cluster.size=function(x){return arguments.length?(nodeSize=false,dx=+x[0],dy=+x[1],cluster):nodeSize?null:[dx,dy]};cluster.nodeSize=function(x){return arguments.length?(nodeSize=true,dx=+x[0],dy=+x[1],cluster):nodeSize?[dx,dy]:null};return cluster};function count(node){var sum=0,children=node.children,i=children&&children.length;if(!i)sum=1;else while(--i>=0)sum+=children[i].value;node.value=sum}var node_count=function(){return this.eachAfter(count)};var node_each=function(callback){var node=this,current,next=[node],children,i,n;do{current=next.reverse(),next=[];while(node=current.pop()){callback(node),children=node.children;if(children)for(i=0,n=children.length;i<n;++i){next.push(children[i])}}}while(next.length);return this};var node_eachBefore=function(callback){var node=this,nodes=[node],children,i;while(node=nodes.pop()){callback(node),children=node.children;if(children)for(i=children.length-1;i>=0;--i){nodes.push(children[i])}}return this};var node_eachAfter=function(callback){var node=this,nodes=[node],next=[],children,i,n;while(node=nodes.pop()){next.push(node),children=node.children;if(children)for(i=0,n=children.length;i<n;++i){nodes.push(children[i])}}while(node=next.pop()){callback(node)}return this};var node_sum=function(value){return this.eachAfter(function(node){var sum=+value(node.data)||0,children=node.children,i=children&&children.length;while(--i>=0)sum+=children[i].value;node.value=sum})};var node_sort=function(compare){return this.eachBefore(function(node){if(node.children){node.children.sort(compare)}})};var node_path=function(end){var start=this,ancestor=leastCommonAncestor(start,end),nodes=[start];while(start!==ancestor){start=start.parent;nodes.push(start)}var k=nodes.length;while(end!==ancestor){nodes.splice(k,0,end);end=end.parent}return nodes};function leastCommonAncestor(a,b){if(a===b)return a;var aNodes=a.ancestors(),bNodes=b.ancestors(),c=null;a=aNodes.pop();b=bNodes.pop();while(a===b){c=a;a=aNodes.pop();b=bNodes.pop()}return c}var node_ancestors=function(){var node=this,nodes=[node];while(node=node.parent){nodes.push(node)}return nodes};var node_descendants=function(){var nodes=[];this.each(function(node){nodes.push(node)});return nodes};var node_leaves=function(){var leaves=[];this.eachBefore(function(node){if(!node.children){leaves.push(node)}});return leaves};var node_links=function(){var root=this,links=[];root.each(function(node){if(node!==root){links.push({source:node.parent,target:node})}});return links};function hierarchy(data,children){var root=new Node(data),valued=+data.value&&(root.value=data.value),node,nodes=[root],child,childs,i,n;if(children==null)children=defaultChildren;while(node=nodes.pop()){if(valued)node.value=+node.data.value;if((childs=children(node.data))&&(n=childs.length)){node.children=new Array(n);for(i=n-1;i>=0;--i){nodes.push(child=node.children[i]=new Node(childs[i]));child.parent=node;child.depth=node.depth+1}}}return root.eachBefore(computeHeight)}function node_copy(){return hierarchy(this).eachBefore(copyData)}function defaultChildren(d){return d.children}function copyData(node){node.data=node.data.data}function computeHeight(node){var height=0;do{node.height=height}while((node=node.parent)&&node.height<++height)}function Node(data){this.data=data;this.depth=this.height=0;this.parent=null}Node.prototype=hierarchy.prototype={constructor:Node,count:node_count,each:node_each,eachAfter:node_eachAfter,eachBefore:node_eachBefore,sum:node_sum,sort:node_sort,path:node_path,ancestors:node_ancestors,descendants:node_descendants,leaves:node_leaves,links:node_links,copy:node_copy};function Node$2(value){this._=value;this.next=null}var shuffle=function(array){var i,n=(array=array.slice()).length,head=null,node=head;while(n){var next=new Node$2(array[n-1]);if(node)node=node.next=next;else node=head=next;array[i]=array[--n]}return{head:head,tail:node}};var enclose=function(circles){return encloseN(shuffle(circles),[])};function encloses(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r-b.r;return dr*dr+1e-6>dx*dx+dy*dy}function encloseN(L,B){var circle,l0=null,l1=L.head,l2,p1;switch(B.length){case 1:circle=enclose1(B[0]);break;case 2:circle=enclose2(B[0],B[1]);break;case 3:circle=enclose3(B[0],B[1],B[2]);break}while(l1){p1=l1._,l2=l1.next;if(!circle||!encloses(circle,p1)){if(l0)L.tail=l0,l0.next=null;else L.head=L.tail=null;B.push(p1);circle=encloseN(L,B);B.pop();if(L.head)l1.next=L.head,L.head=l1;else l1.next=null,L.head=L.tail=l1;l0=L.tail,l0.next=l2}else{l0=l1}l1=l2}L.tail=l0;return circle}function enclose1(a){return{x:a.x,y:a.y,r:a.r}}function enclose2(a,b){var x1=a.x,y1=a.y,r1=a.r,x2=b.x,y2=b.y,r2=b.r,x21=x2-x1,y21=y2-y1,r21=r2-r1,l=Math.sqrt(x21*x21+y21*y21);return{x:(x1+x2+x21/l*r21)/2,y:(y1+y2+y21/l*r21)/2,r:(l+r1+r2)/2}}function enclose3(a,b,c){var x1=a.x,y1=a.y,r1=a.r,x2=b.x,y2=b.y,r2=b.r,x3=c.x,y3=c.y,r3=c.r,a2=2*(x1-x2),b2=2*(y1-y2),c2=2*(r2-r1),d2=x1*x1+y1*y1-r1*r1-x2*x2-y2*y2+r2*r2,a3=2*(x1-x3),b3=2*(y1-y3),c3=2*(r3-r1),d3=x1*x1+y1*y1-r1*r1-x3*x3-y3*y3+r3*r3,ab=a3*b2-a2*b3,xa=(b2*d3-b3*d2)/ab-x1,xb=(b3*c2-b2*c3)/ab,ya=(a3*d2-a2*d3)/ab-y1,yb=(a2*c3-a3*c2)/ab,A=xb*xb+yb*yb-1,B=2*(xa*xb+ya*yb+r1),C=xa*xa+ya*ya-r1*r1,r=(-B-Math.sqrt(B*B-4*A*C))/(2*A);return{x:xa+xb*r+x1,y:ya+yb*r+y1,r:r}}function place(a,b,c){var ax=a.x,ay=a.y,da=b.r+c.r,db=a.r+c.r,dx=b.x-ax,dy=b.y-ay,dc=dx*dx+dy*dy;if(dc){var x=.5+((db*=db)-(da*=da))/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=ax+x*dx+y*dy;c.y=ay+x*dy-y*dx}else{c.x=ax+db;c.y=ay}}function intersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return dr*dr-1e-6>dx*dx+dy*dy}function distance2(node,x,y){var a=node._,b=node.next._,ab=a.r+b.r,dx=(a.x*b.r+b.x*a.r)/ab-x,dy=(a.y*b.r+b.y*a.r)/ab-y;return dx*dx+dy*dy}function Node$1(circle){this._=circle;this.next=null;this.previous=null}function packEnclose(circles){if(!(n=circles.length))return 0;var a,b,c,n;a=circles[0],a.x=0,a.y=0;if(!(n>1))return a.r;b=circles[1],a.x=-b.r,b.x=a.r,b.y=0;if(!(n>2))return a.r+b.r;place(b,a,c=circles[2]);var aa=a.r*a.r,ba=b.r*b.r,ca=c.r*c.r,oa=aa+ba+ca,ox=aa*a.x+ba*b.x+ca*c.x,oy=aa*a.y+ba*b.y+ca*c.y,cx,cy,i,j,k,sj,sk;a=new Node$1(a),b=new Node$1(b),c=new Node$1(c);a.next=c.previous=b;b.next=a.previous=c;c.next=b.previous=a;pack:for(i=3;i<n;++i){place(a._,b._,c=circles[i]),c=new Node$1(c);j=b.next,k=a.previous,sj=b._.r,sk=a._.r;do{if(sj<=sk){if(intersects(j._,c._)){b=j,a.next=b,b.previous=a,--i;continue pack}sj+=j._.r,j=j.next}else{if(intersects(k._,c._)){a=k,a.next=b,b.previous=a,--i;continue pack}sk+=k._.r,k=k.previous}}while(j!==k.next);c.previous=a,c.next=b,a.next=b.previous=b=c;oa+=ca=c._.r*c._.r;ox+=ca*c._.x;oy+=ca*c._.y;aa=distance2(a,cx=ox/oa,cy=oy/oa);while((c=c.next)!==b){if((ca=distance2(c,cx,cy))<aa){a=c,aa=ca}}b=a.next}a=[b._],c=b;while((c=c.next)!==b)a.push(c._);c=enclose(a);for(i=0;i<n;++i)a=circles[i],a.x-=c.x,a.y-=c.y;return c.r}var siblings=function(circles){packEnclose(circles);return circles}
;function optional(f){return f==null?null:required(f)}function required(f){if(typeof f!=="function")throw new Error;return f}function constantZero(){return 0}var constant=function(x){return function(){return x}};function defaultRadius(d){return Math.sqrt(d.value)}var index=function(){var radius=null,dx=1,dy=1,padding=constantZero;function pack(root){root.x=dx/2,root.y=dy/2;if(radius){root.eachBefore(radiusLeaf(radius)).eachAfter(packChildren(padding,.5)).eachBefore(translateChild(1))}else{root.eachBefore(radiusLeaf(defaultRadius)).eachAfter(packChildren(constantZero,1)).eachAfter(packChildren(padding,root.r/Math.min(dx,dy))).eachBefore(translateChild(Math.min(dx,dy)/(2*root.r)))}return root}pack.radius=function(x){return arguments.length?(radius=optional(x),pack):radius};pack.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],pack):[dx,dy]};pack.padding=function(x){return arguments.length?(padding=typeof x==="function"?x:constant(+x),pack):padding};return pack};function radiusLeaf(radius){return function(node){if(!node.children){node.r=Math.max(0,+radius(node)||0)}}}function packChildren(padding,k){return function(node){if(children=node.children){var children,i,n=children.length,r=padding(node)*k||0,e;if(r)for(i=0;i<n;++i)children[i].r+=r;e=packEnclose(children);if(r)for(i=0;i<n;++i)children[i].r-=r;node.r=e+r}}}function translateChild(k){return function(node){var parent=node.parent;node.r*=k;if(parent){node.x=parent.x+k*node.x;node.y=parent.y+k*node.y}}}var roundNode=function(node){node.x0=Math.round(node.x0);node.y0=Math.round(node.y0);node.x1=Math.round(node.x1);node.y1=Math.round(node.y1)};var treemapDice=function(parent,x0,y0,x1,y1){var nodes=parent.children,node,i=-1,n=nodes.length,k=parent.value&&(x1-x0)/parent.value;while(++i<n){node=nodes[i],node.y0=y0,node.y1=y1;node.x0=x0,node.x1=x0+=node.value*k}};var partition=function(){var dx=1,dy=1,padding=0,round=false;function partition(root){var n=root.height+1;root.x0=root.y0=padding;root.x1=dx;root.y1=dy/n;root.eachBefore(positionNode(dy,n));if(round)root.eachBefore(roundNode);return root}function positionNode(dy,n){return function(node){if(node.children){treemapDice(node,node.x0,dy*(node.depth+1)/n,node.x1,dy*(node.depth+2)/n)}var x0=node.x0,y0=node.y0,x1=node.x1-padding,y1=node.y1-padding;if(x1<x0)x0=x1=(x0+x1)/2;if(y1<y0)y0=y1=(y0+y1)/2;node.x0=x0;node.y0=y0;node.x1=x1;node.y1=y1}}partition.round=function(x){return arguments.length?(round=!!x,partition):round};partition.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],partition):[dx,dy]};partition.padding=function(x){return arguments.length?(padding=+x,partition):padding};return partition};var keyPrefix="$";var preroot={depth:-1};var ambiguous={};function defaultId(d){return d.id}function defaultParentId(d){return d.parentId}var stratify=function(){var id=defaultId,parentId=defaultParentId;function stratify(data){var d,i,n=data.length,root,parent,node,nodes=new Array(n),nodeId,nodeKey,nodeByKey={};for(i=0;i<n;++i){d=data[i],node=nodes[i]=new Node(d);if((nodeId=id(d,i,data))!=null&&(nodeId+="")){nodeKey=keyPrefix+(node.id=nodeId);nodeByKey[nodeKey]=nodeKey in nodeByKey?ambiguous:node}}for(i=0;i<n;++i){node=nodes[i],nodeId=parentId(data[i],i,data);if(nodeId==null||!(nodeId+="")){if(root)throw new Error("multiple roots");root=node}else{parent=nodeByKey[keyPrefix+nodeId];if(!parent)throw new Error("missing: "+nodeId);if(parent===ambiguous)throw new Error("ambiguous: "+nodeId);if(parent.children)parent.children.push(node);else parent.children=[node];node.parent=parent}}if(!root)throw new Error("no root");root.parent=preroot;root.eachBefore(function(node){node.depth=node.parent.depth+1;--n}).eachBefore(computeHeight);root.parent=null;if(n>0)throw new Error("cycle");return root}stratify.id=function(x){return arguments.length?(id=required(x),stratify):id};stratify.parentId=function(x){return arguments.length?(parentId=required(x),stratify):parentId};return stratify};function defaultSeparation$1(a,b){return a.parent===b.parent?1:2}function nextLeft(v){var children=v.children;return children?children[0]:v.t}function nextRight(v){var children=v.children;return children?children[children.length-1]:v.t}function moveSubtree(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change;wp.s+=shift;wm.c+=change;wp.z+=shift;wp.m+=shift}function executeShifts(v){var shift=0,change=0,children=v.children,i=children.length,w;while(--i>=0){w=children[i];w.z+=shift;w.m+=shift;shift+=w.s+(change+=w.c)}}function nextAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor}function TreeNode(node,i){this._=node;this.parent=null;this.children=null;this.A=null;this.a=this;this.z=0;this.m=0;this.c=0;this.s=0;this.t=null;this.i=i}TreeNode.prototype=Object.create(Node.prototype);function treeRoot(root){var tree=new TreeNode(root,0),node,nodes=[tree],child,children,i,n;while(node=nodes.pop()){if(children=node._.children){node.children=new Array(n=children.length);for(i=n-1;i>=0;--i){nodes.push(child=node.children[i]=new TreeNode(children[i],i));child.parent=node}}}(tree.parent=new TreeNode(null,0)).children=[tree];return tree}var tree=function(){var separation=defaultSeparation$1,dx=1,dy=1,nodeSize=null;function tree(root){var t=treeRoot(root);t.eachAfter(firstWalk),t.parent.m=-t.z;t.eachBefore(secondWalk);if(nodeSize)root.eachBefore(sizeNode);else{var left=root,right=root,bottom=root;root.eachBefore(function(node){if(node.x<left.x)left=node;if(node.x>right.x)right=node;if(node.depth>bottom.depth)bottom=node});var s=left===right?1:separation(left,right)/2,tx=s-left.x,kx=dx/(right.x+s+tx),ky=dy/(bottom.depth||1);root.eachBefore(function(node){node.x=(node.x+tx)*kx;node.y=node.depth*ky})}return root}function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children){executeShifts(v);var midpoint=(children[0].z+children[children.length-1].z)/2;if(w){v.z=w.z+separation(v._,w._);v.m=v.z-midpoint}else{v.z=midpoint}}else if(w){v.z=w.z+separation(v._,w._)}v.parent.A=apportion(v,w,v.parent.A||siblings[0])}function secondWalk(v){v._.x=v.z+v.parent.m;v.m+=v.parent.m}function apportion(v,w,ancestor){if(w){var vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m,shift;while(vim=nextRight(vim),vip=nextLeft(vip),vim&&vip){vom=nextLeft(vom);vop=nextRight(vop);vop.a=v;shift=vim.z+sim-vip.z-sip+separation(vim._,vip._);if(shift>0){moveSubtree(nextAncestor(vim,v,ancestor),v,shift);sip+=shift;sop+=shift}sim+=vim.m;sip+=vip.m;som+=vom.m;sop+=vop.m}if(vim&&!nextRight(vop)){vop.t=vim;vop.m+=sim-sop}if(vip&&!nextLeft(vom)){vom.t=vip;vom.m+=sip-som;ancestor=v}}return ancestor}function sizeNode(node){node.x*=dx;node.y=node.depth*dy}tree.separation=function(x){return arguments.length?(separation=x,tree):separation};tree.size=function(x){return arguments.length?(nodeSize=false,dx=+x[0],dy=+x[1],tree):nodeSize?null:[dx,dy]};tree.nodeSize=function(x){return arguments.length?(nodeSize=true,dx=+x[0],dy=+x[1],tree):nodeSize?[dx,dy]:null};return tree};var treemapSlice=function(parent,x0,y0,x1,y1){var nodes=parent.children,node,i=-1,n=nodes.length,k=parent.value&&(y1-y0)/parent.value;while(++i<n){node=nodes[i],node.x0=x0,node.x1=x1;node.y0=y0,node.y1=y0+=node.value*k}};var phi=(1+Math.sqrt(5))/2;function squarifyRatio(ratio,parent,x0,y0,x1,y1){var rows=[],nodes=parent.children,row,nodeValue,i0=0,i1=0,n=nodes.length,dx,dy,value=parent.value,sumValue,minValue,maxValue,newRatio,minRatio,alpha,beta;while(i0<n){dx=x1-x0,dy=y1-y0;do{sumValue=nodes[i1++].value}while(!sumValue&&i1<n);minValue=maxValue=sumValue;alpha=Math.max(dy/dx,dx/dy)/(value*ratio);beta=sumValue*sumValue*alpha;minRatio=Math.max(maxValue/beta,beta/minValue);for(;i1<n;++i1){sumValue+=nodeValue=nodes[i1].value;if(nodeValue<minValue)minValue=nodeValue;if(nodeValue>maxValue)maxValue=nodeValue;beta=sumValue*sumValue*alpha;newRatio=Math.max(maxValue/beta,beta/minValue);if(newRatio>minRatio){sumValue-=nodeValue;break}minRatio=newRatio}rows.push(row={value:sumValue,dice:dx<dy,children:nodes.slice(i0,i1)});if(row.dice)treemapDice(row,x0,y0,x1,value?y0+=dy*sumValue/value:y1);else treemapSlice(row,x0,y0,value?x0+=dx*sumValue/value:x1,y1);value-=sumValue,i0=i1}return rows}var squarify=function custom(ratio){function squarify(parent,x0,y0,x1,y1){squarifyRatio(ratio,parent,x0,y0,x1,y1)}squarify.ratio=function(x){return custom((x=+x)>1?x:1)};return squarify}(phi);var index$1=function(){var tile=squarify,round=false,dx=1,dy=1,paddingStack=[0],paddingInner=constantZero,paddingTop=constantZero,paddingRight=constantZero,paddingBottom=constantZero,paddingLeft=constantZero;function treemap(root){root.x0=root.y0=0;root.x1=dx;root.y1=dy;root.eachBefore(positionNode);paddingStack=[0];if(round)root.eachBefore(roundNode);return root}function positionNode(node){var p=paddingStack[node.depth],x0=node.x0+p,y0=node.y0+p,x1=node.x1-p,y1=node.y1-p;if(x1<x0)x0=x1=(x0+x1)/2;if(y1<y0)y0=y1=(y0+y1)/2;node.x0=x0;node.y0=y0;node.x1=x1;node.y1=y1;if(node.children){p=paddingStack[node.depth+1]=paddingInner(node)/2;x0+=paddingLeft(node)-p;y0+=paddingTop(node)-p;x1-=paddingRight(node)-p;y1-=paddingBottom(node)-p;if(x1<x0)x0=x1=(x0+x1)/2;if(y1<y0)y0=y1=(y0+y1)/2;tile(node,x0,y0,x1,y1)}}treemap.round=function(x){return arguments.length?(round=!!x,treemap):round};treemap.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],treemap):[dx,dy]};treemap.tile=function(x){return arguments.length?(tile=required(x),treemap):tile};treemap.padding=function(x){return arguments.length?treemap.paddingInner(x).paddingOuter(x):treemap.paddingInner()};treemap.paddingInner=function(x){return arguments.length?(paddingInner=typeof x==="function"?x:constant(+x),treemap):paddingInner};treemap.paddingOuter=function(x){return arguments.length?treemap.paddingTop(x).paddingRight(x).paddingBottom(x).paddingLeft(x):treemap.paddingTop()};treemap.paddingTop=function(x){return arguments.length?(paddingTop=typeof x==="function"?x:constant(+x),treemap):paddingTop};treemap.paddingRight=function(x){return arguments.length?(paddingRight=typeof x==="function"?x:constant(+x),treemap):paddingRight};treemap.paddingBottom=function(x){return arguments.length?(paddingBottom=typeof x==="function"?x:constant(+x),treemap):paddingBottom};treemap.paddingLeft=function(x){return arguments.length?(paddingLeft=typeof x==="function"?x:constant(+x),treemap):paddingLeft};return treemap};var binary=function(parent,x0,y0,x1,y1){var nodes=parent.children,i,n=nodes.length,sum,sums=new Array(n+1);for(sums[0]=sum=i=0;i<n;++i){sums[i+1]=sum+=nodes[i].value}partition(0,n,parent.value,x0,y0,x1,y1);function partition(i,j,value,x0,y0,x1,y1){if(i>=j-1){var node=nodes[i];node.x0=x0,node.y0=y0;node.x1=x1,node.y1=y1;return}var valueOffset=sums[i],valueTarget=value/2+valueOffset,k=i+1,hi=j-1;while(k<hi){var mid=k+hi>>>1;if(sums[mid]<valueTarget)k=mid+1;else hi=mid}if(valueTarget-sums[k-1]<sums[k]-valueTarget&&i+1<k)--k;var valueLeft=sums[k]-valueOffset,valueRight=value-valueLeft;if(x1-x0>y1-y0){var xk=(x0*valueRight+x1*valueLeft)/value;partition(i,k,valueLeft,x0,y0,xk,y1);partition(k,j,valueRight,xk,y0,x1,y1)}else{var yk=(y0*valueRight+y1*valueLeft)/value;partition(i,k,valueLeft,x0,y0,x1,yk);partition(k,j,valueRight,x0,yk,x1,y1)}}};var sliceDice=function(parent,x0,y0,x1,y1){(parent.depth&1?treemapSlice:treemapDice)(parent,x0,y0,x1,y1)};var resquarify=function custom(ratio){function resquarify(parent,x0,y0,x1,y1){if((rows=parent._squarify)&&rows.ratio===ratio){var rows,row,nodes,i,j=-1,n,m=rows.length,value=parent.value;while(++j<m){row=rows[j],nodes=row.children;for(i=row.value=0,n=nodes.length;i<n;++i)row.value+=nodes[i].value;if(row.dice)treemapDice(row,x0,y0,x1,y0+=(y1-y0)*row.value/value);else treemapSlice(row,x0,y0,x0+=(x1-x0)*row.value/value,y1);value-=row.value}}else{parent._squarify=rows=squarifyRatio(ratio,parent,x0,y0,x1,y1);rows.ratio=ratio}}resquarify.ratio=function(x){return custom((x=+x)>1?x:1)};return resquarify}(phi);exports.cluster=cluster;exports.hierarchy=hierarchy;exports.pack=index;exports.packSiblings=siblings;exports.packEnclose=enclose;exports.partition=partition;exports.stratify=stratify;exports.tree=tree;exports.treemap=index$1;exports.treemapBinary=binary;exports.treemapDice=treemapDice;exports.treemapSlice=treemapSlice;exports.treemapSliceDice=sliceDice;exports.treemapSquarify=squarify;exports.treemapResquarify=resquarify;Object.defineProperty(exports,"__esModule",{value:true})})},{}],12:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("d3-color")):typeof define==="function"&&define.amd?define(["exports","d3-color"],factory):factory(global.d3=global.d3||{},global.d3)})(this,function(exports,d3Color){"use strict";function basis(t1,v0,v1,v2,v3){var t2=t1*t1,t3=t2*t1;return((1-3*t1+3*t2-t3)*v0+(4-6*t2+3*t3)*v1+(1+3*t1+3*t2-3*t3)*v2+t3*v3)/6}var basis$1=function(values){var n=values.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,n-1):Math.floor(t*n),v1=values[i],v2=values[i+1],v0=i>0?values[i-1]:2*v1-v2,v3=i<n-1?values[i+2]:2*v2-v1;return basis((t-i/n)*n,v0,v1,v2,v3)}};var basisClosed=function(values){var n=values.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*n),v0=values[(i+n-1)%n],v1=values[i%n],v2=values[(i+1)%n],v3=values[(i+2)%n];return basis((t-i/n)*n,v0,v1,v2,v3)}};var constant=function(x){return function(){return x}};function linear(a,d){return function(t){return a+t*d}}function exponential(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}function hue(a,b){var d=b-a;return d?linear(a,d>180||d<-180?d-360*Math.round(d/360):d):constant(isNaN(a)?b:a)}function gamma(y){return(y=+y)===1?nogamma:function(a,b){return b-a?exponential(a,b,y):constant(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):constant(isNaN(a)?b:a)}var rgb$1=function rgbGamma(y){var color$$1=gamma(y);function rgb$$1(start,end){var r=color$$1((start=d3Color.rgb(start)).r,(end=d3Color.rgb(end)).r),g=color$$1(start.g,end.g),b=color$$1(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){start.r=r(t);start.g=g(t);start.b=b(t);start.opacity=opacity(t);return start+""}}rgb$$1.gamma=rgbGamma;return rgb$$1}(1);function rgbSpline(spline){return function(colors){var n=colors.length,r=new Array(n),g=new Array(n),b=new Array(n),i,color$$1;for(i=0;i<n;++i){color$$1=d3Color.rgb(colors[i]);r[i]=color$$1.r||0;g[i]=color$$1.g||0;b[i]=color$$1.b||0}r=spline(r);g=spline(g);b=spline(b);color$$1.opacity=1;return function(t){color$$1.r=r(t);color$$1.g=g(t);color$$1.b=b(t);return color$$1+""}}}var rgbBasis=rgbSpline(basis$1);var rgbBasisClosed=rgbSpline(basisClosed);var array=function(a,b){var nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(nb),c=new Array(nb),i;for(i=0;i<na;++i)x[i]=value(a[i],b[i]);for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<na;++i)c[i]=x[i](t);return c}};var date=function(a,b){var d=new Date;return a=+a,b-=a,function(t){return d.setTime(a+b*t),d}};var number=function(a,b){return a=+a,b-=a,function(t){return a+b*t}};var object=function(a,b){var i={},c={},k;if(a===null||typeof a!=="object")a={};if(b===null||typeof b!=="object")b={};for(k in b){if(k in a){i[k]=value(a[k],b[k])}else{c[k]=b[k]}}return function(t){for(k in i)c[k]=i[k](t);return c}};var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;var reB=new RegExp(reA.source,"g");function zero(b){return function(){return b}}function one(b){return function(t){return b(t)+""}}var string=function(a,b){var bi=reA.lastIndex=reB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=reA.exec(a))&&(bm=reB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs}if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm}else{s[++i]=null;q.push({i:i,x:number(am,bm)})}bi=reB.lastIndex}if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs}return s.length<2?q[0]?one(q[0].x):zero(b):(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})};var value=function(a,b){var t=typeof b,c;return b==null||t==="boolean"?constant(b):(t==="number"?number:t==="string"?(c=d3Color.color(b))?(b=c,rgb$1):string:b instanceof d3Color.color?rgb$1:b instanceof Date?date:Array.isArray(b)?array:isNaN(b)?object:number)(a,b)};var round=function(a,b){return a=+a,b-=a,function(t){return Math.round(a+b*t)}};var degrees=180/Math.PI;var identity={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};var decompose=function(a,b,c,d,e,f){var scaleX,scaleY,skewX;if(scaleX=Math.sqrt(a*a+b*b))a/=scaleX,b/=scaleX;if(skewX=a*c+b*d)c-=a*skewX,d-=b*skewX;if(scaleY=Math.sqrt(c*c+d*d))c/=scaleY,d/=scaleY,skewX/=scaleY;if(a*d<b*c)a=-a,b=-b,skewX=-skewX,scaleX=-scaleX;return{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX:scaleX,scaleY:scaleY}};var cssNode;var cssRoot;var cssView;var svgNode;function parseCss(value){if(value==="none")return identity;if(!cssNode)cssNode=document.createElement("DIV"),cssRoot=document.documentElement,cssView=document.defaultView;cssNode.style.transform=value;value=cssView.getComputedStyle(cssRoot.appendChild(cssNode),null).getPropertyValue("transform");cssRoot.removeChild(cssNode);value=value.slice(7,-1).split(",");return decompose(+value[0],+value[1],+value[2],+value[3],+value[4],+value[5])}function parseSvg(value){if(value==null)return identity;if(!svgNode)svgNode=document.createElementNS("http://www.w3.org/2000/svg","g");svgNode.setAttribute("transform",value);if(!(value=svgNode.transform.baseVal.consolidate()))return identity;value=value.matrix;return decompose(value.a,value.b,value.c,value.d,value.e,value.f)}function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}function translate(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else if(xb||yb){s.push("translate("+xb+pxComma+yb+pxParen)}}function rotate(a,b,s,q){if(a!==b){if(a-b>180)b+=360;else if(b-a>180)a+=360;q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:number(a,b)})}else if(b){s.push(pop(s)+"rotate("+b+degParen)}}function skewX(a,b,s,q){if(a!==b){q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:number(a,b)})}else if(b){s.push(pop(s)+"skewX("+b+degParen)}}function scale(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:number(xa,xb)},{i:i-2,x:number(ya,yb)})}else if(xb!==1||yb!==1){s.push(pop(s)+"scale("+xb+","+yb+")")}}return function(a,b){var s=[],q=[];a=parse(a),b=parse(b);translate(a.translateX,a.translateY,b.translateX,b.translateY,s,q);rotate(a.rotate,b.rotate,s,q);skewX(a.skewX,b.skewX,s,q);scale(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q);a=b=null;return function(t){var i=-1,n=q.length,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)");var interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")");var rho=Math.SQRT2;var rho2=2;var rho4=4;var epsilon2=1e-12;function cosh(x){return((x=Math.exp(x))+1/x)/2}function sinh(x){return((x=Math.exp(x))-1/x)/2}function tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}var zoom=function(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,i,S;if(d2<epsilon2){S=Math.log(w1/w0)/rho;i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(rho*t*S)]}}else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+rho4*d2)/(2*w0*rho2*d1),b1=(w1*w1-w0*w0-rho4*d2)/(2*w1*rho2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/rho;i=function(t){var s=t*S,coshr0=cosh(r0),u=w0/(rho2*d1)*(coshr0*tanh(rho*s+r0)-sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/cosh(rho*s+r0)]}}i.duration=S*1e3;return i};function hsl$1(hue$$1){return function(start,end){var h=hue$$1((start=d3Color.hsl(start)).h,(end=d3Color.hsl(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.s=s(t);start.l=l(t);start.opacity=opacity(t);return start+""}}}var hsl$2=hsl$1(hue);var hslLong=hsl$1(nogamma);function lab$1(start,end){var l=nogamma((start=d3Color.lab(start)).l,(end=d3Color.lab(end)).l),a=nogamma(start.a,end.a),b=nogamma(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){start.l=l(t);start.a=a(t);start.b=b(t);start.opacity=opacity(t);return start+""}}function hcl$1(hue$$1){return function(start,end){var h=hue$$1((start=d3Color.hcl(start)).h,(end=d3Color.hcl(end)).h),c=nogamma(start.c,end.c),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.c=c(t);start.l=l(t);start.opacity=opacity(t);return start+""}}}var hcl$2=hcl$1(hue);var hclLong=hcl$1(nogamma);function cubehelix$1(hue$$1){return function cubehelixGamma(y){y=+y;function cubehelix$$1(start,end){var h=hue$$1((start=d3Color.cubehelix(start)).h,(end=d3Color.cubehelix(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.s=s(t);start.l=l(Math.pow(t,y));start.opacity=opacity(t);return start+""}}cubehelix$$1.gamma=cubehelixGamma;return cubehelix$$1}(1)}var cubehelix$2=cubehelix$1(hue);var cubehelixLong=cubehelix$1(nogamma);var quantize=function(interpolator,n){var samples=new Array(n);for(var i=0;i<n;++i)samples[i]=interpolator(i/(n-1));return samples};exports.interpolate=value;exports.interpolateArray=array;exports.interpolateBasis=basis$1;exports.interpolateBasisClosed=basisClosed;exports.interpolateDate=date;exports.interpolateNumber=number;exports.interpolateObject=object;exports.interpolateRound=round;exports.interpolateString=string;exports.interpolateTransformCss=interpolateTransformCss;exports.interpolateTransformSvg=interpolateTransformSvg;exports.interpolateZoom=zoom;exports.interpolateRgb=rgb$1;exports.interpolateRgbBasis=rgbBasis;exports.interpolateRgbBasisClosed=rgbBasisClosed;exports.interpolateHsl=hsl$2;exports.interpolateHslLong=hslLong;exports.interpolateLab=lab$1;exports.interpolateHcl=hcl$2;exports.interpolateHclLong=hclLong;exports.interpolateCubehelix=cubehelix$2;exports.interpolateCubehelixLong=cubehelixLong;exports.quantize=quantize;Object.defineProperty(exports,"__esModule",{value:true})})},{"d3-color":8}],13:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var pi=Math.PI;var tau=2*pi;var epsilon=1e-6;var tauEpsilon=tau-epsilon;function Path(){this._x0=this._y0=this._x1=this._y1=null;this._=""}function path(){return new Path}Path.prototype=path.prototype={constructor:Path,moveTo:function(x,y){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)},closePath:function(){if(this._x1!==null){this._x1=this._x0,this._y1=this._y0;this._+="Z"}},lineTo:function(x,y){this._+="L"+(this._x1=+x)+","+(this._y1=+y)},quadraticCurveTo:function(x1,y1,x,y){this._+="Q"+ +x1+","+ +y1+","+(this._x1=+x)+","+(this._y1=+y)},bezierCurveTo:function(x1,y1,x2,y2,x,y){this._+="C"+ +x1+","+ +y1+","+ +x2+","+ +y2+","+(this._x1=+x)+","+(this._y1=+y)},arcTo:function(x1,y1,x2,y2,r){x1=+x1,y1=+y1,x2=+x2,y2=+y2,r=+r;var x0=this._x1,y0=this._y1,x21=x2-x1,y21=y2-y1,x01=x0-x1,y01=y0-y1,l01_2=x01*x01+y01*y01;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null){this._+="M"+(this._x1=x1)+","+(this._y1=y1)}else if(!(l01_2>epsilon)){}else if(!(Math.abs(y01*x21-y21*x01)>epsilon)||!r){this._+="L"+(this._x1=x1)+","+(this._y1=y1)}else{var x20=x2-x0,y20=y2-y0,l21_2=x21*x21+y21*y21,l20_2=x20*x20+y20*y20,l21=Math.sqrt(l21_2),l01=Math.sqrt(l01_2),l=r*Math.tan((pi-Math.acos((l21_2+l01_2-l20_2)/(2*l21*l01)))/2),t01=l/l01,t21=l/l21;if(Math.abs(t01-1)>epsilon){this._+="L"+(x1+t01*x01)+","+(y1+t01*y01)}this._+="A"+r+","+r+",0,0,"+ +(y01*x20>x01*y20)+","+(this._x1=x1+t21*x21)+","+(this._y1=y1+t21*y21)}},arc:function(x,y,r,a0,a1,ccw){x=+x,y=+y,r=+r;var dx=r*Math.cos(a0),dy=r*Math.sin(a0),x0=x+dx,y0=y+dy,cw=1^ccw,da=ccw?a0-a1:a1-a0;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null){this._+="M"+x0+","+y0}else if(Math.abs(this._x1-x0)>epsilon||Math.abs(this._y1-y0)>epsilon){this._+="L"+x0+","+y0}if(!r)return;if(da<0)da=da%tau+tau;if(da>tauEpsilon){this._+="A"+r+","+r+",0,1,"+cw+","+(x-dx)+","+(y-dy)+"A"+r+","+r+",0,1,"+cw+","+(this._x1=x0)+","+(this._y1=y0)}else if(da>epsilon){this._+="A"+r+","+r+",0,"+ +(da>=pi)+","+cw+","+(this._x1=x+r*Math.cos(a1))+","+(this._y1=y+r*Math.sin(a1))}},rect:function(x,y,w,h){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)+"h"+ +w+"v"+ +h+"h"+-w+"Z"},toString:function(){return this._}};exports.path=path;Object.defineProperty(exports,"__esModule",{value:true})})},{}],14:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("d3-array"),require("d3-collection"),require("d3-interpolate")):typeof define==="function"&&define.amd?define(["exports","d3-array","d3-collection","d3-interpolate"],factory):factory(global.d3_sankey=global.d3_sankey||{},global.d3_array,global.d3_collection,global.d3_interpolate)})(this,function(exports,d3Array,d3Collection,d3Interpolate){"use strict";var version="0.1.0";function sankey(){var sankey={},nodeWidth=24,nodePadding=8,size=[1,1],align="justify",nodes=[],links=[];sankey.nodeWidth=function(_){if(!arguments.length)return nodeWidth;nodeWidth=+_;return sankey};sankey.nodePadding=function(_){if(!arguments.length)return nodePadding;nodePadding=+_;return sankey};sankey.nodes=function(_){if(!arguments.length)return nodes;nodes=_;return sankey};sankey.links=function(_){if(!arguments.length)return links;links=_;return sankey};sankey.size=function(_){if(!arguments.length)return size;size=_;return sankey};sankey.align=function(_){if(!arguments.length)return align;align=_.toLowerCase();return sankey};sankey.layout=function(iterations){computeNodeLinks();computeNodeValues();computeNodeBreadths();computeNodeDepths(iterations);computeLinkDepths();return sankey};sankey.relayout=function(){computeLinkDepths();return sankey};sankey.link=function(){var curvature=.5;function link(d){var x0=d.source.x+d.source.dx,x1=d.target.x,xi=d3Interpolate.number(x0,x1),x2=xi(curvature),x3=xi(1-curvature),y0=d.source.y+d.sy+d.dy/2,y1=d.target.y+d.ty+d.dy/2;return"M"+x0+","+y0+"C"+x2+","+y0+" "+x3+","+y1+" "+x1+","+y1}link.curvature=function(_){if(!arguments.length)return curvature;curvature=+_;return link};return link};function computeNodeLinks(){nodes.forEach(function(node){node.sourceLinks=[];node.targetLinks=[]});links.forEach(function(link){var source=link.source,target=link.target;if(typeof source==="number")source=link.source=nodes[link.source];if(typeof target==="number")target=link.target=nodes[link.target];source.sourceLinks.push(link);target.targetLinks.push(link)})}function computeNodeValues(){nodes.forEach(function(node){node.value=Math.max(d3Array.sum(node.sourceLinks,value),d3Array.sum(node.targetLinks,value))})}function computeNodeBreadths(){var remainingNodes=nodes,nextNodes,x=0,reverse=align==="right";while(remainingNodes.length){nextNodes=[];remainingNodes.forEach(function(node){node.x=x;node.dx=nodeWidth;node[reverse?"targetLinks":"sourceLinks"].forEach(function(link){var nextNode=link[reverse?"source":"target"];if(nextNodes.indexOf(nextNode)<0){nextNodes.push(nextNode)}})});remainingNodes=nextNodes;++x}if(reverse){nodes.forEach(function(node){node.x*=-1;node.x+=x-1})}if(align==="center"){moveSourcesRight()}if(align==="justify"){moveSinksRight(x)}scaleNodeBreadths((size[0]-nodeWidth)/(x-1))}function moveSourcesRight(){nodes.slice().sort(function(a,b){return b.x-a.x}).forEach(function(node){if(!node.targetLinks.length){node.x=d3Array.min(node.sourceLinks,function(d){return d.target.x})-1}})}function moveSinksRight(x){nodes.forEach(function(node){if(!node.sourceLinks.length){node.x=x-1}})}function scaleNodeBreadths(kx){nodes.forEach(function(node){node.x*=kx})}function computeNodeDepths(iterations){var nodesByBreadth=d3Collection.nest().key(function(d){return d.x}).sortKeys(d3Array.ascending).entries(nodes).map(function(d){return d.values});initializeNodeDepth();resolveCollisions();for(var alpha=1;iterations>0;--iterations){relaxRightToLeft(alpha*=.99);resolveCollisions();relaxLeftToRight(alpha);resolveCollisions()}function initializeNodeDepth(){var ky=d3Array.min(nodesByBreadth,function(nodes){return(size[1]-(nodes.length-1)*nodePadding)/d3Array.sum(nodes,value)});nodesByBreadth.forEach(function(nodes){nodes.forEach(function(node,i){node.y=i;node.dy=node.value*ky})});links.forEach(function(link){link.dy=link.value*ky})}function relaxLeftToRight(alpha){nodesByBreadth.forEach(function(nodes){nodes.forEach(function(node){if(node.targetLinks.length){var y=d3Array.sum(node.targetLinks,weightedSource)/d3Array.sum(node.targetLinks,value);node.y+=(y-center(node))*alpha}})});function weightedSource(link){return center(link.source)*link.value}}function relaxRightToLeft(alpha){nodesByBreadth.slice().reverse().forEach(function(nodes){nodes.forEach(function(node){if(node.sourceLinks.length){var y=d3Array.sum(node.sourceLinks,weightedTarget)/d3Array.sum(node.sourceLinks,value);node.y+=(y-center(node))*alpha}})});function weightedTarget(link){return center(link.target)*link.value}}function resolveCollisions(){nodesByBreadth.forEach(function(nodes){var node,dy,y0=0,n=nodes.length,i;nodes.sort(ascendingDepth);for(i=0;i<n;++i){node=nodes[i];dy=y0-node.y;if(dy>0)node.y+=dy;y0=node.y+node.dy+nodePadding}dy=y0-nodePadding-size[1];if(dy>0){y0=node.y-=dy;for(i=n-2;i>=0;--i){node=nodes[i];dy=node.y+node.dy+nodePadding-y0;if(dy>0)node.y-=dy;y0=node.y}}})}function ascendingDepth(a,b){return a.y-b.y}}function computeLinkDepths(){nodes.forEach(function(node){node.sourceLinks.sort(ascendingTargetDepth);node.targetLinks.sort(ascendingSourceDepth)});nodes.forEach(function(node){var sy=0,ty=0;node.sourceLinks.forEach(function(link){link.sy=sy;sy+=link.dy});node.targetLinks.forEach(function(link){link.ty=ty;ty+=link.dy})});function ascendingSourceDepth(a,b){return a.source.y-b.source.y}function ascendingTargetDepth(a,b){return a.target.y-b.target.y}}function center(node){return node.y+node.dy/2}function value(link){return link.value}return sankey}exports.version=version;exports.sankey=sankey;Object.defineProperty(exports,"__esModule",{value:true})})},{"d3-array":15,"d3-collection":16,"d3-interpolate":18}],15:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3_array={})})(this,function(exports){"use strict";function ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(compare){if(compare.length===1)compare=ascendingComparator(compare);return{left:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid}return lo},right:function(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1}return lo}}}function ascendingComparator(f){return function(d,x){return ascending(f(d),x)}}var ascendingBisect=bisector(ascending);var bisectRight=ascendingBisect.right;var bisectLeft=ascendingBisect.left;function descending(a,b){return b<a?-1:b>a?1:b>=a?0:NaN}function number$1(x){return x===null?NaN:+x}function variance(array,f){var n=array.length,m=0,a,d,s=0,i=-1,j=0;if(f==null){while(++i<n){if(!isNaN(a=number$1(array[i]))){d=a-m;m+=d/++j;s+=d*(a-m)}}}else{while(++i<n){if(!isNaN(a=number$1(f(array[i],i,array)))){d=a-m;m+=d/++j;s+=d*(a-m)}}}if(j>1)return s/(j-1)}function deviation(array,f){
var v=variance(array,f);return v?Math.sqrt(v):v}function extent(array,f){var i=-1,n=array.length,a,b,c;if(f==null){while(++i<n)if((b=array[i])!=null&&b>=b){a=c=b;break}while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b}}else{while(++i<n)if((b=f(array[i],i,array))!=null&&b>=b){a=c=b;break}while(++i<n)if((b=f(array[i],i,array))!=null){if(a>b)a=b;if(c<b)c=b}}return[a,c]}function constant(x){return function(){return x}}function identity(x){return x}function range(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;var i=-1,n=Math.max(0,Math.ceil((stop-start)/step))|0,range=new Array(n);while(++i<n){range[i]=start+i*step}return range}var e10=Math.sqrt(50);var e5=Math.sqrt(10);var e2=Math.sqrt(2);function ticks(start,stop,count){var step=tickStep(start,stop,count);return range(Math.ceil(start/step)*step,Math.floor(stop/step)*step+step/2,step)}function tickStep(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;if(error>=e10)step1*=10;else if(error>=e5)step1*=5;else if(error>=e2)step1*=2;return stop<start?-step1:step1}function sturges(values){return Math.ceil(Math.log(values.length)/Math.LN2)+1}function number(x){return+x}function histogram(){var value=identity,domain=extent,threshold=sturges;function histogram(data){var i,n=data.length,x,values=new Array(n);for(i=0;i<n;++i){values[i]=+value(data[i],i,data)}var xz=domain(values),x0=+xz[0],x1=+xz[1],tz=threshold(values,x0,x1);if(!Array.isArray(tz))tz=ticks(x0,x1,+tz);var m=tz.length;for(i=0;i<m;++i)tz[i]=+tz[i];while(tz[0]<=x0)tz.shift(),--m;while(tz[m-1]>=x1)tz.pop(),--m;var bins=new Array(m+1),bin;for(i=0;i<=m;++i){bin=bins[i]=[];bin.x0=i>0?tz[i-1]:x0;bin.x1=i<m?tz[i]:x1}for(i=0;i<n;++i){x=values[i];if(x0<=x&&x<=x1){bins[bisectRight(tz,x,0,m)].push(data[i])}}return bins}histogram.value=function(_){return arguments.length?(value=typeof _==="function"?_:constant(+_),histogram):value};histogram.domain=function(_){return arguments.length?(domain=typeof _==="function"?_:constant([+_[0],+_[1]]),histogram):domain};histogram.thresholds=function(_){if(!arguments.length)return threshold;threshold=typeof _==="function"?_:Array.isArray(_)?constant(Array.prototype.map.call(_,number)):constant(+_);return histogram};return histogram}function quantile(array,p,f){if(f==null)f=number$1;if(!(n=array.length))return;if((p=+p)<=0||n<2)return+f(array[0],0,array);if(p>=1)return+f(array[n-1],n-1,array);var n,h=(n-1)*p,i=Math.floor(h),a=+f(array[i],i,array),b=+f(array[i+1],i+1,array);return a+(b-a)*(h-i)}function freedmanDiaconis(values,min,max){values.sort(ascending);return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(values.length,-1/3)))}function scott(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(values.length,-1/3)))}function max(array,f){var i=-1,n=array.length,a,b;if(f==null){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break}while(++i<n)if((b=array[i])!=null&&b>a)a=b}else{while(++i<n)if((b=f(array[i],i,array))!=null&&b>=b){a=b;break}while(++i<n)if((b=f(array[i],i,array))!=null&&b>a)a=b}return a}function mean(array,f){var s=0,n=array.length,a,i=-1,j=n;if(f==null){while(++i<n)if(!isNaN(a=number$1(array[i])))s+=a;else--j}else{while(++i<n)if(!isNaN(a=number$1(f(array[i],i,array))))s+=a;else--j}if(j)return s/j}function median(array,f){var numbers=[],n=array.length,a,i=-1;if(f==null){while(++i<n)if(!isNaN(a=number$1(array[i])))numbers.push(a)}else{while(++i<n)if(!isNaN(a=number$1(f(array[i],i,array))))numbers.push(a)}return quantile(numbers.sort(ascending),.5)}function merge(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m]}}return merged}function min(array,f){var i=-1,n=array.length,a,b;if(f==null){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break}while(++i<n)if((b=array[i])!=null&&a>b)a=b}else{while(++i<n)if((b=f(array[i],i,array))!=null&&b>=b){a=b;break}while(++i<n)if((b=f(array[i],i,array))!=null&&a>b)a=b}return a}function pairs(array){var i=0,n=array.length-1,p=array[0],pairs=new Array(n<0?0:n);while(i<n)pairs[i]=[p,p=array[++i]];return pairs}function permute(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes}function scan(array,compare){if(!(n=array.length))return;var i=0,n,j=0,xi,xj=array[j];if(!compare)compare=ascending;while(++i<n)if(compare(xi=array[i],xj)<0||compare(xj,xj)!==0)xj=xi,j=i;if(compare(xj,xj)===0)return j}function shuffle(array,i0,i1){var m=(i1==null?array.length:i1)-(i0=i0==null?0:+i0),t,i;while(m){i=Math.random()*m--|0;t=array[m+i0];array[m+i0]=array[i+i0];array[i+i0]=t}return array}function sum(array,f){var s=0,n=array.length,a,i=-1;if(f==null){while(++i<n)if(a=+array[i])s+=a}else{while(++i<n)if(a=+f(array[i],i,array))s+=a}return s}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length),transpose=new Array(m);++i<m;){for(var j=-1,n,row=transpose[i]=new Array(n);++j<n;){row[j]=matrix[j][i]}}return transpose}function length(d){return d.length}function zip(){return transpose(arguments)}var version="0.7.1";exports.version=version;exports.bisect=bisectRight;exports.bisectRight=bisectRight;exports.bisectLeft=bisectLeft;exports.ascending=ascending;exports.bisector=bisector;exports.descending=descending;exports.deviation=deviation;exports.extent=extent;exports.histogram=histogram;exports.thresholdFreedmanDiaconis=freedmanDiaconis;exports.thresholdScott=scott;exports.thresholdSturges=sturges;exports.max=max;exports.mean=mean;exports.median=median;exports.merge=merge;exports.min=min;exports.pairs=pairs;exports.permute=permute;exports.quantile=quantile;exports.range=range;exports.scan=scan;exports.shuffle=shuffle;exports.sum=sum;exports.ticks=ticks;exports.tickStep=tickStep;exports.transpose=transpose;exports.variance=variance;exports.zip=zip})},{}],16:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3_collection=global.d3_collection||{})})(this,function(exports){"use strict";var prefix="$";function Map(){}Map.prototype=map.prototype={constructor:Map,has:function(key){return prefix+key in this},get:function(key){return this[prefix+key]},set:function(key,value){this[prefix+key]=value;return this},remove:function(key){var property=prefix+key;return property in this&&delete this[property]},clear:function(){for(var property in this)if(property[0]===prefix)delete this[property]},keys:function(){var keys=[];for(var property in this)if(property[0]===prefix)keys.push(property.slice(1));return keys},values:function(){var values=[];for(var property in this)if(property[0]===prefix)values.push(this[property]);return values},entries:function(){var entries=[];for(var property in this)if(property[0]===prefix)entries.push({key:property.slice(1),value:this[property]});return entries},size:function(){var size=0;for(var property in this)if(property[0]===prefix)++size;return size},empty:function(){for(var property in this)if(property[0]===prefix)return false;return true},each:function(f){for(var property in this)if(property[0]===prefix)f(this[property],property.slice(1),this)}};function map(object,f){var map=new Map;if(object instanceof Map)object.each(function(value,key){map.set(key,value)});else if(Array.isArray(object)){var i=-1,n=object.length,o;if(f==null)while(++i<n)map.set(i,object[i]);else while(++i<n)map.set(f(o=object[i],i,object),o)}else if(object)for(var key in object)map.set(key,object[key]);return map}function nest(){var keys=[],sortKeys=[],sortValues,rollup,nest;function apply(array,depth,createResult,setResult){if(depth>=keys.length)return rollup?rollup(array):sortValues?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,value,valuesByKey=map(),values,result=createResult();while(++i<n){if(values=valuesByKey.get(keyValue=key(value=array[i])+"")){values.push(value)}else{valuesByKey.set(keyValue,[value])}}valuesByKey.each(function(values,key){setResult(result,key,apply(values,depth,createResult,setResult))});return result}function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];map.each(function(value,key){array.push({key:key,values:entries(value,depth)})});return sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}return nest={object:function(array){return apply(array,0,createObject,setObject)},map:function(array){return apply(array,0,createMap,setMap)},entries:function(array){return entries(apply(array,0,createMap,setMap),0)},key:function(d){keys.push(d);return nest},sortKeys:function(order){sortKeys[keys.length-1]=order;return nest},sortValues:function(order){sortValues=order;return nest},rollup:function(f){rollup=f;return nest}}}function createObject(){return{}}function setObject(object,key,value){object[key]=value}function createMap(){return map()}function setMap(map,key,value){map.set(key,value)}function Set(){}var proto=map.prototype;Set.prototype=set.prototype={constructor:Set,has:proto.has,add:function(value){value+="";this[prefix+value]=value;return this},remove:proto.remove,clear:proto.clear,values:proto.keys,size:proto.size,empty:proto.empty,each:proto.each};function set(object,f){var set=new Set;if(object instanceof Set)object.each(function(value){set.add(value)});else if(object){var i=-1,n=object.length;if(f==null)while(++i<n)set.add(object[i]);else while(++i<n)set.add(f(object[i],i,object))}return set}function keys(map){var keys=[];for(var key in map)keys.push(key);return keys}function values(map){var values=[];for(var key in map)values.push(map[key]);return values}function entries(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries}var version="0.1.2";exports.version=version;exports.nest=nest;exports.set=set;exports.map=map;exports.keys=keys;exports.values=values;exports.entries=entries})},{}],17:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3_color={})})(this,function(exports){"use strict";function Color(){}var darker=.7;var brighter=1/darker;var reHex3=/^#([0-9a-f]{3})$/;var reHex6=/^#([0-9a-f]{6})$/;var reRgbInteger=/^rgb\(\s*([-+]?\d+)\s*,\s*([-+]?\d+)\s*,\s*([-+]?\d+)\s*\)$/;var reRgbPercent=/^rgb\(\s*([-+]?\d+(?:\.\d+)?)%\s*,\s*([-+]?\d+(?:\.\d+)?)%\s*,\s*([-+]?\d+(?:\.\d+)?)%\s*\)$/;var reHslPercent=/^hsl\(\s*([-+]?\d+(?:\.\d+)?)\s*,\s*([-+]?\d+(?:\.\d+)?)%\s*,\s*([-+]?\d+(?:\.\d+)?)%\s*\)$/;var named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};color.prototype=Color.prototype={displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}};function color(format){var m;format=(format+"").trim().toLowerCase();return(m=reHex3.exec(format))?(m=parseInt(m[1],16),new Rgb(m>>8&15|m>>4&240,m>>4&15|m&240,(m&15)<<4|m&15)):(m=reHex6.exec(format))?rgbn(parseInt(m[1],16)):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3]):(m=reRgbPercent.exec(format))?new Rgb(m[1]*255/100,m[2]*255/100,m[3]*255/100):(m=reHslPercent.exec(format))?new Hsl(m[1],m[2]/100,m[3]/100):named.hasOwnProperty(format)?rgbn(named[format]):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,n&255)}function rgb(r,g,b){if(arguments.length===1){if(!(r instanceof Color))r=color(r);if(r){r=r.rgb();b=r.b;g=r.g;r=r.r}else{r=g=b=NaN}}return new Rgb(r,g,b)}function Rgb(r,g,b){this.r=+r;this.g=+g;this.b=+b}var _rgb=rgb.prototype=Rgb.prototype=new Color;_rgb.brighter=function(k){k=k==null?brighter:Math.pow(brighter,k);return new Rgb(this.r*k,this.g*k,this.b*k)};_rgb.darker=function(k){k=k==null?darker:Math.pow(darker,k);return new Rgb(this.r*k,this.g*k,this.b*k)};_rgb.rgb=function(){return this};_rgb.displayable=function(){return 0<=this.r&&this.r<=255&&(0<=this.g&&this.g<=255)&&(0<=this.b&&this.b<=255)};_rgb.toString=function(){var r=Math.round(this.r),g=Math.round(this.g),b=Math.round(this.b);return"#"+(isNaN(r)||r<=0?"00":r<16?"0"+r.toString(16):r>=255?"ff":r.toString(16))+(isNaN(g)||g<=0?"00":g<16?"0"+g.toString(16):g>=255?"ff":g.toString(16))+(isNaN(b)||b<=0?"00":b<16?"0"+b.toString(16):b>=255?"ff":b.toString(16))};function hsl(h,s,l){if(arguments.length===1){if(h instanceof Hsl){l=h.l;s=h.s;h=h.h}else{if(!(h instanceof Color))h=color(h);if(h){if(h instanceof Hsl)return h;h=h.rgb();var r=h.r/255,g=h.g/255,b=h.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),range=max-min;l=(max+min)/2;if(range){s=l<.5?range/(max+min):range/(2-max-min);if(r===max)h=(g-b)/range+(g<b)*6;else if(g===max)h=(b-r)/range+2;else h=(r-g)/range+4;h*=60}else{h=NaN;s=l>0&&l<1?0:h}}else{h=s=l=NaN}}}return new Hsl(h,s,l)}function Hsl(h,s,l){this.h=+h;this.s=+s;this.l=+l}var _hsl=hsl.prototype=Hsl.prototype=new Color;_hsl.brighter=function(k){k=k==null?brighter:Math.pow(brighter,k);return new Hsl(this.h,this.s,this.l*k)};_hsl.darker=function(k){k=k==null?darker:Math.pow(darker,k);return new Hsl(this.h,this.s,this.l*k)};_hsl.rgb=function(){var h=this.h%360+(this.h<0)*360,s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2))};_hsl.displayable=function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&(0<=this.l&&this.l<=1)};function hsl2rgb(h,m1,m2){return(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)*255}var deg2rad=Math.PI/180;var rad2deg=180/Math.PI;var Kn=18;var Xn=.95047;var Yn=1;var Zn=1.08883;var t0=4/29;var t1=6/29;var t2=3*t1*t1;var t3=t1*t1*t1;function lab(l,a,b){if(arguments.length===1){if(l instanceof Lab){b=l.b;a=l.a;l=l.l}else if(l instanceof Hcl){var h=l.h*deg2rad;b=Math.sin(h)*l.c;a=Math.cos(h)*l.c;l=l.l}else{if(!(l instanceof Rgb))l=rgb(l);b=rgb2xyz(l.r);a=rgb2xyz(l.g);l=rgb2xyz(l.b);var x=xyz2lab((.4124564*b+.3575761*a+.1804375*l)/Xn),y=xyz2lab((.2126729*b+.7151522*a+.072175*l)/Yn),z=xyz2lab((.0193339*b+.119192*a+.9503041*l)/Zn);b=200*(y-z);a=500*(x-y);l=116*y-16}}return new Lab(l,a,b)}function Lab(l,a,b){this.l=+l;this.a=+a;this.b=+b}var _lab=lab.prototype=Lab.prototype=new Color;_lab.brighter=function(k){return new Lab(this.l+Kn*(k==null?1:k),this.a,this.b)};_lab.darker=function(k){return new Lab(this.l-Kn*(k==null?1:k),this.a,this.b)};_lab.rgb=function(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;y=Yn*lab2xyz(y);x=Xn*lab2xyz(x);z=Zn*lab2xyz(z);return new Rgb(xyz2rgb(3.2404542*x-1.5371385*y-.4985314*z),xyz2rgb(-.969266*x+1.8760108*y+.041556*z),xyz2rgb(.0556434*x-.2040259*y+1.0572252*z))};function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+t0}function lab2xyz(t){return t>t1?t*t*t:t2*(t-t0)}function xyz2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2xyz(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hcl(h,c,l){if(arguments.length===1){if(h instanceof Hcl){l=h.l;c=h.c;h=h.h}else{if(!(h instanceof Lab))h=lab(h);l=h.l;c=Math.sqrt(h.a*h.a+h.b*h.b);h=Math.atan2(h.b,h.a)*rad2deg;if(h<0)h+=360}}return new Hcl(h,c,l)}function Hcl(h,c,l){this.h=+h;this.c=+c;this.l=+l}var _hcl=hcl.prototype=Hcl.prototype=new Color;_hcl.brighter=function(k){return new Hcl(this.h,this.c,this.l+Kn*(k==null?1:k))};_hcl.darker=function(k){return new Hcl(this.h,this.c,this.l-Kn*(k==null?1:k))};_hcl.rgb=function(){return lab(this).rgb()};var A=-.14861;var B=+1.78277;var C=-.29227;var D=-.90649;var E=+1.97294;var ED=E*D;var EB=E*B;var BC_DA=B*C-D*A;function cubehelix(h,s,l){if(arguments.length===1){if(h instanceof Cubehelix){l=h.l;s=h.s;h=h.h}else{if(!(h instanceof Rgb))h=rgb(h);var r=h.r/255,g=h.g/255,b=h.b/255;l=(BC_DA*b+ED*r-EB*g)/(BC_DA+ED-EB);var bl=b-l,k=(E*(g-l)-C*bl)/D;s=Math.sqrt(k*k+bl*bl)/(E*l*(1-l));h=s?Math.atan2(k,bl)*rad2deg-120:NaN;if(h<0)h+=360}}return new Cubehelix(h,s,l)}function Cubehelix(h,s,l){this.h=+h;this.s=+s;this.l=+l}var _cubehelix=cubehelix.prototype=Cubehelix.prototype=new Color;_cubehelix.brighter=function(k){k=k==null?brighter:Math.pow(brighter,k);return new Cubehelix(this.h,this.s,this.l*k)};_cubehelix.darker=function(k){k=k==null?darker:Math.pow(darker,k);return new Cubehelix(this.h,this.s,this.l*k)};_cubehelix.rgb=function(){var h=isNaN(this.h)?0:(this.h+120)*deg2rad,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(h),sinh=Math.sin(h);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+D*sinh)),255*(l+a*(E*cosh)))};var version="0.3.4";exports.version=version;exports.color=color;exports.rgb=rgb;exports.hsl=hsl;exports.lab=lab;exports.hcl=hcl;exports.cubehelix=cubehelix})},{}],18:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("d3-color")):typeof define==="function"&&define.amd?define("d3-interpolate",["exports","d3-color"],factory):factory(global.d3_interpolate={},global.d3_color)})(this,function(exports,d3Color){"use strict";function deltaHue(h1,h0){var delta=h1-h0;return delta>180||delta<-180?delta-360*Math.round(delta/360):delta}function cubehelixGamma(gamma){return function(a,b){a=d3Color.cubehelix(a);b=d3Color.cubehelix(b);var ah=isNaN(a.h)?b.h:a.h,as=isNaN(a.s)?b.s:a.s,al=a.l,bh=isNaN(b.h)?0:deltaHue(b.h,ah),bs=isNaN(b.s)?0:b.s-as,bl=b.l-al;return function(t){a.h=ah+bh*t;a.s=as+bs*t;a.l=al+bl*Math.pow(t,gamma);return a+""}}}function cubehelixGammaLong(gamma){return function(a,b){a=d3Color.cubehelix(a);b=d3Color.cubehelix(b);var ah=isNaN(a.h)?b.h:a.h,as=isNaN(a.s)?b.s:a.s,al=a.l,bh=isNaN(b.h)?0:b.h-ah,bs=isNaN(b.s)?0:b.s-as,bl=b.l-al;return function(t){a.h=ah+bh*t;a.s=as+bs*t;a.l=al+bl*Math.pow(t,gamma);return a+""}}}function rgb(a,b){a=d3Color.rgb(a);b=d3Color.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){a.r=ar+br*t;a.g=ag+bg*t;a.b=ab+bb*t;return a+""}}function number(a,b){return a=+a,b-=a,function(t){return a+b*t}}function object(a,b){var i={},c={},k;for(k in a){if(k in b){i[k]=value(a[k],b[k])}else{c[k]=a[k]}}for(k in b){if(!(k in a)){c[k]=b[k]}}return function(t){for(k in i)c[k]=i[k](t);return c}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;var reB=new RegExp(reA.source,"g");function zero(b){return function(){return b}}function one(b){return function(t){return b(t)+""}}function string(a,b){var bi=reA.lastIndex=reB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=reA.exec(a))&&(bm=reB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs}if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm}else{s[++i]=null;q.push({i:i,x:number(am,bm)})}bi=reB.lastIndex}if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs}return s.length<2?q[0]?one(q[0].x):zero(b):(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}var values=[function(a,b){var t=typeof b,c;return(t==="string"?(c=d3Color.color(b))?(b=c,rgb):string:b instanceof d3Color.color?rgb:Array.isArray(b)?array:t==="object"&&isNaN(b)?object:number)(a,b)}];function value(a,b){var i=values.length,f;while(--i>=0&&!(f=values[i](a,b)));return f}function array(a,b){var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i;for(i=0;i<n0;++i)x.push(value(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c}}function round(a,b){return a=+a,b-=a,function(t){return Math.round(a+b*t)}}var rad2deg=180/Math.PI;var identity={a:1,b:0,c:0,d:1,e:0,f:0};var g;function Transform(string){if(!g)g=document.createElementNS("http://www.w3.org/2000/svg","g");if(string)g.setAttribute("transform",string),t=g.transform.baseVal.consolidate();var t,m=t?t.matrix:identity,r0=[m.a,m.b],r1=[m.c,m.d],kx=normalize(r0),kz=dot(r0,r1),ky=normalize(combine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1}this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*rad2deg;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*rad2deg:0}function dot(a,b){return a[0]*b[0]+a[1]*b[1]}function normalize(a){var k=Math.sqrt(dot(a,a));if(k)a[0]/=k,a[1]/=k;return k}function combine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a}function pop(s){return s.length?s.pop()+",":""}function translate(ta,tb,s,q){if(ta[0]!==tb[0]||ta[1]!==tb[1]){var i=s.push("translate(",null,",",null,")");q.push({i:i-4,x:number(ta[0],tb[0])},{i:i-2,x:number(ta[1],tb[1])})}else if(tb[0]||tb[1]){s.push("translate("+tb+")")}}function rotate(ra,rb,s,q){if(ra!==rb){if(ra-rb>180)rb+=360;else if(rb-ra>180)ra+=360;q.push({i:s.push(pop(s)+"rotate(",null,")")-2,x:number(ra,rb)})}else if(rb){s.push(pop(s)+"rotate("+rb+")")}}function skew(wa,wb,s,q){if(wa!==wb){q.push({i:s.push(pop(s)+"skewX(",null,")")-2,x:number(wa,wb)})}else if(wb){s.push(pop(s)+"skewX("+wb+")")}}function scale(ka,kb,s,q){if(ka[0]!==kb[0]||ka[1]!==kb[1]){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:number(ka[0],kb[0])},{i:i-2,x:number(ka[1],kb[1])})}else if(kb[0]!==1||kb[1]!==1){s.push(pop(s)+"scale("+kb+")")}}function transform(a,b){var s=[],q=[];a=new Transform(a),b=new Transform(b);translate(a.translate,b.translate,s,q);rotate(a.rotate,b.rotate,s,q);skew(a.skew,b.skew,s,q);scale(a.scale,b.scale,s,q);a=b=null;return function(t){var i=-1,n=q.length,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("")}}var rho=Math.SQRT2;var rho2=2;var rho4=4;var epsilon2=1e-12;function cosh(x){return((x=Math.exp(x))+1/x)/2}function sinh(x){return((x=Math.exp(x))-1/x)/2}function tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}function zoom(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,i,S;if(d2<epsilon2){S=Math.log(w1/w0)/rho;i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(rho*t*S)]}}else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+rho4*d2)/(2*w0*rho2*d1),b1=(w1*w1-w0*w0-rho4*d2)/(2*w1*rho2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/rho;i=function(t){var s=t*S,coshr0=cosh(r0),u=w0/(rho2*d1)*(coshr0*tanh(rho*s+r0)-sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/cosh(rho*s+r0)]}}i.duration=S*1e3;return i}function hsl(a,b){a=d3Color.hsl(a);b=d3Color.hsl(b);var ah=isNaN(a.h)?b.h:a.h,as=isNaN(a.s)?b.s:a.s,al=a.l,bh=isNaN(b.h)?0:deltaHue(b.h,ah),bs=isNaN(b.s)?0:b.s-as,bl=b.l-al;return function(t){a.h=ah+bh*t;a.s=as+bs*t;a.l=al+bl*t;return a+""}}function hslLong(a,b){a=d3Color.hsl(a);b=d3Color.hsl(b);var ah=isNaN(a.h)?b.h:a.h,as=isNaN(a.s)?b.s:a.s,al=a.l,bh=isNaN(b.h)?0:b.h-ah,bs=isNaN(b.s)?0:b.s-as,bl=b.l-al;return function(t){a.h=ah+bh*t;a.s=as+bs*t;a.l=al+bl*t;return a+""}}function lab(a,b){a=d3Color.lab(a);b=d3Color.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){a.l=al+bl*t;a.a=aa+ba*t;a.b=ab+bb*t;return a+""}}function hcl(a,b){a=d3Color.hcl(a);b=d3Color.hcl(b);var ah=isNaN(a.h)?b.h:a.h,ac=isNaN(a.c)?b.c:a.c,al=a.l,bh=isNaN(b.h)?0:deltaHue(b.h,ah),bc=isNaN(b.c)?0:b.c-ac,bl=b.l-al;return function(t){a.h=ah+bh*t;a.c=ac+bc*t;a.l=al+bl*t;return a+""}}function hclLong(a,b){a=d3Color.hcl(a);b=d3Color.hcl(b);var ah=isNaN(a.h)?b.h:a.h,ac=isNaN(a.c)?b.c:a.c,al=a.l,bh=isNaN(b.h)?0:b.h-ah,bc=isNaN(b.c)?0:b.c-ac,bl=b.l-al;return function(t){a.h=ah+bh*t;a.c=ac+bc*t;a.l=al+bl*t;return a+""}}var cubehelix=cubehelixGamma(1);var cubehelixLong=cubehelixGammaLong(1);var version="0.2.1";exports.version=version;exports.cubehelix=cubehelix;exports.cubehelixLong=cubehelixLong;exports.cubehelixGamma=cubehelixGamma;exports.cubehelixGammaLong=cubehelixGammaLong;exports.array=array;exports.number=number;exports.object=object;exports.round=round;exports.string=string;exports.transform=transform;exports.values=values;exports.value=value;exports.zoom=zoom;exports.rgb=rgb;exports.hsl=hsl;exports.hslLong=hslLong;exports.lab=lab;exports.hcl=hcl;exports.hclLong=hclLong})},{"d3-color":17}],19:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("d3-array"),require("d3-collection"),require("d3-interpolate"),require("d3-format"),require("d3-time"),require("d3-time-format"),require("d3-color")):typeof define==="function"&&define.amd?define(["exports","d3-array","d3-collection","d3-interpolate","d3-format","d3-time","d3-time-format","d3-color"],factory):factory(global.d3=global.d3||{},global.d3,global.d3,global.d3,global.d3,global.d3,global.d3,global.d3)})(this,function(exports,d3Array,d3Collection,d3Interpolate,d3Format,d3Time,d3TimeFormat,d3Color){"use strict";var array=Array.prototype;var map$1=array.map;var slice=array.slice;var implicit={name:"implicit"};function ordinal(range$$1){var index=d3Collection.map(),domain=[],unknown=implicit;range$$1=range$$1==null?[]:slice.call(range$$1);function scale(d){var key=d+"",i=index.get(key);if(!i){if(unknown!==implicit)return unknown;index.set(key,i=domain.push(d))}return range$$1[(i-1)%range$$1.length]}scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[],index=d3Collection.map();var i=-1,n=_.length,d,key;while(++i<n)if(!index.has(key=(d=_[i])+""))index.set(key,domain.push(d));return scale};scale.range=function(_){return arguments.length?(range$$1=slice.call(_),scale):range$$1.slice()};scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown};scale.copy=function(){return ordinal().domain(domain).range(range$$1).unknown(unknown)};return scale}function band(){var scale=ordinal().unknown(undefined),domain=scale.domain,ordinalRange=scale.range,range$$1=[0,1],step,bandwidth,round=false,paddingInner=0,paddingOuter=0,align=.5;delete scale.unknown;function rescale(){var n=domain().length,reverse=range$$1[1]<range$$1[0],start=range$$1[reverse-0],stop=range$$1[1-reverse];step=(stop-start)/Math.max(1,n-paddingInner+paddingOuter*2);if(round)step=Math.floor(step);start+=(stop-start-step*(n-paddingInner))*align;bandwidth=step*(1-paddingInner);if(round)start=Math.round(start),bandwidth=Math.round(bandwidth);var values=d3Array.range(n).map(function(i){return start+step*i});return ordinalRange(reverse?values.reverse():values)}scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()};scale.range=function(_){return arguments.length?(range$$1=[+_[0],+_[1]],rescale()):range$$1.slice()};scale.rangeRound=function(_){return range$$1=[+_[0],+_[1]],round=true,rescale()};scale.bandwidth=function(){return bandwidth};scale.step=function(){return step};scale.round=function(_){return arguments.length?(round=!!_,rescale()):round};scale.padding=function(_){return arguments.length?(paddingInner=paddingOuter=Math.max(0,Math.min(1,_)),rescale()):paddingInner};scale.paddingInner=function(_){return arguments.length?(paddingInner=Math.max(0,Math.min(1,_)),rescale()):paddingInner};scale.paddingOuter=function(_){return arguments.length?(paddingOuter=Math.max(0,Math.min(1,_)),rescale()):paddingOuter};scale.align=function(_){return arguments.length?(align=Math.max(0,Math.min(1,_)),rescale()):align};scale.copy=function(){return band().domain(domain()).range(range$$1).round(round).paddingInner(paddingInner).paddingOuter(paddingOuter).align(align)};return rescale()}function pointish(scale){var copy=scale.copy;scale.padding=scale.paddingOuter;delete scale.paddingInner;delete scale.paddingOuter;scale.copy=function(){return pointish(copy())};return scale}function point(){return pointish(band().paddingInner(1))}var constant=function(x){return function(){return x}};var number=function(x){return+x};var unit=[0,1];function deinterpolateLinear(a,b){return(b-=a=+a)?function(x){return(x-a)/b}:constant(b)}function deinterpolateClamp(deinterpolate){return function(a,b){var d=deinterpolate(a=+a,b=+b);return function(x){return x<=a?0:x>=b?1:d(x)}}}function reinterpolateClamp(reinterpolate){return function(a,b){var r=reinterpolate(a=+a,b=+b);return function(t){return t<=0?a:t>=1?b:r(t)}}}function bimap(domain,range$$1,deinterpolate,reinterpolate){var d0=domain[0],d1=domain[1],r0=range$$1[0],r1=range$$1[1];if(d1<d0)d0=deinterpolate(d1,d0),r0=reinterpolate(r1,r0);else d0=deinterpolate(d0,d1),r0=reinterpolate(r0,r1);return function(x){return r0(d0(x))}}function polymap(domain,range$$1,deinterpolate,reinterpolate){var j=Math.min(domain.length,range$$1.length)-1,d=new Array(j),r=new Array(j),i=-1;if(domain[j]<domain[0]){domain=domain.slice().reverse();range$$1=range$$1.slice().reverse()}while(++i<j){d[i]=deinterpolate(domain[i],domain[i+1]);r[i]=reinterpolate(range$$1[i],range$$1[i+1])}return function(x){var i=d3Array.bisect(domain,x,1,j)-1;return r[i](d[i](x))}}function copy(source,target){return target.domain(source.domain()).range(source.range()).interpolate(source.interpolate()).clamp(source.clamp())}function continuous(deinterpolate,reinterpolate){var domain=unit,range$$1=unit,interpolate$$1=d3Interpolate.interpolate,clamp=false,piecewise,output,input;function rescale(){piecewise=Math.min(domain.length,range$$1.length)>2?polymap:bimap;output=input=null;return scale}function scale(x){return(output||(output=piecewise(domain,range$$1,clamp?deinterpolateClamp(deinterpolate):deinterpolate,interpolate$$1)))(+x)}scale.invert=function(y){
return(input||(input=piecewise(range$$1,domain,deinterpolateLinear,clamp?reinterpolateClamp(reinterpolate):reinterpolate)))(+y)};scale.domain=function(_){return arguments.length?(domain=map$1.call(_,number),rescale()):domain.slice()};scale.range=function(_){return arguments.length?(range$$1=slice.call(_),rescale()):range$$1.slice()};scale.rangeRound=function(_){return range$$1=slice.call(_),interpolate$$1=d3Interpolate.interpolateRound,rescale()};scale.clamp=function(_){return arguments.length?(clamp=!!_,rescale()):clamp};scale.interpolate=function(_){return arguments.length?(interpolate$$1=_,rescale()):interpolate$$1};return rescale()}var tickFormat=function(domain,count,specifier){var start=domain[0],stop=domain[domain.length-1],step=d3Array.tickStep(start,stop,count==null?10:count),precision;specifier=d3Format.formatSpecifier(specifier==null?",f":specifier);switch(specifier.type){case"s":{var value=Math.max(Math.abs(start),Math.abs(stop));if(specifier.precision==null&&!isNaN(precision=d3Format.precisionPrefix(step,value)))specifier.precision=precision;return d3Format.formatPrefix(specifier,value)}case"":case"e":case"g":case"p":case"r":{if(specifier.precision==null&&!isNaN(precision=d3Format.precisionRound(step,Math.max(Math.abs(start),Math.abs(stop)))))specifier.precision=precision-(specifier.type==="e");break}case"f":case"%":{if(specifier.precision==null&&!isNaN(precision=d3Format.precisionFixed(step)))specifier.precision=precision-(specifier.type==="%")*2;break}}return d3Format.format(specifier)};function linearish(scale){var domain=scale.domain;scale.ticks=function(count){var d=domain();return d3Array.ticks(d[0],d[d.length-1],count==null?10:count)};scale.tickFormat=function(count,specifier){return tickFormat(domain(),count,specifier)};scale.nice=function(count){var d=domain(),i=d.length-1,n=count==null?10:count,start=d[0],stop=d[i],step=d3Array.tickStep(start,stop,n);if(step){step=d3Array.tickStep(Math.floor(start/step)*step,Math.ceil(stop/step)*step,n);d[0]=Math.floor(start/step)*step;d[i]=Math.ceil(stop/step)*step;domain(d)}return scale};return scale}function linear(){var scale=continuous(deinterpolateLinear,d3Interpolate.interpolateNumber);scale.copy=function(){return copy(scale,linear())};return linearish(scale)}function identity(){var domain=[0,1];function scale(x){return+x}scale.invert=scale;scale.domain=scale.range=function(_){return arguments.length?(domain=map$1.call(_,number),scale):domain.slice()};scale.copy=function(){return identity().domain(domain)};return linearish(scale)}var nice=function(domain,interval){domain=domain.slice();var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],t;if(x1<x0){t=i0,i0=i1,i1=t;t=x0,x0=x1,x1=t}domain[i0]=interval.floor(x0);domain[i1]=interval.ceil(x1);return domain};function deinterpolate(a,b){return(b=Math.log(b/a))?function(x){return Math.log(x/a)/b}:constant(b)}function reinterpolate(a,b){return a<0?function(t){return-Math.pow(-b,t)*Math.pow(-a,1-t)}:function(t){return Math.pow(b,t)*Math.pow(a,1-t)}}function pow10(x){return isFinite(x)?+("1e"+x):x<0?0:x}function powp(base){return base===10?pow10:base===Math.E?Math.exp:function(x){return Math.pow(base,x)}}function logp(base){return base===Math.E?Math.log:base===10&&Math.log10||base===2&&Math.log2||(base=Math.log(base),function(x){return Math.log(x)/base})}function reflect(f){return function(x){return-f(-x)}}function log(){var scale=continuous(deinterpolate,reinterpolate).domain([1,10]),domain=scale.domain,base=10,logs=logp(10),pows=powp(10);function rescale(){logs=logp(base),pows=powp(base);if(domain()[0]<0)logs=reflect(logs),pows=reflect(pows);return scale}scale.base=function(_){return arguments.length?(base=+_,rescale()):base};scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()};scale.ticks=function(count){var d=domain(),u=d[0],v=d[d.length-1],r;if(r=v<u)i=u,u=v,v=i;var i=logs(u),j=logs(v),p,k,t,n=count==null?10:+count,z=[];if(!(base%1)&&j-i<n){i=Math.round(i)-1,j=Math.round(j)+1;if(u>0)for(;i<j;++i){for(k=1,p=pows(i);k<base;++k){t=p*k;if(t<u)continue;if(t>v)break;z.push(t)}}else for(;i<j;++i){for(k=base-1,p=pows(i);k>=1;--k){t=p*k;if(t<u)continue;if(t>v)break;z.push(t)}}}else{z=d3Array.ticks(i,j,Math.min(j-i,n)).map(pows)}return r?z.reverse():z};scale.tickFormat=function(count,specifier){if(specifier==null)specifier=base===10?".0e":",";if(typeof specifier!=="function")specifier=d3Format.format(specifier);if(count===Infinity)return specifier;if(count==null)count=10;var k=Math.max(1,base*count/scale.ticks().length);return function(d){var i=d/pows(Math.round(logs(d)));if(i*base<base-.5)i*=base;return i<=k?specifier(d):""}};scale.nice=function(){return domain(nice(domain(),{floor:function(x){return pows(Math.floor(logs(x)))},ceil:function(x){return pows(Math.ceil(logs(x)))}}))};scale.copy=function(){return copy(scale,log().base(base))};return scale}function raise(x,exponent){return x<0?-Math.pow(-x,exponent):Math.pow(x,exponent)}function pow(){var exponent=1,scale=continuous(deinterpolate,reinterpolate),domain=scale.domain;function deinterpolate(a,b){return(b=raise(b,exponent)-(a=raise(a,exponent)))?function(x){return(raise(x,exponent)-a)/b}:constant(b)}function reinterpolate(a,b){b=raise(b,exponent)-(a=raise(a,exponent));return function(t){return raise(a+b*t,1/exponent)}}scale.exponent=function(_){return arguments.length?(exponent=+_,domain(domain())):exponent};scale.copy=function(){return copy(scale,pow().exponent(exponent))};return linearish(scale)}function sqrt(){return pow().exponent(.5)}function quantile$1(){var domain=[],range$$1=[],thresholds=[];function rescale(){var i=0,n=Math.max(1,range$$1.length);thresholds=new Array(n-1);while(++i<n)thresholds[i-1]=d3Array.quantile(domain,i/n);return scale}function scale(x){if(!isNaN(x=+x))return range$$1[d3Array.bisect(thresholds,x)]}scale.invertExtent=function(y){var i=range$$1.indexOf(y);return i<0?[NaN,NaN]:[i>0?thresholds[i-1]:domain[0],i<thresholds.length?thresholds[i]:domain[domain.length-1]]};scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[];for(var i=0,n=_.length,d;i<n;++i)if(d=_[i],d!=null&&!isNaN(d=+d))domain.push(d);domain.sort(d3Array.ascending);return rescale()};scale.range=function(_){return arguments.length?(range$$1=slice.call(_),rescale()):range$$1.slice()};scale.quantiles=function(){return thresholds.slice()};scale.copy=function(){return quantile$1().domain(domain).range(range$$1)};return scale}function quantize(){var x0=0,x1=1,n=1,domain=[.5],range$$1=[0,1];function scale(x){if(x<=x)return range$$1[d3Array.bisect(domain,x,0,n)]}function rescale(){var i=-1;domain=new Array(n);while(++i<n)domain[i]=((i+1)*x1-(i-n)*x0)/(n+1);return scale}scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],rescale()):[x0,x1]};scale.range=function(_){return arguments.length?(n=(range$$1=slice.call(_)).length-1,rescale()):range$$1.slice()};scale.invertExtent=function(y){var i=range$$1.indexOf(y);return i<0?[NaN,NaN]:i<1?[x0,domain[0]]:i>=n?[domain[n-1],x1]:[domain[i-1],domain[i]]};scale.copy=function(){return quantize().domain([x0,x1]).range(range$$1)};return linearish(scale)}function threshold(){var domain=[.5],range$$1=[0,1],n=1;function scale(x){if(x<=x)return range$$1[d3Array.bisect(domain,x,0,n)]}scale.domain=function(_){return arguments.length?(domain=slice.call(_),n=Math.min(domain.length,range$$1.length-1),scale):domain.slice()};scale.range=function(_){return arguments.length?(range$$1=slice.call(_),n=Math.min(domain.length,range$$1.length-1),scale):range$$1.slice()};scale.invertExtent=function(y){var i=range$$1.indexOf(y);return[domain[i-1],domain[i]]};scale.copy=function(){return threshold().domain(domain).range(range$$1)};return scale}var durationSecond=1e3;var durationMinute=durationSecond*60;var durationHour=durationMinute*60;var durationDay=durationHour*24;var durationWeek=durationDay*7;var durationMonth=durationDay*30;var durationYear=durationDay*365;function date(t){return new Date(t)}function number$1(t){return t instanceof Date?+t:+new Date(+t)}function calendar(year,month,week,day,hour,minute,second,millisecond,format$$1){var scale=continuous(deinterpolateLinear,d3Interpolate.interpolateNumber),invert=scale.invert,domain=scale.domain;var formatMillisecond=format$$1(".%L"),formatSecond=format$$1(":%S"),formatMinute=format$$1("%I:%M"),formatHour=format$$1("%I %p"),formatDay=format$$1("%a %d"),formatWeek=format$$1("%b %d"),formatMonth=format$$1("%B"),formatYear=format$$1("%Y");var tickIntervals=[[second,1,durationSecond],[second,5,5*durationSecond],[second,15,15*durationSecond],[second,30,30*durationSecond],[minute,1,durationMinute],[minute,5,5*durationMinute],[minute,15,15*durationMinute],[minute,30,30*durationMinute],[hour,1,durationHour],[hour,3,3*durationHour],[hour,6,6*durationHour],[hour,12,12*durationHour],[day,1,durationDay],[day,2,2*durationDay],[week,1,durationWeek],[month,1,durationMonth],[month,3,3*durationMonth],[year,1,durationYear]];function tickFormat(date){return(second(date)<date?formatMillisecond:minute(date)<date?formatSecond:hour(date)<date?formatMinute:day(date)<date?formatHour:month(date)<date?week(date)<date?formatDay:formatWeek:year(date)<date?formatMonth:formatYear)(date)}function tickInterval(interval,start,stop,step){if(interval==null)interval=10;if(typeof interval==="number"){var target=Math.abs(stop-start)/interval,i=d3Array.bisector(function(i){return i[2]}).right(tickIntervals,target);if(i===tickIntervals.length){step=d3Array.tickStep(start/durationYear,stop/durationYear,interval);interval=year}else if(i){i=tickIntervals[target/tickIntervals[i-1][2]<tickIntervals[i][2]/target?i-1:i];step=i[1];interval=i[0]}else{step=d3Array.tickStep(start,stop,interval);interval=millisecond}}return step==null?interval:interval.every(step)}scale.invert=function(y){return new Date(invert(y))};scale.domain=function(_){return arguments.length?domain(map$1.call(_,number$1)):domain().map(date)};scale.ticks=function(interval,step){var d=domain(),t0=d[0],t1=d[d.length-1],r=t1<t0,t;if(r)t=t0,t0=t1,t1=t;t=tickInterval(interval,t0,t1,step);t=t?t.range(t0,t1+1):[];return r?t.reverse():t};scale.tickFormat=function(count,specifier){return specifier==null?tickFormat:format$$1(specifier)};scale.nice=function(interval,step){var d=domain();return(interval=tickInterval(interval,d[0],d[d.length-1],step))?domain(nice(d,interval)):scale};scale.copy=function(){return copy(scale,calendar(year,month,week,day,hour,minute,second,millisecond,format$$1))};return scale}var time=function(){return calendar(d3Time.timeYear,d3Time.timeMonth,d3Time.timeWeek,d3Time.timeDay,d3Time.timeHour,d3Time.timeMinute,d3Time.timeSecond,d3Time.timeMillisecond,d3TimeFormat.timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)])};var utcTime=function(){return calendar(d3Time.utcYear,d3Time.utcMonth,d3Time.utcWeek,d3Time.utcDay,d3Time.utcHour,d3Time.utcMinute,d3Time.utcSecond,d3Time.utcMillisecond,d3TimeFormat.utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)])};var colors=function(s){return s.match(/.{6}/g).map(function(x){return"#"+x})};var category10=colors("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");var category20b=colors("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6");var category20c=colors("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9");var category20=colors("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5");var cubehelix$1=d3Interpolate.interpolateCubehelixLong(d3Color.cubehelix(300,.5,0),d3Color.cubehelix(-240,.5,1));var warm=d3Interpolate.interpolateCubehelixLong(d3Color.cubehelix(-100,.75,.35),d3Color.cubehelix(80,1.5,.8));var cool=d3Interpolate.interpolateCubehelixLong(d3Color.cubehelix(260,.75,.35),d3Color.cubehelix(80,1.5,.8));var rainbow=d3Color.cubehelix();var rainbow$1=function(t){if(t<0||t>1)t-=Math.floor(t);var ts=Math.abs(t-.5);rainbow.h=360*t-100;rainbow.s=1.5-1.5*ts;rainbow.l=.8-.9*ts;return rainbow+""};function ramp(range$$1){var n=range$$1.length;return function(t){return range$$1[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}}var viridis=ramp(colors("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var magma=ramp(colors("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));var inferno=ramp(colors("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));var plasma=ramp(colors("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function sequential(interpolator){var x0=0,x1=1,clamp=false;function scale(x){var t=(x-x0)/(x1-x0);return interpolator(clamp?Math.max(0,Math.min(1,t)):t)}scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],scale):[x0,x1]};scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp};scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator};scale.copy=function(){return sequential(interpolator).domain([x0,x1]).clamp(clamp)};return linearish(scale)}exports.scaleBand=band;exports.scalePoint=point;exports.scaleIdentity=identity;exports.scaleLinear=linear;exports.scaleLog=log;exports.scaleOrdinal=ordinal;exports.scaleImplicit=implicit;exports.scalePow=pow;exports.scaleSqrt=sqrt;exports.scaleQuantile=quantile$1;exports.scaleQuantize=quantize;exports.scaleThreshold=threshold;exports.scaleTime=time;exports.scaleUtc=utcTime;exports.schemeCategory10=category10;exports.schemeCategory20b=category20b;exports.schemeCategory20c=category20c;exports.schemeCategory20=category20;exports.interpolateCubehelixDefault=cubehelix$1;exports.interpolateRainbow=rainbow$1;exports.interpolateWarm=warm;exports.interpolateCool=cool;exports.interpolateViridis=viridis;exports.interpolateMagma=magma;exports.interpolateInferno=inferno;exports.interpolatePlasma=plasma;exports.scaleSequential=sequential;Object.defineProperty(exports,"__esModule",{value:true})})},{"d3-array":6,"d3-collection":7,"d3-color":8,"d3-format":9,"d3-interpolate":12,"d3-time":22,"d3-time-format":21}],20:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("d3-path")):typeof define==="function"&&define.amd?define(["exports","d3-path"],factory):factory(global.d3=global.d3||{},global.d3)})(this,function(exports,d3Path){"use strict";var constant=function(x){return function constant(){return x}};var abs=Math.abs;var atan2=Math.atan2;var cos=Math.cos;var max=Math.max;var min=Math.min;var sin=Math.sin;var sqrt=Math.sqrt;var epsilon=1e-12;var pi=Math.PI;var halfPi=pi/2;var tau=2*pi;function acos(x){return x>1?0:x<-1?pi:Math.acos(x)}function asin(x){return x>=1?halfPi:x<=-1?-halfPi:Math.asin(x)}function arcInnerRadius(d){return d.innerRadius}function arcOuterRadius(d){return d.outerRadius}function arcStartAngle(d){return d.startAngle}function arcEndAngle(d){return d.endAngle}function arcPadAngle(d){return d&&d.padAngle}function intersect(x0,y0,x1,y1,x2,y2,x3,y3){var x10=x1-x0,y10=y1-y0,x32=x3-x2,y32=y3-y2,t=(x32*(y0-y2)-y32*(x0-x2))/(y32*x10-x32*y10);return[x0+t*x10,y0+t*y10]}function cornerTangents(x0,y0,x1,y1,r1,rc,cw){var x01=x0-x1,y01=y0-y1,lo=(cw?rc:-rc)/sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x11=x0+ox,y11=y0+oy,x10=x1+ox,y10=y1+oy,x00=(x11+x10)/2,y00=(y11+y10)/2,dx=x10-x11,dy=y10-y11,d2=dx*dx+dy*dy,r=r1-rc,D=x11*y10-x10*y11,d=(dy<0?-1:1)*sqrt(max(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x00,dy0=cy0-y00,dx1=cx1-x00,dy1=cy1-y00;if(dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1)cx0=cx1,cy0=cy1;return{cx:cx0,cy:cy0,x01:-ox,y01:-oy,x11:cx0*(r1/r-1),y11:cy0*(r1/r-1)}}var arc=function(){var innerRadius=arcInnerRadius,outerRadius=arcOuterRadius,cornerRadius=constant(0),padRadius=null,startAngle=arcStartAngle,endAngle=arcEndAngle,padAngle=arcPadAngle,context=null;function arc(){var buffer,r,r0=+innerRadius.apply(this,arguments),r1=+outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)-halfPi,a1=endAngle.apply(this,arguments)-halfPi,da=abs(a1-a0),cw=a1>a0;if(!context)context=buffer=d3Path.path();if(r1<r0)r=r1,r1=r0,r0=r;if(!(r1>epsilon))context.moveTo(0,0);else if(da>tau-epsilon){context.moveTo(r1*cos(a0),r1*sin(a0));context.arc(0,0,r1,a0,a1,!cw);if(r0>epsilon){context.moveTo(r0*cos(a1),r0*sin(a1));context.arc(0,0,r0,a1,a0,cw)}}else{var a01=a0,a11=a1,a00=a0,a10=a1,da0=da,da1=da,ap=padAngle.apply(this,arguments)/2,rp=ap>epsilon&&(padRadius?+padRadius.apply(this,arguments):sqrt(r0*r0+r1*r1)),rc=min(abs(r1-r0)/2,+cornerRadius.apply(this,arguments)),rc0=rc,rc1=rc,t0,t1;if(rp>epsilon){var p0=asin(rp/r0*sin(ap)),p1=asin(rp/r1*sin(ap));if((da0-=p0*2)>epsilon)p0*=cw?1:-1,a00+=p0,a10-=p0;else da0=0,a00=a10=(a0+a1)/2;if((da1-=p1*2)>epsilon)p1*=cw?1:-1,a01+=p1,a11-=p1;else da1=0,a01=a11=(a0+a1)/2}var x01=r1*cos(a01),y01=r1*sin(a01),x10=r0*cos(a10),y10=r0*sin(a10);if(rc>epsilon){var x11=r1*cos(a11),y11=r1*sin(a11),x00=r0*cos(a00),y00=r0*sin(a00);if(da<pi){var oc=da0>epsilon?intersect(x01,y01,x00,y00,x11,y11,x10,y10):[x10,y10],ax=x01-oc[0],ay=y01-oc[1],bx=x11-oc[0],by=y11-oc[1],kc=1/sin(acos((ax*bx+ay*by)/(sqrt(ax*ax+ay*ay)*sqrt(bx*bx+by*by)))/2),lc=sqrt(oc[0]*oc[0]+oc[1]*oc[1]);rc0=min(rc,(r0-lc)/(kc-1));rc1=min(rc,(r1-lc)/(kc+1))}}if(!(da1>epsilon))context.moveTo(x01,y01);else if(rc1>epsilon){t0=cornerTangents(x00,y00,x01,y01,r1,rc1,cw);t1=cornerTangents(x11,y11,x10,y10,r1,rc1,cw);context.moveTo(t0.cx+t0.x01,t0.cy+t0.y01);if(rc1<rc)context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw);else{context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw);context.arc(0,0,r1,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),!cw);context.arc(t1.cx,t1.cy,rc1,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw)}}else context.moveTo(x01,y01),context.arc(0,0,r1,a01,a11,!cw);if(!(r0>epsilon)||!(da0>epsilon))context.lineTo(x10,y10);else if(rc0>epsilon){t0=cornerTangents(x10,y10,x11,y11,r0,-rc0,cw);t1=cornerTangents(x01,y01,x00,y00,r0,-rc0,cw);context.lineTo(t0.cx+t0.x01,t0.cy+t0.y01);if(rc0<rc)context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw);else{context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw);context.arc(0,0,r0,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),cw);context.arc(t1.cx,t1.cy,rc0,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw)}}else context.arc(0,0,r0,a10,a00,cw)}context.closePath();if(buffer)return context=null,buffer+""||null}arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-pi/2;return[cos(a)*r,sin(a)*r]};arc.innerRadius=function(_){return arguments.length?(innerRadius=typeof _==="function"?_:constant(+_),arc):innerRadius};arc.outerRadius=function(_){return arguments.length?(outerRadius=typeof _==="function"?_:constant(+_),arc):outerRadius};arc.cornerRadius=function(_){return arguments.length?(cornerRadius=typeof _==="function"?_:constant(+_),arc):cornerRadius};arc.padRadius=function(_){return arguments.length?(padRadius=_==null?null:typeof _==="function"?_:constant(+_),arc):padRadius};arc.startAngle=function(_){return arguments.length?(startAngle=typeof _==="function"?_:constant(+_),arc):startAngle};arc.endAngle=function(_){return arguments.length?(endAngle=typeof _==="function"?_:constant(+_),arc):endAngle};arc.padAngle=function(_){return arguments.length?(padAngle=typeof _==="function"?_:constant(+_),arc):padAngle};arc.context=function(_){return arguments.length?(context=_==null?null:_,arc):context};return arc};function Linear(context){this._context=context}Linear.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:this._context.lineTo(x,y);break}}};var curveLinear=function(context){return new Linear(context)};function x(p){return p[0]}function y(p){return p[1]}var line=function(){var x$$1=x,y$$1=y,defined=constant(true),context=null,curve=curveLinear,output=null;function line(data){var i,n=data.length,d,defined0=false,buffer;if(context==null)output=curve(buffer=d3Path.path());for(i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0){if(defined0=!defined0)output.lineStart();else output.lineEnd()}if(defined0)output.point(+x$$1(d,i,data),+y$$1(d,i,data))}if(buffer)return output=null,buffer+""||null}line.x=function(_){return arguments.length?(x$$1=typeof _==="function"?_:constant(+_),line):x$$1};line.y=function(_){return arguments.length?(y$$1=typeof _==="function"?_:constant(+_),line):y$$1};line.defined=function(_){return arguments.length?(defined=typeof _==="function"?_:constant(!!_),line):defined};line.curve=function(_){return arguments.length?(curve=_,context!=null&&(output=curve(context)),line):curve};line.context=function(_){return arguments.length?(_==null?context=output=null:output=curve(context=_),line):context};return line};var area=function(){var x0=x,x1=null,y0=constant(0),y1=y,defined=constant(true),context=null,curve=curveLinear,output=null;function area(data){var i,j,k,n=data.length,d,defined0=false,buffer,x0z=new Array(n),y0z=new Array(n);if(context==null)output=curve(buffer=d3Path.path());for(i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0){if(defined0=!defined0){j=i;output.areaStart();output.lineStart()}else{output.lineEnd();output.lineStart();for(k=i-1;k>=j;--k){output.point(x0z[k],y0z[k])}output.lineEnd();output.areaEnd()}}if(defined0){x0z[i]=+x0(d,i,data),y0z[i]=+y0(d,i,data);output.point(x1?+x1(d,i,data):x0z[i],y1?+y1(d,i,data):y0z[i])}}if(buffer)return output=null,buffer+""||null}function arealine(){return line().defined(defined).curve(curve).context(context)}area.x=function(_){return arguments.length?(x0=typeof _==="function"?_:constant(+_),x1=null,area):x0};area.x0=function(_){return arguments.length?(x0=typeof _==="function"?_:constant(+_),area):x0};area.x1=function(_){return arguments.length?(x1=_==null?null:typeof _==="function"?_:constant(+_),area):x1};area.y=function(_){return arguments.length?(y0=typeof _==="function"?_:constant(+_),y1=null,area):y0};area.y0=function(_){return arguments.length?(y0=typeof _==="function"?_:constant(+_),area):y0};area.y1=function(_){return arguments.length?(y1=_==null?null:typeof _==="function"?_:constant(+_),area):y1};area.lineX0=area.lineY0=function(){return arealine().x(x0).y(y0)};area.lineY1=function(){return arealine().x(x0).y(y1)};area.lineX1=function(){return arealine().x(x1).y(y0)};area.defined=function(_){return arguments.length?(defined=typeof _==="function"?_:constant(!!_),area):defined};area.curve=function(_){return arguments.length?(curve=_,context!=null&&(output=curve(context)),area):curve};area.context=function(_){return arguments.length?(_==null?context=output=null:output=curve(context=_),area):context};return area};var descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN};var identity=function(d){return d};var pie=function(){var value=identity,sortValues=descending,sort=null,startAngle=constant(0),endAngle=constant(tau),padAngle=constant(0);function pie(data){var i,n=data.length,j,k,sum=0,index=new Array(n),arcs=new Array(n),a0=+startAngle.apply(this,arguments),da=Math.min(tau,Math.max(-tau,endAngle.apply(this,arguments)-a0)),a1,p=Math.min(Math.abs(da)/n,padAngle.apply(this,arguments)),pa=p*(da<0?-1:1),v;for(i=0;i<n;++i){if((v=arcs[index[i]=i]=+value(data[i],i,data))>0){sum+=v}}if(sortValues!=null)index.sort(function(i,j){return sortValues(arcs[i],arcs[j])});else if(sort!=null)index.sort(function(i,j){return sort(data[i],data[j])});for(i=0,k=sum?(da-n*pa)/sum:0;i<n;++i,a0=a1){j=index[i],v=arcs[j],a1=a0+(v>0?v*k:0)+pa,arcs[j]={data:data[j],index:i,value:v,startAngle:a0,endAngle:a1,padAngle:p}}return arcs}pie.value=function(_){return arguments.length?(value=typeof _==="function"?_:constant(+_),pie):value};pie.sortValues=function(_){return arguments.length?(sortValues=_,sort=null,pie):sortValues};pie.sort=function(_){return arguments.length?(sort=_,sortValues=null,pie):sort};pie.startAngle=function(_){return arguments.length?(startAngle=typeof _==="function"?_:constant(+_),pie):startAngle};pie.endAngle=function(_){return arguments.length?(endAngle=typeof _==="function"?_:constant(+_),pie):endAngle};pie.padAngle=function(_){return arguments.length?(padAngle=typeof _==="function"?_:constant(+_),pie):padAngle};return pie};var curveRadialLinear=curveRadial(curveLinear);function Radial(curve){this._curve=curve}Radial.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(a,r){this._curve.point(r*Math.sin(a),r*-Math.cos(a))}};function curveRadial(curve){function radial(context){return new Radial(curve(context))}radial._curve=curve;return radial}function radialLine(l){var c=l.curve;l.angle=l.x,delete l.x;l.radius=l.y,delete l.y;l.curve=function(_){return arguments.length?c(curveRadial(_)):c()._curve};return l}var radialLine$1=function(){return radialLine(line().curve(curveRadialLinear))};var radialArea=function(){var a=area().curve(curveRadialLinear),c=a.curve,x0=a.lineX0,x1=a.lineX1,y0=a.lineY0,y1=a.lineY1;a.angle=a.x,delete a.x;a.startAngle=a.x0,delete a.x0;a.endAngle=a.x1,delete a.x1;a.radius=a.y,delete a.y;a.innerRadius=a.y0,delete a.y0;a.outerRadius=a.y1,delete a.y1;a.lineStartAngle=function(){return radialLine(x0())},delete a.lineX0;a.lineEndAngle=function(){return radialLine(x1())},delete a.lineX1;a.lineInnerRadius=function(){return radialLine(y0())},delete a.lineY0;a.lineOuterRadius=function(){return radialLine(y1())},delete a.lineY1;a.curve=function(_){return arguments.length?c(curveRadial(_)):c()._curve}
;return a};var circle={draw:function(context,size){var r=Math.sqrt(size/pi);context.moveTo(r,0);context.arc(0,0,r,0,tau)}};var cross={draw:function(context,size){var r=Math.sqrt(size/5)/2;context.moveTo(-3*r,-r);context.lineTo(-r,-r);context.lineTo(-r,-3*r);context.lineTo(r,-3*r);context.lineTo(r,-r);context.lineTo(3*r,-r);context.lineTo(3*r,r);context.lineTo(r,r);context.lineTo(r,3*r);context.lineTo(-r,3*r);context.lineTo(-r,r);context.lineTo(-3*r,r);context.closePath()}};var tan30=Math.sqrt(1/3);var tan30_2=tan30*2;var diamond={draw:function(context,size){var y=Math.sqrt(size/tan30_2),x=y*tan30;context.moveTo(0,-y);context.lineTo(x,0);context.lineTo(0,y);context.lineTo(-x,0);context.closePath()}};var ka=.8908130915292852;var kr=Math.sin(pi/10)/Math.sin(7*pi/10);var kx=Math.sin(tau/10)*kr;var ky=-Math.cos(tau/10)*kr;var star={draw:function(context,size){var r=Math.sqrt(size*ka),x=kx*r,y=ky*r;context.moveTo(0,-r);context.lineTo(x,y);for(var i=1;i<5;++i){var a=tau*i/5,c=Math.cos(a),s=Math.sin(a);context.lineTo(s*r,-c*r);context.lineTo(c*x-s*y,s*x+c*y)}context.closePath()}};var square={draw:function(context,size){var w=Math.sqrt(size),x=-w/2;context.rect(x,x,w,w)}};var sqrt3=Math.sqrt(3);var triangle={draw:function(context,size){var y=-Math.sqrt(size/(sqrt3*3));context.moveTo(0,y*2);context.lineTo(-sqrt3*y,-y);context.lineTo(sqrt3*y,-y);context.closePath()}};var c=-.5;var s=Math.sqrt(3)/2;var k=1/Math.sqrt(12);var a=(k/2+1)*3;var wye={draw:function(context,size){var r=Math.sqrt(size/a),x0=r/2,y0=r*k,x1=x0,y1=r*k+r,x2=-x1,y2=y1;context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2);context.lineTo(c*x0-s*y0,s*x0+c*y0);context.lineTo(c*x1-s*y1,s*x1+c*y1);context.lineTo(c*x2-s*y2,s*x2+c*y2);context.lineTo(c*x0+s*y0,c*y0-s*x0);context.lineTo(c*x1+s*y1,c*y1-s*x1);context.lineTo(c*x2+s*y2,c*y2-s*x2);context.closePath()}};var symbols=[circle,cross,diamond,square,star,triangle,wye];var symbol=function(){var type=constant(circle),size=constant(64),context=null;function symbol(){var buffer;if(!context)context=buffer=d3Path.path();type.apply(this,arguments).draw(context,+size.apply(this,arguments));if(buffer)return context=null,buffer+""||null}symbol.type=function(_){return arguments.length?(type=typeof _==="function"?_:constant(_),symbol):type};symbol.size=function(_){return arguments.length?(size=typeof _==="function"?_:constant(+_),symbol):size};symbol.context=function(_){return arguments.length?(context=_==null?null:_,symbol):context};return symbol};var noop=function(){};function point(that,x,y){that._context.bezierCurveTo((2*that._x0+that._x1)/3,(2*that._y0+that._y1)/3,(that._x0+2*that._x1)/3,(that._y0+2*that._y1)/3,(that._x0+4*that._x1+x)/6,(that._y0+4*that._y1+y)/6)}function Basis(context){this._context=context}Basis.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function(){switch(this._point){case 3:point(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:point(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};var basis=function(context){return new Basis(context)};function BasisClosed(context){this._context=context}BasisClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN;this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2);this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3);this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3);this._context.closePath();break}case 3:{this.point(this._x2,this._y2);this.point(this._x3,this._y3);this.point(this._x4,this._y4);break}}},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._x2=x,this._y2=y;break;case 1:this._point=2;this._x3=x,this._y3=y;break;case 2:this._point=3;this._x4=x,this._y4=y;this._context.moveTo((this._x0+4*this._x1+x)/6,(this._y0+4*this._y1+y)/6);break;default:point(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};var basisClosed=function(context){return new BasisClosed(context)};function BasisOpen(context){this._context=context}BasisOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var x0=(this._x0+4*this._x1+x)/6,y0=(this._y0+4*this._y1+y)/6;this._line?this._context.lineTo(x0,y0):this._context.moveTo(x0,y0);break;case 3:this._point=4;default:point(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};var basisOpen=function(context){return new BasisOpen(context)};function Bundle(context,beta){this._basis=new Basis(context);this._beta=beta}Bundle.prototype={lineStart:function(){this._x=[];this._y=[];this._basis.lineStart()},lineEnd:function(){var x=this._x,y=this._y,j=x.length-1;if(j>0){var x0=x[0],y0=y[0],dx=x[j]-x0,dy=y[j]-y0,i=-1,t;while(++i<=j){t=i/j;this._basis.point(this._beta*x[i]+(1-this._beta)*(x0+t*dx),this._beta*y[i]+(1-this._beta)*(y0+t*dy))}}this._x=this._y=null;this._basis.lineEnd()},point:function(x,y){this._x.push(+x);this._y.push(+y)}};var bundle=function custom(beta){function bundle(context){return beta===1?new Basis(context):new Bundle(context,beta)}bundle.beta=function(beta){return custom(+beta)};return bundle}(.85);function point$1(that,x,y){that._context.bezierCurveTo(that._x1+that._k*(that._x2-that._x0),that._y1+that._k*(that._y2-that._y0),that._x2+that._k*(that._x1-x),that._y2+that._k*(that._y1-y),that._x2,that._y2)}function Cardinal(context,tension){this._context=context;this._k=(1-tension)/6}Cardinal.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:point$1(this,this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;this._x1=x,this._y1=y;break;case 2:this._point=3;default:point$1(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var cardinal=function custom(tension){function cardinal(context){return new Cardinal(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function CardinalClosed(context,tension){this._context=context;this._k=(1-tension)/6}CardinalClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3);this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3);this._context.closePath();break}case 3:{this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}}},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._x3=x,this._y3=y;break;case 1:this._point=2;this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3;this._x5=x,this._y5=y;break;default:point$1(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var cardinalClosed=function custom(tension){function cardinal(context){return new CardinalClosed(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function CardinalOpen(context,tension){this._context=context;this._k=(1-tension)/6}CardinalOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$1(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var cardinalOpen=function custom(tension){function cardinal(context){return new CardinalOpen(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function point$2(that,x,y){var x1=that._x1,y1=that._y1,x2=that._x2,y2=that._y2;if(that._l01_a>epsilon){var a=2*that._l01_2a+3*that._l01_a*that._l12_a+that._l12_2a,n=3*that._l01_a*(that._l01_a+that._l12_a);x1=(x1*a-that._x0*that._l12_2a+that._x2*that._l01_2a)/n;y1=(y1*a-that._y0*that._l12_2a+that._y2*that._l01_2a)/n}if(that._l23_a>epsilon){var b=2*that._l23_2a+3*that._l23_a*that._l12_a+that._l12_2a,m=3*that._l23_a*(that._l23_a+that._l12_a);x2=(x2*b+that._x1*that._l23_2a-x*that._l12_2a)/m;y2=(y2*b+that._y1*that._l23_2a-y*that._l12_2a)/m}that._context.bezierCurveTo(x1,y1,x2,y2,that._x2,that._y2)}function CatmullRom(context,alpha){this._context=context;this._alpha=alpha}CatmullRom.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;default:point$2(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var catmullRom=function custom(alpha){function catmullRom(context){return alpha?new CatmullRom(context,alpha):new Cardinal(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function CatmullRomClosed(context,alpha){this._context=context;this._alpha=alpha}CatmullRomClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3);this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3);this._context.closePath();break}case 3:{this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}}},point:function(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;this._x3=x,this._y3=y;break;case 1:this._point=2;this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3;this._x5=x,this._y5=y;break;default:point$2(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var catmullRomClosed=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomClosed(context,alpha):new CardinalClosed(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function CatmullRomOpen(context,alpha){this._context=context;this._alpha=alpha}CatmullRomOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$2(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var catmullRomOpen=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomOpen(context,alpha):new CardinalOpen(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function LinearClosed(context){this._context=context}LinearClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._point=0},lineEnd:function(){if(this._point)this._context.closePath()},point:function(x,y){x=+x,y=+y;if(this._point)this._context.lineTo(x,y);else this._point=1,this._context.moveTo(x,y)}};var linearClosed=function(context){return new LinearClosed(context)};function sign(x){return x<0?-1:1}function slope3(that,x2,y2){var h0=that._x1-that._x0,h1=x2-that._x1,s0=(that._y1-that._y0)/(h0||h1<0&&-0),s1=(y2-that._y1)/(h1||h0<0&&-0),p=(s0*h1+s1*h0)/(h0+h1);return(sign(s0)+sign(s1))*Math.min(Math.abs(s0),Math.abs(s1),.5*Math.abs(p))||0}function slope2(that,t){var h=that._x1-that._x0;return h?(3*(that._y1-that._y0)/h-t)/2:t}function point$3(that,t0,t1){var x0=that._x0,y0=that._y0,x1=that._x1,y1=that._y1,dx=(x1-x0)/3;that._context.bezierCurveTo(x0+dx,y0+dx*t0,x1-dx,y1-dx*t1,x1,y1)}function MonotoneX(context){this._context=context}MonotoneX.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN;this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:point$3(this,this._t0,slope2(this,this._t0));break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(x,y){var t1=NaN;x=+x,y=+y;if(x===this._x1&&y===this._y1)return;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;point$3(this,slope2(this,t1=slope3(this,x,y)),t1);break;default:point$3(this,this._t0,t1=slope3(this,x,y));break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y;this._t0=t1}};function MonotoneY(context){this._context=new ReflectContext(context)}(MonotoneY.prototype=Object.create(MonotoneX.prototype)).point=function(x,y){MonotoneX.prototype.point.call(this,y,x)};function ReflectContext(context){this._context=context}ReflectContext.prototype={moveTo:function(x,y){this._context.moveTo(y,x)},closePath:function(){this._context.closePath()},lineTo:function(x,y){this._context.lineTo(y,x)},bezierCurveTo:function(x1,y1,x2,y2,x,y){this._context.bezierCurveTo(y1,x1,y2,x2,y,x)}};function monotoneX(context){return new MonotoneX(context)}function monotoneY(context){return new MonotoneY(context)}function Natural(context){this._context=context}Natural.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[];this._y=[]},lineEnd:function(){var x=this._x,y=this._y,n=x.length;if(n){this._line?this._context.lineTo(x[0],y[0]):this._context.moveTo(x[0],y[0]);if(n===2){this._context.lineTo(x[1],y[1])}else{var px=controlPoints(x),py=controlPoints(y);for(var i0=0,i1=1;i1<n;++i0,++i1){this._context.bezierCurveTo(px[0][i0],py[0][i0],px[1][i0],py[1][i0],x[i1],y[i1])}}}if(this._line||this._line!==0&&n===1)this._context.closePath();this._line=1-this._line;this._x=this._y=null},point:function(x,y){this._x.push(+x);this._y.push(+y)}};function controlPoints(x){var i,n=x.length-1,m,a=new Array(n),b=new Array(n),r=new Array(n);a[0]=0,b[0]=2,r[0]=x[0]+2*x[1];for(i=1;i<n-1;++i)a[i]=1,b[i]=4,r[i]=4*x[i]+2*x[i+1];a[n-1]=2,b[n-1]=7,r[n-1]=8*x[n-1]+x[n];for(i=1;i<n;++i)m=a[i]/b[i-1],b[i]-=m,r[i]-=m*r[i-1];a[n-1]=r[n-1]/b[n-1];for(i=n-2;i>=0;--i)a[i]=(r[i]-a[i+1])/b[i];b[n-1]=(x[n]+a[n-1])/2;for(i=0;i<n-1;++i)b[i]=2*x[i+1]-a[i+1];return[a,b]}var natural=function(context){return new Natural(context)};function Step(context,t){this._context=context;this._t=t}Step.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN;this._point=0},lineEnd:function(){if(0<this._t&&this._t<1&&this._point===2)this._context.lineTo(this._x,this._y);if(this._line||this._line!==0&&this._point===1)this._context.closePath();if(this._line>=0)this._t=1-this._t,this._line=1-this._line},point:function(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:{if(this._t<=0){this._context.lineTo(this._x,y);this._context.lineTo(x,y)}else{var x1=this._x*(1-this._t)+x*this._t;this._context.lineTo(x1,this._y);this._context.lineTo(x1,y)}break}}this._x=x,this._y=y}};var step=function(context){return new Step(context,.5)};function stepBefore(context){return new Step(context,0)}function stepAfter(context){return new Step(context,1)}var slice=Array.prototype.slice;var none=function(series,order){if(!((n=series.length)>1))return;for(var i=1,s0,s1=series[order[0]],n,m=s1.length;i<n;++i){s0=s1,s1=series[order[i]];for(var j=0;j<m;++j){s1[j][1]+=s1[j][0]=isNaN(s0[j][1])?s0[j][0]:s0[j][1]}}};var none$1=function(series){var n=series.length,o=new Array(n);while(--n>=0)o[n]=n;return o};function stackValue(d,key){return d[key]}var stack=function(){var keys=constant([]),order=none$1,offset=none,value=stackValue;function stack(data){var kz=keys.apply(this,arguments),i,m=data.length,n=kz.length,sz=new Array(n),oz;for(i=0;i<n;++i){for(var ki=kz[i],si=sz[i]=new Array(m),j=0,sij;j<m;++j){si[j]=sij=[0,+value(data[j],ki,j,data)];sij.data=data[j]}si.key=ki}for(i=0,oz=order(sz);i<n;++i){sz[oz[i]].index=i}offset(sz,oz);return sz}stack.keys=function(_){return arguments.length?(keys=typeof _==="function"?_:constant(slice.call(_)),stack):keys};stack.value=function(_){return arguments.length?(value=typeof _==="function"?_:constant(+_),stack):value};stack.order=function(_){return arguments.length?(order=_==null?none$1:typeof _==="function"?_:constant(slice.call(_)),stack):order};stack.offset=function(_){return arguments.length?(offset=_==null?none:_,stack):offset};return stack};var expand=function(series,order){if(!((n=series.length)>0))return;for(var i,n,j=0,m=series[0].length,y;j<m;++j){for(y=i=0;i<n;++i)y+=series[i][j][1]||0;if(y)for(i=0;i<n;++i)series[i][j][1]/=y}none(series,order)};var silhouette=function(series,order){if(!((n=series.length)>0))return;for(var j=0,s0=series[order[0]],n,m=s0.length;j<m;++j){for(var i=0,y=0;i<n;++i)y+=series[i][j][1]||0;s0[j][1]+=s0[j][0]=-y/2}none(series,order)};var wiggle=function(series,order){if(!((n=series.length)>0)||!((m=(s0=series[order[0]]).length)>0))return;for(var y=0,j=1,s0,m,n;j<m;++j){for(var i=0,s1=0,s2=0;i<n;++i){var si=series[order[i]],sij0=si[j][1]||0,sij1=si[j-1][1]||0,s3=(sij0-sij1)/2;for(var k=0;k<i;++k){var sk=series[order[k]],skj0=sk[j][1]||0,skj1=sk[j-1][1]||0;s3+=skj0-skj1}s1+=sij0,s2+=s3*sij0}s0[j-1][1]+=s0[j-1][0]=y;if(s1)y-=s2/s1}s0[j-1][1]+=s0[j-1][0]=y;none(series,order)};var ascending=function(series){var sums=series.map(sum);return none$1(series).sort(function(a,b){return sums[a]-sums[b]})};function sum(series){var s=0,i=-1,n=series.length,v;while(++i<n)if(v=+series[i][1])s+=v;return s}var descending$1=function(series){return ascending(series).reverse()};var insideOut=function(series){var n=series.length,i,j,sums=series.map(sum),order=none$1(series).sort(function(a,b){return sums[b]-sums[a]}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=order[i];if(top<bottom){top+=sums[j];tops.push(j)}else{bottom+=sums[j];bottoms.push(j)}}return bottoms.reverse().concat(tops)};var reverse=function(series){return none$1(series).reverse()};exports.arc=arc;exports.area=area;exports.line=line;exports.pie=pie;exports.radialArea=radialArea;exports.radialLine=radialLine$1;exports.symbol=symbol;exports.symbols=symbols;exports.symbolCircle=circle;exports.symbolCross=cross;exports.symbolDiamond=diamond;exports.symbolSquare=square;exports.symbolStar=star;exports.symbolTriangle=triangle;exports.symbolWye=wye;exports.curveBasisClosed=basisClosed;exports.curveBasisOpen=basisOpen;exports.curveBasis=basis;exports.curveBundle=bundle;exports.curveCardinalClosed=cardinalClosed;exports.curveCardinalOpen=cardinalOpen;exports.curveCardinal=cardinal;exports.curveCatmullRomClosed=catmullRomClosed;exports.curveCatmullRomOpen=catmullRomOpen;exports.curveCatmullRom=catmullRom;exports.curveLinearClosed=linearClosed;exports.curveLinear=curveLinear;exports.curveMonotoneX=monotoneX;exports.curveMonotoneY=monotoneY;exports.curveNatural=natural;exports.curveStep=step;exports.curveStepAfter=stepAfter;exports.curveStepBefore=stepBefore;exports.stack=stack;exports.stackOffsetExpand=expand;exports.stackOffsetNone=none;exports.stackOffsetSilhouette=silhouette;exports.stackOffsetWiggle=wiggle;exports.stackOrderAscending=ascending;exports.stackOrderDescending=descending$1;exports.stackOrderInsideOut=insideOut;exports.stackOrderNone=none$1;exports.stackOrderReverse=reverse;Object.defineProperty(exports,"__esModule",{value:true})})},{"d3-path":13}],21:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("d3-time")):typeof define==="function"&&define.amd?define(["exports","d3-time"],factory):factory(global.d3=global.d3||{},global.d3)})(this,function(exports,d3Time){"use strict";function localDate(d){if(0<=d.y&&d.y<100){var date=new Date(-1,d.m,d.d,d.H,d.M,d.S,d.L);date.setFullYear(d.y);return date}return new Date(d.y,d.m,d.d,d.H,d.M,d.S,d.L)}function utcDate(d){if(0<=d.y&&d.y<100){var date=new Date(Date.UTC(-1,d.m,d.d,d.H,d.M,d.S,d.L));date.setUTCFullYear(d.y);return date}return new Date(Date.UTC(d.y,d.m,d.d,d.H,d.M,d.S,d.L))}function newYear(y){return{y:y,m:0,d:1,H:0,M:0,S:0,L:0}}function formatLocale(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_weekdays=locale.days,locale_shortWeekdays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;var periodRe=formatRe(locale_periods),periodLookup=formatLookup(locale_periods),weekdayRe=formatRe(locale_weekdays),weekdayLookup=formatLookup(locale_weekdays),shortWeekdayRe=formatRe(locale_shortWeekdays),shortWeekdayLookup=formatLookup(locale_shortWeekdays),monthRe=formatRe(locale_months),monthLookup=formatLookup(locale_months),shortMonthRe=formatRe(locale_shortMonths),shortMonthLookup=formatLookup(locale_shortMonths);var formats={a:formatShortWeekday,A:formatWeekday,b:formatShortMonth,B:formatMonth,c:null,d:formatDayOfMonth,e:formatDayOfMonth,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:formatPeriod,S:formatSeconds,U:formatWeekNumberSunday,w:formatWeekdayNumber,W:formatWeekNumberMonday,x:null,X:null,y:formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent};var utcFormats={a:formatUTCShortWeekday,A:formatUTCWeekday,b:formatUTCShortMonth,B:formatUTCMonth,c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:formatUTCPeriod,S:formatUTCSeconds,U:formatUTCWeekNumberSunday,w:formatUTCWeekdayNumber,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent};var parses={a:parseShortWeekday,A:parseWeekday,b:parseShortMonth,B:parseMonth,c:parseLocaleDateTime,d:parseDayOfMonth,e:parseDayOfMonth,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:parsePeriod,S:parseSeconds,U:parseWeekNumberSunday,w:parseWeekdayNumber,W:parseWeekNumberMonday,x:parseLocaleDate,X:parseLocaleTime,y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};formats.x=newFormat(locale_date,formats);formats.X=newFormat(locale_time,formats);formats.c=newFormat(locale_dateTime,formats);utcFormats.x=newFormat(locale_date,utcFormats);utcFormats.X=newFormat(locale_time,utcFormats);utcFormats.c=newFormat(locale_dateTime,utcFormats);function newFormat(specifier,formats){return function(date){var string=[],i=-1,j=0,n=specifier.length,c,pad,format;if(!(date instanceof Date))date=new Date(+date);while(++i<n){if(specifier.charCodeAt(i)===37){string.push(specifier.slice(j,i));if((pad=pads[c=specifier.charAt(++i)])!=null)c=specifier.charAt(++i);else pad=c==="e"?" ":"0";if(format=formats[c])c=format(date,pad);string.push(c);j=i+1}}string.push(specifier.slice(j,i));return string.join("")}}function newParse(specifier,newDate){return function(string){var d=newYear(1900),i=parseSpecifier(d,specifier,string+="",0);if(i!=string.length)return null;if("p"in d)d.H=d.H%12+d.p*12;if("W"in d||"U"in d){if(!("w"in d))d.w="W"in d?1:0;var day="Z"in d?utcDate(newYear(d.y)).getUTCDay():newDate(newYear(d.y)).getDay();d.m=0;d.d="W"in d?(d.w+6)%7+d.W*7-(day+5)%7:d.w+d.U*7-(day+6)%7}if("Z"in d){d.H+=d.Z/100|0;d.M+=d.Z%100;return utcDate(d)}return newDate(d)}}function parseSpecifier(d,specifier,string,j){var i=0,n=specifier.length,m=string.length,c,parse;while(i<n){if(j>=m)return-1;c=specifier.charCodeAt(i++);if(c===37){c=specifier.charAt(i++);parse=parses[c in pads?specifier.charAt(i++):c];if(!parse||(j=parse(d,string,j))<0)return-1}else if(c!=string.charCodeAt(j++)){return-1}}return j}function parsePeriod(d,string,i){var n=periodRe.exec(string.slice(i));return n?(d.p=periodLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseShortWeekday(d,string,i){var n=shortWeekdayRe.exec(string.slice(i));return n?(d.w=shortWeekdayLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseWeekday(d,string,i){var n=weekdayRe.exec(string.slice(i));return n?(d.w=weekdayLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseShortMonth(d,string,i){var n=shortMonthRe.exec(string.slice(i));return n?(d.m=shortMonthLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseMonth(d,string,i){var n=monthRe.exec(string.slice(i));return n?(d.m=monthLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseLocaleDateTime(d,string,i){return parseSpecifier(d,locale_dateTime,string,i)}function parseLocaleDate(d,string,i){return parseSpecifier(d,locale_date,string,i)}function parseLocaleTime(d,string,i){return parseSpecifier(d,locale_time,string,i)}function formatShortWeekday(d){return locale_shortWeekdays[d.getDay()]}function formatWeekday(d){return locale_weekdays[d.getDay()]}function formatShortMonth(d){return locale_shortMonths[d.getMonth()]}function formatMonth(d){return locale_months[d.getMonth()]}function formatPeriod(d){return locale_periods[+(d.getHours()>=12)]}function formatUTCShortWeekday(d){return locale_shortWeekdays[d.getUTCDay()]}function formatUTCWeekday(d){return locale_weekdays[d.getUTCDay()]}function formatUTCShortMonth(d){return locale_shortMonths[d.getUTCMonth()]}function formatUTCMonth(d){return locale_months[d.getUTCMonth()]}function formatUTCPeriod(d){return locale_periods[+(d.getUTCHours()>=12)]}return{format:function(specifier){var f=newFormat(specifier+="",formats);f.toString=function(){return specifier};return f},parse:function(specifier){var p=newParse(specifier+="",localDate);p.toString=function(){return specifier};return p},utcFormat:function(specifier){var f=newFormat(specifier+="",utcFormats);f.toString=function(){return specifier};return f},utcParse:function(specifier){var p=newParse(specifier,utcDate);p.toString=function(){return specifier};return p}}}var pads={"-":"",_:" ",0:"0"};var numberRe=/^\s*\d+/;var percentRe=/^%/;var requoteRe=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;function pad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function requote(s){return s.replace(requoteRe,"\\$&")}function formatRe(names){return new RegExp("^(?:"+names.map(requote).join("|")+")","i")}function formatLookup(names){var map={},i=-1,n=names.length;while(++i<n)map[names[i].toLowerCase()]=i;return map}function parseWeekdayNumber(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.w=+n[0],i+n[0].length):-1}function parseWeekNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.U=+n[0],i+n[0].length):-1}function parseWeekNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.W=+n[0],i+n[0].length):-1}function parseFullYear(d,string,i){var n=numberRe.exec(string.slice(i,i+4));return n?(d.y=+n[0],i+n[0].length):-1}function parseYear(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function parseZone(d,string,i){var n=/^(Z)|([+-]\d\d)(?:\:?(\d\d))?/.exec(string.slice(i,i+6));return n?(d.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function parseMonthNumber(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.m=n[0]-1,i+n[0].length):-1}function parseDayOfMonth(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.d=+n[0],i+n[0].length):-1}function parseDayOfYear(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.m=0,d.d=+n[0],i+n[0].length):-1}function parseHour24(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.H=+n[0],i+n[0].length):-1}function parseMinutes(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.M=+n[0],i+n[0].length):-1}function parseSeconds(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.S=+n[0],i+n[0].length):-1}function parseMilliseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.L=+n[0],i+n[0].length):-1}function parseLiteralPercent(d,string,i){var n=percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function formatDayOfMonth(d,p){return pad(d.getDate(),p,2)}function formatHour24(d,p){return pad(d.getHours(),p,2)}function formatHour12(d,p){return pad(d.getHours()%12||12,p,2)}function formatDayOfYear(d,p){return pad(1+d3Time.timeDay.count(d3Time.timeYear(d),d),p,3)}function formatMilliseconds(d,p){return pad(d.getMilliseconds(),p,3)}function formatMonthNumber(d,p){return pad(d.getMonth()+1,p,2)}function formatMinutes(d,p){return pad(d.getMinutes(),p,2)}function formatSeconds(d,p){return pad(d.getSeconds(),p,2)}function formatWeekNumberSunday(d,p){
return pad(d3Time.timeSunday.count(d3Time.timeYear(d),d),p,2)}function formatWeekdayNumber(d){return d.getDay()}function formatWeekNumberMonday(d,p){return pad(d3Time.timeMonday.count(d3Time.timeYear(d),d),p,2)}function formatYear(d,p){return pad(d.getFullYear()%100,p,2)}function formatFullYear(d,p){return pad(d.getFullYear()%1e4,p,4)}function formatZone(d){var z=d.getTimezoneOffset();return(z>0?"-":(z*=-1,"+"))+pad(z/60|0,"0",2)+pad(z%60,"0",2)}function formatUTCDayOfMonth(d,p){return pad(d.getUTCDate(),p,2)}function formatUTCHour24(d,p){return pad(d.getUTCHours(),p,2)}function formatUTCHour12(d,p){return pad(d.getUTCHours()%12||12,p,2)}function formatUTCDayOfYear(d,p){return pad(1+d3Time.utcDay.count(d3Time.utcYear(d),d),p,3)}function formatUTCMilliseconds(d,p){return pad(d.getUTCMilliseconds(),p,3)}function formatUTCMonthNumber(d,p){return pad(d.getUTCMonth()+1,p,2)}function formatUTCMinutes(d,p){return pad(d.getUTCMinutes(),p,2)}function formatUTCSeconds(d,p){return pad(d.getUTCSeconds(),p,2)}function formatUTCWeekNumberSunday(d,p){return pad(d3Time.utcSunday.count(d3Time.utcYear(d),d),p,2)}function formatUTCWeekdayNumber(d){return d.getUTCDay()}function formatUTCWeekNumberMonday(d,p){return pad(d3Time.utcMonday.count(d3Time.utcYear(d),d),p,2)}function formatUTCYear(d,p){return pad(d.getUTCFullYear()%100,p,2)}function formatUTCFullYear(d,p){return pad(d.getUTCFullYear()%1e4,p,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}var locale$1;defaultLocale({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function defaultLocale(definition){locale$1=formatLocale(definition);exports.timeFormat=locale$1.format;exports.timeParse=locale$1.parse;exports.utcFormat=locale$1.utcFormat;exports.utcParse=locale$1.utcParse;return locale$1}var isoSpecifier="%Y-%m-%dT%H:%M:%S.%LZ";function formatIsoNative(date){return date.toISOString()}var formatIso=Date.prototype.toISOString?formatIsoNative:exports.utcFormat(isoSpecifier);function parseIsoNative(string){var date=new Date(string);return isNaN(date)?null:date}var parseIso=+new Date("2000-01-01T00:00:00.000Z")?parseIsoNative:exports.utcParse(isoSpecifier);exports.timeFormatDefaultLocale=defaultLocale;exports.timeFormatLocale=formatLocale;exports.isoFormat=formatIso;exports.isoParse=parseIso;Object.defineProperty(exports,"__esModule",{value:true})})},{"d3-time":22}],22:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var t0=new Date;var t1=new Date;function newInterval(floori,offseti,count,field){function interval(date){return floori(date=new Date(+date)),date}interval.floor=interval;interval.ceil=function(date){return floori(date=new Date(date-1)),offseti(date,1),floori(date),date};interval.round=function(date){var d0=interval(date),d1=interval.ceil(date);return date-d0<d1-date?d0:d1};interval.offset=function(date,step){return offseti(date=new Date(+date),step==null?1:Math.floor(step)),date};interval.range=function(start,stop,step){var range=[];start=interval.ceil(start);step=step==null?1:Math.floor(step);if(!(start<stop)||!(step>0))return range;do{range.push(new Date(+start))}while(offseti(start,step),floori(start),start<stop);return range};interval.filter=function(test){return newInterval(function(date){if(date>=date)while(floori(date),!test(date))date.setTime(date-1)},function(date,step){if(date>=date)while(--step>=0)while(offseti(date,1),!test(date)){}})};if(count){interval.count=function(start,end){t0.setTime(+start),t1.setTime(+end);floori(t0),floori(t1);return Math.floor(count(t0,t1))};interval.every=function(step){step=Math.floor(step);return!isFinite(step)||!(step>0)?null:!(step>1)?interval:interval.filter(field?function(d){return field(d)%step===0}:function(d){return interval.count(0,d)%step===0})}}return interval}var millisecond=newInterval(function(){},function(date,step){date.setTime(+date+step)},function(start,end){return end-start});millisecond.every=function(k){k=Math.floor(k);if(!isFinite(k)||!(k>0))return null;if(!(k>1))return millisecond;return newInterval(function(date){date.setTime(Math.floor(date/k)*k)},function(date,step){date.setTime(+date+step*k)},function(start,end){return(end-start)/k})};var milliseconds=millisecond.range;var durationSecond=1e3;var durationMinute=6e4;var durationHour=36e5;var durationDay=864e5;var durationWeek=6048e5;var second=newInterval(function(date){date.setTime(Math.floor(date/durationSecond)*durationSecond)},function(date,step){date.setTime(+date+step*durationSecond)},function(start,end){return(end-start)/durationSecond},function(date){return date.getUTCSeconds()});var seconds=second.range;var minute=newInterval(function(date){date.setTime(Math.floor(date/durationMinute)*durationMinute)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getMinutes()});var minutes=minute.range;var hour=newInterval(function(date){var offset=date.getTimezoneOffset()*durationMinute%durationHour;if(offset<0)offset+=durationHour;date.setTime(Math.floor((+date-offset)/durationHour)*durationHour+offset)},function(date,step){date.setTime(+date+step*durationHour)},function(start,end){return(end-start)/durationHour},function(date){return date.getHours()});var hours=hour.range;var day=newInterval(function(date){date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/durationDay},function(date){return date.getDate()-1});var days=day.range;function weekday(i){return newInterval(function(date){date.setDate(date.getDate()-(date.getDay()+7-i)%7);date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step*7)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/durationWeek})}var sunday=weekday(0);var monday=weekday(1);var tuesday=weekday(2);var wednesday=weekday(3);var thursday=weekday(4);var friday=weekday(5);var saturday=weekday(6);var sundays=sunday.range;var mondays=monday.range;var tuesdays=tuesday.range;var wednesdays=wednesday.range;var thursdays=thursday.range;var fridays=friday.range;var saturdays=saturday.range;var month=newInterval(function(date){date.setDate(1);date.setHours(0,0,0,0)},function(date,step){date.setMonth(date.getMonth()+step)},function(start,end){return end.getMonth()-start.getMonth()+(end.getFullYear()-start.getFullYear())*12},function(date){return date.getMonth()});var months=month.range;var year=newInterval(function(date){date.setMonth(0,1);date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step)},function(start,end){return end.getFullYear()-start.getFullYear()},function(date){return date.getFullYear()});year.every=function(k){return!isFinite(k=Math.floor(k))||!(k>0)?null:newInterval(function(date){date.setFullYear(Math.floor(date.getFullYear()/k)*k);date.setMonth(0,1);date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step*k)})};var years=year.range;var utcMinute=newInterval(function(date){date.setUTCSeconds(0,0)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getUTCMinutes()});var utcMinutes=utcMinute.range;var utcHour=newInterval(function(date){date.setUTCMinutes(0,0,0)},function(date,step){date.setTime(+date+step*durationHour)},function(start,end){return(end-start)/durationHour},function(date){return date.getUTCHours()});var utcHours=utcHour.range;var utcDay=newInterval(function(date){date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step)},function(start,end){return(end-start)/durationDay},function(date){return date.getUTCDate()-1});var utcDays=utcDay.range;function utcWeekday(i){return newInterval(function(date){date.setUTCDate(date.getUTCDate()-(date.getUTCDay()+7-i)%7);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step*7)},function(start,end){return(end-start)/durationWeek})}var utcSunday=utcWeekday(0);var utcMonday=utcWeekday(1);var utcTuesday=utcWeekday(2);var utcWednesday=utcWeekday(3);var utcThursday=utcWeekday(4);var utcFriday=utcWeekday(5);var utcSaturday=utcWeekday(6);var utcSundays=utcSunday.range;var utcMondays=utcMonday.range;var utcTuesdays=utcTuesday.range;var utcWednesdays=utcWednesday.range;var utcThursdays=utcThursday.range;var utcFridays=utcFriday.range;var utcSaturdays=utcSaturday.range;var utcMonth=newInterval(function(date){date.setUTCDate(1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCMonth(date.getUTCMonth()+step)},function(start,end){return end.getUTCMonth()-start.getUTCMonth()+(end.getUTCFullYear()-start.getUTCFullYear())*12},function(date){return date.getUTCMonth()});var utcMonths=utcMonth.range;var utcYear=newInterval(function(date){date.setUTCMonth(0,1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step)},function(start,end){return end.getUTCFullYear()-start.getUTCFullYear()},function(date){return date.getUTCFullYear()});utcYear.every=function(k){return!isFinite(k=Math.floor(k))||!(k>0)?null:newInterval(function(date){date.setUTCFullYear(Math.floor(date.getUTCFullYear()/k)*k);date.setUTCMonth(0,1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step*k)})};var utcYears=utcYear.range;exports.timeInterval=newInterval;exports.timeMillisecond=millisecond;exports.timeMilliseconds=milliseconds;exports.utcMillisecond=millisecond;exports.utcMilliseconds=milliseconds;exports.timeSecond=second;exports.timeSeconds=seconds;exports.utcSecond=second;exports.utcSeconds=seconds;exports.timeMinute=minute;exports.timeMinutes=minutes;exports.timeHour=hour;exports.timeHours=hours;exports.timeDay=day;exports.timeDays=days;exports.timeWeek=sunday;exports.timeWeeks=sundays;exports.timeSunday=sunday;exports.timeSundays=sundays;exports.timeMonday=monday;exports.timeMondays=mondays;exports.timeTuesday=tuesday;exports.timeTuesdays=tuesdays;exports.timeWednesday=wednesday;exports.timeWednesdays=wednesdays;exports.timeThursday=thursday;exports.timeThursdays=thursdays;exports.timeFriday=friday;exports.timeFridays=fridays;exports.timeSaturday=saturday;exports.timeSaturdays=saturdays;exports.timeMonth=month;exports.timeMonths=months;exports.timeYear=year;exports.timeYears=years;exports.utcMinute=utcMinute;exports.utcMinutes=utcMinutes;exports.utcHour=utcHour;exports.utcHours=utcHours;exports.utcDay=utcDay;exports.utcDays=utcDays;exports.utcWeek=utcSunday;exports.utcWeeks=utcSundays;exports.utcSunday=utcSunday;exports.utcSundays=utcSundays;exports.utcMonday=utcMonday;exports.utcMondays=utcMondays;exports.utcTuesday=utcTuesday;exports.utcTuesdays=utcTuesdays;exports.utcWednesday=utcWednesday;exports.utcWednesdays=utcWednesdays;exports.utcThursday=utcThursday;exports.utcThursdays=utcThursdays;exports.utcFriday=utcFriday;exports.utcFridays=utcFridays;exports.utcSaturday=utcSaturday;exports.utcSaturdays=utcSaturdays;exports.utcMonth=utcMonth;exports.utcMonths=utcMonths;exports.utcYear=utcYear;exports.utcYears=utcYears;Object.defineProperty(exports,"__esModule",{value:true})})},{}],23:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.d3=global.d3||{})})(this,function(exports){"use strict";var constant=function(x){return function(){return x}};function x(d){return d[0]}function y(d){return d[1]}function RedBlackTree(){this._=null}function RedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}RedBlackTree.prototype={constructor:RedBlackTree,insert:function(after,node){var parent,grandpa,uncle;if(after){node.P=after;node.N=after.N;if(after.N)after.N.P=node;after.N=node;if(after.R){after=after.R;while(after.L)after=after.L;after.L=node}else{after.R=node}parent=after}else if(this._){after=RedBlackFirst(this._);node.P=null;node.N=after;after.P=after.L=node;parent=after}else{node.P=node.N=null;this._=node;parent=null}node.L=node.R=null;node.U=parent;node.C=true;after=node;while(parent&&parent.C){grandpa=parent.U;if(parent===grandpa.L){uncle=grandpa.R;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.R){RedBlackRotateLeft(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;RedBlackRotateRight(this,grandpa)}}else{uncle=grandpa.L;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.L){RedBlackRotateRight(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;RedBlackRotateLeft(this,grandpa)}}parent=after.U}this._.C=false},remove:function(node){if(node.N)node.N.P=node.P;if(node.P)node.P.N=node.N;node.N=node.P=null;var parent=node.U,sibling,left=node.L,right=node.R,next,red;if(!left)next=right;else if(!right)next=left;else next=RedBlackFirst(right);if(parent){if(parent.L===node)parent.L=next;else parent.R=next}else{this._=next}if(left&&right){red=next.C;next.C=node.C;next.L=left;left.U=next;if(next!==right){parent=next.U;next.U=node.U;node=next.R;parent.L=node;next.R=right;right.U=next}else{next.U=parent;parent=next;node=next.R}}else{red=node.C;node=next}if(node)node.U=parent;if(red)return;if(node&&node.C){node.C=false;return}do{if(node===this._)break;if(node===parent.L){sibling=parent.R;if(sibling.C){sibling.C=false;parent.C=true;RedBlackRotateLeft(this,parent);sibling=parent.R}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.R||!sibling.R.C){sibling.L.C=false;sibling.C=true;RedBlackRotateRight(this,sibling);sibling=parent.R}sibling.C=parent.C;parent.C=sibling.R.C=false;RedBlackRotateLeft(this,parent);node=this._;break}}else{sibling=parent.L;if(sibling.C){sibling.C=false;parent.C=true;RedBlackRotateRight(this,parent);sibling=parent.L}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.L||!sibling.L.C){sibling.R.C=false;sibling.C=true;RedBlackRotateLeft(this,sibling);sibling=parent.L}sibling.C=parent.C;parent.C=sibling.L.C=false;RedBlackRotateRight(this,parent);node=this._;break}}sibling.C=true;node=parent;parent=parent.U}while(!node.C);if(node)node.C=false}};function RedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.R=q.L;if(p.R)p.R.U=p;q.L=p}function RedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.L=q.R;if(p.L)p.L.U=p;q.R=p}function RedBlackFirst(node){while(node.L)node=node.L;return node}function createEdge(left,right,v0,v1){var edge=[null,null],index=edges.push(edge)-1;edge.left=left;edge.right=right;if(v0)setEdgeEnd(edge,left,right,v0);if(v1)setEdgeEnd(edge,right,left,v1);cells[left.index].halfedges.push(index);cells[right.index].halfedges.push(index);return edge}function createBorderEdge(left,v0,v1){var edge=[v0,v1];edge.left=left;return edge}function setEdgeEnd(edge,left,right,vertex){if(!edge[0]&&!edge[1]){edge[0]=vertex;edge.left=left;edge.right=right}else if(edge.left===right){edge[1]=vertex}else{edge[0]=vertex}}function clipEdge(edge,x0,y0,x1,y1){var a=edge[0],b=edge[1],ax=a[0],ay=a[1],bx=b[0],by=b[1],t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r}else if(dx>0){if(r>t1)return;if(r>t0)t0=r}r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r}else if(dx>0){if(r<t0)return;if(r<t1)t1=r}r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r}else if(dy>0){if(r>t1)return;if(r>t0)t0=r}r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r}else if(dy>0){if(r<t0)return;if(r<t1)t1=r}if(!(t0>0)&&!(t1<1))return true;if(t0>0)edge[0]=[ax+t0*dx,ay+t0*dy];if(t1<1)edge[1]=[ax+t1*dx,ay+t1*dy];return true}function connectEdge(edge,x0,y0,x1,y1){var v1=edge[1];if(v1)return true;var v0=edge[0],left=edge.left,right=edge.right,lx=left[0],ly=left[1],rx=right[0],ry=right[1],fx=(lx+rx)/2,fy=(ly+ry)/2,fm,fb;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(!v0)v0=[fx,y0];else if(v0[1]>=y1)return;v1=[fx,y1]}else{if(!v0)v0=[fx,y1];else if(v0[1]<y0)return;v1=[fx,y0]}}else{fm=(lx-rx)/(ry-ly);fb=fy-fm*fx;if(fm<-1||fm>1){if(lx>rx){if(!v0)v0=[(y0-fb)/fm,y0];else if(v0[1]>=y1)return;v1=[(y1-fb)/fm,y1]}else{if(!v0)v0=[(y1-fb)/fm,y1];else if(v0[1]<y0)return;v1=[(y0-fb)/fm,y0]}}else{if(ly<ry){if(!v0)v0=[x0,fm*x0+fb];else if(v0[0]>=x1)return;v1=[x1,fm*x1+fb]}else{if(!v0)v0=[x1,fm*x1+fb];else if(v0[0]<x0)return;v1=[x0,fm*x0+fb]}}}edge[0]=v0;edge[1]=v1;return true}function clipEdges(x0,y0,x1,y1){var i=edges.length,edge;while(i--){if(!connectEdge(edge=edges[i],x0,y0,x1,y1)||!clipEdge(edge,x0,y0,x1,y1)||!(Math.abs(edge[0][0]-edge[1][0])>epsilon||Math.abs(edge[0][1]-edge[1][1])>epsilon)){delete edges[i]}}}function createCell(site){return cells[site.index]={site:site,halfedges:[]}}function cellHalfedgeAngle(cell,edge){var site=cell.site,va=edge.left,vb=edge.right;if(site===vb)vb=va,va=site;if(vb)return Math.atan2(vb[1]-va[1],vb[0]-va[0]);if(site===va)va=edge[1],vb=edge[0];else va=edge[0],vb=edge[1];return Math.atan2(va[0]-vb[0],vb[1]-va[1])}function cellHalfedgeStart(cell,edge){return edge[+(edge.left!==cell.site)]}function cellHalfedgeEnd(cell,edge){return edge[+(edge.left===cell.site)]}function sortCellHalfedges(){for(var i=0,n=cells.length,cell,halfedges,j,m;i<n;++i){if((cell=cells[i])&&(m=(halfedges=cell.halfedges).length)){var index=new Array(m),array=new Array(m);for(j=0;j<m;++j)index[j]=j,array[j]=cellHalfedgeAngle(cell,edges[halfedges[j]]);index.sort(function(i,j){return array[j]-array[i]});for(j=0;j<m;++j)array[j]=halfedges[index[j]];for(j=0;j<m;++j)halfedges[j]=array[j]}}}function clipCells(x0,y0,x1,y1){var nCells=cells.length,iCell,cell,site,iHalfedge,halfedges,nHalfedges,start,startX,startY,end,endX,endY,cover=true;for(iCell=0;iCell<nCells;++iCell){if(cell=cells[iCell]){site=cell.site;halfedges=cell.halfedges;iHalfedge=halfedges.length;while(iHalfedge--){if(!edges[halfedges[iHalfedge]]){halfedges.splice(iHalfedge,1)}}iHalfedge=0,nHalfedges=halfedges.length;while(iHalfedge<nHalfedges){end=cellHalfedgeEnd(cell,edges[halfedges[iHalfedge]]),endX=end[0],endY=end[1];start=cellHalfedgeStart(cell,edges[halfedges[++iHalfedge%nHalfedges]]),startX=start[0],startY=start[1];if(Math.abs(endX-startX)>epsilon||Math.abs(endY-startY)>epsilon){halfedges.splice(iHalfedge,0,edges.push(createBorderEdge(site,end,Math.abs(endX-x0)<epsilon&&y1-endY>epsilon?[x0,Math.abs(startX-x0)<epsilon?startY:y1]:Math.abs(endY-y1)<epsilon&&x1-endX>epsilon?[Math.abs(startY-y1)<epsilon?startX:x1,y1]:Math.abs(endX-x1)<epsilon&&endY-y0>epsilon?[x1,Math.abs(startX-x1)<epsilon?startY:y0]:Math.abs(endY-y0)<epsilon&&endX-x0>epsilon?[Math.abs(startY-y0)<epsilon?startX:x0,y0]:null))-1);++nHalfedges}}if(nHalfedges)cover=false}}if(cover){var dx,dy,d2,dc=Infinity;for(iCell=0,cover=null;iCell<nCells;++iCell){if(cell=cells[iCell]){site=cell.site;dx=site[0]-x0;dy=site[1]-y0;d2=dx*dx+dy*dy;if(d2<dc)dc=d2,cover=cell}}if(cover){var v00=[x0,y0],v01=[x0,y1],v11=[x1,y1],v10=[x1,y0];cover.halfedges.push(edges.push(createBorderEdge(site=cover.site,v00,v01))-1,edges.push(createBorderEdge(site,v01,v11))-1,edges.push(createBorderEdge(site,v11,v10))-1,edges.push(createBorderEdge(site,v10,v00))-1)}}for(iCell=0;iCell<nCells;++iCell){if(cell=cells[iCell]){if(!cell.halfedges.length){delete cells[iCell]}}}}var circlePool=[];var firstCircle;function Circle(){RedBlackNode(this);this.x=this.y=this.arc=this.site=this.cy=null}function attachCircle(arc){var lArc=arc.P,rArc=arc.N;if(!lArc||!rArc)return;var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite===rSite)return;var bx=cSite[0],by=cSite[1],ax=lSite[0]-bx,ay=lSite[1]-by,cx=rSite[0]-bx,cy=rSite[1]-by;var d=2*(ax*cy-ay*cx);if(d>=-epsilon2)return;var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d;var circle=circlePool.pop()||new Circle;circle.arc=arc;circle.site=cSite;circle.x=x+bx;circle.y=(circle.cy=y+by)+Math.sqrt(x*x+y*y);arc.circle=circle;var before=null,node=circles._;while(node){if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(node.L)node=node.L;else{before=node.P;break}}else{if(node.R)node=node.R;else{before=node;break}}}circles.insert(before,circle);if(!before)firstCircle=circle}function detachCircle(arc){var circle=arc.circle;if(circle){if(!circle.P)firstCircle=circle.N;circles.remove(circle);circlePool.push(circle);RedBlackNode(circle);arc.circle=null}}var beachPool=[];function Beach(){RedBlackNode(this);this.edge=this.site=this.circle=null}function createBeach(site){var beach=beachPool.pop()||new Beach;beach.site=site;return beach}function detachBeach(beach){detachCircle(beach);beaches.remove(beach);beachPool.push(beach);RedBlackNode(beach)}function removeBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex=[x,y],previous=beach.P,next=beach.N,disappearing=[beach];detachBeach(beach);var lArc=previous;while(lArc.circle&&Math.abs(x-lArc.circle.x)<epsilon&&Math.abs(y-lArc.circle.cy)<epsilon){previous=lArc.P;disappearing.unshift(lArc);detachBeach(lArc);lArc=previous}disappearing.unshift(lArc);detachCircle(lArc);var rArc=next;while(rArc.circle&&Math.abs(x-rArc.circle.x)<epsilon&&Math.abs(y-rArc.circle.cy)<epsilon){next=rArc.N;disappearing.push(rArc);detachBeach(rArc);rArc=next}disappearing.push(rArc);detachCircle(rArc);var nArcs=disappearing.length,iArc;for(iArc=1;iArc<nArcs;++iArc){rArc=disappearing[iArc];lArc=disappearing[iArc-1];setEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex)}lArc=disappearing[0];rArc=disappearing[nArcs-1];rArc.edge=createEdge(lArc.site,rArc.site,null,vertex);attachCircle(lArc);attachCircle(rArc)}function addBeach(site){var x=site[0],directrix=site[1],lArc,rArc,dxl,dxr,node=beaches._;while(node){dxl=leftBreakPoint(node,directrix)-x;if(dxl>epsilon)node=node.L;else{dxr=x-rightBreakPoint(node,directrix);if(dxr>epsilon){if(!node.R){lArc=node;break}node=node.R}else{if(dxl>-epsilon){lArc=node.P;rArc=node}else if(dxr>-epsilon){lArc=node;rArc=node.N}else{lArc=rArc=node}break}}}createCell(site);var newArc=createBeach(site);beaches.insert(lArc,newArc);if(!lArc&&!rArc)return;if(lArc===rArc){detachCircle(lArc);rArc=createBeach(lArc.site);beaches.insert(newArc,rArc);newArc.edge=rArc.edge=createEdge(lArc.site,newArc.site);attachCircle(lArc);attachCircle(rArc);return}if(!rArc){newArc.edge=createEdge(lArc.site,newArc.site);return}detachCircle(lArc);detachCircle(rArc);var lSite=lArc.site,ax=lSite[0],ay=lSite[1],bx=site[0]-ax,by=site[1]-ay,rSite=rArc.site,cx=rSite[0]-ax,cy=rSite[1]-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex=[(cy*hb-by*hc)/d+ax,(bx*hc-cx*hb)/d+ay];setEdgeEnd(rArc.edge,lSite,rSite,vertex);newArc.edge=createEdge(lSite,site,null,vertex);rArc.edge=createEdge(site,rSite,null,vertex);attachCircle(lArc);attachCircle(rArc)}function leftBreakPoint(arc,directrix){var site=arc.site,rfocx=site[0],rfocy=site[1],pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-Infinity;site=lArc.site;var lfocx=site[0],lfocy=site[1],plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;if(aby2)return(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx;return(rfocx+lfocx)/2}function rightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return leftBreakPoint(rArc,directrix);var site=arc.site;return site[1]===directrix?site[0]:Infinity}var epsilon=1e-6;var epsilon2=1e-12;var beaches;var cells;var circles;var edges;function triangleArea(a,b,c){return(a[0]-c[0])*(b[1]-a[1])-(a[0]-b[0])*(c[1]-a[1])}function lexicographic(a,b){return b[1]-a[1]||b[0]-a[0]}function Diagram(sites,extent){var site=sites.sort(lexicographic).pop(),x,y,circle;edges=[];cells=new Array(sites.length);beaches=new RedBlackTree;circles=new RedBlackTree;while(true){circle=firstCircle;if(site&&(!circle||site[1]<circle.y||site[1]===circle.y&&site[0]<circle.x)){if(site[0]!==x||site[1]!==y){addBeach(site);x=site[0],y=site[1]}site=sites.pop()}else if(circle){removeBeach(circle.arc)}else{break}}sortCellHalfedges();if(extent){var x0=+extent[0][0],y0=+extent[0][1],x1=+extent[1][0],y1=+extent[1][1];clipEdges(x0,y0,x1,y1);clipCells(x0,y0,x1,y1)}this.edges=edges;this.cells=cells;beaches=circles=edges=cells=null}Diagram.prototype={constructor:Diagram,polygons:function(){var edges=this.edges;return this.cells.map(function(cell){var polygon=cell.halfedges.map(function(i){return cellHalfedgeStart(cell,edges[i])});polygon.data=cell.site.data;return polygon})},triangles:function(){var triangles=[],edges=this.edges;this.cells.forEach(function(cell,i){if(!(m=(halfedges=cell.halfedges).length))return;var site=cell.site,halfedges,j=-1,m,s0,e1=edges[halfedges[m-1]],s1=e1.left===site?e1.right:e1.left;while(++j<m){s0=s1;e1=edges[halfedges[j]];s1=e1.left===site?e1.right:e1.left;if(s0&&s1&&i<s0.index&&i<s1.index&&triangleArea(site,s0,s1)<0){triangles.push([site.data,s0.data,s1.data])}}});return triangles},links:function(){return this.edges.filter(function(edge){return edge.right}).map(function(edge){return{source:edge.left.data,target:edge.right.data}})},find:function(x,y,radius){var that=this,i0,i1=that._found||0,n=that.cells.length,cell;while(!(cell=that.cells[i1]))if(++i1>=n)return null;var dx=x-cell.site[0],dy=y-cell.site[1],d2=dx*dx+dy*dy;do{cell=that.cells[i0=i1],i1=null;cell.halfedges.forEach(function(e){var edge=that.edges[e],v=edge.left;if((v===cell.site||!v)&&!(v=edge.right))return;var vx=x-v[0],vy=y-v[1],v2=vx*vx+vy*vy;if(v2<d2)d2=v2,i1=v.index})}while(i1!==null);that._found=i0;return radius==null||d2<=radius*radius?cell.site:null}};var voronoi=function(){var x$$1=x,y$$1=y,extent=null;function voronoi(data){return new Diagram(data.map(function(d,i){var s=[Math.round(x$$1(d,i,data)/epsilon)*epsilon,Math.round(y$$1(d,i,data)/epsilon)*epsilon];s.index=i;s.data=d;return s}),extent)}voronoi.polygons=function(data){return voronoi(data).polygons()};voronoi.links=function(data){return voronoi(data).links()};voronoi.triangles=function(data){return voronoi(data).triangles()};voronoi.x=function(_){return arguments.length?(x$$1=typeof _==="function"?_:constant(+_),voronoi):x$$1};voronoi.y=function(_){return arguments.length?(y$$1=typeof _==="function"?_:constant(+_),voronoi):y$$1};voronoi.extent=function(_){return arguments.length?(extent=_==null?null:[[+_[0][0],+_[0][1]],[+_[1][0],+_[1][1]]],voronoi):extent&&[[extent[0][0],extent[0][1]],[extent[1][0],extent[1][1]]]};voronoi.size=function(_){return arguments.length?(extent=_==null?null:[[0,0],[+_[0],+_[1]]],voronoi):extent&&[extent[1][0]-extent[0][0],extent[1][1]-extent[0][1]]};return voronoi};exports.voronoi=voronoi;Object.defineProperty(exports,"__esModule",{value:true})})},{}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _reflectionEffect=require("./reflection-effect");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_reflectionEffect).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./reflection-effect":27}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default='#define SHADER_NAME reflection-effect-fs\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D reflectionTexture;\nuniform int reflectionTextureWidth;\nuniform int reflectionTextureHeight;\n\nuniform float reflectivity;\nuniform float blur;\n\n\nvarying vec2 uv;\n\n#define KERNEL_SIZE 7\n\n/*\n * Samples from tex with a gaussian-shaped patch, centered at uv and\n * with standard deviation sigma.  The size of the texture in\n * pixels must be specified by dim\n */\nvec4 sample_gaussian(sampler2D tex, vec2 dim, vec2 uv, float sigma) {\n  if (sigma == 0.0) {\n    return texture2D(tex, uv);\n  }\n\n  vec2 delta = 1.0 / dim;\n  vec2 top_left = uv - delta * float(KERNEL_SIZE+1) / 2.0;\n\n  vec4 color = vec4(0);\n  float sum = 0.0;\n  for (int i = 0; i <  KERNEL_SIZE; ++i) {\n    for (int j = 0; j < KERNEL_SIZE; ++j) {\n      vec2 uv2 = top_left + vec2(i, j) * delta;\n      float d = length((uv2 - uv) * dim);\n      float f = exp(-(d*d) / (2.0*sigma * sigma));\n      color += f * texture2D(tex, uv2);\n      sum += f;\n    }\n  }\n  return color / sum;\n}\n\nvoid main(void) {\n  //map blur in [0, 1] to sigma in [0, inf]\n  //alpha will determine the "steepness" of our curve.\n  //this was picked just to make the scale feel "natural"\n  //if our image is 1000 pixels wide, a blur of 0.5 should correspond\n  //to a sigma of 1 pixels\n  float alpha = 1000.0;\n  float sigma = blur / (alpha * (1.0 - blur));\n  //let this be our standard deviation in terms of screen-widths.\n  //rewrite this in terms of pixels.\n  sigma *= float(reflectionTextureWidth);\n\n\n  gl_FragColor = sample_gaussian(reflectionTexture, vec2(reflectionTextureWidth,\n    reflectionTextureHeight), vec2(uv.x, 1. - uv.y), sigma);\n  //because our canvas expects alphas to be pre-multiplied, we multiply by whole\n  //color vector by reflectivity, not just the alpha channel\n  gl_FragColor *= reflectivity;\n}\n'},{}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME reflection-effect-vs\n\nattribute vec3 vertices;\n\nvarying vec2 uv;\n\nvoid main(void) {\n  uv = vertices.xy;\n  gl_Position = vec4(2. * vertices.xy - vec2(1., 1.), 1., 1.);\n}\n"},{}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _luma=require("luma.gl");var _shaderUtils=require("../../../shader-utils");var _lib=require("../../lib");var _viewports=require("../../../lib/viewports");var _reflectionEffectVertex=require("./reflection-effect-vertex.glsl");var _reflectionEffectVertex2=_interopRequireDefault(_reflectionEffectVertex);var _reflectionEffectFragment=require("./reflection-effect-fragment.glsl");var _reflectionEffectFragment2=_interopRequireDefault(_reflectionEffectFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,
configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ReflectionEffect=function(_Effect){_inherits(ReflectionEffect,_Effect);function ReflectionEffect(){var reflectivity=arguments.length>0&&arguments[0]!==undefined?arguments[0]:.5;var blur=arguments.length>1&&arguments[1]!==undefined?arguments[1]:.5;_classCallCheck(this,ReflectionEffect);var _this=_possibleConstructorReturn(this,(ReflectionEffect.__proto__||Object.getPrototypeOf(ReflectionEffect)).call(this));_this.reflectivity=reflectivity;_this.blur=blur;_this.framebuffer=null;_this.setNeedsRedraw();return _this}_createClass(ReflectionEffect,[{key:"getShaders",value:function getShaders(){return{vs:_reflectionEffectVertex2.default,fs:_reflectionEffectFragment2.default}}},{key:"initialize",value:function initialize(_ref){var gl=_ref.gl,layerManager=_ref.layerManager;var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());this.unitQuad=new _luma.Model({gl:gl,id:"reflection-effect",vs:shaders.vs,fs:shaders.fs,geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_FAN,vertices:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])})});this.framebuffer=new _luma.Framebuffer(gl,{depth:true})}},{key:"preDraw",value:function preDraw(_ref2){var gl=_ref2.gl,layerManager=_ref2.layerManager;var viewport=layerManager.context.viewport;var dpi=typeof window!=="undefined"&&window.devicePixelRatio||1;this.framebuffer.resize({width:dpi*viewport.width,height:dpi*viewport.height});var pitch=viewport.pitch;this.framebuffer.bind();layerManager.setViewport(new _viewports.WebMercatorViewport(Object.assign({},viewport,{pitch:-180-pitch})));gl.clear(_luma.GL.COLOR_BUFFER_BIT|_luma.GL.DEPTH_BUFFER_BIT);layerManager.drawLayers({pass:"reflection"});layerManager.setViewport(viewport);this.framebuffer.unbind()}},{key:"draw",value:function draw(_ref3){var gl=_ref3.gl,layerManager=_ref3.layerManager;this.unitQuad.render({reflectionTexture:this.framebuffer.texture,reflectionTextureWidth:this.framebuffer.width,reflectionTextureHeight:this.framebuffer.height,reflectivity:this.reflectivity,blur:this.blur})}},{key:"finalize",value:function finalize(_ref4){var gl=_ref4.gl,layerManager=_ref4.layerManager}}]);return ReflectionEffect}(_lib.Effect);exports.default=ReflectionEffect},{"../../../lib/viewports":111,"../../../shader-utils":120,"../../lib":31,"./reflection-effect-fragment.glsl":25,"./reflection-effect-vertex.glsl":26,"luma.gl":195}],28:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _lib=require("./lib");Object.defineProperty(exports,"EffectManager",{enumerable:true,get:function get(){return _lib.EffectManager}});Object.defineProperty(exports,"Effect",{enumerable:true,get:function get(){return _lib.Effect}});var _reflectionEffect=require("./effects/reflection-effect");Object.defineProperty(exports,"ReflectionEffect",{enumerable:true,get:function get(){return _interopRequireDefault(_reflectionEffect).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./effects/reflection-effect":24,"./lib":31}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var EffectManager=function(){function EffectManager(_ref){var gl=_ref.gl,layerManager=_ref.layerManager;_classCallCheck(this,EffectManager);this.gl=gl;this.layerManager=layerManager;this._effects=[]}_createClass(EffectManager,[{key:"addEffect",value:function addEffect(effect){this._effects.push(effect);this._sortEffects();effect.initialize({gl:this.gl,layerManager:this.layerManager})}},{key:"removeEffect",value:function removeEffect(effect){var i=this._effects.indexOf(effect);if(i>=0){effect.finalize({gl:this.gl,layerManager:this.layerManager});this._effects.splice(i,1);return true}return false}},{key:"preDraw",value:function preDraw(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this._effects[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var effect=_step.value;if(effect.needsRedraw){effect.preDraw({gl:this.gl,layerManager:this.layerManager})}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"draw",value:function draw(){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this._effects[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var effect=_step2.value;if(effect.needsRedraw){effect.draw({gl:this.gl,layerManager:this.layerManager})}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"_sortEffects",value:function _sortEffects(){this._effects.sort(function(a,b){if(a.priority>b.priority){return-1}else if(a.priority<b.priority){return 1}return a.count-b.count})}}]);return EffectManager}();exports.default=EffectManager},{}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var counter=0;var Effect=function(){function Effect(){_classCallCheck(this,Effect);this.count=counter++;this.visible=true;this.priority=0;this.needsRedraw=false}_createClass(Effect,[{key:"initialize",value:function initialize(_ref){var gl=_ref.gl,layerManager=_ref.layerManager}},{key:"finalize",value:function finalize(_ref2){var gl=_ref2.gl,layerManager=_ref2.layerManager}},{key:"preDraw",value:function preDraw(_ref3){var gl=_ref3.gl,layerManager=_ref3.layerManager}},{key:"draw",value:function draw(_ref4){var gl=_ref4.gl,layerManager=_ref4.layerManager}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=redraw}}]);return Effect}();exports.default=Effect},{}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _effect=require("./effect");Object.defineProperty(exports,"Effect",{enumerable:true,get:function get(){return _interopRequireDefault(_effect).default}});var _effectManager=require("./effect-manager");Object.defineProperty(exports,"EffectManager",{enumerable:true,get:function get(){return _interopRequireDefault(_effectManager).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./effect":30,"./effect-manager":29}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.experimental=exports.default=exports.DeckGL=exports.ExtrudedChoroplethLayer64=exports.ChoroplethLayer64=exports.ChoroplethLayer=exports.GeoJsonLayer=exports.PolygonLayer=exports.PathLayer=exports.HexagonCellLayer=exports.HexagonLayer=exports.GridCellLayer=exports.GridLayer=exports.ScreenGridLayer=exports.ScatterplotLayer=exports.PointCloudLayer=exports.LineLayer=exports.IconLayer=exports.ArcLayer=exports.WebMercatorViewport=exports.OrthographicViewport=exports.PerspectiveViewport=exports.Viewport=exports.COORDINATE_SYSTEM=exports.AttributeManager=exports.LayerManager=exports.CompositeLayer=exports.Layer=exports.assembleShaders=undefined;var _shaderUtils=require("./shader-utils");Object.defineProperty(exports,"assembleShaders",{enumerable:true,get:function get(){return _shaderUtils.assembleShaders}});var _lib=require("./lib");Object.defineProperty(exports,"Layer",{enumerable:true,get:function get(){return _lib.Layer}});Object.defineProperty(exports,"CompositeLayer",{enumerable:true,get:function get(){return _lib.CompositeLayer}});Object.defineProperty(exports,"LayerManager",{enumerable:true,get:function get(){return _lib.LayerManager}});Object.defineProperty(exports,"AttributeManager",{enumerable:true,get:function get(){return _lib.AttributeManager}});Object.defineProperty(exports,"COORDINATE_SYSTEM",{enumerable:true,get:function get(){return _lib.COORDINATE_SYSTEM}});var _viewport=require("./lib/viewports/viewport");Object.defineProperty(exports,"Viewport",{enumerable:true,get:function get(){return _interopRequireDefault(_viewport).default}});var _perspectiveViewport=require("./lib/viewports/perspective-viewport");Object.defineProperty(exports,"PerspectiveViewport",{enumerable:true,get:function get(){return _interopRequireDefault(_perspectiveViewport).default}});var _orthographicViewport=require("./lib/viewports/orthographic-viewport");Object.defineProperty(exports,"OrthographicViewport",{enumerable:true,get:function get(){return _interopRequireDefault(_orthographicViewport).default}});var _webMercatorViewport=require("./lib/viewports/web-mercator-viewport");Object.defineProperty(exports,"WebMercatorViewport",{enumerable:true,get:function get(){return _interopRequireDefault(_webMercatorViewport).default}});var _arcLayer=require("./layers/core/arc-layer/arc-layer");Object.defineProperty(exports,"ArcLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_arcLayer).default}});var _iconLayer=require("./layers/core/icon-layer/icon-layer");Object.defineProperty(exports,"IconLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_iconLayer).default}});var _lineLayer=require("./layers/core/line-layer/line-layer");Object.defineProperty(exports,"LineLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_lineLayer).default}});var _pointCloudLayer=require("./layers/core/point-cloud-layer/point-cloud-layer");Object.defineProperty(exports,"PointCloudLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_pointCloudLayer).default}});var _scatterplotLayer=require("./layers/core/scatterplot-layer/scatterplot-layer");Object.defineProperty(exports,"ScatterplotLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_scatterplotLayer).default}});var _screenGridLayer=require("./layers/core/screen-grid-layer/screen-grid-layer");Object.defineProperty(exports,"ScreenGridLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_screenGridLayer).default}});var _gridLayer=require("./layers/core/grid-layer/grid-layer");Object.defineProperty(exports,"GridLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_gridLayer).default}});var _gridCellLayer=require("./layers/core/grid-cell-layer/grid-cell-layer");Object.defineProperty(exports,"GridCellLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_gridCellLayer).default}});var _hexagonLayer=require("./layers/core/hexagon-layer/hexagon-layer");Object.defineProperty(exports,"HexagonLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_hexagonLayer).default}});var _hexagonCellLayer=require("./layers/core/hexagon-cell-layer/hexagon-cell-layer");Object.defineProperty(exports,"HexagonCellLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_hexagonCellLayer).default}});var _pathLayer=require("./layers/core/path-layer/path-layer");Object.defineProperty(exports,"PathLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_pathLayer).default}});var _polygonLayer=require("./layers/core/polygon-layer/polygon-layer");Object.defineProperty(exports,"PolygonLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_polygonLayer).default}});var _geojsonLayer=require("./layers/core/geojson-layer/geojson-layer");Object.defineProperty(exports,"GeoJsonLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_geojsonLayer).default}});var _choroplethLayer=require("./layers/deprecated/choropleth-layer/choropleth-layer");Object.defineProperty(exports,"ChoroplethLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_choroplethLayer).default}});var _choroplethLayer2=require("./layers/deprecated/choropleth-layer-64/choropleth-layer-64");Object.defineProperty(exports,"ChoroplethLayer64",{enumerable:true,get:function get(){return _interopRequireDefault(_choroplethLayer2).default}});var _extrudedChoroplethLayer=require("./layers/deprecated/extruded-choropleth-layer-64/extruded-choropleth-layer-64");Object.defineProperty(exports,"ExtrudedChoroplethLayer64",{enumerable:true,get:function get(){return _interopRequireDefault(_extrudedChoroplethLayer).default}});var _deckgl=require("./react/deckgl");Object.defineProperty(exports,"DeckGL",{enumerable:true,get:function get(){return _interopRequireDefault(_deckgl).default}});Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_deckgl).default}});var _get=require("./lib/utils/get");var _count=require("./lib/utils/count");var _lib2=require("./experimental/lib");var _reflectionEffect=require("./experimental/effects/reflection-effect");var _reflectionEffect2=_interopRequireDefault(_reflectionEffect);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var experimental=exports.experimental={get:_get.get,count:_count.count,EffectManager:_lib2.EffectManager,Effect:_lib2.Effect,ReflectionEffect:_reflectionEffect2.default}},{"./experimental/effects/reflection-effect":24,"./experimental/lib":31,"./layers/core/arc-layer/arc-layer":36,"./layers/core/geojson-layer/geojson-layer":37,"./layers/core/grid-cell-layer/grid-cell-layer":42,"./layers/core/grid-layer/grid-layer":44,"./layers/core/hexagon-cell-layer/hexagon-cell-layer":48,"./layers/core/hexagon-layer/hexagon-layer":50,"./layers/core/icon-layer/icon-layer":54,"./layers/core/line-layer/line-layer":58,"./layers/core/path-layer/path-layer":62,"./layers/core/point-cloud-layer/point-cloud-layer":66,"./layers/core/polygon-layer/polygon-layer":67,"./layers/core/scatterplot-layer/scatterplot-layer":71,"./layers/core/screen-grid-layer/screen-grid-layer":74,"./layers/deprecated/choropleth-layer-64/choropleth-layer-64":82,"./layers/deprecated/choropleth-layer/choropleth-layer":86,"./layers/deprecated/extruded-choropleth-layer-64/extruded-choropleth-layer-64":88,"./lib":95,"./lib/utils/count":103,"./lib/utils/get":106,"./lib/viewports/orthographic-viewport":112,"./lib/viewports/perspective-viewport":113,"./lib/viewports/viewport":114,"./lib/viewports/web-mercator-viewport":115,"./react/deckgl":117,"./shader-utils":120}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME arc-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n"},{}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME arc-layer-vertex-64-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\n\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\n\nattribute vec3 instancePickingColors;\n\nuniform float numSegments;\nuniform vec2 viewportSize;\nuniform float strokeWidth;\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nvec2 paraboloid_fp64(vec2 source[2], vec2 target[2], float ratio) {\n\n  vec2 x[2];\n  vec2_mix_fp64(source, target, ratio, x);\n  vec2 center[2];\n  vec2_mix_fp64(source, target, 0.5, center);\n\n  vec2 dSourceCenter = vec2_distance_fp64(source, center);\n  vec2 dXCenter = vec2_distance_fp64(x, center);\n  return mul_fp64(sum_fp64(dSourceCenter, dXCenter), sub_fp64(dSourceCenter, dXCenter));\n}\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * viewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * strokeWidth / 2.0;\n  vec2 offset_clipspace = offset_screenspace / viewportSize * 2.0;\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvoid get_pos_fp64(vec2 source[2], vec2 target[2], float segmentRatio, out vec2 position[4]) {\n\n  vec2 vertex_height = paraboloid_fp64(source, target, segmentRatio);\n\n  vec2 position_temp[2];\n\n  vec2_mix_fp64(source, target, segmentRatio, position_temp);\n\n  position[0] = position_temp[0];\n  position[1] = position_temp[1];\n\n  if (vertex_height.x < 0.0 || (vertex_height.x == 0.0 && vertex_height.y <= 0.0)) {\n    vertex_height = vec2(0.0, 0.0);\n  }\n\n  position[2] = sqrt_fp64(vertex_height);\n  position[3] = vec2(1.0, 0.0);\n}\n\nvoid main(void) {\n  vec4 instanceSourcePositions64 = vec4(instancePositions.x,\n    instancePositions64Low.x, instancePositions.y, instancePositions64Low.y);\n  vec4 instanceTargetPositions64 = vec4(instancePositions.z,\n    instancePositions64Low.z, instancePositions.w, instancePositions64Low.w);\n\n  vec2 projected_source_coord[2];\n  vec2 projected_target_coord[2];\n\n  project_position_fp64(instanceSourcePositions64, projected_source_coord);\n  project_position_fp64(instanceTargetPositions64, projected_target_coord);\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  // if it's the first point, use next - current as direction\n  // otherwise use current - prev\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 curr_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, segmentRatio,\n    curr_pos_modelspace);\n\n  vec2 next_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, nextSegmentRatio,\n    next_pos_modelspace);\n\n  vec4 curr_pos_clipspace = project_to_clipspace_fp64(curr_pos_modelspace);\n  vec4 next_pos_clipspace = project_to_clipspace_fp64(next_pos_modelspace);\n\n  vec2 offset = getExtrusionOffset(next_pos_clipspace.xy - curr_pos_clipspace.xy, positions.y);\n\n  gl_Position = curr_pos_clipspace + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n\n  vColor = mix(\n    vec4(color.rgb, color.a * opacity),\n    vec4(instancePickingColors / 255., 1.),\n    renderPickingBuffer\n  );\n}\n"},{}],35:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec3 instancePickingColors;\n\nuniform float numSegments;\nuniform vec2 viewportSize;\nuniform float strokeWidth;\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * viewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * strokeWidth / 2.0;\n  vec2 offset_clipspace = offset_screenspace / viewportSize * 2.0;\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\n\nvoid main(void) {\n  vec2 source = project_position(instancePositions.xy);\n  vec2 target = project_position(instancePositions.zw);\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  // if it's the first point, use next - current as direction\n  // otherwise use current - prev\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec3 currPos = getPos(source, target, segmentRatio);\n  vec3 nextPos = getPos(source, target, nextSegmentRatio);\n  vec4 curr = project_to_clipspace(vec4(currPos, 1.0));\n  vec4 next = project_to_clipspace(vec4(nextPos, 1.0));\n\n  // extrude\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y);\n  gl_Position = curr + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n\n  vColor = mix(\n    vec4(color.rgb, color.a * opacity),\n    vec4(instancePickingColors / 255., 1.),\n    renderPickingBuffer\n  );\n}\n"},{}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");var _arcLayerVertex=require("./arc-layer-vertex.glsl");var _arcLayerVertex2=_interopRequireDefault(_arcLayerVertex);var _arcLayerVertex3=require("./arc-layer-vertex-64.glsl");var _arcLayerVertex4=_interopRequireDefault(_arcLayerVertex3);var _arcLayerFragment=require("./arc-layer-fragment.glsl");var _arcLayerFragment2=_interopRequireDefault(_arcLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,0,255];var defaultProps={strokeWidth:1,fp64:false,getSourcePosition:function getSourcePosition(x){return x.sourcePosition},getTargetPosition:function getTargetPosition(x){return x.targetPosition},getSourceColor:function getSourceColor(x){return x.color||DEFAULT_COLOR},getTargetColor:function getTargetColor(x){return x.color||DEFAULT_COLOR}};var ArcLayer=function(_Layer){_inherits(ArcLayer,_Layer);function ArcLayer(){_classCallCheck(this,ArcLayer);return _possibleConstructorReturn(this,(ArcLayer.__proto__||Object.getPrototypeOf(ArcLayer)).apply(this,arguments))}_createClass(ArcLayer,[{key:"getShaders",value:function getShaders(){return(0,_fp.enable64bitSupport)(this.props)?{vs:_arcLayerVertex4.default,fs:_arcLayerFragment2.default,modules:["fp64","project64"]}:{vs:_arcLayerVertex2.default,fs:_arcLayerFragment2.default,modules:[]}}},{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this._getModel(gl)});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions},instanceSourceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,accessor:"getSourceColor",update:this.calculateInstanceSourceColors},instanceTargetColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,accessor:"getTargetColor",update:this.calculateInstanceTargetColors}})}},{key:"updateAttribute",value:function updateAttribute(_ref){var props=_ref.props,oldProps=_ref.oldProps,changeFlags=_ref.changeFlags;if(props.fp64!==oldProps.fp64){var attributeManager=this.state.attributeManager;attributeManager.invalidateAll();if(props.fp64&&props.projectionMode===_lib.COORDINATE_SYSTEM.LNGLAT){attributeManager.addInstanced({instancePositions64Low:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions64Low}})}else{attributeManager.remove(["instancePositions64Low"])}}}},{key:"updateState",value:function updateState(_ref2){var props=_ref2.props,oldProps=_ref2.oldProps,changeFlags=_ref2.changeFlags;_get(ArcLayer.prototype.__proto__||Object.getPrototypeOf(ArcLayer.prototype),"updateState",this).call(this,{props:props,oldProps:oldProps,changeFlags:changeFlags});if(props.fp64!==oldProps.fp64){var gl=this.context.gl;this.setState({model:this._getModel(gl)})}this.updateAttribute({props:props,oldProps:oldProps,changeFlags:changeFlags})}},{key:"draw",value:function draw(_ref3){var uniforms=_ref3.uniforms;var strokeWidth=this.props.strokeWidth;this.state.model.render(Object.assign({},uniforms,{strokeWidth:strokeWidth}))}},{key:"_getModel",value:function _getModel(gl){var positions=[];var NUM_SEGMENTS=50;for(var i=0;i<NUM_SEGMENTS;i++){positions=positions.concat([i,-1,0,i,1,0])}var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());var model=new _luma.Model({gl:gl,vs:shaders.vs,fs:shaders.fs,geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_STRIP,positions:new Float32Array(positions)}),isInstanced:true});model.setUniforms({numSegments:NUM_SEGMENTS});return model}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props=this.props,data=_props.data,getSourcePosition=_props.getSourcePosition,getTargetPosition=_props.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var sourcePosition=getSourcePosition(object);var targetPosition=getTargetPosition(object);value[i+0]=sourcePosition[0];value[i+1]=sourcePosition[1];value[i+2]=targetPosition[0];value[i+3]=targetPosition[1];i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstancePositions64Low",value:function calculateInstancePositions64Low(attribute){var _props2=this.props,data=_props2.data,getSourcePosition=_props2.getSourcePosition,getTargetPosition=_props2.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var object=_step2.value;var sourcePosition=getSourcePosition(object);var targetPosition=getTargetPosition(object);value[i+0]=(0,_fp.fp64ify)(sourcePosition[0])[1];value[i+1]=(0,_fp.fp64ify)(sourcePosition[1])[1];value[i+2]=(0,_fp.fp64ify)(targetPosition[0])[1];value[i+3]=(0,_fp.fp64ify)(targetPosition[1])[1];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceSourceColors",value:function calculateInstanceSourceColors(attribute){var _props3=this.props,data=_props3.data,getSourceColor=_props3.getSourceColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var color=getSourceColor(object);value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?255:color[3];i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"calculateInstanceTargetColors",value:function calculateInstanceTargetColors(attribute){var _props4=this.props,data=_props4.data,getTargetColor=_props4.getTargetColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=data[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var object=_step4.value;var color=getTargetColor(object);value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?255:color[3];i+=size}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}}]);return ArcLayer}(_lib.Layer);exports.default=ArcLayer
;ArcLayer.layerName="ArcLayer";ArcLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../lib/utils/fp64":105,"../../../shader-utils":120,"./arc-layer-fragment.glsl":33,"./arc-layer-vertex-64.glsl":34,"./arc-layer-vertex.glsl":35,"luma.gl":195}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lib=require("../../../lib");var _scatterplotLayer=require("../scatterplot-layer/scatterplot-layer");var _scatterplotLayer2=_interopRequireDefault(_scatterplotLayer);var _pathLayer=require("../path-layer/path-layer");var _pathLayer2=_interopRequireDefault(_pathLayer);var _solidPolygonLayer=require("../solid-polygon-layer/solid-polygon-layer");var _solidPolygonLayer2=_interopRequireDefault(_solidPolygonLayer);var _geojson=require("./geojson");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var defaultLineColor=[0,0,0,255];var defaultFillColor=[0,0,0,255];var defaultProps={stroked:true,filled:true,extruded:false,wireframe:false,lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:false,lineMiterLimit:4,fp64:false,getLineColor:function getLineColor(f){return(0,_lib.get)(f,"properties.lineColor")||defaultLineColor},getFillColor:function getFillColor(f){return(0,_lib.get)(f,"properties.fillColor")||defaultFillColor},getRadius:function getRadius(f){return(0,_lib.get)(f,"properties.radius")||(0,_lib.get)(f,"properties.size")||1},getLineWidth:function getLineWidth(f){return(0,_lib.get)(f,"properties.lineWidth")||1},getElevation:function getElevation(f){return(0,_lib.get)(f,"properties.elevation")||1e3},lightSettings:{lightsPosition:[-122.45,37.75,8e3,-122,38,5e3],ambientRatio:.05,diffuseRatio:.6,specularRatio:.8,lightsStrength:[2,0,0,0],numberOfLights:2}};var getCoordinates=function getCoordinates(f){return(0,_lib.get)(f,"geometry.coordinates")};var GeoJsonLayer=function(_CompositeLayer){_inherits(GeoJsonLayer,_CompositeLayer);function GeoJsonLayer(){_classCallCheck(this,GeoJsonLayer);return _possibleConstructorReturn(this,(GeoJsonLayer.__proto__||Object.getPrototypeOf(GeoJsonLayer)).apply(this,arguments))}_createClass(GeoJsonLayer,[{key:"initializeState",value:function initializeState(){this.state={features:{}}}},{key:"updateState",value:function updateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;if(changeFlags.dataChanged){var data=this.props.data;var features=(0,_geojson.getGeojsonFeatures)(data);this.state.features=(0,_geojson.separateGeojsonFeatures)(features)}}},{key:"getPickingInfo",value:function getPickingInfo(_ref2){var info=_ref2.info;return Object.assign(info,{object:info.object&&info.object.feature||info.object})}},{key:"renderLayers",value:function renderLayers(){var features=this.state.features;var pointFeatures=features.pointFeatures,lineFeatures=features.lineFeatures,polygonFeatures=features.polygonFeatures,polygonOutlineFeatures=features.polygonOutlineFeatures;var _props=this.props,id=_props.id,stroked=_props.stroked,filled=_props.filled,extruded=_props.extruded,wireframe=_props.wireframe,lightSettings=_props.lightSettings;var _props2=this.props,lineWidthScale=_props2.lineWidthScale,lineWidthMinPixels=_props2.lineWidthMinPixels,lineWidthMaxPixels=_props2.lineWidthMaxPixels,lineJointRounded=_props2.lineJointRounded,lineMiterLimit=_props2.lineMiterLimit,fp64=_props2.fp64;var _props3=this.props,getLineColor=_props3.getLineColor,getFillColor=_props3.getFillColor,getRadius=_props3.getRadius,getLineWidth=_props3.getLineWidth,getElevation=_props3.getElevation,updateTriggers=_props3.updateTriggers;var _props4=this.props,opacity=_props4.opacity,pickable=_props4.pickable,visible=_props4.visible;var _props5=this.props,positionOrigin=_props5.positionOrigin,projectionMode=_props5.projectionMode,modelMatrix=_props5.modelMatrix;var drawPoints=pointFeatures&&pointFeatures.length>0;var drawLines=lineFeatures&&lineFeatures.length>0;var hasPolygonLines=polygonOutlineFeatures&&polygonOutlineFeatures.length>0;var hasPolygon=polygonFeatures&&polygonFeatures.length>0;var polygonFillLayer=filled&&hasPolygon&&new _solidPolygonLayer2.default({id:id+"-polygon-fill",data:polygonFeatures,extruded:extruded,wireframe:false,lightSettings:lightSettings,fp64:fp64,opacity:opacity,pickable:pickable,visible:visible,projectionMode:projectionMode,positionOrigin:positionOrigin,modelMatrix:modelMatrix,getPolygon:getCoordinates,getElevation:getElevation,getColor:getFillColor,updateTriggers:{getElevation:updateTriggers.getElevation,getColor:updateTriggers.getFillColor}});var polygonWireframeLayer=wireframe&&extruded&&hasPolygon&&new _solidPolygonLayer2.default({id:id+"-polygon-wireframe",data:polygonFeatures,extruded:extruded,wireframe:true,fp64:fp64,opacity:opacity,pickable:pickable,visible:visible,projectionMode:projectionMode,positionOrigin:positionOrigin,modelMatrix:modelMatrix,getPolygon:getCoordinates,getElevation:getElevation,getColor:getLineColor,updateTriggers:{getElevation:updateTriggers.getElevation,getColor:updateTriggers.getLineColor}});var polygonLineLayer=!extruded&&stroked&&hasPolygonLines&&new _pathLayer2.default({id:id+"-polygon-outline",data:polygonOutlineFeatures,widthScale:lineWidthScale,widthMinPixels:lineWidthMinPixels,widthMaxPixels:lineWidthMaxPixels,rounded:lineJointRounded,miterLimit:lineMiterLimit,fp64:fp64,opacity:opacity,pickable:pickable,visible:visible,projectionMode:projectionMode,positionOrigin:positionOrigin,modelMatrix:modelMatrix,getPath:getCoordinates,getColor:getLineColor,getWidth:getLineWidth,updateTriggers:{getColor:updateTriggers.getLineColor,getWidth:updateTriggers.getLineWidth}});var pathLayer=drawLines&&new _pathLayer2.default({id:id+"-line-paths",data:lineFeatures,widthScale:lineWidthScale,widthMinPixels:lineWidthMinPixels,widthMaxPixels:lineWidthMaxPixels,rounded:lineJointRounded,miterLimit:lineMiterLimit,fp64:fp64,opacity:opacity,pickable:pickable,visible:visible,projectionMode:projectionMode,positionOrigin:positionOrigin,modelMatrix:modelMatrix,getPath:getCoordinates,getColor:getLineColor,getWidth:getLineWidth,updateTriggers:{getColor:updateTriggers.getLineColor,getWidth:updateTriggers.getLineWidth}});var pointLayer=drawPoints&&new _scatterplotLayer2.default({id:id+"-points",data:pointFeatures,fp64:fp64,opacity:opacity,pickable:pickable,visible:visible,projectionMode:projectionMode,positionOrigin:positionOrigin,modelMatrix:modelMatrix,getPosition:getCoordinates,getColor:getFillColor,getRadius:getRadius,updateTriggers:{getColor:updateTriggers.getFillColor,getRadius:updateTriggers.getRadius}});return[polygonFillLayer,polygonWireframeLayer,polygonLineLayer,pathLayer,pointLayer].filter(Boolean)}}]);return GeoJsonLayer}(_lib.CompositeLayer);exports.default=GeoJsonLayer;GeoJsonLayer.layerName="GeoJsonLayer";GeoJsonLayer.defaultProps=defaultProps},{"../../../lib":95,"../path-layer/path-layer":62,"../scatterplot-layer/scatterplot-layer":71,"../solid-polygon-layer/solid-polygon-layer":81,"./geojson":38}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getGeojsonFeatures=getGeojsonFeatures;exports.separateGeojsonFeatures=separateGeojsonFeatures;var _lib=require("../../../lib");function getGeojsonFeatures(geojson){if(Array.isArray(geojson)){return geojson}var type=(0,_lib.get)(geojson,"type");switch(type){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":case"GeometryCollection":return[{type:"Feature",properties:{},geometry:geojson}];case"Feature":return[geojson];case"FeatureCollection":return(0,_lib.get)(geojson,"features");default:throw new Error("Unknown geojson type")}}function separateGeojsonFeatures(features){var pointFeatures=[];var lineFeatures=[];var polygonFeatures=[];var polygonOutlineFeatures=[];features.forEach(function(feature){var type=(0,_lib.get)(feature,"geometry.type");var coordinates=(0,_lib.get)(feature,"geometry.coordinates");var properties=(0,_lib.get)(feature,"properties");switch(type){case"Point":pointFeatures.push(feature);break;case"MultiPoint":coordinates.forEach(function(point){pointFeatures.push({geometry:{coordinates:point},properties:properties,feature:feature})});break;case"LineString":lineFeatures.push(feature);break;case"MultiLineString":coordinates.forEach(function(path){lineFeatures.push({geometry:{coordinates:path},properties:properties,feature:feature})});break;case"Polygon":polygonFeatures.push(feature);coordinates.forEach(function(path){polygonOutlineFeatures.push({geometry:{coordinates:path},properties:properties,feature:feature})});break;case"MultiPolygon":coordinates.forEach(function(polygon){polygonFeatures.push({geometry:{coordinates:polygon},properties:properties,feature:feature});polygon.forEach(function(path){polygonOutlineFeatures.push({geometry:{coordinates:path},properties:properties,feature:feature})})});break;case"GeometryCollection":default:throw new Error("GeoJsonLayer: "+type+" not supported.")}});return{pointFeatures:pointFeatures,lineFeatures:lineFeatures,polygonFeatures:polygonFeatures,polygonOutlineFeatures:polygonOutlineFeatures}}},{"../../../lib":95}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME grid-cell-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n"},{}],40:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default='#define SHADER_NAME grid-layer-vs\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec4 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\n// Picking uniforms\n// Set to 1.0 if rendering picking buffer, 0.0 if rendering for display\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\n// Custom uniforms\nuniform float extruded;\nuniform float lonOffset;\nuniform float latOffset;\nuniform float opacity;\nuniform float elevationScale;\n\n// A magic number to scale elevation so that 1 unit approximate to 1 meter\n#define ELEVATION_SCALE 0.8\n\n// Result\nvarying vec4 vColor;\n\nfloat isPicked(vec3 pickingColors, vec3 selectedColor) {\n return float(pickingColors.x == selectedColor.x\n && pickingColors.y == selectedColor.y\n && pickingColors.z == selectedColor.z);\n}\n\n\nvoid main(void) {\n  vec4 instancePositions64xy = vec4(\n    instancePositions.x + (positions.x + 1.0) * lonOffset / 2.0,\n    instancePositions64xyLow.x,\n    instancePositions.y + (positions.y + 1.0) * latOffset / 2.0,\n    instancePositions64xyLow.y);\n\n  vec2 projected_coord_xy[2];\n  project_position_fp64(instancePositions64xy, projected_coord_xy);\n\n  float elevation = 0.0;\n\n  if (extruded > 0.5) {\n    elevation = project_scale(instancePositions.w  * (positions.z + 1.0) *\n      ELEVATION_SCALE * elevationScale) + 1.0;\n  }\n\n  vec2 vertex_pos_modelspace[4];\n  vertex_pos_modelspace[0] = projected_coord_xy[0];\n  vertex_pos_modelspace[1] = projected_coord_xy[1];\n  vertex_pos_modelspace[2] = vec2(elevation, 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  vec4 position_worldspace = vec4(\n    vertex_pos_modelspace[0].x, vertex_pos_modelspace[1].x,\n    vertex_pos_modelspace[2].x, vertex_pos_modelspace[3].x);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  if (renderPickingBuffer < 0.5) {\n\n    // TODO: we should allow the user to specify the color for "selected element"\n    // check whether a bar is currently picked.\n    float selected = isPicked(instancePickingColors, selectedPickingColor);\n\n    float lightWeight = 1.0;\n\n    if (extruded > 0.5) {\n      lightWeight = getLightWeight(\n        position_worldspace,\n        normals\n      );\n    }\n\n    vec3 lightWeightedColor = lightWeight * instanceColors.rgb;\n    vec4 color = vec4(lightWeightedColor, instanceColors.a * opacity) / 255.0;\n    vColor = color;\n\n  } else {\n\n    vec4 pickingColor = vec4(instancePickingColors / 255.0, 1.0);\n     vColor = pickingColor;\n\n  }\n}\n'},{}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default='#define SHADER_NAME grid-layer-vs\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec4 instancePositions;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\n// Picking uniforms\n// Set to 1.0 if rendering picking buffer, 0.0 if rendering for display\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\n// Custom uniforms\nuniform float extruded;\nuniform float cellSize;\nuniform float opacity;\nuniform float elevationScale;\n\n// A magic number to scale elevation so that 1 unit approximate to 1 meter\n#define ELEVATION_SCALE 0.8\n\n// Result\nvarying vec4 vColor;\n\n// whether is point picked\nfloat isPicked(vec3 pickingColors, vec3 selectedColor) {\n return float(pickingColors.x == selectedColor.x\n && pickingColors.y == selectedColor.y\n && pickingColors.z == selectedColor.z);\n}\n\nvoid main(void) {\n\n  vec2 topLeftPos = project_position(instancePositions.xy);\n\n  // cube gemoetry vertics are between -1 to 1, scale and transform it to between 0, 1\n  vec2 pos = topLeftPos + vec2((positions.x + 1.0) * cellSize\n     / 2.0, (positions.y + 1.0) * cellSize / 2.0);\n\n  float elevation = 0.0;\n\n  if (extruded > 0.5) {\n    elevation = project_scale(instancePositions.w  * (positions.z + 1.0) *\n      ELEVATION_SCALE * elevationScale);\n  }\n\n  // extrude positions\n  vec3 extrudedPosition = vec3(pos.xy, elevation + 1.0);\n  vec4 position_worldspace = vec4(extrudedPosition, 1.0);\n  gl_Position = project_to_clipspace(position_worldspace);\n\n  if (renderPickingBuffer < 0.5) {\n\n    // TODO: we should allow the user to specify the color for "selected element"\n    // check whether a bar is currently picked.\n    float selected = isPicked(instancePickingColors, selectedPickingColor);\n\n    float lightWeight = 1.0;\n\n    if (extruded > 0.5) {\n      lightWeight = getLightWeight(\n        position_worldspace,\n        normals\n      );\n    }\n\n    vec3 lightWeightedColor = lightWeight * instanceColors.rgb;\n    vec4 color = vec4(lightWeightedColor, instanceColors.a * opacity) / 255.0;\n    vColor = color;\n\n  } else {\n\n    vec4 pickingColor = vec4(instancePickingColors / 255.0, 1.0);\n     vColor = pickingColor;\n\n  }\n}\n'},{}],42:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");var _gridCellLayerVertex=require("./grid-cell-layer-vertex.glsl");var _gridCellLayerVertex2=_interopRequireDefault(_gridCellLayerVertex);var _gridCellLayerVertex3=require("./grid-cell-layer-vertex-64.glsl");var _gridCellLayerVertex4=_interopRequireDefault(_gridCellLayerVertex3);var _gridCellLayerFragment=require("./grid-cell-layer-fragment.glsl");var _gridCellLayerFragment2=_interopRequireDefault(_gridCellLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[255,0,255,255];var defaultProps={cellSize:1e3,elevationScale:1,extruded:true,fp64:false,getPosition:function getPosition(x){return x.position},getElevation:function getElevation(x){return x.elevation},getColor:function getColor(x){return x.color},lightSettings:{lightsPosition:[-122.45,37.65,8e3,-122.45,37.2,1e3],ambientRatio:.4,diffuseRatio:.6,specularRatio:.8,lightsStrength:[1,0,.8,0],numberOfLights:2}};var GridCellLayer=function(_Layer){_inherits(GridCellLayer,_Layer);function GridCellLayer(){_classCallCheck(this,GridCellLayer);return _possibleConstructorReturn(this,(GridCellLayer.__proto__||Object.getPrototypeOf(GridCellLayer)).apply(this,arguments))}_createClass(GridCellLayer,[{key:"getShaders",value:function getShaders(){return(0,_fp.enable64bitSupport)(this.props)?{vs:_gridCellLayerVertex4.default,fs:_gridCellLayerFragment2.default,modules:["fp64","project64","lighting"]}:{vs:_gridCellLayerVertex2.default,fs:_gridCellLayerFragment2.default,modules:["lighting"]}}},{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this._getModel(gl)});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:4,accessor:["getPosition","getElevation"],update:this.calculateInstancePositions},instanceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,accessor:"getColor",update:this.calculateInstanceColors}})}},{key:"updateAttribute",value:function updateAttribute(_ref){var props=_ref.props,oldProps=_ref.oldProps,changeFlags=_ref.changeFlags;if(props.fp64!==oldProps.fp64){var attributeManager=this.state.attributeManager;attributeManager.invalidateAll();if(props.fp64&&props.projectionMode===_lib.COORDINATE_SYSTEM.LNGLAT){attributeManager.addInstanced({instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow}})}else{attributeManager.remove(["instancePositions64xyLow"])}}}},{key:"updateState",value:function updateState(_ref2){var props=_ref2.props,oldProps=_ref2.oldProps,changeFlags=_ref2.changeFlags;_get(GridCellLayer.prototype.__proto__||Object.getPrototypeOf(GridCellLayer.prototype),"updateState",this).call(this,{props:props,oldProps:oldProps,changeFlags:changeFlags});if(props.fp64!==oldProps.fp64){var gl=this.context.gl;this.setState({model:this._getModel(gl)})}this.updateAttribute({props:props,oldProps:oldProps,changeFlags:changeFlags});this.updateUniforms()}},{key:"_getModel",value:function _getModel(gl){var geometry=new _luma.CubeGeometry({});var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());return new _luma.Model({gl:gl,id:this.props.id,vs:shaders.vs,fs:shaders.fs,geometry:geometry,isInstanced:true})}},{key:"updateUniforms",value:function updateUniforms(){var _props=this.props,opacity=_props.opacity,extruded=_props.extruded,elevationScale=_props.elevationScale,cellSize=_props.cellSize,lightSettings=_props.lightSettings;var viewport=this.context.viewport;var _viewport$getDistance=viewport.getDistanceScales(),pixelsPerMeter=_viewport$getDistance.pixelsPerMeter;this.setUniforms(Object.assign({},{extruded:extruded,elevationScale:elevationScale,opacity:opacity,cellSize:cellSize*pixelsPerMeter[0]},lightSettings))}},{key:"draw",value:function draw(_ref3){var uniforms=_ref3.uniforms;_get(GridCellLayer.prototype.__proto__||Object.getPrototypeOf(GridCellLayer.prototype),"draw",this).call(this,{uniforms:Object.assign({},uniforms)})}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props2=this.props,data=_props2.data,getPosition=_props2.getPosition,getElevation=_props2.getElevation;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var position=getPosition(object);var elevation=getElevation(object)||0;value[i+0]=position[0];value[i+1]=position[1];value[i+2]=0;value[i+3]=elevation;i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstancePositions64xyLow",value:function calculateInstancePositions64xyLow(attribute){var _props3=this.props,data=_props3.data,getPosition=_props3.getPosition;var value=attribute.value;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var point=_step2.value;var position=getPosition(point);value[i++]=(0,_fp.fp64ify)(position[0])[1];value[i++]=(0,_fp.fp64ify)(position[1])[1]}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props4=this.props,data=_props4.data,getColor=_props4.getColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var color=getColor(object)||DEFAULT_COLOR;value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=Number.isFinite(color[3])?color[3]:DEFAULT_COLOR[3];i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}]);return GridCellLayer}(_lib.Layer);exports.default=GridCellLayer;GridCellLayer.layerName="GridCellLayer";GridCellLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../lib/utils/fp64":105,"../../../shader-utils":120,"./grid-cell-layer-fragment.glsl":39,"./grid-cell-layer-vertex-64.glsl":40,"./grid-cell-layer-vertex.glsl":41,"luma.gl":195}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pointToDensityGridData=pointToDensityGridData;var R_EARTH=6378e3;function pointToDensityGridData(points,cellSize,getPosition){var _pointsToGridHashing2=_pointsToGridHashing(points,cellSize,getPosition),gridHash=_pointsToGridHashing2.gridHash,gridOffset=_pointsToGridHashing2.gridOffset;var layerData=_getGridLayerDataFromGridHash(gridHash,gridOffset);var countRange=_getCellCountExtent(layerData);return{gridOffset:gridOffset,layerData:layerData,countRange:countRange}}function _pointsToGridHashing(points,cellSize,getPosition){var allLat=points.map(function(p){return getPosition(p)[1]});var latMin=Math.min.apply(null,allLat);var latMax=Math.max.apply(null,allLat);var centerLat=(latMin+latMax)/2;var gridOffset=_calculateGridLatLonOffset(cellSize,centerLat);if(gridOffset.xOffset<=0||gridOffset.yOffset<=0){return{gridHash:{},gridOffset:gridOffset}}var gridHash=points.reduce(function(accu,pt){var latIdx=Math.floor((getPosition(pt)[1]+90)/gridOffset.yOffset);var lonIdx=Math.floor((getPosition(pt)[0]+180)/gridOffset.xOffset);var key=latIdx+"-"+lonIdx;accu[key]=accu[key]||{count:0,points:[]};accu[key].count+=1;accu[key].points.push(pt);return accu},{});return{gridHash:gridHash,gridOffset:gridOffset}}function _getGridLayerDataFromGridHash(gridHash,gridOffset){return Object.keys(gridHash).reduce(function(accu,key,i){var idxs=key.split("-");var latIdx=parseInt(idxs[0],10);var lonIdx=parseInt(idxs[1],10);accu.push(Object.assign({index:i,position:[-180+gridOffset.xOffset*lonIdx,-90+gridOffset.yOffset*latIdx]},gridHash[key]));return accu},[])}function _getCellCountExtent(data){return data.length?[Math.min.apply(null,data.map(function(d){return d.count})),Math.max.apply(null,data.map(function(d){return d.count}))]:[0,1]}function _calculateGridLatLonOffset(cellSize,latitude){var yOffset=_calculateLatOffset(cellSize);var xOffset=_calculateLonOffset(latitude,cellSize);return{yOffset:yOffset,xOffset:xOffset}}function _calculateLatOffset(dy){return dy/R_EARTH*(180/Math.PI)}function _calculateLonOffset(lat,dx){return dx/R_EARTH*(180/Math.PI)/Math.cos(lat*Math.PI/180)}},{}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lib=require("../../../lib");var _gridCellLayer=require("../grid-cell-layer/grid-cell-layer");var _gridCellLayer2=_interopRequireDefault(_gridCellLayer);var _gridAggregator=require("./grid-aggregator");var _scaleUtils=require("../../../utils/scale-utils");var _colorUtils=require("../../../utils/color-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var defaultCellSize=1e3;var defaultElevationRange=[0,1e3];var defaultElevationScale=1;var defaultProps={cellSize:defaultCellSize,colorRange:_colorUtils.defaultColorRange,colorDomain:null,elevationRange:defaultElevationRange,elevationDomain:null,elevationScale:defaultElevationScale,getPosition:function getPosition(x){return x.position},extruded:false,fp64:false,lightSettings:{lightsPosition:[-122.45,37.75,8e3,-122,38,5e3],ambientRatio:.05,diffuseRatio:.6,specularRatio:.8,lightsStrength:[2,0,0,0],numberOfLights:2}};function _needsReProjectPoints(oldProps,props){return oldProps.cellSize!==props.cellSize}var GridLayer=function(_Layer){_inherits(GridLayer,_Layer);function GridLayer(){_classCallCheck(this,GridLayer);return _possibleConstructorReturn(this,(GridLayer.__proto__||Object.getPrototypeOf(GridLayer)).apply(this,arguments))}_createClass(GridLayer,[{key:"initializeState",value:function initializeState(){this.state={layerData:[],countRange:null}}},{key:"updateState",value:function updateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;if(changeFlags.dataChanged||_needsReProjectPoints(oldProps,props)){var _props=this.props,data=_props.data,cellSize=_props.cellSize,getPosition=_props.getPosition;var _pointToDensityGridDa=(0,_gridAggregator.pointToDensityGridData)(data,cellSize,getPosition),layerData=_pointToDensityGridDa.layerData,countRange=_pointToDensityGridDa.countRange;Object.assign(this.state,{layerData:layerData,countRange:countRange})}}},{key:"getPickingInfo",value:function getPickingInfo(_ref2){var info=_ref2.info;var pickedCell=info.picked&&info.index>-1?this.state.layerData[info.index]:null;return Object.assign(info,{picked:Boolean(pickedCell),object:pickedCell})}},{key:"_onGetSublayerColor",value:function _onGetSublayerColor(cell){var colorRange=this.props.colorRange;var colorDomain=this.props.colorDomain||this.state.countRange;return(0,_scaleUtils.quantizeScale)(colorDomain,colorRange,cell.count)}},{key:"_onGetSublayerElevation",value:function _onGetSublayerElevation(cell){var elevationRange=this.props.elevationRange;var elevationDomain=this.props.elevationDomain||[0,this.state.countRange[1]];return(0,_scaleUtils.linearScale)(elevationDomain,elevationRange,cell.count)}},{key:"renderLayers",value:function renderLayers(){var _props2=this.props,id=_props2.id,elevationScale=_props2.elevationScale,fp64=_props2.fp64,extruded=_props2.extruded,cellSize=_props2.cellSize,lightSettings=_props2.lightSettings;var _props3=this.props,opacity=_props3.opacity,pickable=_props3.pickable,visible=_props3.visible;var _props4=this.props,positionOrigin=_props4.positionOrigin,projectionMode=_props4.projectionMode,modelMatrix=_props4.modelMatrix;return new _gridCellLayer2.default({id:id+"-grid-cell",data:this.state.layerData,cellSize:cellSize,lightSettings:lightSettings,elevationScale:elevationScale,extruded:extruded,fp64:fp64,opacity:opacity,pickable:pickable,visible:visible,projectionMode:projectionMode,positionOrigin:positionOrigin,modelMatrix:modelMatrix,getColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),getPosition:function getPosition(d){return d.position},updateTriggers:{getColor:{colorRange:this.props.colorRange},getElevation:{
elevationRange:this.props.elevationRange}}})}}]);return GridLayer}(_lib.Layer);exports.default=GridLayer;GridLayer.layerName="GridLayer";GridLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../utils/color-utils":131,"../../../utils/scale-utils":132,"../grid-cell-layer/grid-cell-layer":42,"./grid-aggregator":43}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME hexagon-cell-layer-fs\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n"},{}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default='#define SHADER_NAME hexagon-cell-layer-vs-64\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\n// Picking uniforms\n// Set to 1.0 if rendering picking buffer, 0.0 if rendering for display\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\n// Custom uniforms\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform float extruded;\nuniform float coverage;\nuniform float elevationScale;\n\n// Result\nvarying vec4 vColor;\n\n// A magic number to scale elevation so that 1 unit approximate to 1 meter.\n#define ELEVATION_SCALE 0.8\n\nfloat isPicked(vec3 pickingColors, vec3 selectedColor) {\n return float(pickingColors.x == selectedColor.x\n && pickingColors.y == selectedColor.y\n && pickingColors.z == selectedColor.z);\n}\n\nvoid main(void) {\n\n  // rotate primitive position and normal\n  mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));\n\n  vec2 rPos = rotationMatrix * positions.xz;\n  vec2 rNorm = rotationMatrix * normals.xz;\n\n  vec3 rotatedPositions = vec3(rPos.x, positions.y, rPos.y);\n  vec3 rotatedNormals = vec3(rNorm.x, normals.y, rNorm.y);\n\n  // calculate elevation, if 3d not enabled set to 0\n  // cylindar gemoetry height are between -0.5 to 0.5, transform it to between 0, 1\n  float elevation = 0.0;\n\n  if (extruded > 0.5) {\n    elevation = project_scale(instancePositions.z * (positions.y + 0.5) *\n      ELEVATION_SCALE * elevationScale);\n}\n\n  float dotRadius = radius * clamp(coverage, 0.0, 1.0);\n  // // project center of hexagon\n\n  vec4 instancePositions64xy = vec4(\n    instancePositions.x, instancePositions64xyLow.x,\n    instancePositions.y, instancePositions64xyLow.y);\n\n  vec2 projected_coord_xy[2];\n  project_position_fp64(instancePositions64xy, projected_coord_xy);\n\n  vec2 vertex_pos_localspace[4];\n  vec4_fp64(vec4(rotatedPositions.xz * dotRadius, 0.0, 1.0), vertex_pos_localspace);\n\n  vec2 vertex_pos_modelspace[4];\n  vertex_pos_modelspace[0] = sum_fp64(vertex_pos_localspace[0], projected_coord_xy[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vertex_pos_localspace[1], projected_coord_xy[1]);\n  vertex_pos_modelspace[2] = sum_fp64(vertex_pos_localspace[2], vec2(elevation, 0.0));\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  vec4 position_worldspace = vec4(\n    vertex_pos_modelspace[0].x, vertex_pos_modelspace[1].x,\n    vertex_pos_modelspace[2].x, vertex_pos_modelspace[3].x);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  // render display\n  if (renderPickingBuffer < 0.5) {\n\n    // TODO: we should allow the user to specify the color for "selected element"\n    // check whether hexagon is currently picked.\n    float selected = isPicked(instancePickingColors, selectedPickingColor);\n\n    // Light calculations\n    // Worldspace is the linear space after Mercator projection\n\n    vec3 normals_worldspace = rotatedNormals;\n\n    float lightWeight = 1.0;\n\n    if (extruded > 0.5) {\n      lightWeight = getLightWeight(\n        position_worldspace,\n        normals_worldspace\n      );\n    }\n\n    vec3 lightWeightedColor = lightWeight * instanceColors.rgb;\n\n    // Color: Either opacity-multiplied instance color, or picking color\n    vec4 color = vec4(lightWeightedColor, opacity * instanceColors.a) / 255.0;\n\n    vColor = color;\n\n  } else {\n\n    vec4 pickingColor = vec4(instancePickingColors / 255.0, 1.0);\n    vColor = pickingColor;\n\n  }\n}\n'},{}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default='\n#define SHADER_NAME hexagon-cell-layer-vs\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\n// Picking uniforms\n// Set to 1.0 if rendering picking buffer, 0.0 if rendering for display\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\n// Custom uniforms\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform float extruded;\nuniform float coverage;\nuniform float elevationScale;\n\n// Result\nvarying vec4 vColor;\n\n// A magic number to scale elevation so that 1 unit approximate to 1 meter.\n#define ELEVATION_SCALE 0.8\n\n// whether is point picked\nfloat isPicked(vec3 pickingColors, vec3 selectedColor) {\n return float(pickingColors.x == selectedColor.x\n && pickingColors.y == selectedColor.y\n && pickingColors.z == selectedColor.z);\n}\n\nvoid main(void) {\n\n  // rotate primitive position and normal\n  mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));\n\n  vec2 rPos = rotationMatrix * positions.xz;\n  vec2 rNorm = rotationMatrix * normals.xz;\n\n  vec3 rotatedPositions = vec3(rPos.x, positions.y, rPos.y);\n  vec3 rotatedNormals = vec3(rNorm.x, normals.y, rNorm.y);\n\n  // calculate elevation, if 3d not enabled set to 0\n  // cylindar gemoetry height are between -0.5 to 0.5, transform it to between 0, 1\n  float elevation = 0.0;\n\n  if (extruded > 0.5) {\n    elevation = project_scale(instancePositions.z * (positions.y + 0.5) *\n      ELEVATION_SCALE * elevationScale);\n  }\n\n  float dotRadius = radius * mix(coverage, 0.0, float(instanceColors.a == 0.0));\n  // // project center of hexagon\n\n  vec4 centroidPosition = vec4(project_position(instancePositions.xy), elevation, 0.0);\n\n  vec4 position_worldspace = centroidPosition + vec4(vec2(rotatedPositions.xz * dotRadius), 0., 1.);\n\n  gl_Position = project_to_clipspace(position_worldspace);\n\n  // render display\n  if (renderPickingBuffer < 0.5) {\n\n    // TODO: we should allow the user to specify the color for "selected element"\n    // check whether hexagon is currently picked.\n    float selected = isPicked(instancePickingColors, selectedPickingColor);\n\n    // Light calculations\n    // Worldspace is the linear space after Mercator projection\n\n    vec3 normals_worldspace = rotatedNormals;\n\n    float lightWeight = 1.0;\n\n    if (extruded > 0.5) {\n      lightWeight = getLightWeight(\n        position_worldspace,\n        normals_worldspace\n      );\n    }\n\n    vec3 lightWeightedColor = lightWeight * instanceColors.rgb;\n\n    // Color: Either opacity-multiplied instance color, or picking color\n    vec4 color = vec4(lightWeightedColor, opacity * instanceColors.a) / 255.0;\n\n    vColor = color;\n\n  } else {\n\n    vec4 pickingColor = vec4(instancePickingColors / 255.0, 1.0);\n    vColor = pickingColor;\n\n  }\n}\n'},{}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _utils=require("../../../lib/utils");var _fp=require("../../../lib/utils/fp64");var _hexagonCellLayerVertex=require("./hexagon-cell-layer-vertex.glsl");var _hexagonCellLayerVertex2=_interopRequireDefault(_hexagonCellLayerVertex);var _hexagonCellLayerVertex3=require("./hexagon-cell-layer-vertex-64.glsl");var _hexagonCellLayerVertex4=_interopRequireDefault(_hexagonCellLayerVertex3);var _hexagonCellLayerFragment=require("./hexagon-cell-layer-fragment.glsl");var _hexagonCellLayerFragment2=_interopRequireDefault(_hexagonCellLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function positionsAreEqual(v1,v2){return v1===v2||v1&&v2&&v1[0][0]===v2[0][0]&&v1[0][1]===v2[0][1]}var DEFAULT_COLOR=[255,0,255,255];var defaultProps={hexagonVertices:null,radius:null,angle:null,coverage:1,elevationScale:1,extruded:true,fp64:false,getCentroid:function getCentroid(x){return x.centroid},getColor:function getColor(x){return x.color},getElevation:function getElevation(x){return x.elevation},lightSettings:{lightsPosition:[-122.45,37.75,8e3,-122,38,5e3],ambientRatio:.4,diffuseRatio:.6,specularRatio:.8,lightsStrength:[1.2,0,.8,0],numberOfLights:2}};var HexagonCellLayer=function(_Layer){_inherits(HexagonCellLayer,_Layer);function HexagonCellLayer(props){_classCallCheck(this,HexagonCellLayer);var missingProps=false;if(!props.hexagonVertices&&(!props.radius||!Number.isFinite(props.angle))){_utils.log.once(0,"HexagonCellLayer: Either hexagonVertices or radius and angle are "+"needed to calculate primitive hexagon.");missingProps=true}else if(props.hexagonVertices&&(!Array.isArray(props.hexagonVertices)||props.hexagonVertices.length<6)){_utils.log.once(0,"HexagonCellLayer: hexagonVertices needs to be an array of 6 points");missingProps=true}if(missingProps){_utils.log.once(0,"Now using 1000 meter as default radius, 0 as default angle");props.radius=1e3;props.angle=0}return _possibleConstructorReturn(this,(HexagonCellLayer.__proto__||Object.getPrototypeOf(HexagonCellLayer)).call(this,props))}_createClass(HexagonCellLayer,[{key:"getShaders",value:function getShaders(){return(0,_fp.enable64bitSupport)(this.props)?{vs:_hexagonCellLayerVertex4.default,fs:_hexagonCellLayerFragment2.default,modules:["fp64","project64","lighting"]}:{vs:_hexagonCellLayerVertex2.default,fs:_hexagonCellLayerFragment2.default,modules:["lighting"]}}},{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this._getModel(gl)});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:3,accessor:["getCentroid","getElevation"],update:this.calculateInstancePositions},instanceColors:{size:4,type:gl.UNSIGNED_BYTE,accessor:"getColor",update:this.calculateInstanceColors}});this.updateRadiusAngle()}},{key:"updateAttribute",value:function updateAttribute(_ref){var props=_ref.props,oldProps=_ref.oldProps,changeFlags=_ref.changeFlags;if(props.fp64!==oldProps.fp64){var attributeManager=this.state.attributeManager;attributeManager.invalidateAll();if(props.fp64&&props.projectionMode===_lib.COORDINATE_SYSTEM.LNGLAT){attributeManager.addInstanced({instancePositions64xyLow:{size:2,accessor:"getCentroid",update:this.calculateInstancePositions64xyLow}})}else{attributeManager.remove(["instancePositions64xyLow"])}}}},{key:"updateState",value:function updateState(_ref2){var props=_ref2.props,oldProps=_ref2.oldProps,changeFlags=_ref2.changeFlags;_get(HexagonCellLayer.prototype.__proto__||Object.getPrototypeOf(HexagonCellLayer.prototype),"updateState",this).call(this,{props:props,oldProps:oldProps,changeFlags:changeFlags});if(props.fp64!==oldProps.fp64){var gl=this.context.gl;this.setState({model:this._getModel(gl)})}this.updateAttribute({props:props,oldProps:oldProps,changeFlags:changeFlags});var viewportChanged=changeFlags.viewportChanged;var model=this.state.model;var verticesChanged=!positionsAreEqual(oldProps.hexagonVertices,props.hexagonVertices);if(model&&(verticesChanged||viewportChanged)){this.updateRadiusAngle()}this.updateUniforms()}},{key:"updateRadiusAngle",value:function updateRadiusAngle(){var angle=void 0;var radius=void 0;var hexagonVertices=this.props.hexagonVertices;if(Array.isArray(hexagonVertices)&&hexagonVertices.length>=6){var vertices=this.props.hexagonVertices;var vertex0=vertices[0];var vertex3=vertices[3];var spaceCoord0=this.projectFlat(vertex0);var spaceCoord3=this.projectFlat(vertex3);var dx=spaceCoord0[0]-spaceCoord3[0];var dy=spaceCoord0[1]-spaceCoord3[1];var dxy=Math.sqrt(dx*dx+dy*dy);angle=Math.acos(dx/dxy)*-Math.sign(dy)+Math.PI/2;radius=dxy/2}else if(this.props.radius&&Number.isFinite(this.props.angle)){var viewport=this.context.viewport;var _viewport$getDistance=viewport.getDistanceScales(),pixelsPerMeter=_viewport$getDistance.pixelsPerMeter;angle=this.props.angle;radius=this.props.radius*pixelsPerMeter[0]}this.setUniforms({angle:angle,radius:radius})}},{key:"getCylinderGeometry",value:function getCylinderGeometry(radius){return new _luma.CylinderGeometry({radius:radius,topRadius:radius,bottomRadius:radius,topCap:true,bottomCap:true,height:1,nradial:6,nvertical:1})}},{key:"updateUniforms",value:function updateUniforms(){var _props=this.props,opacity=_props.opacity,elevationScale=_props.elevationScale,extruded=_props.extruded,coverage=_props.coverage,lightSettings=_props.lightSettings;this.setUniforms(Object.assign({},{extruded:extruded,opacity:opacity,coverage:coverage,elevationScale:elevationScale},lightSettings))}},{key:"_getModel",value:function _getModel(gl){var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());return new _luma.Model({gl:gl,id:this.props.id,vs:shaders.vs,fs:shaders.fs,geometry:this.getCylinderGeometry(1),isInstanced:true})}},{key:"draw",value:function draw(_ref3){var uniforms=_ref3.uniforms;_get(HexagonCellLayer.prototype.__proto__||Object.getPrototypeOf(HexagonCellLayer.prototype),"draw",this).call(this,{uniforms:Object.assign({},uniforms)})}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props2=this.props,data=_props2.data,getCentroid=_props2.getCentroid,getElevation=_props2.getElevation;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var _getCentroid=getCentroid(object),_getCentroid2=_slicedToArray(_getCentroid,2),lon=_getCentroid2[0],lat=_getCentroid2[1];var elevation=getElevation(object);value[i+0]=lon;value[i+1]=lat;value[i+2]=elevation||this.props.elevation;i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstancePositions64xyLow",value:function calculateInstancePositions64xyLow(attribute){var _props3=this.props,data=_props3.data,getCentroid=_props3.getCentroid;var value=attribute.value;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var object=_step2.value;var position=getCentroid(object);value[i++]=(0,_fp.fp64ify)(position[0])[1];value[i++]=(0,_fp.fp64ify)(position[1])[1]}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props4=this.props,data=_props4.data,getColor=_props4.getColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var color=getColor(object)||DEFAULT_COLOR;value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=Number.isFinite(color[3])?color[3]:DEFAULT_COLOR[3];i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}}]);return HexagonCellLayer}(_lib.Layer);exports.default=HexagonCellLayer;HexagonCellLayer.layerName="HexagonCellLayer";HexagonCellLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../lib/utils":108,"../../../lib/utils/fp64":105,"../../../shader-utils":120,"./hexagon-cell-layer-fragment.glsl":45,"./hexagon-cell-layer-vertex-64.glsl":46,"./hexagon-cell-layer-vertex.glsl":47,"luma.gl":195}],49:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pointToHexbin=pointToHexbin;exports.getRadiusInPixel=getRadiusInPixel;var _d3Hexbin=require("d3-hexbin");function pointToHexbin(_ref,viewport){var data=_ref.data,radius=_ref.radius,getPosition=_ref.getPosition;var radiusInPixel=getRadiusInPixel(radius,viewport);var screenPoints=data.map(function(pt){return Object.assign({screenCoord:viewport.projectFlat(getPosition(pt))},pt)});var newHexbin=(0,_d3Hexbin.hexbin)().radius(radiusInPixel).x(function(d){return d.screenCoord[0]}).y(function(d){return d.screenCoord[1]});var hexagonBins=newHexbin(screenPoints);return hexagonBins.map(function(hex){return{centroid:viewport.unprojectFlat([hex.x,hex.y]),points:hex}})}function getRadiusInPixel(radius,viewport){var _viewport$getDistance=viewport.getDistanceScales(),pixelsPerMeter=_viewport$getDistance.pixelsPerMeter;return radius*pixelsPerMeter[0]}},{"d3-hexbin":10}],50:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lib=require("../../../lib");var _hexagonCellLayer=require("../hexagon-cell-layer/hexagon-cell-layer");var _hexagonCellLayer2=_interopRequireDefault(_hexagonCellLayer);var _utils=require("../../../lib/utils");var _scaleUtils=require("../../../utils/scale-utils");var _colorUtils=require("../../../utils/color-utils");var _hexagonAggregator=require("./hexagon-aggregator");var _binSorter=require("../../../utils/bin-sorter");var _binSorter2=_interopRequireDefault(_binSorter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var defaultProps={colorDomain:null,colorRange:_colorUtils.defaultColorRange,elevationDomain:null,elevationRange:[0,1e3],elevationScale:1,lowerPercentile:0,upperPercentile:100,radius:1e3,coverage:1,extruded:false,hexagonAggregator:_hexagonAggregator.pointToHexbin,getPosition:function getPosition(x){return x.position},fp64:false,lightSettings:{lightsPosition:[-122.45,37.75,8e3,-122,38,5e3],ambientRatio:.05,diffuseRatio:.6,specularRatio:.8,lightsStrength:[2,0,0,0],numberOfLights:2}};function _needsReProjectPoints(oldProps,props){return oldProps.radius!==props.radius}function _percentileChanged(oldProps,props){return oldProps.lowerPercentile!==props.lowerPercentile||oldProps.upperPercentile!==props.upperPercentile}var HexagonLayer=function(_Layer){_inherits(HexagonLayer,_Layer);function HexagonLayer(props){_classCallCheck(this,HexagonLayer);if(!props.radius){_utils.log.once(0,"HexagonLayer: radius in meter is needed to aggregate points into "+"hexagonal bins, Now using 1000 meter as default");props.radius=defaultProps.radius}if(Number.isFinite(props.upperPercentile)&&(props.upperPercentile>100||props.upperPercentile<0)){_utils.log.once(0,"HexagonLayer: upperPercentile should be between 0 and 100. "+"Assign to 100 by default");props.upperPercentile=defaultProps.upperPercentile}if(Number.isFinite(props.lowerPercentile)&&(props.lowerPercentile>100||props.lowerPercentile<0)){_utils.log.once(0,"HexagonLayer: lowerPercentile should be between 0 and 100. "+"Assign to 0 by default");props.lowerPercentile=defaultProps.upperPercentile}if(props.lowerPercentile>=props.upperPercentile){_utils.log.once(0,"HexagonLayer: lowerPercentile should not be bigger than "+"upperPercentile. Assign to 0 by default");props.lowerPercentile=defaultProps.lowerPercentile}return _possibleConstructorReturn(this,(HexagonLayer.__proto__||Object.getPrototypeOf(HexagonLayer)).call(this,props))}_createClass(HexagonLayer,[{key:"initializeState",value:function initializeState(){this.state={hexagons:[],countRange:null,sortedCounts:null,valueDomain:null}}},{key:"updateState",value:function updateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;if(changeFlags.dataChanged||_needsReProjectPoints(oldProps,props)){var hexagonAggregator=this.props.hexagonAggregator;var viewport=this.context.viewport;var hexagons=hexagonAggregator(this.props,viewport);var sortedCounts=new _binSorter2.default(hexagons);Object.assign(this.state,{hexagons:hexagons,sortedCounts:sortedCounts});this._onPercentileChange()}else if(_percentileChanged(oldProps,props)){this._onPercentileChange()}}},{key:"getPickingInfo",value:function getPickingInfo(_ref2){var info=_ref2.info;var pickedCell=info.picked&&info.index>-1?this.state.hexagons[info.index]:null;return Object.assign(info,{picked:Boolean(pickedCell),object:pickedCell})}},{key:"_onPercentileChange",value:function _onPercentileChange(){var _props=this.props,lowerPercentile=_props.lowerPercentile,upperPercentile=_props.upperPercentile;this.state.valueDomain=this.state.sortedCounts.getCountRange([lowerPercentile,upperPercentile])}},{key:"_onGetSublayerColor",value:function _onGetSublayerColor(cell){var colorRange=this.props.colorRange;var valueDomain=this.state.valueDomain;var colorDomain=this.props.colorDomain||valueDomain;var count=cell.points.length;var color=(0,_scaleUtils.quantizeScale)(colorDomain,colorRange,count);var alpha=count>=valueDomain[0]&&count<=valueDomain[1]?Number.isFinite(color[3])?color[3]:255:0;return color.concat([alpha])}},{key:"_onGetSublayerElevation",value:function _onGetSublayerElevation(cell){var _props2=this.props,elevationDomain=_props2.elevationDomain,elevationRange=_props2.elevationRange;var sortedCounts=this.state.sortedCounts;var domain=elevationDomain||[0,sortedCounts.getMaxCount()];return(0,_scaleUtils.linearScale)(domain,elevationRange,cell.points.length)}},{key:"renderLayers",value:function renderLayers(){var _props3=this.props,id=_props3.id,radius=_props3.radius,elevationScale=_props3.elevationScale,extruded=_props3.extruded,coverage=_props3.coverage,lightSettings=_props3.lightSettings,fp64=_props3.fp64;var _props4=this.props,opacity=_props4.opacity,pickable=_props4.pickable,visible=_props4.visible;var _props5=this.props,positionOrigin=_props5.positionOrigin,projectionMode=_props5.projectionMode,modelMatrix=_props5.modelMatrix;return new _hexagonCellLayer2.default({id:id+"-hexagon-cell",data:this.state.hexagons,radius:radius,elevationScale:elevationScale,angle:Math.PI,extruded:extruded,coverage:coverage,lightSettings:lightSettings,fp64:fp64,opacity:opacity,pickable:pickable,visible:visible,projectionMode:projectionMode,positionOrigin:positionOrigin,modelMatrix:modelMatrix,getColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),updateTriggers:{getColor:{colorRange:this.props.colorRange,colorDomain:this.props.colorDomain,lowerPercentile:this.props.lowerPercentile,upperPercentile:this.props.upperPercentile},getElevation:{elevationRange:this.props.elevationRange,elevationDomain:this.props.elevationDomain}}})}}]);return HexagonLayer}(_lib.Layer);exports.default=HexagonLayer;HexagonLayer.layerName="HexagonLayer";HexagonLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../lib/utils":108,"../../../utils/bin-sorter":130,"../../../utils/color-utils":131,"../../../utils/scale-utils":132,"../hexagon-cell-layer/hexagon-cell-layer":48,"./hexagon-aggregator":49}],51:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME scatterplot-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform float opacity;\nuniform float renderPickingBuffer;\nuniform sampler2D iconsTexture;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nconst float MIN_ALPHA = 0.05;\n\nvoid main(void) {\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n\n  // if colorMode == 0, use pixel color from the texture\n  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask\n  vec3 color = mix(texColor.rgb, vColor.rgb,\n    max(vColorMode, renderPickingBuffer)\n  );\n  float a = texColor.a * opacity * mix(1.0, vColor.a, vColorMode);\n\n  if (a < MIN_ALPHA) {\n    discard;\n  }\n\n  // if rendering to screen, use mixed alpha\n  // if rendering picking buffer, use binary alpha\n  a = mix(a, 1.0, renderPickingBuffer);\n\n  gl_FragColor = vec4(color, a);\n}\n"},{}],52:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceSizes;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\n\nuniform vec2 viewportSize;\nuniform float sizeScale;\nuniform float renderPickingBuffer;\nuniform vec2 iconsTextureDim;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nvoid main(void) {\n  vec2 iconSize = instanceIconFrames.zw;\n  vec2 iconSize_clipspace = iconSize / viewportSize * 2.0;\n  // scale icon height to match instanceSize\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : instanceSizes / iconSize.y;\n\n  // The vertex variable is in clip space and should not go through project_to_clipspace call\n  vec2 vertex = (positions / 2.0 + instanceOffsets) * iconSize_clipspace *\n    sizeScale * instanceScale;\n\n  vertex.y *= -1.0;\n\n  vec4 instancePositions64xy = vec4(\n    instancePositions.x, instancePositions64xyLow.x,\n    instancePositions.y, instancePositions64xyLow.y);\n\n  vec2 projected_coord_xy[2];\n  project_position_fp64(instancePositions64xy, projected_coord_xy);\n\n  vec2 vertex_pos_modelspace[4];\n  vertex_pos_modelspace[0] = projected_coord_xy[0];\n  vertex_pos_modelspace[1] = projected_coord_xy[1];\n  vertex_pos_modelspace[2] = vec2(project_scale(instancePositions.z), 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace) + vec4(vertex, 0.0, 0.0);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vTextureCoords.y = 1.0 - vTextureCoords.y;\n\n  vec4 color = instanceColors / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n  vColor = mix(color, pickingColor, renderPickingBuffer);\n\n  vColorMode = instanceColorModes;\n}\n"},{}],53:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})
;exports.default="#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute float instanceSizes;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\n\nuniform vec2 viewportSize;\nuniform float sizeScale;\nuniform float renderPickingBuffer;\nuniform vec2 iconsTextureDim;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nvoid main(void) {\n  vec2 iconSize = instanceIconFrames.zw;\n  vec2 iconSize_clipspace = iconSize / viewportSize * 2.0;\n  // scale icon height to match instanceSize\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : instanceSizes / iconSize.y;\n  vec3 center = project_position(instancePositions);\n  vec2 vertex = (positions / 2.0 + instanceOffsets) * iconSize_clipspace *\n    sizeScale * instanceScale;\n  vertex.y *= -1.0;\n  gl_Position = project_to_clipspace(vec4(center, 1.0)) + vec4(vertex, 0.0, 0.0);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vTextureCoords.y = 1.0 - vTextureCoords.y;\n\n  vec4 color = instanceColors / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n  vColor = mix(color, pickingColor, renderPickingBuffer);\n\n  vColorMode = instanceColorModes;\n}\n"},{}],54:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");var _iconLayerVertex=require("./icon-layer-vertex.glsl");var _iconLayerVertex2=_interopRequireDefault(_iconLayerVertex);var _iconLayerVertex3=require("./icon-layer-vertex-64.glsl");var _iconLayerVertex4=_interopRequireDefault(_iconLayerVertex3);var _iconLayerFragment=require("./icon-layer-fragment.glsl");var _iconLayerFragment2=_interopRequireDefault(_iconLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,0,255];var defaultProps={iconAtlas:null,iconMapping:{},sizeScale:1,fp64:false,getPosition:function getPosition(x){return x.position},getIcon:function getIcon(x){return x.icon},getColor:function getColor(x){return x.color||DEFAULT_COLOR},getSize:function getSize(x){return x.size||1}};var IconLayer=function(_Layer){_inherits(IconLayer,_Layer);function IconLayer(){_classCallCheck(this,IconLayer);return _possibleConstructorReturn(this,(IconLayer.__proto__||Object.getPrototypeOf(IconLayer)).apply(this,arguments))}_createClass(IconLayer,[{key:"initializeState",value:function initializeState(){var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:3,accessor:"getPosition",update:this.calculateInstancePositions},instanceSizes:{size:1,accessor:"getSize",update:this.calculateInstanceSizes},instanceOffsets:{size:2,accessor:"getIcon",update:this.calculateInstanceOffsets},instanceIconFrames:{size:4,accessor:"getIcon",update:this.calculateInstanceIconFrames},instanceColorModes:{size:1,type:_luma.GL.UNSIGNED_BYTE,accessor:"getIcon",update:this.calculateInstanceColorMode},instanceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,accessor:"getColor",update:this.calculateInstanceColors}});var gl=this.context.gl;this.setState({model:this._getModel(gl)})}},{key:"updateAttribute",value:function updateAttribute(_ref){var props=_ref.props,oldProps=_ref.oldProps,changeFlags=_ref.changeFlags;if(props.fp64!==oldProps.fp64){var attributeManager=this.state.attributeManager;attributeManager.invalidateAll();if(props.fp64&&props.projectionMode===_lib.COORDINATE_SYSTEM.LNGLAT){attributeManager.addInstanced({instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow}})}else{attributeManager.remove(["instancePositions64xyLow"])}}}},{key:"updateState",value:function updateState(_ref2){var oldProps=_ref2.oldProps,props=_ref2.props,changeFlags=_ref2.changeFlags;_get(IconLayer.prototype.__proto__||Object.getPrototypeOf(IconLayer.prototype),"updateState",this).call(this,{props:props,oldProps:oldProps,changeFlags:changeFlags});var iconAtlas=props.iconAtlas,iconMapping=props.iconMapping;if(oldProps.iconMapping!==iconMapping){var attributeManager=this.state.attributeManager;attributeManager.invalidate("instanceOffsets");attributeManager.invalidate("instanceIconFrames");attributeManager.invalidate("instanceColorModes")}if(oldProps.iconAtlas!==iconAtlas){var icons={};this.state.icons=icons;if(iconAtlas instanceof _luma.Texture2D){icons.texture=iconAtlas}else if(typeof iconAtlas==="string"){(0,_luma.loadTextures)(this.context.gl,{urls:[iconAtlas]}).then(function(_ref3){var _ref4=_slicedToArray(_ref3,1),texture=_ref4[0];icons.texture=texture})}}if(props.fp64!==oldProps.fp64){var gl=this.context.gl;this.setState({model:this._getModel(gl)})}this.updateAttribute({props:props,oldProps:oldProps,changeFlags:changeFlags})}},{key:"draw",value:function draw(_ref5){var uniforms=_ref5.uniforms;var sizeScale=this.props.sizeScale;var iconsTexture=this.state.icons&&this.state.icons.texture;if(iconsTexture){this.state.model.render(Object.assign({},uniforms,{iconsTexture:iconsTexture,iconsTextureDim:[iconsTexture.width,iconsTexture.height],sizeScale:sizeScale}))}}},{key:"getShaders",value:function getShaders(){return(0,_fp.enable64bitSupport)(this.props)?{vs:_iconLayerVertex4.default,fs:_iconLayerFragment2.default,modules:["fp64","project64"]}:{vs:_iconLayerVertex2.default,fs:_iconLayerFragment2.default,modules:[]}}},{key:"_getModel",value:function _getModel(gl){var positions=[-1,-1,0,-1,1,0,1,1,0,1,-1,0];var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());return new _luma.Model({gl:gl,id:this.props.id,vs:shaders.vs,fs:shaders.fs,geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_FAN,positions:new Float32Array(positions)}),isInstanced:true})}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props=this.props,data=_props.data,getPosition=_props.getPosition;var value=attribute.value;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var position=getPosition(object);value[i++]=position[0];value[i++]=position[1];value[i++]=position[2]||0}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstancePositions64xyLow",value:function calculateInstancePositions64xyLow(attribute){var _props2=this.props,data=_props2.data,getPosition=_props2.getPosition;var value=attribute.value;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var point=_step2.value;var position=getPosition(point);value[i++]=(0,_fp.fp64ify)(position[0])[1];value[i++]=(0,_fp.fp64ify)(position[1])[1]}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceSizes",value:function calculateInstanceSizes(attribute){var _props3=this.props,data=_props3.data,getSize=_props3.getSize;var value=attribute.value;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;value[i++]=getSize(object)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props4=this.props,data=_props4.data,getColor=_props4.getColor;var value=attribute.value;var i=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=data[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var object=_step4.value;var color=getColor(object);value[i++]=color[0];value[i++]=color[1];value[i++]=color[2];value[i++]=isNaN(color[3])?255:color[3]}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}},{key:"calculateInstanceOffsets",value:function calculateInstanceOffsets(attribute){var _props5=this.props,data=_props5.data,iconMapping=_props5.iconMapping,getIcon=_props5.getIcon;var value=attribute.value;var i=0;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=data[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var object=_step5.value;var icon=getIcon(object);var rect=iconMapping[icon]||{};value[i++]=1/2-rect.anchorX/rect.width||0;value[i++]=1/2-rect.anchorY/rect.height||0}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}}},{key:"calculateInstanceColorMode",value:function calculateInstanceColorMode(attribute){var _props6=this.props,data=_props6.data,iconMapping=_props6.iconMapping,getIcon=_props6.getIcon;var value=attribute.value;var i=0;var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=data[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var object=_step6.value;var icon=getIcon(object);var colorMode=iconMapping[icon]&&iconMapping[icon].mask;value[i++]=colorMode?1:0}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return()}}finally{if(_didIteratorError6){throw _iteratorError6}}}}},{key:"calculateInstanceIconFrames",value:function calculateInstanceIconFrames(attribute){var _props7=this.props,data=_props7.data,iconMapping=_props7.iconMapping,getIcon=_props7.getIcon;var value=attribute.value;var i=0;var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=data[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var object=_step7.value;var icon=getIcon(object);var rect=iconMapping[icon]||{};value[i++]=rect.x||0;value[i++]=rect.y||0;value[i++]=rect.width||0;value[i++]=rect.height||0}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return()}}finally{if(_didIteratorError7){throw _iteratorError7}}}}}]);return IconLayer}(_lib.Layer);exports.default=IconLayer;IconLayer.layerName="IconLayer";IconLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../lib/utils/fp64":105,"../../../shader-utils":120,"./icon-layer-fragment.glsl":51,"./icon-layer-vertex-64.glsl":52,"./icon-layer-vertex.glsl":53,"luma.gl":195}],55:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME line-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n"},{}],56:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME line-layer-vertex-64-shader\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec4 instanceSourceTargetPositions64xyLow;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform vec2 viewportSize;\nuniform float strokeWidth;\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * viewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * strokeWidth / 2.0;\n  vec2 offset_clipspace = offset_screenspace / viewportSize * 2.0;\n\n  return offset_clipspace;\n}\n\nvoid main(void) {\n  // Position\n  vec4 instanceSourcePositions64 = vec4(\n    instanceSourcePositions.x, instanceSourceTargetPositions64xyLow.x,\n    instanceSourcePositions.y, instanceSourceTargetPositions64xyLow.y);\n\n  vec4 instanceTargetPositions64 = vec4(\n    instanceTargetPositions.x, instanceSourceTargetPositions64xyLow.z,\n    instanceTargetPositions.y, instanceSourceTargetPositions64xyLow.w);\n\n  vec2 projected_source_coord[2];\n  vec2 projected_target_coord[2];\n\n  project_position_fp64(instanceSourcePositions64, projected_source_coord);\n  project_position_fp64(instanceTargetPositions64, projected_target_coord);\n\n  vec2 source_pos_modelspace[4];\n  source_pos_modelspace[0] =  projected_source_coord[0];\n  source_pos_modelspace[1] =  projected_source_coord[1];\n  source_pos_modelspace[2] = vec2(project_scale(instanceSourcePositions.z), 0.0);\n  source_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  vec4 source_pos_clipspace = project_to_clipspace_fp64(source_pos_modelspace);\n\n  vec2 target_pos_modelspace[4];\n  target_pos_modelspace[0] =  projected_target_coord[0];\n  target_pos_modelspace[1] =  projected_target_coord[1];\n  target_pos_modelspace[2] = vec2(project_scale(instanceTargetPositions.z), 0.0);\n  target_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  vec4 target_pos_clipspace = project_to_clipspace_fp64(target_pos_modelspace);\n\n  float segmentIndex = positions.x;\n  vec4 p = mix(source_pos_clipspace, target_pos_clipspace, segmentIndex);\n\n  vec2 offset = getExtrusionOffset(target_pos_clipspace.xy - source_pos_clipspace.xy, positions.y);\n\n  gl_Position = p + vec4(offset, 0.0, 0.0);\n\n  // Color\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n"},{}],57:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform vec2 viewportSize;\nuniform float strokeWidth;\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * viewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * strokeWidth / 2.0;\n  vec2 offset_clipspace = offset_screenspace / viewportSize * 2.0;\n\n  return offset_clipspace;\n}\n\nvoid main(void) {\n  // Position\n  vec3 sourcePos = project_position(instanceSourcePositions);\n  vec3 targetPos = project_position(instanceTargetPositions);\n  vec4 source = project_to_clipspace(vec4(sourcePos, 1.0));\n  vec4 target = project_to_clipspace(vec4(targetPos, 1.0));\n\n  // linear interpolation of source & target to pick right coord\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n\n  // extrude\n  vec2 offset = getExtrusionOffset(target.xy - source.xy, positions.y);\n  gl_Position = p + vec4(offset, 0.0, 0.0);\n\n  // Color\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n  vColor = mix(\n    color,\n    pickingColor,\n    renderPickingBuffer\n  );\n}\n"},{}],58:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");var _lineLayerVertex=require("./line-layer-vertex.glsl");var _lineLayerVertex2=_interopRequireDefault(_lineLayerVertex);var _lineLayerVertex3=require("./line-layer-vertex-64.glsl");var _lineLayerVertex4=_interopRequireDefault(_lineLayerVertex3);var _lineLayerFragment=require("./line-layer-fragment.glsl");var _lineLayerFragment2=_interopRequireDefault(_lineLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,0,255];var defaultProps={strokeWidth:1,fp64:false,getSourcePosition:function getSourcePosition(x){return x.sourcePosition},getTargetPosition:function getTargetPosition(x){return x.targetPosition},getColor:function getColor(x){return x.color||DEFAULT_COLOR}};var LineLayer=function(_Layer){_inherits(LineLayer,_Layer);function LineLayer(){_classCallCheck(this,LineLayer);return _possibleConstructorReturn(this,(LineLayer.__proto__||Object.getPrototypeOf(LineLayer)).apply(this,arguments))}_createClass(LineLayer,[{key:"getShaders",value:function getShaders(){return(0,_fp.enable64bitSupport)(this.props)?{vs:_lineLayerVertex4.default,fs:_lineLayerFragment2.default,modules:["fp64","project64"]}:{vs:_lineLayerVertex2.default,fs:_lineLayerFragment2.default,modules:[]}}},{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this._getModel(gl)});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instanceSourcePositions:{size:3,accessor:"getSourcePosition",update:this.calculateInstanceSourcePositions},instanceTargetPositions:{size:3,accessor:"getTargetPosition",update:this.calculateInstanceTargetPositions},instanceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,accessor:"getColor",update:this.calculateInstanceColors}})}},{key:"updateAttribute",value:function updateAttribute(_ref){var props=_ref.props,oldProps=_ref.oldProps,changeFlags=_ref.changeFlags;if(props.fp64!==oldProps.fp64){var attributeManager=this.state.attributeManager;attributeManager.invalidateAll();if(props.fp64&&props.projectionMode===_lib.COORDINATE_SYSTEM.LNGLAT){attributeManager.addInstanced({instanceSourceTargetPositions64xyLow:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstanceSourceTargetPositions64xyLow}})}else{attributeManager.remove(["instanceSourceTargetPositions64xyLow"])}}}},{key:"updateState",value:function updateState(_ref2){var props=_ref2.props,oldProps=_ref2.oldProps,changeFlags=_ref2.changeFlags;_get(LineLayer.prototype.__proto__||Object.getPrototypeOf(LineLayer.prototype),"updateState",this).call(this,{props:props,oldProps:oldProps,changeFlags:changeFlags});if(props.fp64!==oldProps.fp64){var gl=this.context.gl;this.setState({model:this._getModel(gl)})}this.updateAttribute({props:props,oldProps:oldProps,changeFlags:changeFlags})}},{key:"draw",value:function draw(_ref3){var uniforms=_ref3.uniforms;var strokeWidth=this.props.strokeWidth;this.state.model.render(Object.assign({},uniforms,{strokeWidth:strokeWidth}))}},{key:"_getModel",value:function _getModel(gl){var positions=[0,-1,0,0,1,0,1,-1,0,1,1,0];var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());return new _luma.Model({gl:gl,id:this.props.id,vs:shaders.vs,fs:shaders.fs,geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_STRIP,positions:new Float32Array(positions)}),isInstanced:true})}},{key:"calculateInstanceSourcePositions",value:function calculateInstanceSourcePositions(attribute){var _props=this.props,data=_props.data,getSourcePosition=_props.getSourcePosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var sourcePosition=getSourcePosition(object);value[i+0]=sourcePosition[0];value[i+1]=sourcePosition[1];value[i+2]=isNaN(sourcePosition[2])?0:sourcePosition[2];i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstanceTargetPositions",value:function calculateInstanceTargetPositions(attribute){var _props2=this.props,data=_props2.data,getTargetPosition=_props2.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var object=_step2.value;var targetPosition=getTargetPosition(object);value[i+0]=targetPosition[0];value[i+1]=targetPosition[1];value[i+2]=isNaN(targetPosition[2])?0:targetPosition[2];i+=size}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceSourceTargetPositions64xyLow",value:function calculateInstanceSourceTargetPositions64xyLow(attribute){var _props3=this.props,data=_props3.data,getSourcePosition=_props3.getSourcePosition,getTargetPosition=_props3.getTargetPosition;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;var sourcePosition=getSourcePosition(object);var targetPosition=getTargetPosition(object);value[i+0]=(0,_fp.fp64ify)(sourcePosition[0])[1];value[i+1]=(0,_fp.fp64ify)(sourcePosition[1])[1];value[i+2]=(0,_fp.fp64ify)(targetPosition[0])[1];value[i+3]=(0,_fp.fp64ify)(targetPosition[1])[1];i+=size}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props4=this.props,data=_props4.data,getColor=_props4.getColor;var value=attribute.value,size=attribute.size;var i=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=data[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var object=_step4.value;var color=getColor(object);value[i+0]=color[0];value[i+1]=color[1];value[i+2]=color[2];value[i+3]=isNaN(color[3])?255:color[3];i+=size}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}}]);return LineLayer}(_lib.Layer);exports.default=LineLayer;LineLayer.layerName="LineLayer";LineLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../lib/utils/fp64":105,"../../../shader-utils":120,"./line-layer-fragment.glsl":55,"./line-layer-vertex-64.glsl":56,"./line-layer-vertex.glsl":57,"luma.gl":195}],59:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME path-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform float jointType;\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\n\nvoid main(void) {\n  // if joint is rounded, test distance from the corner\n  if (jointType > 0.0 && vMiterLength > 0.0 && length(vCornerOffset) > 1.0) {\n    discard;\n  }\n  if (jointType == 0.0 && vMiterLength > miterLimit) {\n    discard;\n  }\n  gl_FragColor = vColor;\n}\n"},{}],60:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})
;exports.default="\n#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftDeltas;\nattribute vec3 instanceRightDeltas;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\n\nconst float EPSILON = 0.001;\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(vec3 prevPoint, vec3 currPoint, vec3 nextPoint) {\n\n  float width = clamp(project_scale(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0;\n\n  vec2 deltaA = currPoint.xy - prevPoint.xy;\n  vec2 deltaB = nextPoint.xy - currPoint.xy;\n\n  vec2 offsetVec;\n  float offsetScale;\n  float offsetDirection;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(1.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(1.0, 0.0);\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n\n  // tangent of the corner\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  // direction of the corner\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  // width offset from current position\n  vec2 perp = mix(perpB, perpA, positions.x);\n  float L = mix(lenB, lenA, positions.x);\n\n  // cap super sharp angles\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  // relative position to the corner:\n  // -1: inside (smaller side of the angle)\n  // 0: center\n  // 1: outside (bigger side of the angle)\n  float cornerPosition = mix(\n    flipIfTrue(turnsRight == (positions.y > 0.0)),\n    0.0,\n    positions.z\n  );\n\n  offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  // do not bevel if line segment is too short\n  cornerPosition *= float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) / width * cosHalfA);\n  // trim if inside corner extends further than the line segment\n  offsetScale = mix(\n    offsetScale,\n    min(offsetScale, L / width / max(cosHalfA, EPSILON)),\n    float(cornerPosition < 0.0)\n  );\n\n  vMiterLength = mix(\n    offsetScale * cornerPosition,\n    mix(offsetScale, 0.0, cornerPosition),\n    step(0.0, cornerPosition)\n  ) - sinHalfA * jointType;\n  offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n  offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n\n  // special treatment for start cap and end cap\n  float isStartCap = step(0.0, -lenA);\n  float isEndCap = step(0.0, -lenB);\n  float isCap = max(isStartCap, isEndCap);\n\n  // 0: center, 1: side\n  cornerPosition = isCap * (1.0 - positions.z);\n\n  // start of path: use next - curr\n  offsetVec = mix(offsetVec, mix(dirB, perpB, cornerPosition), isStartCap);\n  // end of path: use curr - prev\n  offsetVec = mix(offsetVec, mix(dirA, perpA, cornerPosition), isEndCap);\n\n  // extend out a triangle to envelope the round cap\n  offsetScale = mix(\n    offsetScale,\n    mix(4.0 * jointType, 1.0, cornerPosition),\n    isCap\n  );\n  vMiterLength = mix(vMiterLength, 1.0 - cornerPosition, isCap);\n\n  offsetDirection = mix(\n    offsetDirection,\n    mix(flipIfTrue(isStartCap > 0.), positions.y, cornerPosition),\n    isCap\n  );\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n\n  return vec3(vCornerOffset * width, 0.0);\n}\n\nvoid main() {\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors, 255.) / 255.;\n  vColor = mix(color, pickingColor, renderPickingBuffer);\n\n  float isEnd = positions.x;\n\n  // Calculate previous position\n  vec3 prevPosition = mix(-instanceLeftDeltas, vec3(0.0), isEnd) + instanceStartPositions;\n  prevPosition = project_position(prevPosition);\n\n  // Calculate current position\n  // Only here we need to do the 64-bit calculations.\n\n  vec2 instanceStartPositions64[2];\n  instanceStartPositions64[0] = vec2(instanceStartPositions.x, instanceStartEndPositions64xyLow.x);\n  instanceStartPositions64[1] = vec2(instanceStartPositions.y, instanceStartEndPositions64xyLow.y);\n\n  vec2 instanceEndPositions64[2];\n  instanceEndPositions64[0] = vec2(instanceEndPositions.x, instanceStartEndPositions64xyLow.z);\n  instanceEndPositions64[1] = vec2(instanceEndPositions.y, instanceStartEndPositions64xyLow.w);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n\n  vec2 tempCurrPosition64[2];\n  vec2_mix_fp64(instanceStartPositions64, instanceEndPositions64, isEnd, tempCurrPosition64);\n\n  vec4 currPosition64 = vec4(tempCurrPosition64[0].xy, tempCurrPosition64[1].xy);\n\n  vec2 projected_curr_position[2];\n  project_position_fp64(currPosition64, projected_curr_position);\n  float projected_curr_position_z = project_scale(currPosition.z);\n\n  currPosition = project_position(currPosition);\n\n  // Calculate next positions\n  vec3 nextPosition = mix(vec3(0.0), instanceRightDeltas, isEnd) + instanceEndPositions;\n  nextPosition = project_position(nextPosition);\n\n  vec3 pos = lineJoin(prevPosition, currPosition, nextPosition);\n  vec2 vertex_pos_modelspace[4];\n  vertex_pos_modelspace[0] = sum_fp64(vec2(pos.x, 0.0), projected_curr_position[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vec2(pos.y, 0.0), projected_curr_position[1]);\n  vertex_pos_modelspace[2] = vec2(pos.z + projected_curr_position_z, 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n}\n"},{}],61:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftDeltas;\nattribute vec3 instanceRightDeltas;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\n\nconst float EPSILON = 0.001;\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\n// calculate line join positions\nvec3 lineJoin(vec3 prevPoint, vec3 currPoint, vec3 nextPoint) {\n\n  float width = clamp(project_scale(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0;\n\n  vec2 deltaA = currPoint.xy - prevPoint.xy;\n  vec2 deltaB = nextPoint.xy - currPoint.xy;\n\n  vec2 offsetVec;\n  float offsetScale;\n  float offsetDirection;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(1.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(1.0, 0.0);\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n\n  // tangent of the corner\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  // direction of the corner\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  // width offset from current position\n  vec2 perp = mix(perpB, perpA, positions.x);\n  float L = mix(lenB, lenA, positions.x);\n\n  // cap super sharp angles\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  // relative position to the corner:\n  // -1: inside (smaller side of the angle)\n  // 0: center\n  // 1: outside (bigger side of the angle)\n  float cornerPosition = mix(\n    flipIfTrue(turnsRight == (positions.y > 0.0)),\n    0.0,\n    positions.z\n  );\n\n  offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  // do not bevel if line segment is too short\n  cornerPosition *= float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) / width * cosHalfA);\n  // trim if inside corner extends further than the line segment\n  offsetScale = mix(\n    offsetScale,\n    min(offsetScale, L / width / max(cosHalfA, EPSILON)),\n    float(cornerPosition < 0.0)\n  );\n\n  vMiterLength = mix(\n    offsetScale * cornerPosition,\n    mix(offsetScale, 0.0, cornerPosition),\n    step(0.0, cornerPosition)\n  ) - sinHalfA * jointType;\n  offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n  offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n\n  // special treatment for start cap and end cap\n  float isStartCap = step(0.0, -lenA);\n  float isEndCap = step(0.0, -lenB);\n  float isCap = max(isStartCap, isEndCap);\n\n  // 0: center, 1: side\n  cornerPosition = isCap * (1.0 - positions.z);\n\n  // start of path: use next - curr\n  offsetVec = mix(offsetVec, mix(dirB, perpB, cornerPosition), isStartCap);\n  // end of path: use curr - prev\n  offsetVec = mix(offsetVec, mix(dirA, perpA, cornerPosition), isEndCap);\n\n  // extend out a triangle to envelope the round cap\n  offsetScale = mix(\n    offsetScale,\n    mix(4.0 * jointType, 1.0, cornerPosition),\n    isCap\n  );\n  vMiterLength = mix(vMiterLength, 1.0 - cornerPosition, isCap);\n\n  offsetDirection = mix(\n    offsetDirection,\n    mix(flipIfTrue(isStartCap > 0.), positions.y, cornerPosition),\n    isCap\n  );\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n\n  return currPoint + vec3(vCornerOffset * width, 0.0);\n}\n\nvoid main() {\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors, 255.) / 255.;\n  vColor = mix(color, pickingColor, renderPickingBuffer);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(-instanceLeftDeltas, vec3(0.0), isEnd) + instanceStartPositions;\n  prevPosition = project_position(prevPosition);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  currPosition = project_position(currPosition);\n\n  vec3 nextPosition = mix(vec3(0.0), instanceRightDeltas, isEnd) + instanceEndPositions;\n  nextPosition = project_position(nextPosition);\n\n  vec3 pos;\n\n  pos = lineJoin(prevPosition, currPosition, nextPosition);\n\n  gl_Position = project_to_clipspace(vec4(pos, 1.0));\n}\n"},{}],62:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");var _pathLayerVertex=require("./path-layer-vertex.glsl");var _pathLayerVertex2=_interopRequireDefault(_pathLayerVertex);var _pathLayerVertex3=require("./path-layer-vertex-64.glsl");var _pathLayerVertex4=_interopRequireDefault(_pathLayerVertex3);var _pathLayerFragment=require("./path-layer-fragment.glsl");var _pathLayerFragment2=_interopRequireDefault(_pathLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,0,255];var defaultProps={widthScale:1,widthMinPixels:0,widthMaxPixels:Number.MAX_SAFE_INTEGER,rounded:false,miterLimit:4,fp64:false,getPath:function getPath(object){return object.path},getColor:function getColor(object){return object.color||DEFAULT_COLOR},getWidth:function getWidth(object){return object.width||1}};var isClosed=function isClosed(path){var firstPoint=path[0];var lastPoint=path[path.length-1];return firstPoint[0]===lastPoint[0]&&firstPoint[1]===lastPoint[1]&&firstPoint[2]===lastPoint[2]};var PathLayer=function(_Layer){_inherits(PathLayer,_Layer);function PathLayer(){_classCallCheck(this,PathLayer);return _possibleConstructorReturn(this,(PathLayer.__proto__||Object.getPrototypeOf(PathLayer)).apply(this,arguments))}_createClass(PathLayer,[{key:"getShaders",value:function getShaders(){return(0,_fp.enable64bitSupport)(this.props)?{vs:_pathLayerVertex4.default,fs:_pathLayerFragment2.default,modules:["fp64","project64"]}:{vs:_pathLayerVertex2.default,fs:_pathLayerFragment2.default,modules:[]}}},{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this._getModel(gl)});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instanceStartPositions:{size:3,update:this.calculateStartPositions},instanceEndPositions:{size:3,update:this.calculateEndPositions},instanceLeftDeltas:{size:3,update:this.calculateLeftDeltas},instanceRightDeltas:{size:3,update:this.calculateRightDeltas},instanceStrokeWidths:{size:1,accessor:"getWidth",update:this.calculateStrokeWidths},instanceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,accessor:"getColor",update:this.calculateColors},instancePickingColors:{size:3,type:_luma.GL.UNSIGNED_BYTE,update:this.calculatePickingColors}})}},{key:"updateAttribute",value:function updateAttribute(_ref){var props=_ref.props,oldProps=_ref.oldProps,changeFlags=_ref.changeFlags;if(props.fp64!==oldProps.fp64){var attributeManager=this.state.attributeManager;attributeManager.invalidateAll();if(props.fp64&&props.projectionMode===_lib.COORDINATE_SYSTEM.LNGLAT){attributeManager.addInstanced({instanceStartEndPositions64xyLow:{size:4,update:this.calculateInstanceStartEndPositions64xyLow}})}else{attributeManager.remove(["instanceStartEndPositions64xyLow"])}}}},{key:"updateState",value:function updateState(_ref2){var oldProps=_ref2.oldProps,props=_ref2.props,changeFlags=_ref2.changeFlags;_get(PathLayer.prototype.__proto__||Object.getPrototypeOf(PathLayer.prototype),"updateState",this).call(this,{props:props,oldProps:oldProps,changeFlags:changeFlags});var getPath=this.props.getPath;var attributeManager=this.state.attributeManager;if(props.fp64!==oldProps.fp64){var gl=this.context.gl;this.setState({model:this._getModel(gl)})}this.updateAttribute({props:props,oldProps:oldProps,changeFlags:changeFlags});if(changeFlags.dataChanged){var paths=props.data.map(getPath);var numInstances=paths.reduce(function(count,path){return count+path.length-1},0);this.setState({paths:paths,numInstances:numInstances});attributeManager.invalidateAll()}}},{key:"draw",value:function draw(_ref3){var uniforms=_ref3.uniforms;var _props=this.props,rounded=_props.rounded,miterLimit=_props.miterLimit,widthScale=_props.widthScale,widthMinPixels=_props.widthMinPixels,widthMaxPixels=_props.widthMaxPixels;this.state.model.render(Object.assign({},uniforms,{jointType:Number(rounded),widthScale:widthScale,miterLimit:miterLimit,widthMinPixels:widthMinPixels,widthMaxPixels:widthMaxPixels}))}},{key:"_getModel",value:function _getModel(gl){var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());var SEGMENT_INDICES=[0,2,1,1,2,4,1,4,3,3,4,5];var SEGMENT_POSITIONS=[0,0,1,0,-1,0,0,1,0,1,-1,0,1,1,0,1,0,1];return new _luma.Model({gl:gl,id:this.props.id,fs:shaders.fs,vs:shaders.vs,geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLES,attributes:{indices:new Uint16Array(SEGMENT_INDICES),positions:new Float32Array(SEGMENT_POSITIONS)}}),isInstanced:true})}},{key:"calculateStartPositions",value:function calculateStartPositions(attribute){var paths=this.state.paths;var value=attribute.value;var i=0;paths.forEach(function(path){var numSegments=path.length-1;for(var ptIndex=0;ptIndex<numSegments;ptIndex++){var point=path[ptIndex];value[i++]=point[0];value[i++]=point[1];value[i++]=point[2]||0}})}},{key:"calculateEndPositions",value:function calculateEndPositions(attribute){var paths=this.state.paths;var value=attribute.value;var i=0;paths.forEach(function(path){for(var ptIndex=1;ptIndex<path.length;ptIndex++){var point=path[ptIndex];value[i++]=point[0];value[i++]=point[1];value[i++]=point[2]||0}})}},{key:"calculateInstanceStartEndPositions64xyLow",value:function calculateInstanceStartEndPositions64xyLow(attribute){var paths=this.state.paths;var value=attribute.value;var i=0;paths.forEach(function(path){var numSegments=path.length-1;for(var ptIndex=0;ptIndex<numSegments;ptIndex++){var startPoint=path[ptIndex];var endPoint=path[ptIndex+1];value[i++]=(0,_fp.fp64ify)(startPoint[0])[1];value[i++]=(0,_fp.fp64ify)(startPoint[1])[1];value[i++]=(0,_fp.fp64ify)(endPoint[0])[1];value[i++]=(0,_fp.fp64ify)(endPoint[1])[1]}})}},{key:"calculateLeftDeltas",value:function calculateLeftDeltas(attribute){var paths=this.state.paths;var value=attribute.value;var i=0;paths.forEach(function(path){var numSegments=path.length-1;var prevPoint=isClosed(path)?path[path.length-2]:path[0];for(var ptIndex=0;ptIndex<numSegments;ptIndex++){var point=path[ptIndex];value[i++]=point[0]-prevPoint[0];value[i++]=point[1]-prevPoint[1];value[i++]=point[2]-prevPoint[2]||0;prevPoint=point}})}},{key:"calculateRightDeltas",value:function calculateRightDeltas(attribute){var paths=this.state.paths;var value=attribute.value;var i=0;paths.forEach(function(path){for(var ptIndex=1;ptIndex<path.length;ptIndex++){var point=path[ptIndex];var nextPoint=path[ptIndex+1];if(!nextPoint){nextPoint=isClosed(path)?path[1]:point}value[i++]=nextPoint[0]-point[0];value[i++]=nextPoint[1]-point[1];value[i++]=nextPoint[2]-point[2]||0}})}},{key:"calculateStrokeWidths",value:function calculateStrokeWidths(attribute){var _props2=this.props,data=_props2.data,getWidth=_props2.getWidth;var paths=this.state.paths;var value=attribute.value;var i=0;paths.forEach(function(path,index){var width=getWidth(data[index],index);for(var ptIndex=1;ptIndex<path.length;ptIndex++){value[i++]=width}})}},{key:"calculateColors",value:function calculateColors(attribute){var _props3=this.props,data=_props3.data,getColor=_props3.getColor;var paths=this.state.paths;var value=attribute.value;var i=0;paths.forEach(function(path,index){var pointColor=getColor(data[index],index);if(isNaN(pointColor[3])){pointColor[3]=255}for(var ptIndex=1;ptIndex<path.length;ptIndex++){value[i++]=pointColor[0];value[i++]=pointColor[1];value[i++]=pointColor[2];value[i++]=pointColor[3]}})}},{key:"calculatePickingColors",value:function calculatePickingColors(attribute){var _this2=this;var paths=this.state.paths;var value=attribute.value;var i=0;paths.forEach(function(path,index){var pickingColor=_this2.encodePickingColor(index);for(var ptIndex=1;ptIndex<path.length;ptIndex++){value[i++]=pickingColor[0];value[i++]=pickingColor[1];value[i++]=pickingColor[2]}})}}]);return PathLayer}(_lib.Layer);exports.default=PathLayer;PathLayer.layerName="PathLayer";PathLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../lib/utils/fp64":105,"../../../shader-utils":120,"./path-layer-fragment.glsl":59,"./path-layer-vertex-64.glsl":60,"./path-layer-vertex.glsl":61,"luma.gl":195}],63:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME point-cloud-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter <= 1.0) {\n    gl_FragColor = vColor;\n  } else {\n    discard;\n  }\n}\n"},{}],64:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME point-cloud-layer-vertex-64-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float renderPickingBuffer;\nuniform float opacity;\nuniform float radiusPixels;\nuniform vec2 screenSize;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n\n  vec4 instancePositions64xy = vec4(\n    instancePositions.x, instancePositions64xyLow.x,\n    instancePositions.y, instancePositions64xyLow.y);\n\n  vec2 projected_coord_xy[2];\n  project_position_fp64(instancePositions64xy, projected_coord_xy);\n\n  vec2 vertex_pos_localspace[4];\n  vec4_fp64(vec4(positions.xy * radiusPixels / screenSize * 2.0, 0.0, 0.0), vertex_pos_localspace);\n\n  vec2 vertex_pos_modelspace[4];\n  vertex_pos_modelspace[0] = sum_fp64(vertex_pos_localspace[0], projected_coord_xy[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vertex_pos_localspace[1], projected_coord_xy[1]);\n  vertex_pos_modelspace[2] = sum_fp64(vertex_pos_localspace[2],\n    vec2(project_scale(instancePositions.z), 0.0));\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec4 position_worldspace = vec4(\n    projected_coord_xy[0].x, projected_coord_xy[1].x,\n    project_scale(instancePositions.z), 1.0);\n\n  if (renderPickingBuffer > 0.5) {\n    vColor = vec4(instancePickingColors / 255., 1.);\n  } else {\n    // Apply lighting\n    float lightWeight = getLightWeight(position_worldspace, instanceNormals);\n\n    // Apply opacity to instance color, or return instance picking color\n    vColor = vec4(lightWeight * instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  }\n}\n"},{}],65:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float renderPickingBuffer;\nuniform float opacity;\nuniform float radiusPixels;\nuniform vec2 viewportSize;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n\n  // Find the center of the point and add the current vertex\n  vec4 position_worldspace = vec4(project_position(instancePositions), 1.0);\n  vec2 vertex = positions.xy * radiusPixels / viewportSize * 2.0;\n  gl_Position = project_to_clipspace(position_worldspace) + vec4(vertex, 0.0, 0.0);\n\n  // Apply lighting\n  float lightWeight = getLightWeight(position_worldspace, instanceNormals);\n\n  // Apply opacity to instance color, or return instance picking color\n  vec4 color = vec4(lightWeight * instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n  vColor = mix(color, pickingColor, renderPickingBuffer);\n}\n"},{}],66:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");var _pointCloudLayerVertex=require("./point-cloud-layer-vertex.glsl");var _pointCloudLayerVertex2=_interopRequireDefault(_pointCloudLayerVertex);var _pointCloudLayerVertex3=require("./point-cloud-layer-vertex-64.glsl");var _pointCloudLayerVertex4=_interopRequireDefault(_pointCloudLayerVertex3);var _pointCloudLayerFragment=require("./point-cloud-layer-fragment.glsl");var _pointCloudLayerFragment2=_interopRequireDefault(_pointCloudLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,0,255];var defaultProps={radiusPixels:10,fp64:false,getPosition:function getPosition(x){return x.position},getNormal:function getNormal(x){return x.normal},getColor:function getColor(x){return x.color||DEFAULT_COLOR},lightSettings:{lightsPosition:[0,0,5e3,-1e3,1e3,8e3,5e3,-5e3,1e3],ambientRatio:.2,diffuseRatio:.6,specularRatio:.8,lightsStrength:[1,0,.8,0,.4,0],numberOfLights:3}};var PointCloudLayer=function(_Layer){_inherits(PointCloudLayer,_Layer);function PointCloudLayer(){_classCallCheck(this,PointCloudLayer);return _possibleConstructorReturn(this,(PointCloudLayer.__proto__||Object.getPrototypeOf(PointCloudLayer)).apply(this,arguments))}_createClass(PointCloudLayer,[{key:"getShaders",value:function getShaders(id){return(0,_fp.enable64bitSupport)(this.props)?{vs:_pointCloudLayerVertex4.default,fs:_pointCloudLayerFragment2.default,modules:["fp64","project64","lighting"]}:{vs:_pointCloudLayerVertex2.default,fs:_pointCloudLayerFragment2.default,modules:["lighting"]}}},{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this._getModel(gl)});this.state.attributeManager.addInstanced({instancePositions:{size:3,accessor:"getPosition",update:this.calculateInstancePositions},instanceNormals:{size:3,accessor:"getNormal",defaultValue:1,update:this.calculateInstanceNormals},instanceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,accessor:"getColor",update:this.calculateInstanceColors}})}},{key:"updateAttribute",value:function updateAttribute(_ref){var props=_ref.props,oldProps=_ref.oldProps,changeFlags=_ref.changeFlags;if(props.fp64!==oldProps.fp64){var attributeManager=this.state.attributeManager;attributeManager.invalidateAll();if(props.fp64&&props.projectionMode===_lib.COORDINATE_SYSTEM.LNGLAT){attributeManager.addInstanced({instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow}})}else{attributeManager.remove(["instancePositions64xyLow"])}}}},{key:"updateState",value:function updateState(_ref2){var props=_ref2.props,oldProps=_ref2.oldProps,changeFlags=_ref2.changeFlags;_get(PointCloudLayer.prototype.__proto__||Object.getPrototypeOf(PointCloudLayer.prototype),"updateState",this).call(this,{props:props,oldProps:oldProps,changeFlags:changeFlags});if(props.fp64!==oldProps.fp64){var gl=this.context.gl;this.setState({model:this._getModel(gl)})}this.updateAttribute({props:props,oldProps:oldProps,changeFlags:changeFlags})}},{key:"draw",value:function draw(_ref3){var uniforms=_ref3.uniforms;var _props=this.props,radiusPixels=_props.radiusPixels,lightSettings=_props.lightSettings;this.state.model.render(Object.assign({},uniforms,{radiusPixels:radiusPixels},lightSettings))}},{key:"_getModel",value:function _getModel(gl){var positions=[];for(var i=0;i<3;i++){var angle=i/3*Math.PI*2;positions.push(Math.cos(angle)*2,Math.sin(angle)*2,0)}var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());return new _luma.Model({gl:gl,id:this.props.id,vs:shaders.vs,fs:shaders.fs,geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLES,positions:new Float32Array(positions)}),isInstanced:true})}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props2=this.props,data=_props2.data,getPosition=_props2.getPosition;var value=attribute.value;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var point=_step.value;var position=getPosition(point);value[i++]=position[0];value[i++]=position[1];value[i++]=position[2]||0}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstancePositions64xyLow",value:function calculateInstancePositions64xyLow(attribute){var _props3=this.props,data=_props3.data,getPosition=_props3.getPosition;var value=attribute.value;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var point=_step2.value;var position=getPosition(point)
;value[i++]=(0,_fp.fp64ify)(position[0])[1];value[i++]=(0,_fp.fp64ify)(position[1])[1]}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceNormals",value:function calculateInstanceNormals(attribute){var _props4=this.props,data=_props4.data,getNormal=_props4.getNormal;var value=attribute.value;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var point=_step3.value;var normal=getNormal(point);value[i++]=normal[0];value[i++]=normal[1];value[i++]=normal[2]}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props5=this.props,data=_props5.data,getColor=_props5.getColor;var value=attribute.value;var i=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=data[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var point=_step4.value;var color=getColor(point);value[i++]=color[0];value[i++]=color[1];value[i++]=color[2];value[i++]=isNaN(color[3])?255:color[3]}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}}]);return PointCloudLayer}(_lib.Layer);exports.default=PointCloudLayer;PointCloudLayer.layerName="PointCloudLayer";PointCloudLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../lib/utils/fp64":105,"../../../shader-utils":120,"./point-cloud-layer-fragment.glsl":63,"./point-cloud-layer-vertex-64.glsl":64,"./point-cloud-layer-vertex.glsl":65,"luma.gl":195}],67:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lib=require("../../../lib");var _solidPolygonLayer=require("../solid-polygon-layer/solid-polygon-layer");var _solidPolygonLayer2=_interopRequireDefault(_solidPolygonLayer);var _pathLayer=require("../path-layer/path-layer");var _pathLayer2=_interopRequireDefault(_pathLayer);var _polygon=require("../solid-polygon-layer/polygon");var Polygon=_interopRequireWildcard(_polygon);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var defaultLineColor=[0,0,0,255];var defaultFillColor=[0,0,0,255];var defaultProps={stroked:true,filled:true,extruded:false,wireframe:false,lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:false,lineMiterLimit:4,fp64:false,getPolygon:function getPolygon(f){return(0,_lib.get)(f,"polygon")},getFillColor:function getFillColor(f){return(0,_lib.get)(f,"fillColor")||defaultFillColor},getLineColor:function getLineColor(f){return(0,_lib.get)(f,"lineColor")||defaultLineColor},getLineWidth:function getLineWidth(f){return(0,_lib.get)(f,"lineWidth")||1},getElevation:function getElevation(f){return(0,_lib.get)(f,"elevation")||1e3},lightSettings:{lightsPosition:[-122.45,37.75,8e3,-122,38,5e3],ambientRatio:.05,diffuseRatio:.6,specularRatio:.8,lightsStrength:[2,0,0,0],numberOfLights:2}};var PolygonLayer=function(_CompositeLayer){_inherits(PolygonLayer,_CompositeLayer);function PolygonLayer(){_classCallCheck(this,PolygonLayer);return _possibleConstructorReturn(this,(PolygonLayer.__proto__||Object.getPrototypeOf(PolygonLayer)).apply(this,arguments))}_createClass(PolygonLayer,[{key:"initializeState",value:function initializeState(){this.state={paths:[]}}},{key:"updateState",value:function updateState(_ref){var _this2=this;var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;if(changeFlags.dataChanged){var _props=this.props,data=_props.data,getPolygon=_props.getPolygon;this.state.paths=[];data.forEach(function(object){var complexPolygon=Polygon.normalize(getPolygon(object));complexPolygon.forEach(function(polygon){return _this2.state.paths.push({path:polygon,object:object})})})}}},{key:"getPickingInfo",value:function getPickingInfo(_ref2){var info=_ref2.info;return Object.assign(info,{object:info.object&&info.object.object||info.object})}},{key:"renderLayers",value:function renderLayers(){var _props2=this.props,data=_props2.data,id=_props2.id,stroked=_props2.stroked,filled=_props2.filled,extruded=_props2.extruded,wireframe=_props2.wireframe;var _props3=this.props,lineWidthScale=_props3.lineWidthScale,lineWidthMinPixels=_props3.lineWidthMinPixels,lineWidthMaxPixels=_props3.lineWidthMaxPixels,lineJointRounded=_props3.lineJointRounded,lineMiterLimit=_props3.lineMiterLimit,fp64=_props3.fp64;var _props4=this.props,getFillColor=_props4.getFillColor,getLineColor=_props4.getLineColor,getLineWidth=_props4.getLineWidth,getElevation=_props4.getElevation,getPolygon=_props4.getPolygon,updateTriggers=_props4.updateTriggers,lightSettings=_props4.lightSettings;var _props5=this.props,opacity=_props5.opacity,pickable=_props5.pickable,visible=_props5.visible;var _props6=this.props,positionOrigin=_props6.positionOrigin,projectionMode=_props6.projectionMode,modelMatrix=_props6.modelMatrix;var paths=this.state.paths;var hasData=data&&data.length>0;var polygonLayer=filled&&hasData&&new _solidPolygonLayer2.default({id:id+"-fill",data:data,extruded:extruded,wireframe:false,fp64:fp64,opacity:opacity,pickable:pickable,visible:visible,projectionMode:projectionMode,positionOrigin:positionOrigin,modelMatrix:modelMatrix,getPolygon:getPolygon,getElevation:getElevation,getColor:getFillColor,updateTriggers:{getElevation:updateTriggers.getElevation,getColor:updateTriggers.getFillColor},lightSettings:lightSettings});var polygonWireframeLayer=extruded&&wireframe&&hasData&&new _solidPolygonLayer2.default({id:id+"-wireframe",data:data,extruded:true,wireframe:true,fp64:fp64,opacity:opacity,pickable:pickable,visible:visible,projectionMode:projectionMode,positionOrigin:positionOrigin,modelMatrix:modelMatrix,getPolygon:getPolygon,getElevation:getElevation,getColor:getLineColor,updateTriggers:{getElevation:updateTriggers.getElevation,getColor:updateTriggers.getLineColor}});var polygonLineLayer=!extruded&&stroked&&hasData&&new _pathLayer2.default({id:id+"-stroke",data:paths,widthScale:lineWidthScale,widthMinPixels:lineWidthMinPixels,widthMaxPixels:lineWidthMaxPixels,rounded:lineJointRounded,miterLimit:lineMiterLimit,fp64:fp64,opacity:opacity,pickable:pickable,visible:visible,projectionMode:projectionMode,positionOrigin:positionOrigin,modelMatrix:modelMatrix,getPath:function getPath(x){return x.path},getColor:getLineColor,getWidth:getLineWidth,updateTriggers:{getWidth:updateTriggers.getLineWidth,getColor:updateTriggers.getLineColor}});return[polygonLayer,polygonWireframeLayer,polygonLineLayer].filter(Boolean)}}]);return PolygonLayer}(_lib.CompositeLayer);exports.default=PolygonLayer;PolygonLayer.layerName="PolygonLayer";PolygonLayer.defaultProps=defaultProps},{"../../../lib":95,"../path-layer/path-layer":62,"../solid-polygon-layer/polygon":77,"../solid-polygon-layer/solid-polygon-layer":81}],68:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME scatterplot-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter <= 1.0 && distToCenter >= innerUnitRadius) {\n    gl_FragColor = vColor;\n  } else {\n    discard;\n  }\n}\n"},{}],69:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME scatterplot-layer-vertex-64-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\n// Only one-dimensional arrays may be declared in GLSL ES 1.0. specs p.24\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float renderPickingBuffer;\nuniform float outline;\nuniform float strokeWidth;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n  // Multiply out radius and clamp to limits\n  float outerRadiusPixels = clamp(\n    project_scale(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n\n  // outline is centered at the radius\n  // outer radius needs to offset by half stroke width\n  outerRadiusPixels += outline * strokeWidth / 2.0;\n\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n  // 0 - solid circle, 1 - stroke with lineWidth=0\n  innerUnitRadius = outline * (1.0 - strokeWidth / outerRadiusPixels);\n\n  vec4 instancePositions64xy = vec4(\n    instancePositions.x, instancePositions64xyLow.x,\n    instancePositions.y, instancePositions64xyLow.y);\n\n  vec2 projected_coord_xy[2];\n  project_position_fp64(instancePositions64xy, projected_coord_xy);\n\n  vec2 vertex_pos_localspace[4];\n  vec4_fp64(vec4(positions * outerRadiusPixels, 0.0), vertex_pos_localspace);\n\n  vec2 vertex_pos_modelspace[4];\n  vertex_pos_modelspace[0] = sum_fp64(vertex_pos_localspace[0], projected_coord_xy[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vertex_pos_localspace[1], projected_coord_xy[1]);\n  vertex_pos_modelspace[2] = sum_fp64(vertex_pos_localspace[2],\n    vec2(project_scale(instancePositions.z), 0.0));\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  if (renderPickingBuffer > 0.5) {\n    vColor = vec4(instancePickingColors / 255., 1.);\n  } else {\n    vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  }\n  // // Apply opacity to instance color, or return instance picking color\n  // vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  // vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n  // vColor = mix(color, pickingColor, renderPickingBuffer);\n}\n"},{}],70:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute float instanceRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float renderPickingBuffer;\nuniform float outline;\nuniform float strokeWidth;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n  // Multiply out radius and clamp to limits\n  float outerRadiusPixels = clamp(\n    project_scale(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  // outline is centered at the radius\n  // outer radius needs to offset by half stroke width\n  outerRadiusPixels += outline * strokeWidth / 2.0;\n\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n  // 0 - solid circle, 1 - stroke with lineWidth=0\n  innerUnitRadius = outline * (1.0 - strokeWidth / outerRadiusPixels);\n\n  // Find the center of the point and add the current vertex\n  vec3 center = project_position(instancePositions);\n  vec3 vertex = positions * outerRadiusPixels;\n  gl_Position = project_to_clipspace(vec4(center + vertex, 1.0));\n\n  // Apply opacity to instance color, or return instance picking color\n  vec4 color = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vec4 pickingColor = vec4(instancePickingColors / 255., 1.);\n  vColor = mix(color, pickingColor, renderPickingBuffer);\n}\n"},{}],71:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _utils=require("../../../lib/utils");var _fp=require("../../../lib/utils/fp64");var _luma=require("luma.gl");var _scatterplotLayerVertex=require("./scatterplot-layer-vertex.glsl");var _scatterplotLayerVertex2=_interopRequireDefault(_scatterplotLayerVertex);var _scatterplotLayerVertex3=require("./scatterplot-layer-vertex-64.glsl");var _scatterplotLayerVertex4=_interopRequireDefault(_scatterplotLayerVertex3);var _scatterplotLayerFragment=require("./scatterplot-layer-fragment.glsl");var _scatterplotLayerFragment2=_interopRequireDefault(_scatterplotLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,0,255];var defaultProps={radiusScale:1,radiusMinPixels:0,radiusMaxPixels:Number.MAX_SAFE_INTEGER,strokeWidth:1,outline:false,fp64:false,getPosition:function getPosition(x){return x.position},getRadius:function getRadius(x){return x.radius||1},getColor:function getColor(x){return x.color||DEFAULT_COLOR}};var ScatterplotLayer=function(_Layer){_inherits(ScatterplotLayer,_Layer);function ScatterplotLayer(){_classCallCheck(this,ScatterplotLayer);return _possibleConstructorReturn(this,(ScatterplotLayer.__proto__||Object.getPrototypeOf(ScatterplotLayer)).apply(this,arguments))}_createClass(ScatterplotLayer,[{key:"getShaders",value:function getShaders(id){return(0,_fp.enable64bitSupport)(this.props)?{vs:_scatterplotLayerVertex4.default,fs:_scatterplotLayerFragment2.default,modules:["fp64","project64"]}:{vs:_scatterplotLayerVertex2.default,fs:_scatterplotLayerFragment2.default,modules:[]}}},{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this._getModel(gl)});this._checkRemovedProp("radius","radiusScale");this._checkRemovedProp("drawOutline","outline");this.state.attributeManager.addInstanced({instancePositions:{size:3,accessor:"getPosition",update:this.calculateInstancePositions},instanceRadius:{size:1,accessor:"getRadius",defaultValue:1,update:this.calculateInstanceRadius},instanceColors:{size:4,type:_luma.GL.UNSIGNED_BYTE,accessor:"getColor",update:this.calculateInstanceColors}})}},{key:"updateAttribute",value:function updateAttribute(_ref){var props=_ref.props,oldProps=_ref.oldProps,changeFlags=_ref.changeFlags;if(props.fp64!==oldProps.fp64){var attributeManager=this.state.attributeManager;attributeManager.invalidateAll();if(props.fp64&&props.projectionMode===_lib.COORDINATE_SYSTEM.LNGLAT){attributeManager.addInstanced({instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow}})}else{attributeManager.remove(["instancePositions64xyLow"])}}}},{key:"updateState",value:function updateState(_ref2){var props=_ref2.props,oldProps=_ref2.oldProps,changeFlags=_ref2.changeFlags;_get(ScatterplotLayer.prototype.__proto__||Object.getPrototypeOf(ScatterplotLayer.prototype),"updateState",this).call(this,{props:props,oldProps:oldProps,changeFlags:changeFlags});if(props.fp64!==oldProps.fp64){var gl=this.context.gl;this.setState({model:this._getModel(gl)})}this.updateAttribute({props:props,oldProps:oldProps,changeFlags:changeFlags})}},{key:"draw",value:function draw(_ref3){var uniforms=_ref3.uniforms;var _props=this.props,radiusScale=_props.radiusScale,radiusMinPixels=_props.radiusMinPixels,radiusMaxPixels=_props.radiusMaxPixels,outline=_props.outline,strokeWidth=_props.strokeWidth;this.state.model.render(Object.assign({},uniforms,{outline:outline?1:0,strokeWidth:strokeWidth,radiusScale:radiusScale,radiusMinPixels:radiusMinPixels,radiusMaxPixels:radiusMaxPixels}))}},{key:"_getModel",value:function _getModel(gl){var positions=[-1,-1,0,-1,1,0,1,1,0,1,-1,0];var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());return new _luma.Model({gl:gl,id:this.props.id,vs:shaders.vs,fs:shaders.fs,geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_FAN,positions:new Float32Array(positions)}),isInstanced:true})}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute){var _props2=this.props,data=_props2.data,getPosition=_props2.getPosition;var value=attribute.value;var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var point=_step.value;var position=getPosition(point);value[i++]=(0,_utils.get)(position,0);value[i++]=(0,_utils.get)(position,1);value[i++]=(0,_utils.get)(position,2)||0}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"calculateInstancePositions64xyLow",value:function calculateInstancePositions64xyLow(attribute){var _props3=this.props,data=_props3.data,getPosition=_props3.getPosition;var value=attribute.value;var i=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var point=_step2.value;var position=getPosition(point);value[i++]=(0,_fp.fp64ify)((0,_utils.get)(position,0))[1];value[i++]=(0,_fp.fp64ify)((0,_utils.get)(position,1))[1]}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"calculateInstanceRadius",value:function calculateInstanceRadius(attribute){var _props4=this.props,data=_props4.data,getRadius=_props4.getRadius;var value=attribute.value;var i=0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var point=_step3.value;var radius=getRadius(point);value[i++]=isNaN(radius)?1:radius}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"calculateInstanceColors",value:function calculateInstanceColors(attribute){var _props5=this.props,data=_props5.data,getColor=_props5.getColor;var value=attribute.value;var i=0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=data[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var point=_step4.value;var color=getColor(point)||DEFAULT_COLOR;value[i++]=(0,_utils.get)(color,0);value[i++]=(0,_utils.get)(color,1);value[i++]=(0,_utils.get)(color,2);value[i++]=isNaN((0,_utils.get)(color,3))?255:(0,_utils.get)(color,3)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}}]);return ScatterplotLayer}(_lib.Layer);exports.default=ScatterplotLayer;ScatterplotLayer.layerName="ScatterplotLayer";ScatterplotLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../lib/utils":108,"../../../lib/utils/fp64":105,"../../../shader-utils":120,"./scatterplot-layer-fragment.glsl":68,"./scatterplot-layer-vertex-64.glsl":69,"./scatterplot-layer-vertex.glsl":70,"luma.gl":195}],72:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME grid-layer-fs\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n"},{}],73:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME grid-layer-vs\n\nattribute vec3 vertices;\nattribute vec3 instancePositions;\nattribute float instanceCount;\nattribute vec3 instancePickingColors;\n\nuniform float maxCount;\nuniform float opacity;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform float renderPickingBuffer;\nuniform vec3 cellScale;\nuniform vec3 selectedPickingColor;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec4 color = mix(minColor, maxColor, instanceCount / maxCount) / 255.;\n\n  vColor = mix(\n    vec4(color.rgb, color.a * opacity),\n    vec4(instancePickingColors / 255., 1.),\n    renderPickingBuffer\n  );\n\n  gl_Position = vec4(instancePositions + vertices * cellScale, 1.);\n}\n"},{}],74:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _luma=require("luma.gl");var _screenGridLayerVertex=require("./screen-grid-layer-vertex.glsl");var _screenGridLayerVertex2=_interopRequireDefault(_screenGridLayerVertex);var _screenGridLayerFragment=require("./screen-grid-layer-fragment.glsl");var _screenGridLayerFragment2=_interopRequireDefault(_screenGridLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var defaultProps={cellSizePixels:100,minColor:[0,0,0,255],maxColor:[0,255,0,255],getPosition:function getPosition(d){return d.position},getWeight:function getWeight(d){return 1}};var ScreenGridLayer=function(_Layer){_inherits(ScreenGridLayer,_Layer);_createClass(ScreenGridLayer,[{key:"getShaders",value:function getShaders(){return{vs:_screenGridLayerVertex2.default,fs:_screenGridLayerFragment2.default}}}]);function ScreenGridLayer(props){_classCallCheck(this,ScreenGridLayer);var _this=_possibleConstructorReturn(this,(ScreenGridLayer.__proto__||Object.getPrototypeOf(ScreenGridLayer)).call(this,props));_this._checkRemovedProp("unitWidth","cellSizePixels");_this._checkRemovedProp("unitHeight","cellSizePixels");return _this}_createClass(ScreenGridLayer,[{key:"initializeState",value:function initializeState(){var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCount:{size:1,accessor:["getPosition","getWeight"],update:this.calculateInstanceCount}});var gl=this.context.gl;this.setState({model:this.getModel(gl)})}},{key:"updateState",value:function updateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;_get(ScreenGridLayer.prototype.__proto__||Object.getPrototypeOf(ScreenGridLayer.prototype),"updateState",this).call(this,{props:props,oldProps:oldProps,changeFlags:changeFlags});var cellSizeChanged=props.cellSizePixels!==oldProps.cellSizePixels;if(cellSizeChanged||changeFlags.viewportChanged){this.updateCell()}}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var _props=this.props,minColor=_props.minColor,maxColor=_props.maxColor;var _state=this.state,model=_state.model,cellScale=_state.cellScale,maxCount=_state.maxCount;var gl=this.context.gl;gl.depthMask(true);uniforms=Object.assign({},uniforms,{minColor:minColor,maxColor:maxColor,cellScale:cellScale,maxCount:maxCount});model.render(uniforms)}},{key:"getModel",value:function getModel(gl){var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());return new _luma.Model({gl:gl,id:this.props.id,vs:shaders.vs,fs:shaders.fs,geometry:new _luma.Geometry({drawMode:_luma.GL.TRIANGLE_FAN,vertices:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}),isInstanced:true})}},{key:"updateCell",value:function updateCell(){var _context$viewport=this.context.viewport,width=_context$viewport.width,height=_context$viewport.height;var cellSizePixels=this.props.cellSizePixels;var MARGIN=2;var cellScale=new Float32Array([(cellSizePixels-MARGIN)/width*2,-(cellSizePixels-MARGIN)/height*2,1]);var numCol=Math.ceil(width/cellSizePixels);var numRow=Math.ceil(height/cellSizePixels);this.setState({cellScale:cellScale,numCol:numCol,numRow:numRow,numInstances:numCol*numRow});var attributeManager=this.state.attributeManager;attributeManager.invalidateAll()}},{key:"calculateInstancePositions",value:function calculateInstancePositions(attribute,_ref3){var numInstances=_ref3.numInstances;var _context$viewport2=this.context.viewport,width=_context$viewport2.width,height=_context$viewport2.height;var cellSizePixels=this.props.cellSizePixels;var numCol=this.state.numCol;var value=attribute.value,size=attribute.size;for(var i=0;i<numInstances;i++){var x=i%numCol;var y=Math.floor(i/numCol);value[i*size+0]=x*cellSizePixels/width*2-1;value[i*size+1]=1-y*cellSizePixels/height*2;value[i*size+2]=0}}},{key:"calculateInstanceCount",value:function calculateInstanceCount(attribute){var _props2=this.props,data=_props2.data,cellSizePixels=_props2.cellSizePixels,getPosition=_props2.getPosition,getWeight=_props2.getWeight;var _state2=this.state,numCol=_state2.numCol,numRow=_state2.numRow;var value=attribute.value;var maxCount=0;value.fill(0);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var point=_step.value;var pixel=this.project(getPosition(point));var colId=Math.floor(pixel[0]/cellSizePixels);var rowId=Math.floor(pixel[1]/cellSizePixels);if(colId>=0&&colId<numCol&&rowId>=0&&rowId<numRow){var i=colId+rowId*numCol;value[i]+=getWeight(point);if(value[i]>maxCount){maxCount=value[i]}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.setState({maxCount:maxCount})}}]);return ScreenGridLayer}(_lib.Layer);exports.default=ScreenGridLayer;ScreenGridLayer.layerName="ScreenGridLayer";ScreenGridLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../shader-utils":120,"./screen-grid-layer-fragment.glsl":72,"./screen-grid-layer-vertex.glsl":73,"luma.gl":195}],75:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PolygonTesselatorExtruded=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}
return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _polygon=require("./polygon");var Polygon=_interopRequireWildcard(_polygon);var _glMatrix=require("gl-matrix");var _fp=require("../../../lib/utils/fp64");var _utils=require("../../../lib/utils");var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _lodash=require("lodash.flattendeep");var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function getPickingColor(index){return[(index+1)%256,Math.floor((index+1)/256)%256,Math.floor((index+1)/256/256)%256]}function parseColor(color){if(!Array.isArray(color)){color=[(0,_utils.get)(color,0),(0,_utils.get)(color,1),(0,_utils.get)(color,2),(0,_utils.get)(color,3)]}color[3]=Number.isFinite(color[3])?color[3]:255;return color}var DEFAULT_COLOR=[0,0,0,255];var PolygonTesselatorExtruded=exports.PolygonTesselatorExtruded=function(){function PolygonTesselatorExtruded(_ref){var polygons=_ref.polygons,_ref$getHeight=_ref.getHeight,getHeight=_ref$getHeight===undefined?function(x){return 1e3}:_ref$getHeight,_ref$getColor=_ref.getColor,getColor=_ref$getColor===undefined?function(x){return[0,0,0,255]}:_ref$getColor,_ref$wireframe=_ref.wireframe,wireframe=_ref$wireframe===undefined?false:_ref$wireframe,_ref$fp=_ref.fp64,fp64=_ref$fp===undefined?false:_ref$fp;_classCallCheck(this,PolygonTesselatorExtruded);this.fp64=fp64;polygons=polygons.map(function(complexPolygon,polygonIndex){var height=getHeight(polygonIndex)||0;return Polygon.normalize(complexPolygon).map(function(polygon){return polygon.map(function(coord){return[(0,_utils.get)(coord,0),(0,_utils.get)(coord,1),height]})})});var groupedVertices=polygons;this.groupedVertices=polygons;this.wireframe=wireframe;this.attributes={};var positionsJS=calculatePositionsJS({groupedVertices:groupedVertices,wireframe:wireframe});Object.assign(this.attributes,{positions:calculatePositions(positionsJS,this.fp64),indices:calculateIndices({groupedVertices:groupedVertices,wireframe:wireframe}),normals:calculateNormals({groupedVertices:groupedVertices,wireframe:wireframe}),pickingColors:calculatePickingColors({groupedVertices:groupedVertices,wireframe:wireframe})})}_createClass(PolygonTesselatorExtruded,[{key:"indices",value:function indices(){return this.attributes.indices}},{key:"positions",value:function positions(){return this.attributes.positions}},{key:"normals",value:function normals(){return this.attributes.normals}},{key:"colors",value:function colors(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$getColor=_ref2.getColor,getColor=_ref2$getColor===undefined?function(x){return DEFAULT_COLOR}:_ref2$getColor;var groupedVertices=this.groupedVertices,wireframe=this.wireframe;return calculateColors({groupedVertices:groupedVertices,wireframe:wireframe,getColor:getColor})}},{key:"pickingColors",value:function pickingColors(){return this.attributes.pickingColors}}]);return PolygonTesselatorExtruded}();function countVertices(vertices){return vertices.reduce(function(vertexCount,polygon){return vertexCount+(0,_utils.count)(polygon)},0)}function calculateIndices(_ref3){var groupedVertices=_ref3.groupedVertices,_ref3$wireframe=_ref3.wireframe,wireframe=_ref3$wireframe===undefined?false:_ref3$wireframe;var multiplier=wireframe?2:5;var offsets=groupedVertices.reduce(function(acc,vertices){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+countVertices(vertices)*multiplier])},[0]);var indices=groupedVertices.map(function(vertices,polygonIndex){return wireframe?calculateContourIndices(vertices,offsets[polygonIndex]):calculateSurfaceIndices(vertices,offsets[polygonIndex])});return new Uint32Array((0,_lodash2.default)(indices))}function calculatePositionsJS(_ref4){var groupedVertices=_ref4.groupedVertices,_ref4$wireframe=_ref4.wireframe,wireframe=_ref4$wireframe===undefined?false:_ref4$wireframe;var positions=groupedVertices.map(function(vertices){var topVertices=Array.prototype.concat.apply([],vertices);var baseVertices=topVertices.map(function(v){return[(0,_utils.get)(v,0),(0,_utils.get)(v,1),0]});return wireframe?[topVertices,baseVertices]:[topVertices,topVertices,topVertices,baseVertices,baseVertices]});return(0,_lodash2.default)(positions)}function calculatePositions(positionsJS,fp64){var positionLow=void 0;if(fp64){positionLow=new Float32Array(positionsJS.length/3*2);for(var i=0;i<positionsJS.length/3;i++){positionLow[i*2+0]=(0,_fp.fp64ify)(positionsJS[i*3+0])[1];positionLow[i*2+1]=(0,_fp.fp64ify)(positionsJS[i*3+1])[1]}}return{positions:new Float32Array(positionsJS),positions64xyLow:positionLow}}function calculateNormals(_ref5){var groupedVertices=_ref5.groupedVertices,wireframe=_ref5.wireframe;var up=[0,1,0];var normals=groupedVertices.map(function(vertices,polygonIndex){var topNormals=new Array(countVertices(vertices)).fill(up);var sideNormals=vertices.map(function(polygon){return calculateSideNormals(polygon)});var sideNormalsForward=sideNormals.map(function(n){return n[0]});var sideNormalsBackward=sideNormals.map(function(n){return n[1]});return wireframe?[topNormals,topNormals]:[topNormals,sideNormalsForward,sideNormalsBackward,sideNormalsForward,sideNormalsBackward]});return new Float32Array((0,_lodash2.default)(normals))}function calculateSideNormals(vertices){var normals=[];var lastVertice=null;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=vertices[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var vertice=_step.value;if(lastVertice){var n=getNormal(lastVertice,vertice);normals.push(n)}lastVertice=vertice}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return[[].concat(normals,[normals[0]]),[normals[0]].concat(normals)]}function calculateColors(_ref6){var groupedVertices=_ref6.groupedVertices,getColor=_ref6.getColor,_ref6$wireframe=_ref6.wireframe,wireframe=_ref6$wireframe===undefined?false:_ref6$wireframe;var colors=groupedVertices.map(function(complexPolygon,polygonIndex){var color=getColor(polygonIndex);color=parseColor(color);var numVertices=countVertices(complexPolygon);var topColors=new Array(numVertices).fill(color);var baseColors=new Array(numVertices).fill(color);return wireframe?[topColors,baseColors]:[topColors,topColors,topColors,baseColors,baseColors]});return new Uint8ClampedArray((0,_lodash2.default)(colors))}function calculatePickingColors(_ref7){var groupedVertices=_ref7.groupedVertices,_ref7$wireframe=_ref7.wireframe,wireframe=_ref7$wireframe===undefined?false:_ref7$wireframe;var colors=groupedVertices.map(function(vertices,polygonIndex){var numVertices=countVertices(vertices);var color=getPickingColor(polygonIndex);var topColors=new Array(numVertices).fill(color);var baseColors=new Array(numVertices).fill(color);return wireframe?[topColors,baseColors]:[topColors,topColors,topColors,baseColors,baseColors]});return new Uint8ClampedArray((0,_lodash2.default)(colors))}function calculateContourIndices(vertices,offset){var stride=countVertices(vertices);return vertices.map(function(polygon){var indices=[offset];var numVertices=polygon.length;for(var i=1;i<numVertices-1;i++){indices.push(i+offset,i+offset)}indices.push(offset);for(var _i=0;_i<numVertices-1;_i++){indices.push(_i+offset,_i+stride+offset)}offset+=numVertices;return indices})}function calculateSurfaceIndices(vertices,offset){var stride=countVertices(vertices);var quad=[[0,1],[0,3],[1,2],[1,2],[0,3],[1,4]];function drawRectangle(i){return quad.map(function(v){return i+v[0]+stride*v[1]+offset})}var holes=null;if(vertices.length>1){holes=vertices.reduce(function(acc,polygon){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+polygon.length])},[0]).slice(1,vertices.length)}var topIndices=(0,_earcut2.default)((0,_lodash2.default)(vertices),holes,3).map(function(index){return index+offset});var sideIndices=vertices.map(function(polygon){var numVertices=polygon.length;var indices=[];for(var i=0;i<numVertices-1;i++){indices.push.apply(indices,_toConsumableArray(drawRectangle(i)))}offset+=numVertices;return indices});return[topIndices,sideIndices]}function getNormal(p1,p2){var p1x=(0,_utils.get)(p1,0);var p1y=(0,_utils.get)(p1,1);var p2x=(0,_utils.get)(p2,0);var p2y=(0,_utils.get)(p2,1);if(p1x===p2x&&p1y===p2y){return[1,0,0]}var degrees2radians=Math.PI/180;var lon1=degrees2radians*p1x;var lon2=degrees2radians*p2x;var lat1=degrees2radians*p1y;var lat2=degrees2radians*p2y;var a=Math.sin(lon2-lon1)*Math.cos(lat2);var b=Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1);return _glMatrix.vec3.normalize([],[b,0,-a])}},{"../../../lib/utils":108,"../../../lib/utils/fp64":105,"./polygon":77,earcut:137,"gl-matrix":144,"lodash.flattendeep":156}],76:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PolygonTesselator=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.flattenVertices2=flattenVertices2;var _polygon=require("./polygon");var Polygon=_interopRequireWildcard(_polygon);var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _utils=require("../../../lib/utils");var _fp=require("../../../lib/utils/fp64");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function getPickingColor(index){return[(index+1)%256,Math.floor((index+1)/256)%256,Math.floor((index+1)/256/256)%256]}function parseColor(color){if(!Array.isArray(color)){color=[(0,_utils.get)(color,0),(0,_utils.get)(color,1),(0,_utils.get)(color,2),(0,_utils.get)(color,3)]}color[3]=Number.isFinite(color[3])?color[3]:255;return color}var DEFAULT_COLOR=[0,0,0,255];var PolygonTesselator=exports.PolygonTesselator=function(){function PolygonTesselator(_ref){var polygons=_ref.polygons,_ref$fp=_ref.fp64,fp64=_ref$fp===undefined?false:_ref$fp;_classCallCheck(this,PolygonTesselator);this.polygons=polygons.map(function(polygon){return Polygon.normalize(polygon)});this.pointCount=getPointCount(this.polygons);this.fp64=fp64}_createClass(PolygonTesselator,[{key:"indices",value:function indices(){var polygons=this.polygons,indexCount=this.indexCount;return calculateIndices({polygons:polygons,indexCount:indexCount})}},{key:"positions",value:function positions(){var polygons=this.polygons,pointCount=this.pointCount;return calculatePositions({polygons:polygons,pointCount:pointCount,fp64:this.fp64})}},{key:"normals",value:function normals(){var polygons=this.polygons,pointCount=this.pointCount;return calculateNormals({polygons:polygons,pointCount:pointCount})}},{key:"colors",value:function colors(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$getColor=_ref2.getColor,getColor=_ref2$getColor===undefined?function(x){return DEFAULT_COLOR}:_ref2$getColor;var polygons=this.polygons,pointCount=this.pointCount;return calculateColors({polygons:polygons,pointCount:pointCount,getColor:getColor})}},{key:"pickingColors",value:function pickingColors(){var polygons=this.polygons,pointCount=this.pointCount;return calculatePickingColors({polygons:polygons,pointCount:pointCount})}}]);return PolygonTesselator}();function getPointCount(polygons){return polygons.reduce(function(points,polygon){return points+Polygon.getVertexCount(polygon)},0)}function getTriangleCount(polygons){return polygons.reduce(function(triangles,polygon){return triangles+Polygon.getTriangleCount(polygon)},0)}function getPolygonOffsets(polygons){var offsets=new Array((0,_utils.count)(polygons)+1);offsets[0]=0;var offset=0;polygons.forEach(function(polygon,i){offset+=Polygon.getVertexCount(polygon);offsets[i+1]=offset});return offsets}function getHoleIndices(complexPolygon){var holeIndices=null;if((0,_utils.count)(complexPolygon)>1){var polygonStartIndex=0;holeIndices=[];complexPolygon.forEach(function(polygon){polygonStartIndex+=(0,_utils.count)(polygon);holeIndices.push(polygonStartIndex)});holeIndices.pop()}return holeIndices}function calculateIndices(_ref3){var polygons=_ref3.polygons,_ref3$IndexType=_ref3.IndexType,IndexType=_ref3$IndexType===undefined?Uint32Array:_ref3$IndexType;var indexCount=3*getTriangleCount(polygons);var offsets=getPolygonOffsets(polygons);if(IndexType===Uint16Array&&indexCount>65535){throw new Error("Vertex count exceeds browser's limit")}var attribute=new IndexType(indexCount);var i=0;polygons.forEach(function(polygon,polygonIndex){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=calculateSurfaceIndices(polygon)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var index=_step.value;attribute[i++]=index+offsets[polygonIndex]}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}});return attribute}function calculateSurfaceIndices(complexPolygon){var holeIndices=getHoleIndices(complexPolygon);var verts=flattenVertices2(complexPolygon);return(0,_earcut2.default)(verts,holeIndices,3)}function isContainer(value){return Array.isArray(value)||ArrayBuffer.isView(value)||value!==null&&(typeof value==="undefined"?"undefined":_typeof(value))==="object"}function flattenVertices2(nestedArray){var _ref4=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref4$result=_ref4.result,result=_ref4$result===undefined?[]:_ref4$result,_ref4$dimensions=_ref4.dimensions,dimensions=_ref4$dimensions===undefined?3:_ref4$dimensions;var index=-1;var vertexLength=0;var length=(0,_utils.count)(nestedArray);while(++index<length){var value=(0,_utils.get)(nestedArray,index);if(isContainer(value)){(0,_utils.flattenVertices)(value,{result:result,dimensions:dimensions})}else{if(vertexLength<dimensions){result.push(value);vertexLength++}}}if(vertexLength>0&&vertexLength<dimensions){result.push(0)}return result}function calculatePositions(_ref5){var polygons=_ref5.polygons,pointCount=_ref5.pointCount,fp64=_ref5.fp64;var attribute=new Float32Array(pointCount*3);var attributeLow=void 0;if(fp64){attributeLow=new Float32Array(pointCount*2)}var i=0;var j=0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=polygons[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var polygon=_step2.value;Polygon.forEachVertex(polygon,function(vertex){var x=(0,_utils.get)(vertex,0);var y=(0,_utils.get)(vertex,1);var z=(0,_utils.get)(vertex,2)||0;attribute[i++]=x;attribute[i++]=y;attribute[i++]=z;if(fp64){attributeLow[j++]=(0,_fp.fp64ify)(x)[1];attributeLow[j++]=(0,_fp.fp64ify)(y)[1]}})}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return{positions:attribute,positions64xyLow:attributeLow}}function calculateNormals(_ref6){var polygons=_ref6.polygons,pointCount=_ref6.pointCount;var attribute=new Float32Array(pointCount*3);(0,_utils.fillArray)({target:attribute,source:[0,1,0],start:0,pointCount:pointCount});return attribute}function calculateColors(_ref7){var polygons=_ref7.polygons,pointCount=_ref7.pointCount,getColor=_ref7.getColor;var attribute=new Uint8ClampedArray(pointCount*4);var i=0;polygons.forEach(function(complexPolygon,polygonIndex){var color=getColor(polygonIndex);color=parseColor(color);var vertexCount=Polygon.getVertexCount(complexPolygon);(0,_utils.fillArray)({target:attribute,source:color,start:i,count:vertexCount});i+=color.length*vertexCount});return attribute}function calculatePickingColors(_ref8){var polygons=_ref8.polygons,pointCount=_ref8.pointCount;var attribute=new Uint8ClampedArray(pointCount*3);var i=0;polygons.forEach(function(complexPolygon,polygonIndex){var color=getPickingColor(polygonIndex);var vertexCount=Polygon.getVertexCount(complexPolygon);(0,_utils.fillArray)({target:attribute,source:color,start:i,count:vertexCount});i+=color.length*vertexCount});return attribute}},{"../../../lib/utils":108,"../../../lib/utils/fp64":105,"./polygon":77,earcut:137}],77:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isSimple=isSimple;exports.normalize=normalize;exports.getVertexCount=getVertexCount;exports.getTriangleCount=getTriangleCount;exports.forEachVertex=forEachVertex;var _utils=require("../../../lib/utils");function isSimple(polygon){return(0,_utils.count)(polygon)>=1&&(0,_utils.count)((0,_utils.get)(polygon,0))>=2&&Number.isFinite((0,_utils.get)((0,_utils.get)(polygon,0),0))}function normalize(polygon){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$dimensions=_ref.dimensions,dimensions=_ref$dimensions===undefined?3:_ref$dimensions;return isSimple(polygon)?[polygon]:polygon}function getVertexCount(polygon){return isSimple(polygon)?(0,_utils.count)(polygon):polygon.reduce(function(length,simplePolygon){return length+(0,_utils.count)(simplePolygon)},0)}function getTriangleCount(polygon){var triangleCount=0;var first=true;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=normalize(polygon)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var simplePolygon=_step.value;var size=(0,_utils.count)(simplePolygon);if(first){triangleCount+=size>=3?size-2:0}else{triangleCount+=size+1}first=false}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return triangleCount}function forEachVertex(polygon,visitor){if(isSimple(polygon)){polygon.forEach(visitor);return}var vertexIndex=0;polygon.forEach(function(simplePolygon){simplePolygon.forEach(function(v,i,p){return visitor(v,vertexIndex,polygon)});vertexIndex++})}},{"../../../lib/utils":108}],78:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME polygon-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\n// PICKING\n// uniform bool pickingEnabled;\nvarying vec4 vPickingColor;\nvec4 picking_getColor() {\n  return vPickingColor;\n}\n// PICKING\n\nvoid main(void) {\n  gl_FragColor = picking_getColor();\n}\n"},{}],79:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\nattribute vec3 normals;\nattribute vec4 colors;\nattribute vec3 pickingColors;\n\nuniform float extruded;\nuniform float opacity;\n\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\n// PICKING\nuniform float pickingEnabled;\nvarying vec4 vPickingColor;\n\nvoid main(void) {\n  vec4 positions64xy = vec4(positions.x, positions64xyLow.x, positions.y, positions64xyLow.y);\n\n  vec2 projected_coord_xy[2];\n  project_position_fp64(positions64xy, projected_coord_xy);\n\n  vec2 vertex_pos_modelspace[4];\n  vertex_pos_modelspace[0] = projected_coord_xy[0];\n  vertex_pos_modelspace[1] = projected_coord_xy[1];\n  vertex_pos_modelspace[2] = vec2(project_scale(positions.z), 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec4 position_worldspace = vec4(\n    vertex_pos_modelspace[0].x, vertex_pos_modelspace[1].x,\n    vertex_pos_modelspace[2].x, vertex_pos_modelspace[3].x);\n\n  if (pickingEnabled < 0.5) {\n    float lightWeight = 1.0;\n\n    if (extruded > 0.5) {\n      lightWeight = getLightWeight(\n        position_worldspace,\n        normals\n      );\n    }\n\n    vec3 lightWeightedColor = lightWeight * colors.rgb;\n    vec4 color = vec4(lightWeightedColor, colors.a * opacity) / 255.0;\n\n    vPickingColor = color;\n\n  } else {\n    vPickingColor = vec4(pickingColors.rgb / 255.0, 1.0);\n  }\n}\n"},{}],80:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 colors;\nattribute vec3 pickingColors;\n\nuniform float extruded;\nuniform float opacity;\n\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\n// PICKING\nuniform float pickingEnabled;\nvarying vec4 vPickingColor;\n\nvoid main(void) {\n  vec4 position_worldspace = vec4(project_position(positions), 1.0);\n  gl_Position = project_to_clipspace(position_worldspace);\n\n  if (pickingEnabled < 0.5) {\n    float lightWeight = 1.0;\n\n    if (extruded > 0.5) {\n      lightWeight = getLightWeight(\n        position_worldspace,\n        normals\n      );\n    }\n\n    vec3 lightWeightedColor = lightWeight * colors.rgb;\n    vec4 color = vec4(lightWeightedColor, colors.a * opacity) / 255.0;\n\n    vPickingColor = color;\n\n  } else {\n    vPickingColor = vec4(pickingColors.rgb / 255.0, 1.0);\n  }\n}\n"},{}],81:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _utils=require("../../../lib/utils");var _luma=require("luma.gl");var _fp=require("../../../lib/utils/fp64");var _polygonTesselator=require("./polygon-tesselator");var _polygonTesselatorExtruded=require("./polygon-tesselator-extruded");var _solidPolygonLayerVertex=require("./solid-polygon-layer-vertex.glsl");var _solidPolygonLayerVertex2=_interopRequireDefault(_solidPolygonLayerVertex);var _solidPolygonLayerVertex3=require("./solid-polygon-layer-vertex-64.glsl");var _solidPolygonLayerVertex4=_interopRequireDefault(_solidPolygonLayerVertex3);var _solidPolygonLayerFragment=require("./solid-polygon-layer-fragment.glsl");var _solidPolygonLayerFragment2=_interopRequireDefault(_solidPolygonLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var defaultProps={extruded:false,wireframe:false,fp64:false,getPolygon:function getPolygon(f){return(0,_utils.get)(f,"polygon")||(0,_utils.get)(f,"geometry.coordinates")},getElevation:function getElevation(f){return(0,_utils.get)(f,"elevation")||(0,_utils.get)(f,"properties.height")||0},getColor:function getColor(f){return(0,_utils.get)(f,"color")||(0,_utils.get)(f,"properties.color")},lightSettings:{lightsPosition:[-122.45,37.75,8e3,-122,38,5e3],ambientRatio:.05,diffuseRatio:.6,specularRatio:.8,lightsStrength:[2,0,0,0],numberOfLights:2}};var SolidPolygonLayer=function(_Layer){_inherits(SolidPolygonLayer,_Layer);function SolidPolygonLayer(){_classCallCheck(this,SolidPolygonLayer);return _possibleConstructorReturn(this,(SolidPolygonLayer.__proto__||Object.getPrototypeOf(SolidPolygonLayer)).apply(this,arguments))}_createClass(SolidPolygonLayer,[{key:"getShaders",value:function getShaders(){return(0,_fp.enable64bitSupport)(this.props)?{vs:_solidPolygonLayerVertex4.default,fs:_solidPolygonLayerFragment2.default,modules:["fp64","project64","lighting"]}:{vs:_solidPolygonLayerVertex2.default,fs:_solidPolygonLayerFragment2.default,modules:["lighting"]}}},{key:"initializeState",value:function initializeState(){var gl=this.context.gl;this.setState({model:this._getModel(gl),numInstances:0,IndexType:gl.getExtension("OES_element_index_uint")?Uint32Array:Uint16Array});var attributeManager=this.state.attributeManager;var noAlloc=true;attributeManager.add({indices:{size:1,isIndexed:true,update:this.calculateIndices,noAlloc:noAlloc},positions:{size:3,accessor:"getElevation",update:this.calculatePositions,noAlloc:noAlloc},normals:{size:3,update:this.calculateNormals,noAlloc:noAlloc},colors:{size:4,type:_luma.GL.UNSIGNED_BYTE,accessor:"getColor",update:this.calculateColors,noAlloc:noAlloc},pickingColors:{size:3,type:_luma.GL.UNSIGNED_BYTE,update:this.calculatePickingColors,noAlloc:noAlloc}})}},{key:"updateAttribute",value:function updateAttribute(_ref){var props=_ref.props,oldProps=_ref.oldProps,changeFlags=_ref.changeFlags;if(props.fp64!==oldProps.fp64){var attributeManager=this.state.attributeManager;attributeManager.invalidateAll();if(props.fp64&&props.projectionMode===_lib.COORDINATE_SYSTEM.LNGLAT){attributeManager.add({positions64xyLow:{size:2,update:this.calculatePositionsLow}})}else{attributeManager.remove(["positions64xyLow"])}}}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var _props=this.props,extruded=_props.extruded,lightSettings=_props.lightSettings;this.state.model.render(Object.assign({},uniforms,{extruded:extruded?1:0},lightSettings))}},{key:"updateState",value:function updateState(_ref3){var props=_ref3.props,oldProps=_ref3.oldProps,changeFlags=_ref3.changeFlags;_get(SolidPolygonLayer.prototype.__proto__||Object.getPrototypeOf(SolidPolygonLayer.prototype),"updateState",this).call(this,{props:props,oldProps:oldProps,changeFlags:changeFlags});var geometryChanged=this.updateGeometry({props:props,oldProps:oldProps,changeFlags:changeFlags});if(geometryChanged){var gl=this.context.gl;this.setState({model:this._getModel(gl)})}this.updateAttribute({props:props,oldProps:oldProps,changeFlags:changeFlags})}},{key:"updateGeometry",value:function updateGeometry(_ref4){var _this2=this;var props=_ref4.props,oldProps=_ref4.oldProps,changeFlags=_ref4.changeFlags;var regenerateModel=changeFlags.dataChanged||props.extruded!==oldProps.extruded||props.wireframe!==oldProps.wireframe||props.fp64!==oldProps.fp64;if(regenerateModel){var getPolygon=props.getPolygon,extruded=props.extruded,wireframe=props.wireframe,getElevation=props.getElevation;var polygons=props.data.map(getPolygon);this.setState({polygonTesselator:!extruded?new _polygonTesselator.PolygonTesselator({polygons:polygons,fp64:this.props.fp64}):new _polygonTesselatorExtruded.PolygonTesselatorExtruded({polygons:polygons,wireframe:wireframe,getHeight:function getHeight(polygonIndex){return getElevation(_this2.props.data[polygonIndex])},fp64:this.props.fp64})});this.state.attributeManager.invalidateAll()}return regenerateModel}},{key:"_getModel",value:function _getModel(gl){var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());return new _luma.Model({gl:gl,id:this.props.id,vs:shaders.vs,fs:shaders.fs,geometry:new _luma.Geometry({drawMode:this.props.wireframe?_luma.GL.LINES:_luma.GL.TRIANGLES}),vertexCount:0,isIndexed:true})}},{key:"calculateIndices",value:function calculateIndices(attribute){attribute.value=this.state.polygonTesselator.indices();attribute.target=_luma.GL.ELEMENT_ARRAY_BUFFER;this.state.model.setVertexCount(attribute.value.length/attribute.size)}},{key:"calculatePositions",value:function calculatePositions(attribute){attribute.value=this.state.polygonTesselator.positions().positions}},{key:"calculatePositionsLow",value:function calculatePositionsLow(attribute){attribute.value=this.state.polygonTesselator.positions().positions64xyLow}},{key:"calculateNormals",value:function calculateNormals(attribute){attribute.value=this.state.polygonTesselator.normals()}},{key:"calculateColors",value:function calculateColors(attribute){var _this3=this;attribute.value=this.state.polygonTesselator.colors({getColor:function getColor(polygonIndex){return _this3.props.getColor(_this3.props.data[polygonIndex])}})}},{key:"calculatePickingColors",value:function calculatePickingColors(attribute){attribute.value=this.state.polygonTesselator.pickingColors()}}]);return SolidPolygonLayer}(_lib.Layer);exports.default=SolidPolygonLayer;SolidPolygonLayer.layerName="SolidPolygonLayer";SolidPolygonLayer.defaultProps=defaultProps},{"../../../lib":95,"../../../lib/utils":108,"../../../lib/utils/fp64":105,"../../../shader-utils":120,"./polygon-tesselator":76,"./polygon-tesselator-extruded":75,"./solid-polygon-layer-fragment.glsl":78,"./solid-polygon-layer-vertex-64.glsl":79,"./solid-polygon-layer-vertex.glsl":80,"luma.gl":195}],82:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined
;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _choroplethLayer=require("../choropleth-layer/choropleth-layer");var _choroplethLayer2=_interopRequireDefault(_choroplethLayer);var _utils=require("../../../lib/utils");var _lodash=require("lodash.flattendeep");var _lodash2=_interopRequireDefault(_lodash);var _choroplethLayerVertex=require("./choropleth-layer-vertex-64.glsl");var _choroplethLayerVertex2=_interopRequireDefault(_choroplethLayerVertex);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ChoroplethLayer64=function(_ChoroplethLayer){_inherits(ChoroplethLayer64,_ChoroplethLayer);function ChoroplethLayer64(props){_classCallCheck(this,ChoroplethLayer64);var _this=_possibleConstructorReturn(this,(ChoroplethLayer64.__proto__||Object.getPrototypeOf(ChoroplethLayer64)).call(this,props));_utils.log.once("ChoroplethLayer64 is deprecated. Consider using GeoJsonLayer instead");return _this}_createClass(ChoroplethLayer64,[{key:"initializeState",value:function initializeState(){_get(ChoroplethLayer64.prototype.__proto__||Object.getPrototypeOf(ChoroplethLayer64.prototype),"initializeState",this).call(this);this.state.attributeManager.add({positions64:{size:4,update:this.calculatePositions64},heights64:{size:2,update:this.calculateHeights64}})}},{key:"getShaders",value:function getShaders(){return{vs:_choroplethLayerVertex2.default,fs:_get(ChoroplethLayer64.prototype.__proto__||Object.getPrototypeOf(ChoroplethLayer64.prototype),"getShaders",this).call(this).fs,fp64:true,project64:true}}},{key:"calculatePositions64",value:function calculatePositions64(attribute){var vertices=(0,_lodash2.default)(this.state.choropleths);attribute.value=new Float32Array(vertices.length/3*4);for(var index=0;index<vertices.length/3;index++){var _fp64ify=(0,_utils.fp64ify)(vertices[index*3]);var _fp64ify2=_slicedToArray(_fp64ify,2);attribute.value[index*4]=_fp64ify2[0];attribute.value[index*4+1]=_fp64ify2[1];var _fp64ify3=(0,_utils.fp64ify)(vertices[index*3+1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);attribute.value[index*4+2]=_fp64ify4[0];attribute.value[index*4+3]=_fp64ify4[1]}}},{key:"calculateHeights64",value:function calculateHeights64(attribute){var vertices=(0,_lodash2.default)(this.state.choropleths);attribute.value=new Float32Array(vertices.length/3*2);for(var index=0;index<vertices.length/3;index++){var _fp64ify5=(0,_utils.fp64ify)(vertices[index*3+2]);var _fp64ify6=_slicedToArray(_fp64ify5,2);attribute.value[index*2]=_fp64ify6[0];attribute.value[index*2+1]=_fp64ify6[1]}}}]);return ChoroplethLayer64}(_choroplethLayer2.default);exports.default=ChoroplethLayer64;ChoroplethLayer64.layerName="ChoroplethLayer64"},{"../../../lib/utils":108,"../choropleth-layer/choropleth-layer":86,"./choropleth-layer-vertex-64.glsl":83,"lodash.flattendeep":156}],83:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME choropleth-layer-vertex-64-shader\n\nattribute vec4 positions64;\nattribute vec2 heights64;\nattribute vec4 colors;\nattribute vec3 pickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\nuniform float pickingEnabled;\nvarying vec4 vPickingColor;\nvoid picking_setPickColor(vec3 pickingColor) {\n  vPickingColor = vec4(pickingColor,  1.);\n}\nvec4 picking_setNormalAndPickColors(vec4 color, vec3 pickingColor) {\n  vec4 pickingColor4 = vec4(pickingColor.rgb, 1.);\n  vPickingColor = mix(color, pickingColor4, pickingEnabled);\n  return vPickingColor;\n}\n\nvoid main(void) {\n  // For some reason, need to add one to elevation to show up in untilted mode\n  vec2 projectedCoord[2];\n  project_position_fp64(positions64, projectedCoord);\n\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = projectedCoord[0];\n  vertex_pos_modelspace[1] = projectedCoord[1];\n  vertex_pos_modelspace[2] = heights64;\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec4 color = vec4(colors.rgb, colors.a * opacity) / 255.;\n\n  picking_setNormalAndPickColors(\n    color,\n    pickingColors / 255.\n  );\n}\n"},{}],84:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME choropleth-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\n// PICKING\n// uniform bool pickingEnabled;\nvarying vec4 vPickingColor;\nvec4 picking_getColor() {\n  return vPickingColor;\n}\n// PICKING\n\nvoid main(void) {\n  gl_FragColor = picking_getColor();\n}\n"},{}],85:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME choropleth-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 colors;\nattribute vec3 pickingColors;\n\nuniform float opacity;\nuniform float renderPickingBuffer;\nuniform vec3 selectedPickingColor;\n\n// PICKING\nuniform float pickingEnabled;\nvarying vec4 vPickingColor;\nvoid picking_setPickColor(vec3 pickingColor) {\n  vPickingColor = vec4(pickingColor,  1.);\n}\nvec4 picking_setNormalAndPickColors(vec4 color, vec3 pickingColor) {\n  vec4 pickingColor4 = vec4(pickingColor.rgb, 1.);\n  vPickingColor = mix(color, pickingColor4, pickingEnabled);\n  return vPickingColor;\n}\n\n// PICKING\n// vec4 getColor(vec4 color, float opacity, vec3 pickingColor, float renderPickingBuffer) {\n//   vec4 color4 = vec4(color.xyz / 255., color.w / 255. * opacity);\n//   vec4 pickingColor4 = vec4(pickingColor / 255., 1.);\n//   return mix(color4, pickingColor4, renderPickingBuffer);\n// }\n\nvoid main(void) {\n\n  vec4 color = vec4(colors.rgb, colors.a * opacity) / 255.;\n\n  picking_setNormalAndPickColors(\n    color,\n    pickingColors / 255.\n  );\n\n  vec3 p = project_position(positions);\n  gl_Position = project_to_clipspace(vec4(p, 1.));\n}\n"},{}],86:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _utils=require("../../../lib/utils");var _geojson=require("./geojson");var _luma=require("luma.gl");var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _choroplethLayerVertex=require("./choropleth-layer-vertex.glsl");var _choroplethLayerVertex2=_interopRequireDefault(_choroplethLayerVertex);var _choroplethLayerFragment=require("./choropleth-layer-fragment.glsl");var _choroplethLayerFragment2=_interopRequireDefault(_choroplethLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[0,0,255,255];var defaultProps={getColor:function getColor(feature){return(0,_utils.get)(feature,"properties.color")},drawContour:false,strokeWidth:1};var ChoroplethLayer=function(_Layer){_inherits(ChoroplethLayer,_Layer);function ChoroplethLayer(props){_classCallCheck(this,ChoroplethLayer);var _this=_possibleConstructorReturn(this,(ChoroplethLayer.__proto__||Object.getPrototypeOf(ChoroplethLayer)).call(this,props));_utils.log.once("ChoroplethLayer is deprecated. Consider using GeoJsonLayer instead");return _this}_createClass(ChoroplethLayer,[{key:"getShaders",value:function getShaders(){return{vs:_choroplethLayerVertex2.default,fs:_choroplethLayerFragment2.default}}},{key:"initializeState",value:function initializeState(){var gl=this.context.gl;var attributeManager=this.state.attributeManager;attributeManager.add({indices:{size:1,update:this.calculateIndices,isIndexed:true},positions:{size:3,update:this.calculatePositions},colors:{size:4,type:_luma.GL.UNSIGNED_BYTE,update:this.calculateColors},pickingColors:{size:3,type:_luma.GL.UNSIGNED_BYTE,update:this.calculatePickingColors,noAlloc:true}});var IndexType=gl.getExtension("OES_element_index_uint")?Uint32Array:Uint16Array;this.setState({model:this.getModel(gl),numInstances:0,IndexType:IndexType})}},{key:"updateState",value:function updateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,changeFlags=_ref.changeFlags;var attributeManager=this.state.attributeManager;if(changeFlags.dataChanged){this.state.choropleths=(0,_geojson.extractPolygons)(props.data);attributeManager.invalidateAll()}if(props.drawContour!==oldProps.drawContour){this.state.model.geometry.drawMode=props.drawContour?_luma.GL.LINES:_luma.GL.TRIANGLES;attributeManager.invalidateAll()}}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;var gl=this.context.gl;var lineWidth=this.screenToDevicePixels(this.props.strokeWidth);gl.lineWidth(lineWidth);this.state.model.render(uniforms);gl.lineWidth(1)}},{key:"getPickingInfo",value:function getPickingInfo(opts){var info=_get(ChoroplethLayer.prototype.__proto__||Object.getPrototypeOf(ChoroplethLayer.prototype),"getPickingInfo",this).call(this,opts);var index=this.decodePickingColor(info.color);var feature=index>=0?(0,_utils.get)(this.props.data,["features",index]):null;info.feature=feature;info.object=feature;return info}},{key:"getModel",value:function getModel(gl){var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());return new _luma.Model({gl:gl,id:this.props.id,vs:shaders.vs,fs:shaders.fs,geometry:new _luma.Geometry({drawMode:this.props.drawContour?_luma.GL.LINES:_luma.GL.TRIANGLES}),vertexCount:0,isIndexed:true})}},{key:"calculateIndices",value:function calculateIndices(attribute){var _this2=this;var offsets=this.state.choropleths.reduce(function(acc,choropleth){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+choropleth.reduce(function(count,polygon){return count+polygon.length},0)])},[0]);var IndexType=this.state.IndexType;if(IndexType===Uint16Array&&offsets[offsets.length-1]>65535){throw new Error("Vertex count exceeds browser's limit")}var indices=this.state.choropleths.map(function(choropleth,choroplethIndex){return _this2.props.drawContour?calculateContourIndices(choropleth).map(function(index){return index+offsets[choroplethIndex]}):calculateSurfaceIndices(choropleth).map(function(index){return index+offsets[choroplethIndex]})});attribute.value=new IndexType((0,_utils.flatten)(indices));attribute.target=_luma.GL.ELEMENT_ARRAY_BUFFER;this.state.model.setVertexCount(attribute.value.length/attribute.size)}},{key:"calculatePositions",value:function calculatePositions(attribute){var vertices=(0,_utils.flatten)(this.state.choropleths);attribute.value=new Float32Array(vertices)}},{key:"calculateColors",value:function calculateColors(attribute){var _props=this.props,data=_props.data,getColor=_props.getColor;var features=(0,_utils.get)(data,"features");var colors=this.state.choropleths.map(function(choropleth,choroplethIndex){var feature=(0,_utils.get)(features,choropleth.featureIndex);var color=getColor(feature)||DEFAULT_COLOR;if(isNaN(color[3])){color[3]=DEFAULT_COLOR[3]}return choropleth.map(function(polygon){return polygon.map(function(vertex){return color})})});attribute.value=new Uint8Array((0,_utils.flatten)(colors))}},{key:"calculatePickingColors",value:function calculatePickingColors(attribute){var _this3=this;var colors=this.state.choropleths.map(function(choropleth,choroplethIndex){var featureIndex=choropleth.featureIndex;var color=_this3.props.drawContour?[0,0,0]:[(featureIndex+1)%256,Math.floor((featureIndex+1)/256)%256,Math.floor((featureIndex+1)/256/256)%256];return choropleth.map(function(polygon){return polygon.map(function(vertex){return color})})});attribute.value=new Uint8Array((0,_utils.flatten)(colors))}}]);return ChoroplethLayer}(_lib.Layer);exports.default=ChoroplethLayer;ChoroplethLayer.layerName="ChoroplethLayer";ChoroplethLayer.defaultProps=defaultProps;function calculateContourIndices(choropleth){var offset=0;return choropleth.reduce(function(acc,polygon){var numVertices=polygon.length;var indices=[].concat(_toConsumableArray(acc),[offset]);for(var i=1;i<numVertices-1;i++){indices.push(i+offset,i+offset)}indices.push(offset+numVertices-1);offset+=numVertices;return indices},[])}function calculateSurfaceIndices(choropleth){var holes=null;if(choropleth.length>1){holes=choropleth.reduce(function(acc,polygon){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+polygon.length])},[0]).slice(1,choropleth.length)}return(0,_earcut2.default)((0,_utils.flatten)(choropleth),holes,3)}},{"../../../lib":95,"../../../lib/utils":108,"../../../shader-utils":120,"./choropleth-layer-fragment.glsl":84,"./choropleth-layer-vertex.glsl":85,"./geojson":87,earcut:137,"luma.gl":195}],87:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getGeojsonFeatures=getGeojsonFeatures;exports.featureToPolygons=featureToPolygons;exports.extractPolygons=extractPolygons;exports.normalizeGeojson=normalizeGeojson;var _utils=require("../../../lib/utils");function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function getGeojsonFeatures(geojson){if(Array.isArray(geojson)){return geojson}var type=(0,_utils.get)(geojson,"type");switch(type){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":case"GeometryCollection":return[{type:"Feature",properties:{},geometry:geojson}];case"Feature":return[geojson];case"FeatureCollection":return(0,_utils.get)(geojson,"features");default:throw new Error("Unknown geojson type")}}function featureToPolygons(feature){var geometry=(0,_utils.get)(feature,"geometry");if(geometry===undefined){return feature}var type=(0,_utils.get)(geometry,"type");var coordinates=(0,_utils.get)(geometry,"coordinates");var polygons=void 0;switch(type){case"MultiPolygon":polygons=coordinates;break;case"Polygon":polygons=[coordinates];break;case"LineString":polygons=[[coordinates]];break;case"MultiLineString":polygons=coordinates.map(function(coords){return[coords]});break;default:polygons=[]}return polygons}function extractPolygons(data){var normalizedGeojson=normalizeGeojson(data);var features=(0,_utils.get)(normalizedGeojson,"features");var result=[];features.forEach(function(feature,featureIndex){var choropleths=featureToPolygons(feature);choropleths=choropleths.map(function(choropleth){return choropleth.map(function(polygon){return polygon.map(function(coord){return[(0,_utils.get)(coord,0),(0,_utils.get)(coord,1),(0,_utils.get)(coord,2)||0]})})});var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=choropleths[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var choropleth=_step.value;choropleth.featureIndex=featureIndex}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}result.push.apply(result,_toConsumableArray(choropleths))});return result}function normalizeGeojson(geojson){var type=(0,_utils.get)(geojson,"type");switch(type){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":case"GeometryCollection":return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:geojson}]};case"Feature":return{type:"FeatureCollection",features:[geojson]};case"FeatureCollection":return geojson;default:throw new Error("Unknown geojson type")}}},{"../../../lib/utils":108}],88:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lib=require("../../../lib");var _shaderUtils=require("../../../shader-utils");var _fp=require("../../../lib/utils/fp64");var _luma=require("luma.gl");var _utils=require("../../../lib/utils");var _earcut=require("earcut");var _earcut2=_interopRequireDefault(_earcut);var _glMatrix=require("gl-matrix");var _extrudedChoroplethLayerVertex=require("./extruded-choropleth-layer-vertex.glsl");var _extrudedChoroplethLayerVertex2=_interopRequireDefault(_extrudedChoroplethLayerVertex);var _extrudedChoroplethLayerFragment=require("./extruded-choropleth-layer-fragment.glsl");var _extrudedChoroplethLayerFragment2=_interopRequireDefault(_extrudedChoroplethLayerFragment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_COLOR=[180,180,200,255];var DEFAULT_AMBIENT_COLOR=[255,255,255];var DEFAULT_POINTLIGHT_AMBIENT_COEFFICIENT=.1;var DEFAULT_POINTLIGHT_LOCATION=[40.4406,-79.9959,100];var DEFAULT_POINTLIGHT_COLOR=[255,255,255];var DEFAULT_POINTLIGHT_ATTENUATION=1;var DEFAULT_MATERIAL_SPECULAR_COLOR=[255,255,255];var DEFAULT_MATERIAL_SHININESS=1;var defaultProps={opacity:1,elevation:1};var ExtrudedChoroplethLayer64=function(_Layer){_inherits(ExtrudedChoroplethLayer64,_Layer);function ExtrudedChoroplethLayer64(props){_classCallCheck(this,ExtrudedChoroplethLayer64);var _this=_possibleConstructorReturn(this,(ExtrudedChoroplethLayer64.__proto__||Object.getPrototypeOf(ExtrudedChoroplethLayer64)).call(this,props));_utils.log.once("ExtrudedChoroplethLayer64 is deprecated. Consider using GeoJsonLayer instead");return _this}_createClass(ExtrudedChoroplethLayer64,[{key:"initializeState",value:function initializeState(){var attributeManager=this.state.attributeManager;attributeManager.add({indices:{size:1,isIndexed:true,update:this.calculateIndices},positions:{size:4,update:this.calculatePositions},heights:{size:2,update:this.calculateHeights},normals:{size:3,update:this.calculateNormals},colors:{size:4,update:this.calculateColors}});var gl=this.context.gl;this.setState({numInstances:0,model:this.getModel(gl)})}},{key:"updateState",value:function updateState(_ref){var changeFlags=_ref.changeFlags;var attributeManager=this.state.attributeManager;if(changeFlags.dataChanged){this.extractExtrudedChoropleth();attributeManager.invalidateAll()}var _props=this.props,elevation=_props.elevation,ambientColor=_props.ambientColor,pointLightColor=_props.pointLightColor,pointLightLocation=_props.pointLightLocation,pointLightAmbientCoefficient=_props.pointLightAmbientCoefficient,pointLightAttenuation=_props.pointLightAttenuation,materialSpecularColor=_props.materialSpecularColor,materialShininess=_props.materialShininess;this.setUniforms({elevation:Number.isFinite(elevation)?elevation:1,uAmbientColor:ambientColor||DEFAULT_AMBIENT_COLOR,uPointLightAmbientCoefficient:pointLightAmbientCoefficient||DEFAULT_POINTLIGHT_AMBIENT_COEFFICIENT,uPointLightLocation:pointLightLocation||DEFAULT_POINTLIGHT_LOCATION,uPointLightColor:pointLightColor||DEFAULT_POINTLIGHT_COLOR,uPointLightAttenuation:pointLightAttenuation||DEFAULT_POINTLIGHT_ATTENUATION,uMaterialSpecularColor:materialSpecularColor||DEFAULT_MATERIAL_SPECULAR_COLOR,uMaterialShininess:materialShininess||DEFAULT_MATERIAL_SHININESS})}},{key:"draw",value:function draw(_ref2){var uniforms=_ref2.uniforms;this.state.model.render(uniforms)}},{key:"getPickingInfo",value:function getPickingInfo(opts){var info=_get(ExtrudedChoroplethLayer64.prototype.__proto__||Object.getPrototypeOf(ExtrudedChoroplethLayer64.prototype),"getPickingInfo",this).call(this,opts);var index=this.decodePickingColor(info.color);var feature=index>=0?this.props.data.features[index]:null;info.feature=feature;info.object=feature;return info}},{key:"getShaders",value:function getShaders(){return{vs:_extrudedChoroplethLayerVertex2.default,fs:_extrudedChoroplethLayerFragment2.default,fp64:true,project64:true}}},{key:"getModel",value:function getModel(gl){if(!gl.getExtension("OES_element_index_uint")){throw new Error("Extruded choropleth layer needs 32 bit indices")}gl.enable(_luma.GL.DEPTH_TEST);gl.depthFunc(_luma.GL.LEQUAL);var shaders=(0,_shaderUtils.assembleShaders)(gl,this.getShaders());return new _luma.Model({gl:gl,id:this.props.id,vs:shaders.vs,fs:shaders.fs,geometry:new _luma.Geometry({drawMode:this.props.drawWireframe?_luma.GL.LINES:_luma.GL.TRIANGLES}),vertexCount:0,isIndexed:true})}},{key:"calculatePositions",value:function calculatePositions(attribute){var _this2=this;var positions=this.state.positions;if(!positions){positions=(0,_utils.flatten)(this.state.groupedVertices.map(function(vertices){var topVertices=Array.prototype.concat.apply([],vertices);var baseVertices=topVertices.map(function(v){return[v[0],v[1],0]});return _this2.props.drawWireframe?[topVertices,baseVertices]:[topVertices,topVertices,topVertices,baseVertices,baseVertices]}))}attribute.value=new Float32Array(positions.length/3*4);for(var i=0;i<positions.length/3;i++){var _fp64ify=(0,_fp.fp64ify)(positions[i*3+0]);var _fp64ify2=_slicedToArray(_fp64ify,2);attribute.value[i*4+0]=_fp64ify2[0];attribute.value[i*4+1]=_fp64ify2[1];var _fp64ify3=(0,_fp.fp64ify)(positions[i*3+1]);var _fp64ify4=_slicedToArray(_fp64ify3,2);attribute.value[i*4+2]=_fp64ify4[0];attribute.value[i*4+3]=_fp64ify4[1]}}},{key:"calculateHeights",value:function calculateHeights(attribute){var _this3=this;var positions=this.state.positions;if(!positions){positions=(0,_utils.flatten)(this.state.groupedVertices.map(function(vertices){var topVertices=Array.prototype.concat.apply([],vertices);var baseVertices=topVertices.map(function(v){return[v[0],v[1],0]});return _this3.props.drawWireframe?[topVertices,baseVertices]:[topVertices,topVertices,topVertices,baseVertices,baseVertices]}))}attribute.value=new Float32Array(positions.length/3*2);for(var i=0;i<positions.length/3;i++){var _fp64ify5=(0,_fp.fp64ify)(positions[i*3+2]+.1);var _fp64ify6=_slicedToArray(_fp64ify5,2);attribute.value[i*2+0]=_fp64ify6[0];attribute.value[i*2+1]=_fp64ify6[1]}}},{key:"calculateNormals",value:function calculateNormals(attribute){var _this4=this;var up=[0,1,0];var normals=this.state.groupedVertices.map(function(vertices,buildingIndex){var topNormals=new Array(countVertices(vertices)).fill(up);var sideNormals=vertices.map(function(polygon){return _this4.calculateSideNormals(polygon)});var sideNormalsForward=sideNormals.map(function(n){return n[0]});var sideNormalsBackward=sideNormals.map(function(n){return n[1]});return _this4.props.drawWireframe?[topNormals,topNormals]:[topNormals,sideNormalsForward,sideNormalsBackward,sideNormalsForward,sideNormalsBackward]});attribute.value=new Float32Array((0,_utils.flatten)(normals))}},{key:"calculateSideNormals",value:function calculateSideNormals(vertices){var numVertices=vertices.length;var normals=[];for(var i=0;i<numVertices-1;i++){var n=getNormal(vertices[i],vertices[i+1]);normals.push(n)}return[[].concat(normals,[normals[0]]),[normals[0]].concat(normals)]}},{key:"calculateIndices",value:function calculateIndices(attribute){var _this5=this;var multiplier=this.props.drawWireframe?2:5;var offsets=this.state.groupedVertices.reduce(function(acc,vertices){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+countVertices(vertices)*multiplier])},[0]);var indices=this.state.groupedVertices.map(function(vertices,buildingIndex){return _this5.props.drawWireframe?_this5.calculateContourIndices(vertices,offsets[buildingIndex]):_this5.calculateSurfaceIndices(vertices,offsets[buildingIndex])});attribute.value=new Uint32Array((0,_utils.flatten)(indices));attribute.target=_luma.GL.ELEMENT_ARRAY_BUFFER;this.state.model.setVertexCount(attribute.value.length/attribute.size)}},{key:"calculateColors",value:function calculateColors(attribute){var _this6=this;var colors=this.state.groupedVertices.map(function(vertices,buildingIndex){var color=_this6.props.color;var baseColor=color||DEFAULT_COLOR;var topColor=color||DEFAULT_COLOR;var numVertices=countVertices(vertices);var topColors=new Array(numVertices).fill(topColor);var baseColors=new Array(numVertices).fill(baseColor);return _this6.props.drawWireframe?[topColors,baseColors]:[topColors,topColors,topColors,baseColors,baseColors]});attribute.value=new Float32Array((0,_utils.flatten)(colors))}},{key:"extractExtrudedChoropleth",value:function extractExtrudedChoropleth(){var _this7=this;var data=this.props.data;this.state.buildings=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{var _loop=function _loop(){var _state$buildings;var building=_step.value;var properties=building.properties,geometry=building.geometry;var coordinates=geometry.coordinates,type=geometry.type;if(!properties.height){properties.height=Math.random()*1e3}switch(type){case"MultiPolygon":var buildings=coordinates.map(function(coords){return{coordinates:coords,properties:properties}});(_state$buildings=_this7.state.buildings).push.apply(_state$buildings,_toConsumableArray(buildings));break;case"Polygon":_this7.state.buildings.push({coordinates:coordinates,properties:properties});break;default:}};for(var _iterator=data.features[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_loop()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.state.groupedVertices=this.state.buildings.map(function(building){return building.coordinates.map(function(polygon){return polygon.map(function(coordinate){return[coordinate[0],coordinate[1],building.properties.height||10]})})})}},{key:"calculateContourIndices",value:function calculateContourIndices(vertices,offset){var stride=countVertices(vertices);return vertices.map(function(polygon){var indices=[offset];var numVertices=polygon.length
;for(var i=1;i<numVertices-1;i++){indices.push(i+offset,i+offset)}indices.push(offset);for(var _i=0;_i<numVertices-1;_i++){indices.push(_i+offset,_i+stride+offset)}offset+=numVertices;return indices})}},{key:"calculateSurfaceIndices",value:function calculateSurfaceIndices(vertices,offset){var stride=countVertices(vertices);var holes=null;var quad=[[0,1],[0,3],[1,2],[1,2],[0,3],[1,4]];if(vertices.length>1){holes=vertices.reduce(function(acc,polygon){return[].concat(_toConsumableArray(acc),[acc[acc.length-1]+polygon.length])},[0]).slice(1,vertices.length)}var topIndices=(0,_earcut2.default)((0,_utils.flatten)(vertices),holes,3).map(function(index){return index+offset});var sideIndices=vertices.map(function(polygon){var numVertices=polygon.length;var indices=[];for(var i=0;i<numVertices-1;i++){indices.push.apply(indices,_toConsumableArray(drawRectangle(i)))}offset+=numVertices;return indices});return[topIndices,sideIndices];function drawRectangle(i){return quad.map(function(v){return i+v[0]+stride*v[1]+offset})}}}]);return ExtrudedChoroplethLayer64}(_lib.Layer);exports.default=ExtrudedChoroplethLayer64;ExtrudedChoroplethLayer64.layerName="ExtrudedChoroplethLayer64";ExtrudedChoroplethLayer64.defaultProps=defaultProps;function getNormal(p1,p2){if(p1[0]===p2[0]&&p1[1]===p2[1]){return[1,0,0]}var degrees2radians=Math.PI/180;var lon1=degrees2radians*p1[0];var lon2=degrees2radians*p2[0];var lat1=degrees2radians*p1[1];var lat2=degrees2radians*p2[1];var a=Math.sin(lon2-lon1)*Math.cos(lat2);var b=Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1);return _glMatrix.vec3.normalize([],[b,0,-a])}function countVertices(vertices){return vertices.reduce(function(count,polygon){return count+polygon.length},0)}},{"../../../lib":95,"../../../lib/utils":108,"../../../lib/utils/fp64":105,"../../../shader-utils":120,"./extruded-choropleth-layer-fragment.glsl":89,"./extruded-choropleth-layer-vertex.glsl":90,earcut:137,"gl-matrix":144,"luma.gl":195}],89:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME building-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n}\n"},{}],90:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define SHADER_NAME extruded-choropleths-layer-vertex-shader\n\nattribute vec4 positions;\nattribute vec2 heights;\nattribute vec3 normals;\nattribute vec4 colors;\n\nuniform float opacity;\nuniform float elevation;\n\nuniform vec3 uAmbientColor;\nuniform float uPointLightAmbientCoefficient;\nuniform vec3 uPointLightLocation;\nuniform vec3 uPointLightColor;\nuniform float uPointLightAttenuation;\n\nuniform vec3 uMaterialSpecularColor;\nuniform float uMaterialShininess;\n\nvarying vec4 vColor;\n\nvec3 applyLighting(vec3 position_modelspace, vec3 normal_modelspace, vec3 color) {\n\n  vec3 pointLightLocation_modelspace = vec3(project_position(uPointLightLocation));\n  vec3 lightDirection = normalize(pointLightLocation_modelspace - position_modelspace);\n\n  vec3 ambient = uPointLightAmbientCoefficient * color / 255.0 * uAmbientColor / 255.0;\n\n  float diffuseCoefficient = max(dot(normal_modelspace, lightDirection), 0.0);\n  vec3 diffuse = diffuseCoefficient * uPointLightColor / 255. * color / 255.;\n\n  return ambient + uPointLightAttenuation * diffuse;\n}\n\nvoid main(void) {\n  vec2 projected_xy[2];\n  project_position_fp64(positions, projected_xy);\n  vec2 scaled_height = mul_fp64(heights, vec2(projectionPixelsPerUnit.x * elevation, 0.0));\n\n  vec2 vertex_pos_modelspace[4];\n  vertex_pos_modelspace[0] = projected_xy[0];\n  vertex_pos_modelspace[1] = projected_xy[1];\n  vertex_pos_modelspace[2] = sum_fp64(scaled_height, vec2(1.0, 0.0));\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n\n  vec3 color = applyLighting(\n  \tvec3(\n  \t  vertex_pos_modelspace[0].x,\n  \t  vertex_pos_modelspace[1].x,\n  \t  vertex_pos_modelspace[2].x),\n  \tnormals,\n  \tcolors.rgb\n  );\n  vColor = vec4(color, opacity);\n}\n"},{}],91:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.glArrayFromType=glArrayFromType;var _luma=require("luma.gl");var _utils=require("./utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var LOG_START_END_PRIORITY=1;var LOG_DETAIL_PRIORITY=2;function noop(){}function glArrayFromType(glType){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$clamped=_ref.clamped,clamped=_ref$clamped===undefined?true:_ref$clamped;switch(glType){case _luma.GL.FLOAT:return Float32Array;case _luma.GL.UNSIGNED_SHORT:case _luma.GL.UNSIGNED_SHORT_5_6_5:case _luma.GL.UNSIGNED_SHORT_4_4_4_4:case _luma.GL.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case _luma.GL.UNSIGNED_INT:return Uint32Array;case _luma.GL.UNSIGNED_BYTE:return clamped?Uint8ClampedArray:Uint8Array;case _luma.GL.BYTE:return Int8Array;case _luma.GL.SHORT:return Int16Array;case _luma.GL.INT:return Int32Array;default:throw new Error("Failed to deduce type from array")}}var logFunctions={onUpdateStart:function onUpdateStart(_ref2){var level=_ref2.level,id=_ref2.id;_utils.log.time(level,"Updated attributes for "+id)},onLog:function onLog(_ref3){var level=_ref3.level,message=_ref3.message;_utils.log.log(level,message)},onUpdateEnd:function onUpdateEnd(_ref4){var level=_ref4.level,id=_ref4.id;_utils.log.timeEnd(level,"Updated attributes for "+id)}};var AttributeManager=function(){_createClass(AttributeManager,null,[{key:"setDefaultLogFunctions",value:function setDefaultLogFunctions(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},onLog=_ref5.onLog,onUpdateStart=_ref5.onUpdateStart,onUpdateEnd=_ref5.onUpdateEnd;if(onLog!==undefined){logFunctions.onLog=onLog||noop}if(onUpdateStart!==undefined){logFunctions.onUpdateStart=onUpdateStart||noop}if(onUpdateEnd!==undefined){logFunctions.onUpdateEnd=onUpdateEnd||noop}}}]);function AttributeManager(){var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref6$id=_ref6.id,id=_ref6$id===undefined?"attribute-manager":_ref6$id;_classCallCheck(this,AttributeManager);this.id=id;this.attributes={};this.updateTriggers={};this.allocedInstances=-1;this.needsRedraw=true;this.userData={};Object.seal(this)}_createClass(AttributeManager,[{key:"add",value:function add(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters)}},{key:"remove",value:function remove(attributeNameArray){for(var i=0;i<attributeNameArray.length;i++){var name=attributeNameArray[i];if(this.attributes[name]!==undefined){delete this.attributes[name]}}}},{key:"invalidate",value:function invalidate(triggerName){var attributes=this.attributes,updateTriggers=this.updateTriggers;var attributesToUpdate=updateTriggers[triggerName];if(!attributesToUpdate){var message="invalidating non-existent attribute "+triggerName+" for "+this.id+"\n";message+="Valid attributes: "+Object.keys(attributes).join(", ");(0,_assert2.default)(attributesToUpdate,message)}attributesToUpdate.forEach(function(name){var attribute=attributes[name];if(attribute){attribute.needsUpdate=true}});logFunctions.onLog({level:LOG_DETAIL_PRIORITY,message:"invalidated attribute "+attributesToUpdate+" for "+this.id,id:this.identifier})}},{key:"invalidateAll",value:function invalidateAll(){var attributes=this.attributes;for(var attributeName in attributes){this.invalidate(attributeName)}}},{key:"update",value:function update(){var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},data=_ref7.data,numInstances=_ref7.numInstances,_ref7$props=_ref7.props,props=_ref7$props===undefined?{}:_ref7$props,_ref7$buffers=_ref7.buffers,buffers=_ref7$buffers===undefined?{}:_ref7$buffers,_ref7$context=_ref7.context,context=_ref7$context===undefined?{}:_ref7$context,_ref7$ignoreUnknownAt=_ref7.ignoreUnknownAttributes,ignoreUnknownAttributes=_ref7$ignoreUnknownAt===undefined?false:_ref7$ignoreUnknownAt;this._checkExternalBuffers({buffers:buffers,ignoreUnknownAttributes:ignoreUnknownAttributes});this._setExternalBuffers(buffers);if(this._analyzeBuffers({numInstances:numInstances})){logFunctions.onUpdateStart({level:LOG_START_END_PRIORITY,id:this.id});this._updateBuffers({numInstances:numInstances,data:data,props:props,context:context});logFunctions.onUpdateEnd({level:LOG_START_END_PRIORITY,id:this.id})}}},{key:"getAttributes",value:function getAttributes(){return this.attributes}},{key:"getChangedAttributes",value:function getChangedAttributes(_ref8){var _ref8$clearChangedFla=_ref8.clearChangedFlags,clearChangedFlags=_ref8$clearChangedFla===undefined?false:_ref8$clearChangedFla;var attributes=this.attributes;var changedAttributes={};for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute.changed){attribute.changed=attribute.changed&&!clearChangedFlags;changedAttributes[attributeName]=attribute}}return changedAttributes}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref9=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref9$clearRedrawFlag=_ref9.clearRedrawFlags,clearRedrawFlags=_ref9$clearRedrawFlag===undefined?false:_ref9$clearRedrawFlag;var redraw=this.needsRedraw;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;return redraw}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=true;return this}},{key:"addInstanced",value:function addInstanced(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._add(attributes,updaters,{instanced:1})}},{key:"_add",value:function _add(attributes){var updaters=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _extraProps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var newAttributes={};for(var attributeName in attributes){if(attributeName in updaters){attributes[attributeName]=Object.assign({},attributes[attributeName],updaters[attributeName])}var attribute=attributes[attributeName];var isIndexed=attribute.isIndexed||attribute.elements;var size=attribute.elements&&1||attribute.size;var value=attribute.value||null;var attributeData=Object.assign({target:undefined,userData:{}},attribute,{isExternalBuffer:false,needsAlloc:false,needsUpdate:false,changed:false,isIndexed:isIndexed,size:size,value:value},_extraProps);Object.seal(attributeData);this._validateAttributeDefinition(attributeName,attributeData);newAttributes[attributeName]=attributeData}Object.assign(this.attributes,newAttributes);this._mapUpdateTriggersToAttributes()}},{key:"_mapUpdateTriggersToAttributes",value:function _mapUpdateTriggersToAttributes(){var _this=this;var triggers={};var _loop=function _loop(attributeName){var attribute=_this.attributes[attributeName];var accessor=attribute.accessor;triggers[attributeName]=[attributeName];if(typeof accessor==="string"){accessor=[accessor]}if(Array.isArray(accessor)){accessor.forEach(function(accessorName){if(!triggers[accessorName]){triggers[accessorName]=[]}triggers[accessorName].push(attributeName)})}};for(var attributeName in this.attributes){_loop(attributeName)}this.updateTriggers=triggers}},{key:"_validateAttributeDefinition",value:function _validateAttributeDefinition(attributeName,attribute){(0,_assert2.default)(attribute.size>=1&&attribute.size<=4,"Attribute definition for "+attributeName+" invalid size");var hasUpdater=attribute.noAlloc||typeof attribute.update==="function"||typeof attribute.accessor==="string";if(!hasUpdater){throw new Error("Attribute "+attributeName+" missing update or accessor")}}},{key:"_checkExternalBuffers",value:function _checkExternalBuffers(){var _ref10=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref10$buffers=_ref10.buffers,buffers=_ref10$buffers===undefined?{}:_ref10$buffers,_ref10$ignoreUnknownA=_ref10.ignoreUnknownAttributes,ignoreUnknownAttributes=_ref10$ignoreUnknownA===undefined?false:_ref10$ignoreUnknownA;var attributes=this.attributes;for(var attributeName in buffers){var attribute=attributes[attributeName];if(!attribute&&!ignoreUnknownAttributes){throw new Error("Unknown attribute prop "+attributeName)}}}},{key:"_setExternalBuffers",value:function _setExternalBuffers(bufferMap){var attributes=this.attributes,numInstances=this.numInstances;for(var attributeName in attributes){var attribute=attributes[attributeName];var buffer=bufferMap[attributeName];attribute.isExternalBuffer=false;if(buffer){if(!(buffer instanceof Float32Array)){throw new Error("Attribute properties must be of type Float32Array")}if(attribute.auto&&buffer.length<=numInstances*attribute.size){throw new Error("Attribute prop array must match length and size")}attribute.isExternalBuffer=true;attribute.needsUpdate=false;if(attribute.value!==buffer){attribute.value=buffer;attribute.changed=true;this.needsRedraw=true}}}}},{key:"_analyzeBuffers",value:function _analyzeBuffers(_ref11){var numInstances=_ref11.numInstances;var attributes=this.attributes;(0,_assert2.default)(numInstances!==undefined,"numInstances not defined");var needsUpdate=false;for(var attributeName in attributes){var attribute=attributes[attributeName];if(!attribute.isExternalBuffer){var needsAlloc=attribute.value===null||attribute.value.length/attribute.size<numInstances;if(needsAlloc&&(attribute.update||attribute.accessor)){attribute.needsAlloc=true;needsUpdate=true}if(attribute.needsUpdate){needsUpdate=true}}}return needsUpdate}},{key:"_updateBuffers",value:function _updateBuffers(_ref12){var numInstances=_ref12.numInstances,data=_ref12.data,props=_ref12.props,context=_ref12.context;var attributes=this.attributes;var allocCount=Math.max(numInstances,1);for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute.needsAlloc){var ArrayType=glArrayFromType(attribute.type||_luma.GL.FLOAT);attribute.value=new ArrayType(attribute.size*allocCount);logFunctions.onLog({level:LOG_DETAIL_PRIORITY,message:this.id+":"+attributeName+" allocated "+allocCount,id:this.id});attribute.needsAlloc=false;attribute.needsUpdate=true}if(attribute.needsUpdate){this._updateBuffer({attribute:attribute,attributeName:attributeName,numInstances:numInstances,data:data,props:props,context:context})}}this.allocedInstances=allocCount}},{key:"_updateBuffer",value:function _updateBuffer(_ref13){var attribute=_ref13.attribute,attributeName=_ref13.attributeName,numInstances=_ref13.numInstances,data=_ref13.data,props=_ref13.props,context=_ref13.context;var update=attribute.update,accessor=attribute.accessor;if(update){logFunctions.onLog({level:LOG_DETAIL_PRIORITY,message:this.id+":"+attributeName+" updating "+numInstances,id:this.id});update.call(context,attribute,{data:data,props:props,numInstances:numInstances});this._checkAttributeArray(attribute,attributeName)}else if(accessor){this._updateBufferViaStandardAccessor({attribute:attribute,data:data,props:props});this._checkAttributeArray(attribute,attributeName)}else{logFunctions.onLog({level:LOG_DETAIL_PRIORITY,message:this.id+":"+attributeName+" missing update function",id:this.id})}attribute.needsUpdate=false;attribute.changed=true;this.needsRedraw=true}},{key:"_updateBufferViaStandardAccessor",value:function _updateBufferViaStandardAccessor(_ref14){var attribute=_ref14.attribute,data=_ref14.data,props=_ref14.props;var accessor=attribute.accessor,value=attribute.value,size=attribute.size;var accessorFunc=props[accessor];(0,_assert2.default)(typeof accessorFunc==="function",'accessor "'+accessor+'" is not a function');var _attribute$defaultVal=attribute.defaultValue,defaultValue=_attribute$defaultVal===undefined?[0,0,0,0]:_attribute$defaultVal;defaultValue=Array.isArray(defaultValue)?defaultValue:[defaultValue];var i=0;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;var objectValue=accessorFunc(object);objectValue=Array.isArray(objectValue)?objectValue:[objectValue];switch(size){case 4:value[i+3]=Number.isFinite(objectValue[3])?objectValue[3]:defaultValue[3];case 3:value[i+2]=Number.isFinite(objectValue[2])?objectValue[2]:defaultValue[2];case 2:value[i+1]=Number.isFinite(objectValue[1])?objectValue[1]:defaultValue[1];case 1:value[i+0]=Number.isFinite(objectValue[0])?objectValue[0]:defaultValue[0]}i+=size}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"_checkAttributeArray",value:function _checkAttributeArray(attribute,attributeName){var value=attribute.value;if(value&&value.length>=4){var valid=Number.isFinite(value[0])&&Number.isFinite(value[1])&&Number.isFinite(value[2])&&Number.isFinite(value[3]);if(!valid){throw new Error("Illegal attribute generated for "+attributeName)}}}}]);return AttributeManager}();exports.default=AttributeManager},{"./utils":108,assert:1,"luma.gl":195}],92:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _layer=require("./layer");var _layer2=_interopRequireDefault(_layer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CompositeLayer=function(_Layer){_inherits(CompositeLayer,_Layer);function CompositeLayer(props){_classCallCheck(this,CompositeLayer);return _possibleConstructorReturn(this,(CompositeLayer.__proto__||Object.getPrototypeOf(CompositeLayer)).call(this,props))}_createClass(CompositeLayer,[{key:"initializeState",value:function initializeState(){}},{key:"invalidateAttribute",value:function invalidateAttribute(){}},{key:"getPickingInfo",value:function getPickingInfo(_ref){var info=_ref.info;return info}}]);return CompositeLayer}(_layer2.default);exports.default=CompositeLayer},{"./layer":98}],93:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var COORDINATE_SYSTEM=exports.COORDINATE_SYSTEM={LNGLAT:1,LNGLAT_OFFSETS:3,METER_OFFSETS:2,METERS:2,IDENTITY:0}},{}],94:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.drawLayers=drawLayers;exports.pickLayers=pickLayers;var _luma=require("luma.gl");var _viewportUniforms=require("./viewport-uniforms");var _utils=require("./utils");var EMPTY_PIXEL=new Uint8Array(4);var renderCount=0;function drawLayers(_ref){var layers=_ref.layers,pass=_ref.pass;_utils.log.log(3,"DRAWING "+layers.length+" layers");var visibleCount=0;layers.forEach(function(layer,layerIndex){if(layer.props.visible){layer.drawLayer({uniforms:Object.assign({renderPickingBuffer:0,pickingEnabled:0},layer.context.uniforms,(0,_viewportUniforms.getUniformsFromViewport)(layer.context.viewport,layer.props),{layerIndex:layerIndex})});visibleCount++}});_utils.log.log(3,"RENDER PASS "+pass+": "+renderCount+++"\n    "+visibleCount+" visible, "+layers.length+" total")}function pickLayers(gl,_ref2){var layers=_ref2.layers,pickingFBO=_ref2.pickingFBO,_ref2$uniforms=_ref2.uniforms,uniforms=_ref2$uniforms===undefined?{}:_ref2$uniforms,x=_ref2.x,y=_ref2.y,viewport=_ref2.viewport,mode=_ref2.mode,lastPickedInfo=_ref2.lastPickedInfo;var pixelRatio=typeof window!=="undefined"?window.devicePixelRatio:1;var deviceX=x*pixelRatio;var deviceY=gl.canvas.height-y*pixelRatio;var unhandledPickInfos=[];(0,_luma.glContextWithState)(gl,{frameBuffer:pickingFBO,framebuffer:pickingFBO,scissorTest:{x:deviceX,y:deviceY,w:1,h:1}},function(){gl.clear(_luma.GL.COLOR_BUFFER_BIT|_luma.GL.DEPTH_BUFFER_BIT);var oldBlendMode=(0,_utils.getBlendMode)(gl);gl.enable(gl.BLEND);gl.blendFuncSeparate(gl.ONE,gl.ZERO,gl.CONSTANT_ALPHA,gl.ZERO);gl.blendEquation(gl.FUNC_ADD);layers.forEach(function(layer,layerIndex){if(layer.props.visible&&layer.props.pickable){gl.blendColor(0,0,0,(layerIndex+1)/255);layer.drawLayer({uniforms:Object.assign({renderPickingBuffer:1,pickingEnabled:1},layer.context.uniforms,(0,_viewportUniforms.getUniformsFromViewport)(layer.context.viewport,layer.props),{layerIndex:layerIndex})})}});var pickedColor=new Uint8Array(4);gl.readPixels(deviceX,deviceY,1,1,_luma.GL.RGBA,_luma.GL.UNSIGNED_BYTE,pickedColor);(0,_utils.setBlendMode)(gl,oldBlendMode);var pickedLayerIndex=pickedColor[3]-1;var pickedLayer=pickedLayerIndex>=0?layers[pickedLayerIndex]:null;var pickedObjectIndex=pickedLayer?pickedLayer.decodePickingColor(pickedColor):-1;var pickedLayerId=pickedLayer&&pickedLayer.props.id;var affectedLayers=pickedLayer?[pickedLayer]:[];if(mode==="hover"){var lastPickedObjectIndex=lastPickedInfo.index;var lastPickedLayerId=lastPickedInfo.layerId;if(pickedLayerId===lastPickedLayerId&&pickedObjectIndex===lastPickedObjectIndex){return}if(pickedLayerId!==lastPickedLayerId){var lastPickedLayer=layers.find(function(l){return l.props.id===lastPickedLayerId});if(lastPickedLayer){affectedLayers.unshift(lastPickedLayer)}}lastPickedInfo.layerId=pickedLayerId;lastPickedInfo.index=pickedObjectIndex}var baseInfo=createInfo([x,y],viewport);baseInfo.devicePixel=[deviceX,deviceY];baseInfo.pixelRatio=pixelRatio;var infos=new Map;affectedLayers.forEach(function(layer){var info=Object.assign({},baseInfo);if(layer===pickedLayer){info.color=pickedColor;info.index=pickedObjectIndex;info.picked=true}while(layer&&info){var sourceLayer=info.layer||layer;info.layer=layer;info=layer.pickLayer({info:info,mode:mode,sourceLayer:sourceLayer});layer=layer.parentLayer}if(info){infos.set(info.layer.id,info)}});infos.forEach(function(info){var handled=false;switch(mode){case"click":handled=info.layer.props.onClick(info);break;case"hover":handled=info.layer.props.onHover(info);break;default:throw new Error("unknown pick type")}if(!handled){unhandledPickInfos.push(info)}})});return unhandledPickInfos}function createInfo(pixel,viewport){return{color:EMPTY_PIXEL,index:-1,picked:false,x:pixel[0],y:pixel[1],pixel:pixel,lngLat:viewport.unproject(pixel)}}},{"./utils":108,"./viewport-uniforms":110,"luma.gl":195}],95:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.get=exports.LayerManager=exports.AttributeManager=exports.CompositeLayer=exports.Layer=exports.COORDINATE_SYSTEM=undefined;var _constants=require("./constants");Object.defineProperty(exports,"COORDINATE_SYSTEM",{enumerable:true,get:function get(){return _constants.COORDINATE_SYSTEM}});var _layer=require("./layer");Object.defineProperty(exports,"Layer",{enumerable:true,get:function get(){return _interopRequireDefault(_layer).default}});var _compositeLayer=require("./composite-layer");Object.defineProperty(exports,"CompositeLayer",{enumerable:true,get:function get(){return _interopRequireDefault(_compositeLayer).default}});var _attributeManager=require("./attribute-manager");Object.defineProperty(exports,"AttributeManager",{enumerable:true,get:function get(){return _interopRequireDefault(_attributeManager).default}});var _layerManager=require("./layer-manager");Object.defineProperty(exports,"LayerManager",{enumerable:true,get:function get(){return _interopRequireDefault(_layerManager).default}});var _get=require("./utils/get");Object.defineProperty(exports,"get",{enumerable:true,get:function get(){return _get.get}});require("./init");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./attribute-manager":91,"./composite-layer":92,"./constants":93,"./init":96,"./layer":98,"./layer-manager":97,"./utils/get":106}],96:[function(require,module,exports){"use strict";var _globals=require("./utils/globals");var _log=require("./utils/log");var _log2=_interopRequireDefault(_log);var _package=require("../../package.json");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var STARTUP_MESSAGE="set deck.log.priority=2 to trace attribute updates";if(_globals.global.deck&&_globals.global.deck.VERSION!==_package.version){throw new Error("deck.gl - multiple versions detected: "+_globals.global.deck.VERSION+" vs "+_package.version)}if(!_globals.global.deck){console.log("deck.gl "+_package.version+" - "+STARTUP_MESSAGE);_globals.global.deck=_globals.global.deck||{VERSION:_package.version,log:_log2.default}}},{"../../package.json":133,"./utils/globals":107,"./utils/log":109}],97:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _layer=require("./layer");var _layer2=_interopRequireDefault(_layer);var _utils=require("./utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _drawAndPick=require("./draw-and-pick");var _viewports=require("./viewports");var _luma=require("luma.gl");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var LOG_PRIORITY_LIFECYCLE=2;var LOG_PRIORITY_LIFECYCLE_MINOR=3;var LayerManager=function(){function LayerManager(_ref){var gl=_ref.gl;_classCallCheck(this,LayerManager);this.prevLayers=[];this.layers=[];this.screenCleared=false;this.oldContext={};this.context={gl:gl,uniforms:{},viewport:null,viewportChanged:true,pickingFBO:null,lastPickedInfo:{index:-1,layerId:null}};Object.seal(this.context)}_createClass(LayerManager,[{key:"setViewport",value:function setViewport(viewport){(0,_assert2.default)(viewport instanceof _viewports.Viewport,"Invalid viewport");var viewportChanged=true;if(viewportChanged){Object.assign(this.oldContext,this.context);this.context.viewport=viewport;this.context.viewportChanged=true;this.context.uniforms={};(0,_utils.log)(4,viewport)}return this}},{key:"updateLayers",value:function updateLayers(_ref2){var newLayers=_ref2.newLayers;(0,_assert2.default)(this.context.viewport,"LayerManager.updateLayers: viewport not set");newLayers=newLayers.filter(function(newLayer){return newLayer!==null});var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=newLayers[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var layer=_step.value;layer.context=this.context}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.prevLayers=this.layers;var _updateLayers2=this._updateLayers({oldLayers:this.prevLayers,newLayers:newLayers}),error=_updateLayers2.error,generatedLayers=_updateLayers2.generatedLayers;this.layers=generatedLayers;if(error){throw error}return this}},{key:"drawLayers",value:function drawLayers(_ref3){var pass=_ref3.pass;(0,_assert2.default)(this.context.viewport,"LayerManager.drawLayers: viewport not set");(0,_drawAndPick.drawLayers)({layers:this.layers,pass:pass});return this}},{key:"pickLayer",value:function pickLayer(_ref4){var x=_ref4.x,y=_ref4.y,mode=_ref4.mode;var _context=this.context,gl=_context.gl,uniforms=_context.uniforms;if(this.context.pickingFBO===null||gl.canvas.width!==this.context.pickingFBO.width||gl.canvas.height!==this.context.pickingFBO.height){this.context.pickingFBO=new _luma.FramebufferObject(gl,{width:gl.canvas.width,height:gl.canvas.height})}return(0,_drawAndPick.pickLayers)(gl,{x:x,y:y,uniforms:{renderPickingBuffer:true,picking_uEnable:true},layers:this.layers,mode:mode,viewport:this.context.viewport,pickingFBO:this.context.pickingFBO,lastPickedInfo:this.context.lastPickedInfo})}},{key:"needsRedraw",value:function needsRedraw(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref5$clearRedrawFlag=_ref5.clearRedrawFlags,clearRedrawFlags=_ref5$clearRedrawFlag===undefined?false:_ref5$clearRedrawFlag;if(!this.context.viewport){return false}var redraw=false;if(this.layers.length===0){if(this.screenCleared===false){redraw=true;this.screenCleared=true;return true}}else{if(this.screenCleared===true){this.screenCleared=false}}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.layers[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var layer=_step2.value;redraw=redraw||layer.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags})}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return redraw}},{key:"_updateLayers",value:function _updateLayers(_ref6){var oldLayers=_ref6.oldLayers,newLayers=_ref6.newLayers;var oldLayerMap={};var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=oldLayers[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var oldLayer=_step3.value;if(oldLayerMap[oldLayer.id]){_utils.log.once(0,"Multipe old layers with same id "+layerName(oldLayer))}else{oldLayerMap[oldLayer.id]=oldLayer}}}catch(err){
_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}var generatedLayers=[];var error=this._matchSublayers({newLayers:newLayers,oldLayerMap:oldLayerMap,generatedLayers:generatedLayers});var error2=this._finalizeOldLayers(oldLayers);var firstError=error||error2;return{error:firstError,generatedLayers:generatedLayers}}},{key:"_matchSublayers",value:function _matchSublayers(_ref7){var _this=this;var newLayers=_ref7.newLayers,oldLayerMap=_ref7.oldLayerMap,generatedLayers=_ref7.generatedLayers;newLayers=newLayers.filter(function(newLayer){return newLayer!==null});var error=null;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{var _loop=function _loop(){var newLayer=_step4.value;newLayer.context=_this.context;try{var oldLayer=oldLayerMap[newLayer.id];oldLayerMap[newLayer.id]=null;if(oldLayer===null){_utils.log.once(0,"Multipe new layers with same id "+layerName(newLayer))}if(oldLayer){(0,_utils.log)(LOG_PRIORITY_LIFECYCLE_MINOR,"matched "+layerName(newLayer),oldLayer,"=>",newLayer);_this._transferLayerState(oldLayer,newLayer);_this._updateLayer(newLayer)}else{_this._initializeNewLayer(newLayer)}generatedLayers.push(newLayer);var sublayers=newLayer.renderLayers();if(sublayers){sublayers=Array.isArray(sublayers)?sublayers:[sublayers];sublayers.forEach(function(layer){layer.parentLayer=newLayer});_this._matchSublayers({newLayers:sublayers,oldLayerMap:oldLayerMap,generatedLayers:generatedLayers})}}catch(err){_utils.log.once(0,"deck.gl error during matching of "+layerName(newLayer)+" "+err,err);error=error||err}};for(var _iterator4=newLayers[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){_loop()}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}return error}},{key:"_transferLayerState",value:function _transferLayerState(oldLayer,newLayer){var state=oldLayer.state,props=oldLayer.props;(0,_assert2.default)(state,"deck.gl sanity check - Matching layer has no state");(0,_assert2.default)(oldLayer!==newLayer,"deck.gl sanity check - Matching layer is same");newLayer.state=state;newLayer.lifecycle="Matched. State transferred from previous layer";state.layer=newLayer;if(state.model){state.model.userData.layer=newLayer}newLayer.oldProps=props;newLayer.lifecycle="Awaiting garbage collection"}},{key:"_finalizeOldLayers",value:function _finalizeOldLayers(oldLayers){var error=null;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=oldLayers[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var layer=_step5.value;if(layer.state){error=error||this._finalizeLayer(layer)}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}return error}},{key:"_initializeNewLayer",value:function _initializeNewLayer(layer){var error=null;if(!layer.state){(0,_utils.log)(LOG_PRIORITY_LIFECYCLE,"initializing "+layerName(layer));try{layer.initializeLayer({oldProps:{},props:layer.props,oldContext:this.oldContext,context:this.context,changeFlags:layer.diffProps({},layer.props,this.context)});layer.lifecycle="Intialized"}catch(err){_utils.log.once(0,"deck.gl error during initialization of "+layerName(layer)+" "+err,err);error=error||err}if(layer.state){layer.state.layer=layer}if(layer.state&&layer.state.model){layer.state.model.userData.layer=layer}}return error}},{key:"_updateLayer",value:function _updateLayer(layer){var oldProps=layer.oldProps,props=layer.props;var error=null;if(oldProps){try{layer.updateLayer({oldProps:oldProps,props:props,context:this.context,oldContext:this.oldContext,changeFlags:layer.diffProps(oldProps,layer.props,this.context)})}catch(err){_utils.log.once(0,"deck.gl error during update of "+layerName(layer),err);error=err}(0,_utils.log)(LOG_PRIORITY_LIFECYCLE_MINOR,"updating "+layerName(layer))}return error}},{key:"_finalizeLayer",value:function _finalizeLayer(layer){var error=null;var state=layer.state;if(state){try{layer.finalizeLayer()}catch(err){_utils.log.once(0,"deck.gl error during finalization of "+layerName(layer),err);error=err}layer.lifecycle="Finalized! Awaiting garbage collection";(0,_utils.log)(LOG_PRIORITY_LIFECYCLE,"finalizing "+layerName(layer))}return error}}]);return LayerManager}();exports.default=LayerManager;function layerName(layer){if(layer instanceof _layer2.default){return""+layer}return!layer?"null layer":"invalid layer"}},{"./draw-and-pick":94,"./layer":98,"./utils":108,"./viewports":111,assert:1,"luma.gl":195}],98:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TEST_EXPORTS=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _constants=require("./constants");var _attributeManager=require("./attribute-manager");var _attributeManager2=_interopRequireDefault(_attributeManager);var _utils=require("./utils");var _luma=require("luma.gl");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var LOG_PRIORITY_UPDATE=2;var defaultProps={dataComparator:null,numInstances:undefined,visible:true,pickable:false,opacity:.8,onHover:function onHover(){},onClick:function onClick(){},updateTriggers:{},projectionMode:_constants.COORDINATE_SYSTEM.LNGLAT};var counter=0;var Layer=function(){function Layer(props){_classCallCheck(this,Layer);var mergedDefaultProps=getDefaultProps(this);props=Object.assign({},mergedDefaultProps,props);props.data=props.data||[];Object.freeze(props);this.id=props.id;this.props=props;this.oldProps=null;this.state=null;this.context=null;this.parentLayer=null;this.count=counter++;this.lifecycle="Awaiting state";Object.seal(this)}_createClass(Layer,[{key:"toString",value:function toString(){var className=this.constructor.layerName||this.constructor.name;return className!==this.props.id?"<"+className+":'"+this.props.id+"'>":"<"+className+">"}},{key:"initializeState",value:function initializeState(){throw new Error("Layer "+this+" has not defined initializeState")}},{key:"shouldUpdateState",value:function shouldUpdateState(_ref){var oldProps=_ref.oldProps,props=_ref.props,oldContext=_ref.oldContext,context=_ref.context,changeFlags=_ref.changeFlags;return changeFlags.somethingChanged}},{key:"updateState",value:function updateState(_ref2){var oldProps=_ref2.oldProps,props=_ref2.props,oldContext=_ref2.oldContext,context=_ref2.context,changeFlags=_ref2.changeFlags;if(changeFlags.dataChanged){this.invalidateAttribute("all")}}},{key:"finalizeState",value:function finalizeState(){}},{key:"renderLayers",value:function renderLayers(){return null}},{key:"draw",value:function draw(_ref3){var _ref3$uniforms=_ref3.uniforms,uniforms=_ref3$uniforms===undefined?{}:_ref3$uniforms;if(this.state.model){this.state.model.render(uniforms)}}},{key:"getPickingInfo",value:function getPickingInfo(_ref4){var info=_ref4.info,mode=_ref4.mode;var color=info.color,index=info.index;if(index>=0){if(Array.isArray(this.props.data)){info.object=this.props.data[index]}}if(mode==="hover"){var selectedPickingColor=new Float32Array(3);selectedPickingColor[0]=color[0];selectedPickingColor[1]=color[1];selectedPickingColor[2]=color[2];this.setUniforms({selectedPickingColor:selectedPickingColor})}return info}},{key:"invalidateAttribute",value:function invalidateAttribute(){var name=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"all";if(name==="all"){this.state.attributeManager.invalidateAll()}else{this.state.attributeManager.invalidate(name)}}},{key:"updateAttributes",value:function updateAttributes(props){var _state=this.state,attributeManager=_state.attributeManager,model=_state.model;if(!attributeManager){return}var numInstances=this.getNumInstances(props);attributeManager.update({data:props.data,numInstances:numInstances,props:props,buffers:props,context:this,ignoreUnknownAttributes:true});if(model){var changedAttributes=attributeManager.getChangedAttributes({clearChangedFlags:true});model.setAttributes(changedAttributes)}}},{key:"setState",value:function setState(updateObject){Object.assign(this.state,updateObject);this.state.needsRedraw=true}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.state){this.state.needsRedraw=redraw}}},{key:"project",value:function project(lngLat){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(lngLat),"Layer.project needs [lng,lat]");return viewport.project(lngLat)}},{key:"unproject",value:function unproject(xy){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(xy),"Layer.unproject needs [x,y]");return viewport.unproject(xy)}},{key:"projectFlat",value:function projectFlat(lngLat){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(lngLat),"Layer.project needs [lng,lat]");return viewport.projectFlat(lngLat)}},{key:"unprojectFlat",value:function unprojectFlat(xy){var viewport=this.context.viewport;(0,_assert2.default)(Array.isArray(xy),"Layer.unproject needs [x,y]");return viewport.unprojectFlat(xy)}},{key:"screenToDevicePixels",value:function screenToDevicePixels(screenPixels){var devicePixelRatio=typeof window!=="undefined"?window.devicePixelRatio:1;return screenPixels*devicePixelRatio}},{key:"nullPickingColor",value:function nullPickingColor(){return[0,0,0]}},{key:"encodePickingColor",value:function encodePickingColor(i){return[(i+1)%256,Math.floor((i+1)/256)%256,Math.floor((i+1)/256/256)%256]}},{key:"decodePickingColor",value:function decodePickingColor(color){(0,_assert2.default)(color instanceof Uint8Array);var _color=_slicedToArray(color,3),i1=_color[0],i2=_color[1],i3=_color[2];var index=i1+i2*256+i3*65536-1;return index}},{key:"calculateInstancePickingColors",value:function calculateInstancePickingColors(attribute,_ref5){var numInstances=_ref5.numInstances;var value=attribute.value,size=attribute.size;for(var i=0;i<numInstances;i++){var pickingColor=this.encodePickingColor(i);value[i*size+0]=pickingColor[0];value[i*size+1]=pickingColor[1];value[i*size+2]=pickingColor[2]}}},{key:"getFirstObject",value:function getFirstObject(){var data=this.props.data;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;return object}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return null}},{key:"getNumInstances",value:function getNumInstances(props){props=props||this.props;if(this.state&&this.state.numInstances!==undefined){return this.state.numInstances}if(props.numInstances!==undefined){return props.numInstances}var _props=props,data=_props.data;return(0,_utils.count)(data)}},{key:"initializeLayer",value:function initializeLayer(updateParams){(0,_assert2.default)(this.context.gl,"Layer context missing gl");(0,_assert2.default)(!this.state,"Layer missing state");this.state={};this.setState({attributeManager:new _attributeManager2.default({id:this.props.id}),model:null,needsRedraw:true,dataChanged:true});var attributeManager=this.state.attributeManager;attributeManager.addInstanced({instancePickingColors:{type:_luma.GL.UNSIGNED_BYTE,size:3,update:this.calculateInstancePickingColors}});this.initializeState();this.updateState(updateParams);this.updateAttributes(this.props);this._updateBaseUniforms();var model=this.state.model;if(model){model.setInstanceCount(this.getNumInstances());model.id=this.props.id;model.program.id=this.props.id+"-program";model.geometry.id=this.props.id+"-geometry";model.setAttributes(attributeManager.getAttributes())}}},{key:"updateLayer",value:function updateLayer(updateParams){if(this.shouldUpdate){_utils.log.once(0,"deck.gl v3 "+this+': "shouldUpdate" deprecated, renamed to "shouldUpdateState"')}var stateNeedsUpdate=this.shouldUpdateState(updateParams);if(stateNeedsUpdate){this.updateState(updateParams);this.updateAttributes(updateParams.props);this._updateBaseUniforms();if(this.state.model){this.state.model.setInstanceCount(this.getNumInstances())}}}},{key:"finalizeLayer",value:function finalizeLayer(){this.finalizeState()}},{key:"drawLayer",value:function drawLayer(_ref6){var _ref6$uniforms=_ref6.uniforms,uniforms=_ref6$uniforms===undefined?{}:_ref6$uniforms;this.draw({uniforms:uniforms})}},{key:"pickLayer",value:function pickLayer(opts){return this.getPickingInfo(opts)}},{key:"diffProps",value:function diffProps(oldProps,newProps,context){var propsChangedReason=(0,_utils.compareProps)({newProps:newProps,oldProps:oldProps,ignoreProps:{data:null,updateTriggers:null}});var dataChangedReason=this._diffDataProps(oldProps,newProps);var propsChanged=Boolean(propsChangedReason);var dataChanged=Boolean(dataChangedReason);var viewportChanged=context.viewportChanged;var somethingChanged=propsChanged||dataChanged||viewportChanged;if(!dataChanged){this._diffUpdateTriggers(oldProps,newProps)}else{_utils.log.log(2,"dataChanged: "+dataChanged)}return{propsChanged:propsChanged,dataChanged:dataChanged,viewportChanged:viewportChanged,somethingChanged:somethingChanged,reason:dataChangedReason||propsChangedReason}}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref7$clearRedrawFlag=_ref7.clearRedrawFlags,clearRedrawFlags=_ref7$clearRedrawFlag===undefined?false:_ref7$clearRedrawFlag;if(!this.state){return false}var redraw=false;redraw=redraw||this.state.needsRedraw;this.state.needsRedraw=this.state.needsRedraw&&!clearRedrawFlags;var _state2=this.state,attributeManager=_state2.attributeManager,model=_state2.model;redraw=redraw||attributeManager&&attributeManager.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags});redraw=redraw||model&&model.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags});return redraw}},{key:"_diffDataProps",value:function _diffDataProps(oldProps,newProps){var dataComparator=newProps.dataComparator;if(dataComparator){if(!dataComparator(newProps.data,oldProps.data)){return"Data comparator detected a change"}}else if(newProps.data!==oldProps.data){return"A new data container was supplied"}return null}},{key:"_diffUpdateTriggers",value:function _diffUpdateTriggers(oldProps,newProps){var change=false;for(var propName in newProps.updateTriggers){var oldTriggers=oldProps.updateTriggers[propName]||{};var newTriggers=newProps.updateTriggers[propName]||{};var diffReason=(0,_utils.compareProps)({oldProps:oldTriggers,newProps:newTriggers});if(diffReason){if(propName==="all"){_utils.log.log(LOG_PRIORITY_UPDATE,"updateTriggers invalidating all attributes: "+diffReason);this.invalidateAttribute("all");change=true}else{_utils.log.log(LOG_PRIORITY_UPDATE,"updateTriggers invalidating attribute "+propName+": "+diffReason);this.invalidateAttribute(propName);change=true}}}return change}},{key:"_checkRequiredProp",value:function _checkRequiredProp(propertyName,condition){var value=this.props[propertyName];if(value===undefined){throw new Error("Property "+propertyName+" undefined in layer "+this)}if(condition&&!condition(value)){throw new Error("Bad property "+propertyName+" in layer "+this)}}},{key:"_checkRemovedProp",value:function _checkRemovedProp(oldProp){var newProp=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(this.props[oldProp]!==undefined){var layerName=this.constructor;var message=layerName+" no longer accepts props."+oldProp+" in this version of deck.gl.";if(newProp){message+="\nPlease use props."+newProp+" instead."}_utils.log.once(0,message)}}},{key:"_updateBaseUniforms",value:function _updateBaseUniforms(){this.setUniforms({opacity:Math.pow(this.props.opacity,1/2.2),ONE:1})}},{key:"setUniforms",value:function setUniforms(uniformMap){if(this.state.model){this.state.model.setUniforms(uniformMap)}this.state.needsRedraw=true;(0,_utils.log)(3,"layer.setUniforms",uniformMap)}}]);return Layer}();exports.default=Layer;Layer.layerName="Layer";Layer.defaultProps=defaultProps;function getOwnProperty(object,prop){return object.hasOwnProperty(prop)&&object[prop]}function getDefaultProps(layer){var mergedDefaultProps=getOwnProperty(layer.constructor,"mergedDefaultProps");if(mergedDefaultProps){return mergedDefaultProps}return mergeDefaultProps(layer)}function mergeDefaultProps(layer){var subClassConstructor=layer.constructor;var layerName=getOwnProperty(subClassConstructor,"layerName");if(!layerName){_utils.log.once(0,"layer "+layer.constructor.name+' does not specify a "layerName"')}var mergedDefaultProps={id:layerName||layer.constructor.name};while(layer){var layerDefaultProps=getOwnProperty(layer.constructor,"defaultProps");Object.freeze(layerDefaultProps);if(layerDefaultProps){mergedDefaultProps=Object.assign({},layerDefaultProps,mergedDefaultProps)}layer=Object.getPrototypeOf(layer)}subClassConstructor.mergedDefaultProps=mergedDefaultProps;return mergedDefaultProps}var TEST_EXPORTS=exports.TEST_EXPORTS={mergeDefaultProps:mergeDefaultProps}},{"./attribute-manager":91,"./constants":93,"./utils":108,assert:1,"luma.gl":195}],99:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getBlendMode=getBlendMode;exports.setBlendMode=setBlendMode;function getBlendMode(gl){return{enabled:gl.getParameter(gl.BLEND),equationRGB:gl.getParameter(gl.BLEND_EQUATION_RGB),equationAlpha:gl.getParameter(gl.BLEND_EQUATION_ALPHA),srcRGB:gl.getParameter(gl.BLEND_SRC_RGB),dstRGB:gl.getParameter(gl.BLEND_DST_RGB),srcAlpha:gl.getParameter(gl.BLEND_SRC_ALPHA),dstAlpha:gl.getParameter(gl.BLEND_DST_ALPHA)}}function setBlendMode(gl,settings){if(settings.enabled){gl.enable(gl.BLEND)}else{gl.disable(gl.BLEND)}gl.blendEquationSeparate(settings.equationRGB,settings.equationAlpha);gl.blendFuncSeparate(settings.srcRGB,settings.dstRGB,settings.srcAlpha,settings.dstAlpha)}},{}],100:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parseColor=parseColor;exports.parseHexColor=parseHexColor;exports.setOpacity=setOpacity;exports.applyOpacity=applyOpacity;function parseColor(color){if(Array.isArray(color)){if(color.length===3){return[color[0],color[1],color[2],255]}return color}if(typeof color==="string"){return parseHexColor(color)}return null}function parseHexColor(color){var array=new Uint8ClampedArray(4);if(color.length===7){var value=parseInt(color.substring(1),16);array[0]=value/65536;array[1]=value/256%256;array[2]=value%256;array[3]=255}else if(color.length===9){var _value=parseInt(color.substring(1),16);array[0]=_value/16777216;array[1]=_value/65536%256;array[2]=_value/256%256;array[3]=_value%256}return array}function setOpacity(color){var opacity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:127;return[color[0],color[1],color[2],opacity]}function applyOpacity(color){var opacity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:127;return[color[0],color[1],color[2],opacity]}},{}],101:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.compareArrays=compareArrays;exports.checkArray=checkArray;function compareArrays(array1,array2){var length=Math.min(array1.length,array2.length);for(var i=0;i<length;++i){if(array1[i]!==array2[i]){return"Arrays are different in element "+i+": "+array1[i]+" vs "+array2[i]}}if(array1.length!==array2.length){return"Arrays have different length "+array1.length+" vs "+array2.length}return null}function checkArray(array){for(var i=0;i<array.length;++i){if(!Number.isFinite(array[i])){throw new Error("Array has invalid element "+i+": "+array[i])}}return null}},{}],102:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.compareProps=compareProps;exports.areEqualShallow=areEqualShallow;var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function compareProps(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},oldProps=_ref.oldProps,newProps=_ref.newProps,_ref$ignoreProps=_ref.ignoreProps,ignoreProps=_ref$ignoreProps===undefined?{}:_ref$ignoreProps;(0,_assert2.default)(oldProps!==undefined&&newProps!==undefined,"compareProps args");if(oldProps===newProps){return null}if((typeof oldProps==="undefined"?"undefined":_typeof(oldProps))!=="object"||oldProps===null){return"old props is not an object"}if((typeof newProps==="undefined"?"undefined":_typeof(newProps))!=="object"||newProps===null){return"new props is not an object"}for(var key in oldProps){if(!(key in ignoreProps)){if(!newProps.hasOwnProperty(key)){return"prop "+key+" dropped: "+oldProps[key]+" -> (undefined)"}else if(oldProps[key]!==newProps[key]){return"prop "+key+" changed: "+oldProps[key]+" -> "+newProps[key]}}}for(var _key in newProps){if(!(_key in ignoreProps)){if(!oldProps.hasOwnProperty(_key)){return"prop "+_key+" added: (undefined) -> "+newProps[_key]}}}return null}function areEqualShallow(a,b){var _ref2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref2$ignore=_ref2.ignore,ignore=_ref2$ignore===undefined?{}:_ref2$ignore;if(a===b){return true}if((typeof a==="undefined"?"undefined":_typeof(a))!=="object"||a===null||(typeof b==="undefined"?"undefined":_typeof(b))!=="object"||b===null){return false}if(Object.keys(a).length!==Object.keys(b).length){return false}for(var key in a){if(!(key in ignore)&&(!(key in b)||a[key]!==b[key])){return false}}for(var _key2 in b){if(!(_key2 in ignore)&&!(_key2 in a)){return false}}return true}},{assert:1}],103:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.count=count;var ERR_NOT_OBJECT="count(): argument not an object";var ERR_NOT_CONTAINER="count(): argument not a container";function count(container){if(!isObject(container)){throw new Error(ERR_NOT_OBJECT)}if(typeof container.count==="function"){return container.count()}if(Number.isFinite(container.size)){return container.size}if(Number.isFinite(container.length)){return container.length}if(isPlainObject(container)){var counter=0;for(var key in container){counter++}return counter}throw new Error(ERR_NOT_CONTAINER)}function isPlainObject(value){return value!==null&&(typeof value==="undefined"?"undefined":_typeof(value))==="object"&&value.constructor===Object}function isObject(value){return value!==null&&(typeof value==="undefined"?"undefined":_typeof(value))==="object"}},{}],104:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.flatten=flatten;exports.countVertices=countVertices;exports.flattenVertices=flattenVertices;exports.fillArray=fillArray;function flatten(array){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var index=-1;while(++index<array.length){var value=array[index];if(Array.isArray(value)){flatten(value,result)}else{result.push(value)}}return result}function countVertices(nestedArray){var count=0;var index=-1;while(++index<nestedArray.length){var value=nestedArray[index];if(Array.isArray(value)||ArrayBuffer.isView(value)){count+=countVertices(value)}else{count++}}return count}function flattenVertices(nestedArray){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$result=_ref.result,result=_ref$result===undefined?[]:_ref$result,_ref$dimensions=_ref.dimensions,dimensions=_ref$dimensions===undefined?3:_ref$dimensions;var index=-1;var vertexLength=0;while(++index<nestedArray.length){var value=nestedArray[index];if(Array.isArray(value)||ArrayBuffer.isView(value)){flattenVertices(value,{result:result,dimensions:dimensions})}else{if(vertexLength<dimensions){result.push(value);vertexLength++}}}if(vertexLength>0&&vertexLength<dimensions){result.push(0)}return result}function fillArray(_ref2){var target=_ref2.target,source=_ref2.source,_ref2$start=_ref2.start,start=_ref2$start===undefined?0:_ref2$start,_ref2$count=_ref2.count,count=_ref2$count===undefined?1:_ref2$count;var total=count*source.length;var copied=0;for(var i=0;i<source.length;++i){target[start+copied++]=source[i]}while(copied<total){if(copied<total-copied){target.copyWithin(start+copied,start,start+copied);copied*=2}else{target.copyWithin(start+copied,start,start+total-copied);copied=total}}return target}},{}],105:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fp64ify=fp64ify;exports.enable64bitSupport=enable64bitSupport;var _log=require("./log");var _log2=_interopRequireDefault(_log);var _constants=require("../constants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function fp64ify(a){var hiPart=Math.fround(a);var loPart=a-Math.fround(a);return[hiPart,loPart]}function enable64bitSupport(props){if(props.fp64){if(props.projectionMode===_constants.COORDINATE_SYSTEM.LNGLAT){return true}_log2.default.once(0,"64-bit mode only works with projectionMode set to\n      COORDINATE_SYSTEM.LNGLAT. Rendering in 32-bit mode instead")}return false}},{"../constants":93,"./log":109}],106:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.get=get;function get(container,compositeKey){var keyList=getKeys(compositeKey);var value=container;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=keyList[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var key=_step.value;if(!isObject(value)){return undefined}var getter=getGetter(value);value=getter(value,key)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return value}function isObject(value){return value!==null&&(typeof value==="undefined"?"undefined":_typeof(value))==="object"}var squareBracketGetter=function squareBracketGetter(container,key){return container[key]};var getMethodGetter=function getMethodGetter(obj,key){return obj.get(key)};var keyMap={};function getGetter(container){var prototype=Object.getPrototypeOf(container);return prototype.get?getMethodGetter:squareBracketGetter}function getKeys(compositeKey){if(typeof compositeKey==="string"){var keyList=keyMap[compositeKey];if(!keyList){keyList=compositeKey.split(".");keyMap[compositeKey]=keyList}return keyList}return Array.isArray(compositeKey)?compositeKey:[compositeKey]}},{}],107:[function(require,module,exports){(function(global){"use strict";module.exports={window:typeof window!=="undefined"?window:global,global:typeof global!=="undefined"?global:window,document:typeof document!=="undefined"?document:{}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],108:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _log=require("./log");Object.defineProperty(exports,"log",{enumerable:true,get:function get(){return _interopRequireDefault(_log).default}});var _flatten=require("./flatten");Object.defineProperty(exports,"flatten",{enumerable:true,get:function get(){return _flatten.flatten}});Object.defineProperty(exports,"flattenVertices",{enumerable:true,get:function get(){return _flatten.flattenVertices}});Object.defineProperty(exports,"fillArray",{enumerable:true,get:function get(){return _flatten.fillArray}});var _compareObjects=require("./compare-objects");Object.defineProperty(exports,"compareProps",{enumerable:true,get:function get(){return _compareObjects.compareProps}});Object.defineProperty(exports,"areEqualShallow",{enumerable:true,get:function get(){return _compareObjects.areEqualShallow}});var _compareArrays=require("./compare-arrays");Object.defineProperty(exports,"compareArrays",{enumerable:true,get:function get(){return _compareArrays.compareArrays}});Object.defineProperty(exports,"checkArray",{enumerable:true,get:function get(){return _compareArrays.checkArray}});var _fp=require("./fp64");Object.defineProperty(exports,"fp64ify",{enumerable:true,get:function get(){return _fp.fp64ify}});var _color=require("./color");Object.defineProperty(exports,"parseColor",{enumerable:true,get:function get(){return _color.parseColor}});var _blend=require("./blend");Object.defineProperty(exports,"getBlendMode",{enumerable:true,get:function get(){return _blend.getBlendMode}});Object.defineProperty(exports,"setBlendMode",{enumerable:true,get:function get(){return _blend.setBlendMode}});var _get=require("./get");Object.defineProperty(exports,"get",{enumerable:true,get:function get(){return _get.get}});var _count=require("./count");Object.defineProperty(exports,"count",{enumerable:true,get:function get(){return _count.count}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./blend":99,"./color":100,"./compare-arrays":101,"./compare-objects":102,"./count":103,"./flatten":104,"./fp64":105,"./get":106,"./log":109}],109:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function log(priority){(0,_assert2.default)(Number.isFinite(priority),"log priority must be a number");if(priority<=log.priority){
for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}if(console.debug){var _console;(_console=console).debug.apply(_console,args)}else{var _console2;(_console2=console).info.apply(_console2,args)}}}var cache={};function once(priority,arg){if(!cache[arg]&&priority<=log.priority){var _console3;for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){args[_key2-2]=arguments[_key2]}(_console3=console).warn.apply(_console3,[arg].concat(args));cache[arg]=true}}function time(priority,label){(0,_assert2.default)(Number.isFinite(priority),"log priority must be a number");if(priority<=log.priority){if(console.time){console.time(label)}else{console.info(label)}}}function timeEnd(priority,label){(0,_assert2.default)(Number.isFinite(priority),"log priority must be a number");if(priority<=log.priority){if(console.timeEnd){console.timeEnd(label)}else{console.info(label)}}}log.priority=0;log.log=log;log.once=once;log.time=time;log.timeEnd=timeEnd;exports.default=log},{assert:1}],110:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.getUniformsFromViewport=getUniformsFromViewport;var _luma=require("luma.gl");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _constants=require("./constants");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function fp64ify(a){var hiPart=Math.fround(a);var loPart=a-Math.fround(a);return[hiPart,loPart]}var ZERO_VECTOR=[0,0,0,0];var VECTOR_TO_POINT_MATRIX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function calculateMatrixAndOffset(_ref){var projectionMode=_ref.projectionMode,positionOrigin=_ref.positionOrigin,viewport=_ref.viewport,modelMatrix=_ref.modelMatrix;var viewMatrixUncentered=viewport.viewMatrixUncentered,viewMatrix=viewport.viewMatrix,projectionMatrix=viewport.projectionMatrix;var projectionCenter=void 0;var modelViewMatrix=void 0;switch(projectionMode){case _constants.COORDINATE_SYSTEM.IDENTITY:case _constants.COORDINATE_SYSTEM.LNGLAT:projectionCenter=ZERO_VECTOR;modelViewMatrix=new _luma.Matrix4(viewMatrix);break;case _constants.COORDINATE_SYSTEM.METER_OFFSETS:var positionPixels=viewport.projectFlat(positionOrigin);var viewProjectionMatrix=new _luma.Matrix4(projectionMatrix).multiplyRight(viewMatrix);projectionCenter=viewProjectionMatrix.transformVector([positionPixels[0],positionPixels[1],0,1]);modelViewMatrix=new _luma.Matrix4(viewMatrixUncentered||viewMatrix).multiplyRight(VECTOR_TO_POINT_MATRIX);break;default:throw new Error("Unknown projection mode")}var viewMatrixInv=modelViewMatrix.clone().invert();if(modelMatrix){modelViewMatrix.multiplyRight(modelMatrix)}var modelViewProjectionMatrix=new _luma.Matrix4(projectionMatrix).multiplyRight(modelViewMatrix);var cameraPos=[viewMatrixInv[12],viewMatrixInv[13],viewMatrixInv[14]];return{modelViewMatrix:modelViewMatrix,modelViewProjectionMatrix:modelViewProjectionMatrix,projectionCenter:projectionCenter,cameraPos:cameraPos}}function getUniformsFromViewport(viewport){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$modelMatrix=_ref2.modelMatrix,modelMatrix=_ref2$modelMatrix===undefined?null:_ref2$modelMatrix,_ref2$projectionMode=_ref2.projectionMode,projectionMode=_ref2$projectionMode===undefined?_constants.COORDINATE_SYSTEM.LNGLAT:_ref2$projectionMode,_ref2$positionOrigin=_ref2.positionOrigin,positionOrigin=_ref2$positionOrigin===undefined?[0,0]:_ref2$positionOrigin;(0,_assert2.default)(viewport.scale,"Viewport scale missing");var _calculateMatrixAndOf=calculateMatrixAndOffset({projectionMode:projectionMode,positionOrigin:positionOrigin,modelMatrix:modelMatrix,viewport:viewport}),projectionCenter=_calculateMatrixAndOf.projectionCenter,modelViewMatrix=_calculateMatrixAndOf.modelViewMatrix,modelViewProjectionMatrix=_calculateMatrixAndOf.modelViewProjectionMatrix,cameraPos=_calculateMatrixAndOf.cameraPos;(0,_assert2.default)(modelViewProjectionMatrix,"Viewport missing modelViewProjectionMatrix");var projectionPixelsPerUnit=viewport.getDistanceScales().pixelsPerMeter;(0,_assert2.default)(projectionPixelsPerUnit,"Viewport missing pixelsPerMeter");var glProjectionMatrix=new Float32Array(modelViewProjectionMatrix);var glProjectionMatrixFP64=new Float32Array(32);for(var i=0;i<4;++i){for(var j=0;j<4;++j){var _fp64ify=fp64ify(modelViewProjectionMatrix[j*4+i]);var _fp64ify2=_slicedToArray(_fp64ify,2);glProjectionMatrixFP64[(i*4+j)*2]=_fp64ify2[0];glProjectionMatrixFP64[(i*4+j)*2+1]=_fp64ify2[1]}}var devicePixelRatio=window&&window.devicePixelRatio||1;return{projectionMode:projectionMode,projectionCenter:projectionCenter,modelViewMatrix:modelViewMatrix,viewportSize:[viewport.width*devicePixelRatio,viewport.height*devicePixelRatio],devicePixelRatio:devicePixelRatio,projectionMatrix:glProjectionMatrix,projectionMatrixUncentered:glProjectionMatrix,projectionFP64:glProjectionMatrixFP64,projectionPixelsPerUnit:projectionPixelsPerUnit,projectionScale:viewport.scale,projectionScaleFP64:fp64ify(viewport.scale),cameraPos:new Float32Array(cameraPos)}}},{"./constants":93,assert:1,"luma.gl":195}],111:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _viewport=require("./viewport");Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_viewport).default}});Object.defineProperty(exports,"Viewport",{enumerable:true,get:function get(){return _interopRequireDefault(_viewport).default}});var _perspectiveViewport=require("./perspective-viewport");Object.defineProperty(exports,"PerspectiveViewport",{enumerable:true,get:function get(){return _interopRequireDefault(_perspectiveViewport).default}});var _orthographicViewport=require("./orthographic-viewport");Object.defineProperty(exports,"OrthographicViewport",{enumerable:true,get:function get(){return _interopRequireDefault(_orthographicViewport).default}});var _webMercatorViewport=require("./web-mercator-viewport");Object.defineProperty(exports,"WebMercatorViewport",{enumerable:true,get:function get(){return _interopRequireDefault(_webMercatorViewport).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./orthographic-viewport":112,"./perspective-viewport":113,"./viewport":114,"./web-mercator-viewport":115}],112:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _viewport=require("./viewport");var _viewport2=_interopRequireDefault(_viewport);var _glMatrix=require("gl-matrix");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var OrthographicViewport=function(_Viewport){_inherits(OrthographicViewport,_Viewport);function OrthographicViewport(_ref){var width=_ref.width,height=_ref.height,_ref$eye=_ref.eye,eye=_ref$eye===undefined?[0,0,1]:_ref$eye,_ref$lookAt=_ref.lookAt,lookAt=_ref$lookAt===undefined?[0,0,0]:_ref$lookAt,_ref$up=_ref.up,up=_ref$up===undefined?[0,1,0]:_ref$up,_ref$near=_ref.near,near=_ref$near===undefined?1:_ref$near,_ref$far=_ref.far,far=_ref$far===undefined?100:_ref$far,left=_ref.left,top=_ref.top,_ref$right=_ref.right,right=_ref$right===undefined?null:_ref$right,_ref$bottom=_ref.bottom,bottom=_ref$bottom===undefined?null:_ref$bottom;_classCallCheck(this,OrthographicViewport);right=Number.isFinite(right)?right:left+width;bottom=Number.isFinite(bottom)?bottom:top+height;return _possibleConstructorReturn(this,(OrthographicViewport.__proto__||Object.getPrototypeOf(OrthographicViewport)).call(this,{viewMatrix:_glMatrix.mat4.lookAt([],eye,lookAt,up),projectionMatrix:_glMatrix.mat4.ortho([],left,right,bottom,top,near,far),width:width,height:height}))}return OrthographicViewport}(_viewport2.default);exports.default=OrthographicViewport},{"./viewport":114,"gl-matrix":144}],113:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _viewport=require("./viewport");var _viewport2=_interopRequireDefault(_viewport);var _glMatrix=require("gl-matrix");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEGREES_TO_RADIANS=Math.PI/180;var PerspectiveViewport=function(_Viewport){_inherits(PerspectiveViewport,_Viewport);function PerspectiveViewport(_ref){var width=_ref.width,height=_ref.height,eye=_ref.eye,_ref$lookAt=_ref.lookAt,lookAt=_ref$lookAt===undefined?[0,0,0]:_ref$lookAt,_ref$up=_ref.up,up=_ref$up===undefined?[0,1,0]:_ref$up,_ref$fovy=_ref.fovy,fovy=_ref$fovy===undefined?75:_ref$fovy,_ref$near=_ref.near,near=_ref$near===undefined?1:_ref$near,_ref$far=_ref.far,far=_ref$far===undefined?100:_ref$far,_ref$aspect=_ref.aspect,aspect=_ref$aspect===undefined?null:_ref$aspect;_classCallCheck(this,PerspectiveViewport);var fovyRadians=fovy*DEGREES_TO_RADIANS;aspect=Number.isFinite(aspect)?aspect:width/height;return _possibleConstructorReturn(this,(PerspectiveViewport.__proto__||Object.getPrototypeOf(PerspectiveViewport)).call(this,{viewMatrix:_glMatrix.mat4.lookAt([],eye,lookAt,up),projectionMatrix:_glMatrix.mat4.perspective([],fovyRadians,aspect,near,far),width:width,height:height}))}return PerspectiveViewport}(_viewport2.default);exports.default=PerspectiveViewport},{"./viewport":114,"gl-matrix":144}],114:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.createMat4=createMat4;var _glMatrix=require("gl-matrix");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var IDENTITY=createMat4();var ERR_ARGUMENT="Illegal argument to Viewport";var Viewport=function(){function Viewport(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$width=_ref.width,width=_ref$width===undefined?1:_ref$width,_ref$height=_ref.height,height=_ref$height===undefined?1:_ref$height,_ref$viewMatrix=_ref.viewMatrix,viewMatrix=_ref$viewMatrix===undefined?IDENTITY:_ref$viewMatrix,_ref$projectionMatrix=_ref.projectionMatrix,projectionMatrix=_ref$projectionMatrix===undefined?IDENTITY:_ref$projectionMatrix;_classCallCheck(this,Viewport);this.width=width||1;this.height=height||1;this.scale=1;this.viewMatrix=viewMatrix;this.projectionMatrix=projectionMatrix;var vpm=createMat4();_glMatrix.mat4.multiply(vpm,vpm,this.projectionMatrix);_glMatrix.mat4.multiply(vpm,vpm,this.viewMatrix);this.viewProjectionMatrix=vpm;var m=createMat4();_glMatrix.mat4.scale(m,m,[this.width/2,-this.height/2,1]);_glMatrix.mat4.translate(m,m,[1,-1,0]);_glMatrix.mat4.multiply(m,m,this.viewProjectionMatrix);var mInverse=_glMatrix.mat4.invert(createMat4(),m);if(!mInverse){throw new Error("Pixel project matrix not invertible")}this.pixelProjectionMatrix=m;this.pixelUnprojectionMatrix=mInverse;this.equals=this.equals.bind(this);this.project=this.project.bind(this);this.unproject=this.unproject.bind(this);this.projectFlat=this.projectFlat.bind(this);this.unprojectFlat=this.unprojectFlat.bind(this);this.getMatrices=this.getMatrices.bind(this)}_createClass(Viewport,[{key:"equals",value:function equals(viewport){if(!(viewport instanceof Viewport)){return false}return viewport.width===this.width&&viewport.height===this.height&&_glMatrix.mat4.equals(viewport.projectionMatrix,this.projectionMatrix)&&_glMatrix.mat4.equals(viewport.viewMatrix,this.viewMatrix)}},{key:"project",value:function project(xyz){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$topLeft=_ref2.topLeft,topLeft=_ref2$topLeft===undefined?false:_ref2$topLeft;var _xyz=_slicedToArray(xyz,3),x0=_xyz[0],y0=_xyz[1],_xyz$=_xyz[2],z0=_xyz$===undefined?0:_xyz$;(0,_assert2.default)(Number.isFinite(x0)&&Number.isFinite(y0)&&Number.isFinite(z0),ERR_ARGUMENT);var _projectFlat2=this.projectFlat([x0,y0]),_projectFlat3=_slicedToArray(_projectFlat2,2),X=_projectFlat3[0],Y=_projectFlat3[1];var v=this.transformVector(this.pixelProjectionMatrix,[X,Y,z0,1]);var _v=_slicedToArray(v,2),x=_v[0],y=_v[1];var y2=topLeft?this.height-y:y;return xyz.length===2?[x,y2]:[x,y2,0]}},{key:"unproject",value:function unproject(xyz){var _ref3=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref3$topLeft=_ref3.topLeft,topLeft=_ref3$topLeft===undefined?false:_ref3$topLeft;var _xyz2=_slicedToArray(xyz,3),x=_xyz2[0],y=_xyz2[1],_xyz2$=_xyz2[2],targetZ=_xyz2$===undefined?0:_xyz2$;var y2=topLeft?this.height-y:y;var coord0=this.transformVector(this.pixelUnprojectionMatrix,[x,y2,0,1]);var coord1=this.transformVector(this.pixelUnprojectionMatrix,[x,y2,1,1]);var z0=coord0[2];var z1=coord1[2];var t=z0===z1?0:(targetZ-z0)/(z1-z0);var v=_glMatrix.vec2.lerp([],coord0,coord1,t);var vUnprojected=this.unprojectFlat(v);return xyz.length===2?vUnprojected:[vUnprojected[0],vUnprojected[1],0]}},{key:"transformVector",value:function transformVector(matrix,vector){var result=_glMatrix.vec4.transformMat4([0,0,0,0],vector,matrix);var scale=1/result[3];_glMatrix.vec4.multiply(result,result,[scale,scale,scale,scale]);return result}},{key:"projectFlat",value:function projectFlat(_ref4){var _ref5=_slicedToArray(_ref4,2),x=_ref5[0],y=_ref5[1];var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scale;return this._projectFlat.apply(this,arguments)}},{key:"unprojectFlat",value:function unprojectFlat(xyz){var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scale;return this._unprojectFlat.apply(this,arguments)}},{key:"getMatrices",value:function getMatrices(){var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref6$modelMatrix=_ref6.modelMatrix,modelMatrix=_ref6$modelMatrix===undefined?null:_ref6$modelMatrix;var modelViewProjectionMatrix=this.viewProjectionMatrix;var pixelProjectionMatrix=this.pixelProjectionMatrix;var pixelUnprojectionMatrix=this.pixelUnprojectionMatrix;if(modelMatrix){modelViewProjectionMatrix=_glMatrix.mat4.multiply([],this.viewProjectionMatrix,modelMatrix);pixelProjectionMatrix=_glMatrix.mat4.multiply([],this.pixelProjectionMatrix,modelMatrix);pixelUnprojectionMatrix=_glMatrix.mat4.invert([],pixelProjectionMatrix)}var matrices=Object.assign({modelViewProjectionMatrix:modelViewProjectionMatrix,viewProjectionMatrix:this.viewProjectionMatrix,viewMatrix:this.viewMatrix,projectionMatrix:this.projectionMatrix,pixelProjectionMatrix:pixelProjectionMatrix,pixelUnprojectionMatrix:pixelUnprojectionMatrix,width:this.width,height:this.height,scale:this.scale},this._getParams());return matrices}},{key:"getDistanceScales",value:function getDistanceScales(){return{pixelsPerMeter:[1,1,1],metersPerPixel:[1,1,1],pixelsPerDegree:[1,1,1],degreesPerPixel:[1,1,1]}}},{key:"_getParams",value:function _getParams(){return{}}},{key:"_projectFlat",value:function _projectFlat(xyz){var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scale;return xyz}},{key:"_unprojectFlat",value:function _unprojectFlat(xyz){var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scale;return xyz}}]);return Viewport}();exports.default=Viewport;function createMat4(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{assert:1,"gl-matrix":144}],115:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.getFov=getFov;exports.getClippingPlanes=getClippingPlanes;exports.makeProjectionMatrixFromMercatorParams=makeProjectionMatrixFromMercatorParams;var _viewport=require("./viewport");var _viewport2=_interopRequireDefault(_viewport);var _glMatrix=require("gl-matrix");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PI=Math.PI;var PI_4=PI/4;var DEGREES_TO_RADIANS=PI/180;var RADIANS_TO_DEGREES=180/PI;var TILE_SIZE=512;var WORLD_SCALE=TILE_SIZE;var DEFAULT_MAP_STATE={latitude:37,longitude:-122,zoom:11,pitch:0,bearing:0,altitude:1.5};var ERR_ARGUMENT="Illegal argument to WebMercatorViewport";var WebMercatorViewport=function(_Viewport){_inherits(WebMercatorViewport,_Viewport);function WebMercatorViewport(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},width=_ref.width,height=_ref.height,latitude=_ref.latitude,longitude=_ref.longitude,zoom=_ref.zoom,pitch=_ref.pitch,bearing=_ref.bearing,altitude=_ref.altitude,_ref$farZMultiplier=_ref.farZMultiplier,farZMultiplier=_ref$farZMultiplier===undefined?10:_ref$farZMultiplier;_classCallCheck(this,WebMercatorViewport);width=width!==undefined?width:DEFAULT_MAP_STATE.width;height=height!==undefined?height:DEFAULT_MAP_STATE.height;zoom=zoom!==undefined?zoom:DEFAULT_MAP_STATE.zoom;latitude=latitude!==undefined?latitude:DEFAULT_MAP_STATE.latitude;longitude=longitude!==undefined?longitude:DEFAULT_MAP_STATE.longitude;bearing=bearing!==undefined?bearing:DEFAULT_MAP_STATE.bearing;pitch=pitch!==undefined?pitch:DEFAULT_MAP_STATE.pitch;altitude=altitude!==undefined?altitude:DEFAULT_MAP_STATE.altitude;width=width||1;height=height||1;var scale=Math.pow(2,zoom);altitude=Math.max(.75,altitude);var distanceScales=calculateDistanceScales({latitude:latitude,longitude:longitude,scale:scale});var projectionMatrix=makeProjectionMatrixFromMercatorParams({width:width,height:height,pitch:pitch,bearing:bearing,altitude:altitude,farZMultiplier:farZMultiplier});var viewMatrixUncentered=makeUncenteredViewMatrixFromMercatorParams({width:width,height:height,longitude:longitude,latitude:latitude,zoom:zoom,pitch:pitch,bearing:bearing,altitude:altitude,distanceScales:distanceScales});var center=projectFlat([longitude,latitude],scale);var viewMatrix=_glMatrix.mat4.translate((0,_viewport.createMat4)(),viewMatrixUncentered,[-center[0],-center[1],0]);var _this=_possibleConstructorReturn(this,(WebMercatorViewport.__proto__||Object.getPrototypeOf(WebMercatorViewport)).call(this,{width:width,height:height,viewMatrix:viewMatrix,projectionMatrix:projectionMatrix}));_this.latitude=latitude;_this.longitude=longitude;_this.zoom=zoom;_this.pitch=pitch;_this.bearing=bearing;_this.altitude=altitude;_this.scale=scale;_this.center=center;_this.viewMatrixUncentered=viewMatrixUncentered;_this._distanceScales=distanceScales;_this.getDistanceScales=_this.getDistanceScales.bind(_this);_this.metersToLngLatDelta=_this.metersToLngLatDelta.bind(_this);_this.lngLatDeltaToMeters=_this.lngLatDeltaToMeters.bind(_this);_this.addMetersToLngLat=_this.addMetersToLngLat.bind(_this);Object.freeze(_this);return _this}_createClass(WebMercatorViewport,[{key:"_projectFlat",value:function _projectFlat(lngLat){var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scale;return projectFlat(lngLat,scale)}},{key:"_unprojectFlat",value:function _unprojectFlat(xy){var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.scale;return unprojectFlat(xy,scale)}},{key:"getLocationAtPoint",value:function getLocationAtPoint(_ref2){var lngLat=_ref2.lngLat,pos=_ref2.pos;var c=this.project(lngLat,{topLeft:false});var coordCenter=this.project([this.longitude,this.latitude],{topLeft:false});var coordAtPoint=pos;var translate=_glMatrix.vec2.sub([],coordAtPoint,c);var newPos=_glMatrix.vec2.sub([],coordCenter,translate);var newLngLat=this.unproject(newPos,{topLeft:false});return newLngLat}},{key:"getDistanceScales",value:function getDistanceScales(){return this._distanceScales}},{key:"metersToLngLatDelta",value:function metersToLngLatDelta(xyz){var _xyz=_slicedToArray(xyz,3),x=_xyz[0],y=_xyz[1],_xyz$=_xyz[2],z=_xyz$===undefined?0:_xyz$;(0,_assert2.default)(Number.isFinite(x)&&Number.isFinite(y)&&Number.isFinite(z),ERR_ARGUMENT);var _distanceScales=this._distanceScales,pixelsPerMeter=_distanceScales.pixelsPerMeter,degreesPerPixel=_distanceScales.degreesPerPixel;var deltaLng=x*pixelsPerMeter[0]*degreesPerPixel[0];var deltaLat=y*pixelsPerMeter[1]*degreesPerPixel[1];return xyz.length===2?[deltaLng,deltaLat]:[deltaLng,deltaLat,z]}},{key:"lngLatDeltaToMeters",value:function lngLatDeltaToMeters(deltaLngLatZ){var _deltaLngLatZ=_slicedToArray(deltaLngLatZ,3),deltaLng=_deltaLngLatZ[0],deltaLat=_deltaLngLatZ[1],_deltaLngLatZ$=_deltaLngLatZ[2],deltaZ=_deltaLngLatZ$===undefined?0:_deltaLngLatZ$;(0,_assert2.default)(Number.isFinite(deltaLng)&&Number.isFinite(deltaLat)&&Number.isFinite(deltaZ),ERR_ARGUMENT);var _distanceScales2=this._distanceScales,pixelsPerDegree=_distanceScales2.pixelsPerDegree,metersPerPixel=_distanceScales2.metersPerPixel;var deltaX=deltaLng*pixelsPerDegree[0]*metersPerPixel[0];var deltaY=deltaLat*pixelsPerDegree[1]*metersPerPixel[1];return deltaLngLatZ.length===2?[deltaX,deltaY]:[deltaX,deltaY,deltaZ]}},{key:"addMetersToLngLat",value:function addMetersToLngLat(lngLatZ,xyz){var _lngLatZ=_slicedToArray(lngLatZ,3),lng=_lngLatZ[0],lat=_lngLatZ[1],_lngLatZ$=_lngLatZ[2],Z=_lngLatZ$===undefined?0:_lngLatZ$;var _metersToLngLatDelta=this.metersToLngLatDelta(xyz),_metersToLngLatDelta2=_slicedToArray(_metersToLngLatDelta,3),deltaLng=_metersToLngLatDelta2[0],deltaLat=_metersToLngLatDelta2[1],_metersToLngLatDelta3=_metersToLngLatDelta2[2],deltaZ=_metersToLngLatDelta3===undefined?0:_metersToLngLatDelta3;return lngLatZ.length===2?[lng+deltaLng,lat+deltaLat]:[lng+deltaLng,lat+deltaLat,Z+deltaZ]}},{key:"_getParams",value:function _getParams(){return this._distanceScales}}]);return WebMercatorViewport}(_viewport2.default);exports.default=WebMercatorViewport;function projectFlat(_ref3,scale){var _ref4=_slicedToArray(_ref3,2),lng=_ref4[0],lat=_ref4[1];scale=scale*WORLD_SCALE;var lambda2=lng*DEGREES_TO_RADIANS;var phi2=lat*DEGREES_TO_RADIANS;var x=scale*(lambda2+PI)/(2*PI);var y=scale*(PI-Math.log(Math.tan(PI_4+phi2*.5)))/(2*PI);return[x,y]}function unprojectFlat(_ref5,scale){var _ref6=_slicedToArray(_ref5,2),x=_ref6[0],y=_ref6[1];scale=scale*WORLD_SCALE;var lambda2=x/scale*(2*PI)-PI;var phi2=2*(Math.atan(Math.exp(PI-y/scale*(2*PI)))-PI_4);return[lambda2*RADIANS_TO_DEGREES,phi2*RADIANS_TO_DEGREES]}function calculateDistanceScales(_ref7){var latitude=_ref7.latitude,longitude=_ref7.longitude,scale=_ref7.scale;(0,_assert2.default)(!isNaN(latitude)&&!isNaN(longitude)&&!isNaN(scale),ERR_ARGUMENT);var METERS_PER_DEGREE=111e3;var latCosine=Math.cos(latitude*Math.PI/180);var metersPerDegree=METERS_PER_DEGREE*latCosine;var pixelsPerDegreeX=_glMatrix.vec2.distance(projectFlat([longitude+.5,latitude],scale),projectFlat([longitude-.5,latitude],scale));var pixelsPerDegreeY=_glMatrix.vec2.distance(projectFlat([longitude,latitude+.5],scale),projectFlat([longitude,latitude-.5],scale));var pixelsPerMeterX=pixelsPerDegreeX/metersPerDegree;var pixelsPerMeterY=pixelsPerDegreeY/metersPerDegree;var pixelsPerMeterZ=(pixelsPerMeterX+pixelsPerMeterY)/2;var worldSize=TILE_SIZE*scale;var altPixelsPerMeter=worldSize/(4e7*latCosine);var pixelsPerMeter=[altPixelsPerMeter,altPixelsPerMeter,altPixelsPerMeter];var metersPerPixel=[1/altPixelsPerMeter,1/altPixelsPerMeter,1/pixelsPerMeterZ];var pixelsPerDegree=[pixelsPerDegreeX,pixelsPerDegreeY,pixelsPerMeterZ];var degreesPerPixel=[1/pixelsPerDegreeX,1/pixelsPerDegreeY,1/pixelsPerMeterZ];return{pixelsPerMeter:pixelsPerMeter,metersPerPixel:metersPerPixel,pixelsPerDegree:pixelsPerDegree,degreesPerPixel:degreesPerPixel}}function getFov(_ref8){var height=_ref8.height,altitude=_ref8.altitude;return 2*Math.atan(height/2/altitude)}function getClippingPlanes(_ref9){var altitude=_ref9.altitude,pitch=_ref9.pitch;var pitchRadians=pitch*DEGREES_TO_RADIANS;var halfFov=Math.atan(.5/altitude);var topHalfSurfaceDistance=Math.sin(halfFov)*altitude/Math.sin(Math.PI/2-pitchRadians-halfFov);var farZ=Math.cos(Math.PI/2-pitchRadians)*topHalfSurfaceDistance+altitude;return{farZ:farZ,nearZ:.1}}function makeProjectionMatrixFromMercatorParams(_ref10){var width=_ref10.width,height=_ref10.height,pitch=_ref10.pitch,altitude=_ref10.altitude,_ref10$farZMultiplier=_ref10.farZMultiplier,farZMultiplier=_ref10$farZMultiplier===undefined?10:_ref10$farZMultiplier;var _getClippingPlanes=getClippingPlanes({altitude:altitude,pitch:pitch}),nearZ=_getClippingPlanes.nearZ,farZ=_getClippingPlanes.farZ;var fov=getFov({height:height,altitude:altitude});var projectionMatrix=_glMatrix.mat4.perspective((0,_viewport.createMat4)(),fov,width/height,nearZ,farZ*farZMultiplier);return projectionMatrix}function makeUncenteredViewMatrixFromMercatorParams(_ref11){var width=_ref11.width,height=_ref11.height,longitude=_ref11.longitude,latitude=_ref11.latitude,zoom=_ref11.zoom,pitch=_ref11.pitch,bearing=_ref11.bearing,altitude=_ref11.altitude,center=_ref11.center;var vm=(0,_viewport.createMat4)();_glMatrix.mat4.translate(vm,vm,[0,0,-altitude]);_glMatrix.mat4.scale(vm,vm,[1,-1,1/height]);_glMatrix.mat4.rotateX(vm,vm,pitch*DEGREES_TO_RADIANS);_glMatrix.mat4.rotateZ(vm,vm,-bearing*DEGREES_TO_RADIANS);return vm}},{"./viewport":114,assert:1,"gl-matrix":144}],116:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=autobind;var PREDEFINED=["constructor","render","componentWillMount","componentDidMount","componentWillReceiveProps","shouldComponentUpdate","componentWillUpdate","componentDidUpdate","componentWillUnmount"];function autobind(obj){var proto=Object.getPrototypeOf(obj);var propNames=Object.getOwnPropertyNames(proto);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{var _loop=function _loop(){var key=_step.value;if(typeof obj[key]==="function"){if(!PREDEFINED.find(function(name){return key===name})){obj[key]=obj[key].bind(obj)}}};for(var _iterator=propNames[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_loop()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{}],117:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _autobind=require("./autobind");var _autobind2=_interopRequireDefault(_autobind);var _webglRenderer=require("./webgl-renderer");var _webglRenderer2=_interopRequireDefault(_webglRenderer);var _lib=require("../lib")
;var _experimental=require("../experimental");var _luma=require("luma.gl");var _viewports=require("../lib/viewports");var _utils=require("../lib/utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function noop(){}var propTypes={id:_react.PropTypes.string,width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,layers:_react.PropTypes.arrayOf(_react.PropTypes.instanceOf(_lib.Layer)).isRequired,effects:_react.PropTypes.arrayOf(_react.PropTypes.instanceOf(_experimental.Effect)),gl:_react.PropTypes.object,debug:_react.PropTypes.bool,viewport:_react.PropTypes.instanceOf(_viewports.Viewport),onWebGLInitialized:_react.PropTypes.func,onLayerClick:_react.PropTypes.func,onLayerHover:_react.PropTypes.func,onAfterRender:_react.PropTypes.func};var defaultProps={id:"deckgl-overlay",debug:false,gl:null,effects:[],onWebGLInitialized:noop,onLayerClick:noop,onLayerHover:noop,onAfterRender:noop};var DeckGL=function(_React$Component){_inherits(DeckGL,_React$Component);function DeckGL(props){_classCallCheck(this,DeckGL);var _this=_possibleConstructorReturn(this,(DeckGL.__proto__||Object.getPrototypeOf(DeckGL)).call(this,props));_this.state={};_this.needsRedraw=true;_this.layerManager=null;_this.effectManager=null;(0,_autobind2.default)(_this);return _this}_createClass(DeckGL,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){this._updateLayers(nextProps)}},{key:"_updateLayers",value:function _updateLayers(nextProps){var width=nextProps.width,height=nextProps.height,latitude=nextProps.latitude,longitude=nextProps.longitude,zoom=nextProps.zoom,pitch=nextProps.pitch,bearing=nextProps.bearing,altitude=nextProps.altitude;var viewport=nextProps.viewport;viewport=viewport||new _viewports.WebMercatorViewport({width:width,height:height,latitude:latitude,longitude:longitude,zoom:zoom,pitch:pitch,bearing:bearing,altitude:altitude});if(this.layerManager){this.layerManager.setViewport(viewport).updateLayers({newLayers:nextProps.layers})}}},{key:"_onRendererInitialized",value:function _onRendererInitialized(_ref){var gl=_ref.gl,canvas=_ref.canvas;gl.enable(_luma.GL.BLEND);gl.blendFunc(_luma.GL.SRC_ALPHA,_luma.GL.ONE_MINUS_SRC_ALPHA);this.props.onWebGLInitialized(gl);this.layerManager=new _lib.LayerManager({gl:gl});this.effectManager=new _experimental.EffectManager({gl:gl,layerManager:this.layerManager});var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.props.effects[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var effect=_step.value;this.effectManager.addEffect(effect)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this._updateLayers(this.props);var hasEvent=this.props.onLayerClick!==noop||this.props.onLayerHover!==noop;var hasPickableLayer=this.layerManager.layers.map(function(l){return l.props.pickable}).includes(true);if(this.layerManager.layers.length&&hasEvent&&!hasPickableLayer){_utils.log.once(0,"You have supplied a mouse event handler but none of your layers got the `pickable` flag.")}this.events=(0,_luma.addEvents)(canvas,{cacheSize:false,cachePosition:false,centerOrigin:false,onClick:this._onClick,onMouseMove:this._onMouseMove})}},{key:"_onClick",value:function _onClick(event){if(!event||!event.event||!Number.isFinite(event.event.offsetX)){return}var _event$event=event.event,x=_event$event.offsetX,y=_event$event.offsetY;var selectedInfos=this.layerManager.pickLayer({x:x,y:y,mode:"click"});if(selectedInfos.length){var firstInfo=selectedInfos.find(function(info){return info.index>=0});this.props.onLayerClick(firstInfo,selectedInfos,event.event)}}},{key:"_onMouseMove",value:function _onMouseMove(event){if(!event||!event.event||!Number.isFinite(event.event.offsetX)){return}var _event$event2=event.event,x=_event$event2.offsetX,y=_event$event2.offsetY;var selectedInfos=this.layerManager.pickLayer({x:x,y:y,mode:"hover"});if(selectedInfos.length){var firstInfo=selectedInfos.find(function(info){return info.index>=0});this.props.onLayerHover(firstInfo,selectedInfos,event.event)}}},{key:"_onRenderFrame",value:function _onRenderFrame(_ref2){var gl=_ref2.gl;var redraw=this.layerManager.needsRedraw({clearRedrawFlags:true});if(!redraw){return}gl.clear(_luma.GL.COLOR_BUFFER_BIT|_luma.GL.DEPTH_BUFFER_BIT);this.effectManager.preDraw();this.layerManager.drawLayers({pass:"primary"});this.effectManager.draw()}},{key:"render",value:function render(){var _props=this.props,width=_props.width,height=_props.height,gl=_props.gl,debug=_props.debug;return(0,_react.createElement)(_webglRenderer2.default,Object.assign({},this.props,{width:width,height:height,gl:gl,debug:debug,viewport:{x:0,y:0,width:width,height:height},onRendererInitialized:this._onRendererInitialized,onNeedRedraw:this._onNeedRedraw,onRenderFrame:this._onRenderFrame,onMouseMove:this._onMouseMove,onClick:this._onClick}))}}]);return DeckGL}(_react2.default.Component);exports.default=DeckGL;DeckGL.propTypes=propTypes;DeckGL.defaultProps=defaultProps},{"../experimental":28,"../lib":95,"../lib/utils":108,"../lib/viewports":111,"./autobind":116,"./webgl-renderer":118,"luma.gl":195,react:297}],118:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _autobind=require("./autobind");var _autobind2=_interopRequireDefault(_autobind);var _luma=require("luma.gl");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_PIXEL_RATIO=typeof window!=="undefined"&&window.devicePixelRatio||1;var propTypes={id:_react.PropTypes.string.isRequired,width:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,style:_react.PropTypes.object,pixelRatio:_react.PropTypes.number,viewport:_react.PropTypes.object.isRequired,events:_react.PropTypes.object,gl:_react.PropTypes.object,glOptions:_react.PropTypes.object,debug:_react.PropTypes.bool,onInitializationFailed:_react.PropTypes.func,onRendererInitialized:_react.PropTypes.func.isRequired,onRenderFrame:_react.PropTypes.func,onMouseMove:_react.PropTypes.func,onClick:_react.PropTypes.func};var defaultProps={style:{},gl:null,glOptions:{preserveDrawingBuffer:true},debug:false,pixelRatio:DEFAULT_PIXEL_RATIO,onInitializationFailed:function onInitializationFailed(error){throw error},onRendererInitialized:function onRendererInitialized(){},onRenderFrame:function onRenderFrame(){}};var WebGLRenderer=function(_React$Component){_inherits(WebGLRenderer,_React$Component);function WebGLRenderer(props){_classCallCheck(this,WebGLRenderer);var _this=_possibleConstructorReturn(this,(WebGLRenderer.__proto__||Object.getPrototypeOf(WebGLRenderer)).call(this,props));_this.state={};_this._animationFrame=null;_this.gl=null;(0,_autobind2.default)(_this);return _this}_createClass(WebGLRenderer,[{key:"componentDidMount",value:function componentDidMount(){var canvas=this.refs.overlay;this._initWebGL(canvas);this._animationLoop()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._cancelAnimationLoop()}},{key:"_initWebGL",value:function _initWebGL(canvas){var _props=this.props,debug=_props.debug,glOptions=_props.glOptions;var gl=this.props.gl;if(!gl){try{gl=(0,_luma.createGLContext)(Object.assign({canvas:canvas,debug:debug},glOptions))}catch(error){this.props.onInitializationFailed(error);return}}this.gl=gl;this.props.onRendererInitialized({canvas:canvas,gl:gl})}},{key:"_animationLoop",value:function _animationLoop(){this._renderFrame();if(typeof window!=="undefined"){this._animationFrame=requestAnimationFrame(this._animationLoop)}}},{key:"_cancelAnimationLoop",value:function _cancelAnimationLoop(){if(this._animationFrame){cancelAnimationFrame(this._animationFrame)}}},{key:"_updateGLViewport",value:function _updateGLViewport(){var _props$viewport=this.props.viewport,x=_props$viewport.x,y=_props$viewport.y,w=_props$viewport.width,h=_props$viewport.height;var dpr=this.props.pixelRatio;var gl=this.gl;x=x*dpr;y=y*dpr;w=w*dpr;h=h*dpr;if(x!==this.x||y!==this.y||w!==this.w||h!==this.h){gl.viewport(x,y,w,h);this.x=x;this.y=y;this.w=w;this.h=h}}},{key:"_renderFrame",value:function _renderFrame(){var _props$viewport2=this.props.viewport,width=_props$viewport2.width,height=_props$viewport2.height;var gl=this.gl;if(!gl||!(width>0)||!(height>0)){return}this._updateGLViewport();this.props.onRenderFrame({gl:gl});this.props.onAfterRender(this.refs.overlay)}},{key:"render",value:function render(){var _props2=this.props,id=_props2.id,width=_props2.width,height=_props2.height,pixelRatio=_props2.pixelRatio,style=_props2.style;return(0,_react.createElement)("canvas",{ref:"overlay",key:"overlay",id:id,width:width*pixelRatio,height:height*pixelRatio,style:Object.assign({},style,{width:width,height:height})})}}]);return WebGLRenderer}(_react2.default.Component);exports.default=WebGLRenderer;WebGLRenderer.propTypes=propTypes;WebGLRenderer.defaultProps=defaultProps},{"./autobind":116,"luma.gl":195,react:297}],119:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkRendererVendor=checkRendererVendor;exports.getPlatformShaderDefines=getPlatformShaderDefines;exports.assembleShaders=assembleShaders;var _luma=require("luma.gl");var _shaderChunks=require("./shader-chunks");var SHADER_CHUNKS=_interopRequireWildcard(_shaderChunks);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function checkRendererVendor(debugInfo,gpuVendor){var vendor=debugInfo.vendor,renderer=debugInfo.renderer;var result=void 0;switch(gpuVendor){case"nvidia":result=vendor.match(/NVIDIA/i)||renderer.match(/NVIDIA/i);break;case"intel":result=vendor.match(/INTEL/i)||renderer.match(/INTEL/i);break;case"amd":result=vendor.match(/AMD/i)||renderer.match(/AMD/i)||vendor.match(/ATI/i)||renderer.match(/ATI/i);break;default:result=false}return result}function getPlatformShaderDefines(gl){var platformDefines="";var debugInfo=(0,_luma.glGetDebugInfo)(gl);if(checkRendererVendor(debugInfo,"nvidia")){platformDefines+="#define NVIDIA_GPU\n#define NVIDIA_FP64_WORKAROUND 1\n#define NVIDIA_EQUATION_WORKAROUND 1\n"}else if(checkRendererVendor(debugInfo,"intel")){platformDefines+="#define INTEL_GPU\n#define INTEL_FP64_WORKAROUND 1\n#define NVIDIA_EQUATION_WORKAROUND 1\n #define INTEL_TAN_WORKAROUND 1\n"}else if(checkRendererVendor(debugInfo,"amd")){platformDefines+="#define AMD_GPU\n"}else{platformDefines+="#define DEFAULT_GPU\n"}return platformDefines}function assembleShader(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _opts=opts,vs=_opts.vs,_opts$project=_opts.project,project=_opts$project===undefined?true:_opts$project,_opts$project2=_opts.project64,project64=_opts$project2===undefined?false:_opts$project2;var _opts2=opts,_opts2$fp=_opts2.fp64,fp64=_opts2$fp===undefined?false:_opts2$fp;if(project64===true){fp64=true}var source=getPlatformShaderDefines(gl)+"\n";opts=Object.assign({},opts,{project:project,project64:project64,fp64:fp64});var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.keys(SHADER_CHUNKS)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var chunkName=_step.value;if(opts[chunkName]){source+=SHADER_CHUNKS[chunkName].source+"\n"}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=(opts.modules||[])[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _chunkName=_step2.value;if(SHADER_CHUNKS[_chunkName]){source+=SHADER_CHUNKS[_chunkName].source+"\n"}else{throw new Error("Shader module "+_chunkName+" not found")}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}source+=vs;return source}function assembleShaders(gl,opts){return{gl:gl,vs:assembleShader(gl,opts),fs:opts.fs}}},{"./shader-chunks":121,"luma.gl":195}],120:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assembleShaders=require("./assemble-shaders");Object.keys(_assembleShaders).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _assembleShaders[key]}})});var _shaderChunks=require("./shader-chunks");Object.keys(_shaderChunks).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _shaderChunks[key]}})})},{"./assemble-shaders":119,"./shader-chunks":121}],121:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _fp=require("../shaderlib/fp64");Object.keys(_fp).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _fp[key]}})});var _project=require("../shaderlib/project");Object.keys(_project).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _project[key]}})});var _project2=require("../shaderlib/project64");Object.keys(_project2).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _project2[key]}})});var _lighting=require("../shaderlib/lighting");Object.keys(_lighting).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _lighting[key]}})})},{"../shaderlib/fp64":122,"../shaderlib/lighting":124,"../shaderlib/project":126,"../shaderlib/project64":128}],122:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fp64=undefined;var _mathFp=require("./math-fp64.glsl");var _mathFp2=_interopRequireDefault(_mathFp);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var fp64=exports.fp64={interface:"fp64",source:_mathFp2.default}},{"./math-fp64.glsl":123}],123:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})
;exports.default="uniform float ONE;\n\nconst vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);\nconst vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);\nconst vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);\nconst vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);\nconst vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);\nconst vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);\nconst vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);\nconst vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);\nconst vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);\nconst vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);\n\nconst vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);\nconst vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);\nconst vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);\nconst vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);\n\nconst vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);\nconst vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);\nconst vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);\nconst vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);\n\nconst vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09); // 1/3!\nconst vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09); // 1/4!\nconst vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10); // 1/5!\nconst vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11); // 1/6!\nconst vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12); // 1/7!\nconst vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13); // 1/8!\nconst vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14); // 1/9!\nconst vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15); // 1/10!\n\nfloat nint(float d) {\n    if (d == floor(d)) return d;\n    return floor(d + 0.5);\n}\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n  return vec2(a_hi, a_lo);\n}\n#else\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n  return vec2(a_hi, a_lo);\n}\n#endif\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\nvec2 quickTwoSum(float a, float b) {\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n  return vec2(sum, err);\n}\n#else\nvec2 quickTwoSum(float a, float b) {\n  float sum = a + b;\n  float err = b - (sum - a);\n  return vec2(sum, err);\n}\n#endif\n\nvec2 nint_fp64(vec2 a) {\n    float hi = nint(a.x);\n    float lo;\n    vec2 tmp;\n    if (hi == a.x) {\n        lo = nint(a.y);\n        tmp = quickTwoSum(hi, lo);\n    } else {\n        lo = 0.0;\n        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {\n            hi -= 1.0;\n        }\n        tmp = vec2(hi, lo);\n    }\n    return tmp;\n}\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n\n/* The purpose of this workaround is to prevent compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' from.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be one only at the runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n  return vec2(s, err);\n}\n#else\nvec2 twoSum(float a, float b) {\n  float s = a + b;\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n  return vec2(s, err);\n}\n#endif\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n/* Same thing as in twoSum() */\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n  return vec2(s, err);\n}\n#else\nvec2 twoSub(float a, float b) {\n  float s = a - b;\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n  return vec2(s, err);\n}\n#endif\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n  return vec2(prod, err);\n}\n#else\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n  return vec2(prod, err);\n}\n#endif\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n  prod.y += a.y * b.x;\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n  vec2 yn = a * xn;\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n  return sum_fp64(vec2(yn, 0.0), prod);\n}\n\n/* k_power controls how much range reduction we would like to have\nRange reduction uses the following method:\nassume a = k_power * r + m * log(2), k and m being integers.\nSet k_power = 4 (we can choose other k to trade accuracy with performance.\nwe only need to calculate exp(r) and using exp(a) = 2^m * exp(r)^k_power;\n*/\n\nvec2 exp_fp64(vec2 a) {\n  // We need to make sure these two numbers match\n  // as bit-wise shift is not available in GLSL 1.0\n  const int k_power = 4;\n  const float k = 16.0;\n\n  const float inv_k = 1.0 / k;\n\n  if (a.x <= -88.0) return vec2(0.0, 0.0);\n  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);\n  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);\n  if (a.x == 1.0 && a.y == 0.0) return E_FP64;\n\n  float m = floor(a.x / LOG2_FP64.x + 0.5);\n  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;\n  vec2 s, t, p;\n\n  p = mul_fp64(r, r);\n  s = sum_fp64(r, p * 0.5);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);\n\n  // s = sum_fp64(s, t);\n  // p = mul_fp64(p, r);\n  // t = mul_fp64(p, INVERSE_FACTORIAL_6_FP64);\n\n  // s = sum_fp64(s, t);\n  // p = mul_fp64(p, r);\n  // t = mul_fp64(p, INVERSE_FACTORIAL_7_FP64);\n\n  s = sum_fp64(s, t);\n\n\n  // At this point, s = exp(r) - 1; but after following 4 recursions, we will get exp(r) ^ 512 - 1.\n  for (int i = 0; i < k_power; i++) {\n    s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  }\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = sum_fp64(s, vec2(ONE, 0.0));\n#else\n  s = sum_fp64(s, vec2(1.0, 0.0));\n#endif\n\n  return s * pow(2.0, m);\n//   return r;\n}\n\nvec2 log_fp64(vec2 a)\n{\n  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n  vec2 x = vec2(log(a.x), 0.0);\n  vec2 s;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = vec2(ONE, 0.0);\n#else\n  s = vec2(1.0, 0.0);\n#endif\n\n  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);\n  return x;\n}\n\nvec2 sin_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(0.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  s = a;\n  r = a;\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);\n  s = sum_fp64(s, t);\n\n  /* keep the following commented code in case we need them\n  for extra accuracy from the Taylor expansion*/\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_7_FP64);\n  // s = sum_fp64(s, t);\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_9_FP64);\n  // s = sum_fp64(s, t);\n\n  return s;\n}\n\nvec2 cos_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(1.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  r = x;\n  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);\n  s = sum_fp64(s, t);\n\n  /* keep the following commented code in case we need them\n  for extra accuracy from the Taylor expansion*/\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_8_FP64);\n  // s = sum_fp64(s, t);\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_10_FP64);\n  // s = sum_fp64(s, t);\n\n  return s;\n}\n\nvoid sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {\n  if (a.x == 0.0 && a.y == 0.0) {\n    sin_t = vec2(0.0, 0.0);\n    cos_t = vec2(1.0, 0.0);\n  }\n\n  sin_t = sin_taylor_fp64(a);\n  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));\n}\n\nvec2 sin_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return sin_taylor_fp64(t);\n        } else if (j == 1) {\n            return cos_taylor_fp64(t);\n        } else if (j == -1) {\n            return -cos_taylor_fp64(t);\n        } else {\n            return -sin_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 cos_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(1.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return cos_taylor_fp64(t);\n        } else if (j == 1) {\n            return -sin_taylor_fp64(t);\n        } else if (j == -1) {\n            return sin_taylor_fp64(t);\n        } else {\n            return -cos_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 tan_fp64(vec2 a) {\n    vec2 sin_a;\n    vec2 cos_a;\n\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    // We just can't get PI/16 * 3.0 very accurately.\n    // so let's just store it\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n    vec2 sin_t, cos_t;\n    vec2 s, c;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#else\n        if (abs_k == 1) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs_k == 2) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs_k == 3) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs_k == 4) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#endif\n        if (k > 0) {\n            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return div_fp64(sin_a, cos_a);\n}\n\nvec2 radians_fp64(vec2 degree) {\n  return mul_fp64(degree, PI_180_FP64);\n}\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\n// Vector functions\n// vec2 functions\nvoid vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sum_fp64(a[0], b[0]);\n    out_val[1] = sum_fp64(a[1], b[1]);\n}\n\nvoid vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sub_fp64(a[0], b[0]);\n    out_val[1] = sub_fp64(a[1], b[1]);\n}\n\nvoid vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = mul_fp64(a[0], b[0]);\n    out_val[1] = mul_fp64(a[1], b[1]);\n}\n\nvoid vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = div_fp64(a[0], b[0]);\n    out_val[1] = div_fp64(a[1], b[1]);\n}\n\nvoid vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {\n  vec2 range[2];\n  vec2_sub_fp64(y, x, range);\n  vec2 portion[2];\n  portion[0] = range[0] * a;\n  portion[1] = range[1] * a;\n  vec2_sum_fp64(x, portion, out_val);\n}\n\nvec2 vec2_length_fp64(vec2 x[2]) {\n  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));\n}\n\nvoid vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {\n  vec2 length = vec2_length_fp64(x);\n  vec2 length_vec2[2];\n  length_vec2[0] = length;\n  length_vec2[1] = length;\n\n  vec2_div_fp64(x, length_vec2, out_val);\n}\n\nvec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {\n  vec2 diff[2];\n  vec2_sub_fp64(x, y, diff);\n  return vec2_length_fp64(diff);\n}\n\nvec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {\n  vec2 v[2];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n\n  return sum_fp64(v[0], v[1]);\n}\n\n// vec3 functions\nvoid vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvec2 vec3_length_fp64(vec2 x[3]) {\n  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),\n    mul_fp64(x[2], x[2])));\n}\n\nvec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {\n  vec2 diff[3];\n  vec3_sub_fp64(x, y, diff);\n  return vec3_length_fp64(diff);\n}\n\n// vec4 functions\nvoid vec4_fp64(vec4 a, out vec2 out_val[4]) {\n  out_val[0].x = a[0];\n  out_val[0].y = 0.0;\n\n  out_val[1].x = a[1];\n  out_val[1].y = 0.0;\n\n  out_val[2].x = a[2];\n  out_val[2].y = 0.0;\n\n  out_val[3].x = a[3];\n  out_val[3].y = 0.0;\n}\n\nvoid vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {\n  out_val[0] = mul_fp64(a[0], b);\n  out_val[1] = mul_fp64(a[1], b);\n  out_val[2] = mul_fp64(a[2], b);\n  out_val[3] = mul_fp64(a[3], b);\n}\n\nvoid vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {\n  for (int i = 0; i < 4; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {\n  vec2 v[4];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n  v[2] = mul_fp64(a[2], b[2]);\n  v[3] = mul_fp64(a[3], b[3]);\n\n  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));\n}\n\nvoid mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {\n  vec2 tmp[4];\n\n  for (int i = 0; i < 4; i++)\n  {\n    for (int j = 0; j < 4; j++)\n    {\n      tmp[j] = b[j + i * 4];\n    }\n    vec4_dot_fp64(a, tmp, out_val[i]);\n  }\n}\n"},{}],124:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.lighting=undefined;var _lighting=require("./lighting.glsl");var _lighting2=_interopRequireDefault(_lighting);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var lighting=exports.lighting={interface:"lighting",source:_lighting2.default}},{"./lighting.glsl":125}],125:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="#define NUM_OF_LIGHTS 2\nuniform vec3 cameraPos;\nuniform vec3 lightsPosition[16];\nuniform vec2 lightsStrength[16];\nuniform float ambientRatio;\nuniform float diffuseRatio;\nuniform float specularRatio;\n\nfloat getLightWeight(vec4 position_worldspace, vec3 normals_worldspace) {\n  float lightWeight = 0.0;\n\n  vec3 position_worldspace_vec3 = position_worldspace.xyz / position_worldspace.w;\n  vec3 normals_worldspace_vec3 = normals_worldspace.xzy;\n\n  vec3 camera_pos_worldspace = cameraPos;\n  vec3 view_direction = normalize(camera_pos_worldspace - position_worldspace_vec3);\n\n  for (int i = 0; i < NUM_OF_LIGHTS; i++) {\n    vec3 light_position_worldspace = project_position(lightsPosition[i]);\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace_vec3);\n\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normals_worldspace_vec3);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normals_worldspace_vec3, halfway_direction), 0.0);\n      specular = pow(specular_angle, 32.0);\n    }\n    lambertian = max(lambertian, 0.0);\n    lightWeight += (ambientRatio + lambertian * diffuseRatio + specular * specularRatio) *\n      lightsStrength[i].x;\n\n  }\n\n  return lightWeight;\n}\n"},{}],126:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.project=undefined;var _project=require("./project.glsl");var _project2=_interopRequireDefault(_project);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var project=exports.project={interface:"project",source:_project2.default}},{"./project.glsl":127}],127:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})
;exports.default="const float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\n\n// ref: lib/constants.js\nconst float PROJECT_IDENTITY = 0.;\nconst float PROJECT_MERCATOR = 1.;\nconst float PROJECT_MERCATOR_OFFSETS = 2.;\n\nuniform float projectionMode;\nuniform float projectionScale;\nuniform vec4 projectionCenter;\nuniform vec3 projectionPixelsPerUnit;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 projectionMatrixUncentered;\n\n#ifdef INTEL_TAN_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 0.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 0.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef INTEL_TAN_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n\n//\n// Scaling offsets\n//\n\nfloat project_scale(float meters) {\n  if (projectionMode == PROJECT_MERCATOR_OFFSETS) {\n    return meters;\n  } else {\n    return meters * projectionPixelsPerUnit.x;\n  }\n}\n\nvec2 project_scale(vec2 meters) {\n  if (projectionMode == PROJECT_MERCATOR_OFFSETS) {\n    return meters;\n  } else {\n    return vec2(\n      meters.x * projectionPixelsPerUnit.x,\n      meters.y * projectionPixelsPerUnit.x\n    );\n  }\n}\n\nvec3 project_scale(vec3 meters) {\n  if (projectionMode == PROJECT_MERCATOR_OFFSETS) {\n    return meters;\n  } else {\n    return vec3(\n      meters.x * projectionPixelsPerUnit.x,\n      meters.y * projectionPixelsPerUnit.x,\n      meters.z * projectionPixelsPerUnit.x\n    );\n  }\n}\n\nvec4 project_scale(vec4 meters) {\n  if (projectionMode == PROJECT_MERCATOR_OFFSETS) {\n    return meters;\n  } else {\n    return vec4(\n      meters.x * projectionPixelsPerUnit.x,\n      meters.y * projectionPixelsPerUnit.x,\n      meters.z * projectionPixelsPerUnit.x,\n      meters.w\n    );\n  }\n}\n\n//\n// Projecting positions\n//\n\n// non-linear projection: lnglats => unit tile [0-1, 0-1]\nvec2 project_mercator_(vec2 lnglat) {\n  return vec2(\n    radians(lnglat.x) + PI,\n    PI - log(tan_fp32(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nvec2 project_position(vec2 position) {\n  if (projectionMode == PROJECT_IDENTITY) {\n    return position;\n  }\n  if (projectionMode == PROJECT_MERCATOR_OFFSETS) {\n    return position;\n    return project_scale(position);\n  }\n  // Covers projectionMode == PROJECT_MERCATOR\n  return project_mercator_(position) * WORLD_SCALE * projectionScale;\n}\n\nvec3 project_position(vec3 position) {\n  return vec3(project_position(position.xy), project_scale(position.z));\n}\n\nvec4 project_position(vec4 position) {\n  return vec4(project_position(position.xyz), position.w);\n}\n\n//\n\nvec4 project_to_viewspace(vec4 position) {\n  return modelViewMatrix * position;\n}\n\nvec4 project_to_clipspace(vec4 position) {\n  if (projectionMode == PROJECT_MERCATOR_OFFSETS) {\n    position = position * projectionPixelsPerUnit.x;\n  }\n  return projectionMatrix * position + projectionCenter;\n}\n\n// Backwards compatibility\n\nfloat scale(float position) {\n  return project_scale(position);\n}\n\nvec2 scale(vec2 position) {\n  return project_scale(position);\n}\n\nvec3 scale(vec3 position) {\n  return project_scale(position);\n}\n\nvec4 scale(vec4 position) {\n  return project_scale(position);\n}\n\nvec2 preproject(vec2 position) {\n  return project_position(position);\n}\n\nvec3 preproject(vec3 position) {\n  return project_position(position);\n}\n\nvec4 preproject(vec4 position) {\n  return project_position(position);\n}\n\nvec4 project(vec4 position) {\n  return project_to_clipspace(position);\n}\n"},{}],128:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.project64=undefined;var _project=require("./project64.glsl");var _project2=_interopRequireDefault(_project);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var project64=exports.project64={interface:"project64",source:_project2.default}},{"./project64.glsl":129}],129:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="\nconst vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);\n\nuniform vec2 projectionScaleFP64;\nuniform vec2 projectionFP64[16];\n\n// longitude: lnglat_fp64.xy; latitude: lnglat_fp64.zw\nvoid mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {\n\n#if defined(NVIDIA_FP64_WORKAROUND)\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);\n#else\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);\n#endif\n  out_val[1] = sub_fp64(PI_FP64,\n    log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));\n  return;\n}\n\nvoid project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {\n\n  vec2 pos_fp64[2];\n  mercatorProject_fp64(position_fp64, pos_fp64);\n  vec2 x_fp64 = mul_fp64(pos_fp64[0], projectionScaleFP64);\n  vec2 y_fp64 = mul_fp64(pos_fp64[1], projectionScaleFP64);\n  out_val[0] = mul_fp64(x_fp64, WORLD_SCALE_FP64);\n  out_val[1] = mul_fp64(y_fp64, WORLD_SCALE_FP64);\n\n  return;\n}\n\nvec4 project_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  vec2 vertex_pos_clipspace[4];\n  mat4_vec4_mul_fp64(projectionFP64, vertex_pos_modelspace, vertex_pos_clipspace);\n  return vec4(\n    vertex_pos_clipspace[0].x,\n    vertex_pos_clipspace[1].x,\n    vertex_pos_clipspace[2].x,\n    vertex_pos_clipspace[3].x\n    );\n}\n"},{}],130:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var BinSorter=function(){function BinSorter(bins){_classCallCheck(this,BinSorter);this.sortedBins=this.getSortedCounts(bins)}_createClass(BinSorter,[{key:"getSortedCounts",value:function getSortedCounts(bins){return bins.map(function(h,i){return{i:i,counts:h.points.length}}).sort(function(a,b){return a.counts-b.counts})}},{key:"getCountRange",value:function getCountRange(_ref){var _ref2=_slicedToArray(_ref,2),lower=_ref2[0],upper=_ref2[1];var len=this.sortedBins.length;var lowerIdx=Math.ceil(lower/100*(len-1));var upperIdx=Math.floor(upper/100*(len-1));return[this.sortedBins[lowerIdx].counts,this.sortedBins[upperIdx].counts]}},{key:"getMaxCount",value:function getMaxCount(){return this.sortedBins.length&&this.sortedBins[this.sortedBins.length-1].counts}}]);return BinSorter}();exports.default=BinSorter},{}],131:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var defaultColorRange=exports.defaultColorRange=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]]},{}],132:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.linearScale=linearScale;exports.quantizeScale=quantizeScale;exports.clamp=clamp;function linearScale(domain,range,value){return(value-domain[0])/(domain[1]-domain[0])*(range[1]-range[0])+range[0]}function quantizeScale(domain,range,value){var step=(domain[1]-domain[0])/range.length;var idx=Math.floor((value-domain[0])/step);var clampIdx=Math.max(Math.min(idx,range.length-1),0);return range[clampIdx]}function clamp(_ref,value){var _ref2=_slicedToArray(_ref,2),min=_ref2[0],max=_ref2[1];return Math.min(max,Math.max(min,value))}},{}],133:[function(require,module,exports){module.exports={name:"deck.gl",description:"A suite of 3D-enabled data visualization overlays, suitable for react-map-gl",license:"MIT",version:"4.0.0",keywords:["webgl","visualization","overlay","layer"],repository:{type:"git",url:"https://github.com/uber/deck.gl.git"},main:"dist/index.js",module:"dist-es6/index.js",files:["dist","dist-es6","src"],scripts:{start:"(cd examples/layer-browser && (path-exists node_modules || npm i) && npm run start-local)","build-clean":"rm -fr dist dist-es6 && mkdir -p dist dist-es6","build-es6":"rm -fr dist-es6 && babel src --out-dir dist-es6 --plugins=static-fs --source-maps inline","build-es5":"rm -fr dist && babel src --out-dir dist --plugins=static-fs,transform-es2015-modules-commonjs --source-maps inline","build-buble":"buble dist-es6 -o dist --no modules --y dangerousForOf --objectAssign",build:"npm run build-clean && npm run build-es6 && npm run build-es5 && webpack -d --display-modules",lint:"eslint src test examples && npm run lint-yarn","lint-yarn":"!(find . -name yarn.lock -exec grep -l unpm.u {} \\; | egrep '.*')","publish-prod":"npm run build && npm run test && npm run test-dist && npm publish","publish-beta":"npm run build && npm run test && npm run test-dist && npm publish --tag beta",test:"npm run lint && npm run test-node","test-node":"node test/node.js","test-dist":"node test/node-dist.js","test-browser":"webpack-dev-server --config webpack.config.test-browser.js --progress --hot --open --port 3010",bench:"node test/bench/node.js","bench-browser":"webpack-dev-server --config webpack.config.bench-browser.js --progress --hot --open --port 3011","test-fp64":"(cd test/fp64-test && webpack-dev-server --config webpack.config.test-fp64.js --progress --hot --open)","test-rendering":"(cd test/rendering-test && webpack-dev-server --config webpack.config.test-rendering.js --progress --hot --open)"},dependencies:{"d3-hexbin":"^0.2.1",earcut:"^2.0.6","gl-matrix":"^2.3.2","lodash.flattendeep":"^4.4.0"},devDependencies:{"babel-cli":"^6.22.2","babel-core":"^6.22.1","babel-loader":"^6.2.10","babel-plugin-static-fs":"^1.1.0","babel-plugin-transform-es2015-modules-commonjs":"^6.22.0","babel-polyfill":"^6.20.0","babel-preset-es2015":"^6.4.3",benchmark:"^2.1.3","brfs-babel":"^1.0.0",buble:"^0.15.1","buble-loader":"^0.4.0",colorbrewer:"^1.0.0",eslint:"^3.0.0","eslint-config-uber-es2015":"^3.0.0","eslint-config-uber-jsx":"^3.0.0","eslint-plugin-react":"~6.7.0",faucet:"0.0.1","file-loader":"^0.10.1",gl:"^4.0.3",immutable:"^3.8.1","luma.gl":"^3.0.0","module-alias":"^2.0.0","path-exists-cli":"^1.0.0","pre-commit":"^1.2.2","raw-loader":"^0.5.1",react:"^15.4.0","react-addons-test-utils":"^15.4.2","react-dom":"^15.4.0",reify:"^0.4.4","tap-browser-color":"^0.1.2",tape:"^4.5.1","tape-catch":"^1.0.4","transform-loader":"^0.2.3","uglify-js":"^2.6.1","url-loader":"^0.5.7",webpack:"^2.2.0","webpack-dev-server":"^2.2.0"},peerDependencies:{"luma.gl":"^3.0.0",react:"0.14.x - 15.x","react-dom":"0.14.x - 15.x"},babel:{presets:[["es2015",{modules:false}]]}}},{}],134:[function(require,module,exports){var pSlice=Array.prototype.slice;var objectKeys=require("./lib/keys.js");var isArguments=require("./lib/is_arguments.js");var deepEqual=module.exports=function(actual,expected,opts){if(!opts)opts={};if(actual===expected){return true}else if(actual instanceof Date&&expected instanceof Date){return actual.getTime()===expected.getTime()}else if(!actual||!expected||typeof actual!="object"&&typeof expected!="object"){return opts.strict?actual===expected:actual==expected}else{return objEquiv(actual,expected,opts)}};function isUndefinedOrNull(value){return value===null||value===undefined}function isBuffer(x){if(!x||typeof x!=="object"||typeof x.length!=="number")return false;if(typeof x.copy!=="function"||typeof x.slice!=="function"){return false}if(x.length>0&&typeof x[0]!=="number")return false;return true}function objEquiv(a,b,opts){var i,key;if(isUndefinedOrNull(a)||isUndefinedOrNull(b))return false;if(a.prototype!==b.prototype)return false;if(isArguments(a)){if(!isArguments(b)){return false}a=pSlice.call(a);b=pSlice.call(b);return deepEqual(a,b,opts)}if(isBuffer(a)){if(!isBuffer(b)){return false}if(a.length!==b.length)return false;for(i=0;i<a.length;i++){if(a[i]!==b[i])return false}return true}try{var ka=objectKeys(a),kb=objectKeys(b)}catch(e){return false}if(ka.length!=kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!deepEqual(a[key],b[key],opts))return false}return typeof a===typeof b}},{"./lib/is_arguments.js":135,"./lib/keys.js":136}],135:[function(require,module,exports){var supportsArgumentsClass=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";exports=module.exports=supportsArgumentsClass?supported:unsupported;exports.supported=supported;function supported(object){return Object.prototype.toString.call(object)=="[object Arguments]"}exports.unsupported=unsupported;function unsupported(object){return object&&typeof object=="object"&&typeof object.length=="number"&&Object.prototype.hasOwnProperty.call(object,"callee")&&!Object.prototype.propertyIsEnumerable.call(object,"callee")||false}},{}],136:[function(require,module,exports){exports=module.exports=typeof Object.keys==="function"?Object.keys:shim;exports.shim=shim;function shim(obj){var keys=[];for(var key in obj)keys.push(key);return keys}},{}],137:[function(require,module,exports){"use strict";module.exports=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,size;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}size=Math.max(maxX-minX,maxY-minY)}earcutLinked(outerNode,triangles,dim,minX,minY,size);return triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0){for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last)}else{for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last)}if(last&&equals(last,last.next)){removeNode(last);last=last.next}return last}function filterPoints(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next)return null;again=true}else{p=p.next}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,size,pass){if(!ear)return;if(!pass&&size)indexCurve(ear,minX,minY,size);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(size?isEarHashed(ear,minX,minY,size):isEar(ear)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);removeNode(ear);ear=next.next;stop=next.next;continue}ear=next;if(ear===stop){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,size,1)}else if(pass===1){ear=cureLocalIntersections(ear,triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,size,2)}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,size)}break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next}return true}function isEarHashed(ear,minX,minY,size){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y;var minZ=zOrder(minTX,minTY,minX,minY,size),maxZ=zOrder(maxTX,maxTY,minX,minY,size);var p=ear.nextZ;while(p&&p.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.nextZ}p=ear.prevZ;while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ}return true}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);removeNode(p);removeNode(p.next);p=start=b}p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,size){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,size);earcutLinked(c,triangles,dim,minX,minY,size);return}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(getLeftmost(list))}queue.sort(compareX);for(i=0;i<queue.length;i++){eliminateHole(queue[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next)}return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){outerNode=findHoleBridge(hole,outerNode);if(outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m.next;while(p!==stop){if(hx>=p.x&&p.x>=mx&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if((tan<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)){m=p;tanMin=tan}}p=p.next}return m}function indexCurve(start,minX,minY,size){var p=start;do{if(p.z===null)p.z=zOrder(p.x,p.y,minX,minY,size);p.prevZ=p.prev;p.nextZ=p.next;p=p.next}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize===0){e=q;q=q.nextZ;qSize--}else if(qSize===0||!q){e=p;p=p.nextZ;pSize--}else if(p.z<=q.z){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,size){x=32767*(x-minX)/size;y=32767*(y-minY)/size;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x)leftmost=p;p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){if(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))return true;return area(p1,q1,p2)>0!==area(p1,q1,q2)>0&&area(p2,q2,p1)>0!==area(p2,q2,q1)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next}while(p!==a);return false}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)inside=!inside;p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p}return p}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ}function Node(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length;var outerLen=hasHoles?holeIndices[0]*dim:data.length;var polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles){for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim;var end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim;var b=triangles[i+1]*dim;var c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/polygonArea)};function signedArea(data,start,end,dim){var sum=0;for(var i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i}return sum}earcut.flatten=function(data){var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0;for(var i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++){for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d])}if(i>0){holeIndex+=data[i-1].length;result.holes.push(holeIndex)}}return result}},{}],138:[function(require,module,exports){"use strict";function makeEmptyFunction(arg){return function(){return arg}}var emptyFunction=function emptyFunction(){};emptyFunction.thatReturns=makeEmptyFunction;emptyFunction.thatReturnsFalse=makeEmptyFunction(false);emptyFunction.thatReturnsTrue=makeEmptyFunction(true);emptyFunction.thatReturnsNull=makeEmptyFunction(null);emptyFunction.thatReturnsThis=function(){return this};emptyFunction.thatReturnsArgument=function(arg){return arg};module.exports=emptyFunction},{}],139:[function(require,module,exports){(function(process){"use strict";var emptyObject={};if(process.env.NODE_ENV!=="production"){Object.freeze(emptyObject)}module.exports=emptyObject}).call(this,require("_process"))},{_process:252}],140:[function(require,module,exports){(function(process){"use strict";var validateFormat=function validateFormat(format){};if(process.env.NODE_ENV!=="production"){validateFormat=function validateFormat(format){if(format===undefined){throw new Error("invariant requires an error message argument")}}}function invariant(condition,format,a,b,c,d,e,f){validateFormat(format);if(!condition){var error;if(format===undefined){error=new Error("Minified exception occurred; use the non-minified dev environment "+"for the full error message and additional helpful warnings.")}else{var args=[a,b,c,d,e,f];var argIndex=0;error=new Error(format.replace(/%s/g,function(){return args[argIndex++]}));error.name="Invariant Violation"}error.framesToPop=1;throw error}}module.exports=invariant}).call(this,require("_process"))},{_process:252}],141:[function(require,module,exports){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty;function is(x,y){if(x===y){return x!==0||y!==0||1/x===1/y}else{return x!==x&&y!==y}}function shallowEqual(objA,objB){if(is(objA,objB)){return true}if(typeof objA!=="object"||objA===null||typeof objB!=="object"||objB===null){return false}var keysA=Object.keys(objA);var keysB=Object.keys(objB);if(keysA.length!==keysB.length){return false}for(var i=0;i<keysA.length;i++){if(!hasOwnProperty.call(objB,keysA[i])||!is(objA[keysA[i]],objB[keysA[i]])){return false}}return true}module.exports=shallowEqual},{}],142:[function(require,module,exports){(function(process){"use strict";var emptyFunction=require("./emptyFunction");var warning=emptyFunction;if(process.env.NODE_ENV!=="production"){(function(){var printWarning=function printWarning(format){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}var argIndex=0;var message="Warning: "+format.replace(/%s/g,function(){return args[argIndex++]});if(typeof console!=="undefined"){console.error(message)}try{throw new Error(message)}catch(x){}};warning=function warning(condition,format){if(format===undefined){throw new Error("`warning(condition, format, ...args)` requires a warning "+"message argument")}if(format.indexOf("Failed Composite propType: ")===0){return}if(!condition){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){args[_key2-2]=arguments[_key2]}printWarning.apply(undefined,[format].concat(args))}}})()}module.exports=warning}).call(this,require("_process"))},{"./emptyFunction":138,_process:252}],143:[function(require,module,exports){module.exports={ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALPHA:6406,ALPHA_BITS:3413,ALWAYS:519,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATTACHED_SHADERS:35717,BACK:1029,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BROWSER_DEFAULT_WEBGL:37444,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,COMPILE_STATUS:35713,COMPRESSED_TEXTURE_FORMATS:34467,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_LOST_WEBGL:37442,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH_ATTACHMENT:36096,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DONT_CARE:4352,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,FASTEST:4353,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,
GREATER:516,GREEN_BITS:3411,HIGH_FLOAT:36338,HIGH_INT:36341,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE_ALPHA:6410,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_RENDERBUFFER_SIZE:34024,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIRRORED_REPEAT:33648,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NUM_COMPRESSED_TEXTURE_FORMATS:34466,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,RED_BITS:3410,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,REPEAT:10497,REPLACE:7681,RGB:6407,RGB5_A1:32855,RGB565:36194,RGBA:6408,RGBA4:32854,SAMPLER_2D:35678,SAMPLER_CUBE:35680,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SHADER_COMPILER:36346,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_CLEAR_VALUE:2961,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,TEXTURE_2D:3553,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,UNPACK_ALIGNMENT:3317,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VIEWPORT:2978,ZERO:0}},{}],144:[function(require,module,exports){exports.glMatrix=require("./gl-matrix/common.js");exports.mat2=require("./gl-matrix/mat2.js");exports.mat2d=require("./gl-matrix/mat2d.js");exports.mat3=require("./gl-matrix/mat3.js");exports.mat4=require("./gl-matrix/mat4.js");exports.quat=require("./gl-matrix/quat.js");exports.vec2=require("./gl-matrix/vec2.js");exports.vec3=require("./gl-matrix/vec3.js");exports.vec4=require("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":145,"./gl-matrix/mat2.js":146,"./gl-matrix/mat2d.js":147,"./gl-matrix/mat3.js":148,"./gl-matrix/mat4.js":149,"./gl-matrix/quat.js":150,"./gl-matrix/vec2.js":151,"./gl-matrix/vec3.js":152,"./gl-matrix/vec4.js":153}],145:[function(require,module,exports){var glMatrix={};glMatrix.EPSILON=1e-6;glMatrix.ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;glMatrix.RANDOM=Math.random;glMatrix.ENABLE_SIMD=false;glMatrix.SIMD_AVAILABLE=glMatrix.ARRAY_TYPE===Float32Array&&"SIMD"in this;glMatrix.USE_SIMD=glMatrix.ENABLE_SIMD&&glMatrix.SIMD_AVAILABLE;glMatrix.setMatrixArrayType=function(type){glMatrix.ARRAY_TYPE=type};var degree=Math.PI/180;glMatrix.toRadian=function(a){return a*degree};glMatrix.equals=function(a,b){return Math.abs(a-b)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};module.exports=glMatrix},{}],146:[function(require,module,exports){var glMatrix=require("./common.js");var mat2={};mat2.create=function(){var out=new glMatrix.ARRAY_TYPE(4);out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.clone=function(a){var out=new glMatrix.ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.fromValues=function(m00,m01,m10,m11){var out=new glMatrix.ARRAY_TYPE(4);out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out};mat2.set=function(out,m00,m01,m10,m11){out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out};mat2.transpose=function(out,a){if(out===a){var a1=a[1];out[1]=a[2];out[2]=a1}else{out[0]=a[0];out[1]=a[2];out[2]=a[1];out[3]=a[3]}return out};mat2.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],det=a0*a3-a2*a1;if(!det){return null}det=1/det;out[0]=a3*det;out[1]=-a1*det;out[2]=-a2*det;out[3]=a0*det;return out};mat2.adjoint=function(out,a){var a0=a[0];out[0]=a[3];out[1]=-a[1];out[2]=-a[2];out[3]=a0;return out};mat2.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};mat2.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;return out};mat2.mul=mat2.multiply;mat2.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;return out};mat2.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;return out};mat2.fromRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;return out};mat2.fromScaling=function(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];return out};mat2.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};mat2.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};mat2.LDU=function(L,D,U,a){L[2]=a[2]/a[0];U[0]=a[0];U[1]=a[1];U[3]=a[3]-L[2]*U[1];return[L,D,U]};mat2.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out};mat2.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out};mat2.sub=mat2.subtract;mat2.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};mat2.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))};mat2.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out};mat2.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out};module.exports=mat2},{"./common.js":145}],147:[function(require,module,exports){var glMatrix=require("./common.js");var mat2d={};mat2d.create=function(){var out=new glMatrix.ARRAY_TYPE(6);out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.clone=function(a){var out=new glMatrix.ARRAY_TYPE(6);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.fromValues=function(a,b,c,d,tx,ty){var out=new glMatrix.ARRAY_TYPE(6);out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out};mat2d.set=function(out,a,b,c,d,tx,ty){out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out};mat2d.invert=function(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5];var det=aa*ad-ab*ac;if(!det){return null}det=1/det;out[0]=ad*det;out[1]=-ab*det;out[2]=-ac*det;out[3]=aa*det;out[4]=(ac*aty-ad*atx)*det;out[5]=(ab*atx-aa*aty)*det;return out};mat2d.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};mat2d.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;out[4]=a0*b4+a2*b5+a4;out[5]=a1*b4+a3*b5+a5;return out};mat2d.mul=mat2d.multiply;mat2d.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;out[4]=a4;out[5]=a5;return out};mat2d.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;out[4]=a4;out[5]=a5;return out};mat2d.translate=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];out[0]=a0;out[1]=a1;out[2]=a2;out[3]=a3;out[4]=a0*v0+a2*v1+a4;out[5]=a1*v0+a3*v1+a5;return out};mat2d.fromRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;out[4]=0;out[5]=0;return out};mat2d.fromScaling=function(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];out[4]=0;out[5]=0;return out};mat2d.fromTranslation=function(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=v[0];out[5]=v[1];return out};mat2d.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};mat2d.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};mat2d.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];return out};mat2d.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];return out};mat2d.sub=mat2d.subtract;mat2d.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;return out};mat2d.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;return out};mat2d.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]};mat2d.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))};module.exports=mat2d},{"./common.js":145}],148:[function(require,module,exports){var glMatrix=require("./common.js");var mat3={};mat3.create=function(){var out=new glMatrix.ARRAY_TYPE(9);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromMat4=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return out};mat3.clone=function(a){var out=new glMatrix.ARRAY_TYPE(9);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.fromValues=function(m00,m01,m02,m10,m11,m12,m20,m21,m22){var out=new glMatrix.ARRAY_TYPE(9);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out};mat3.set=function(out,m00,m01,m02,m10,m11,m12,m20,m21,m22){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out};mat3.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3];out[2]=a[6];out[3]=a01;out[5]=a[7];out[6]=a02;out[7]=a12}else{out[0]=a[0];out[1]=a[3];out[2]=a[6];out[3]=a[1];out[4]=a[4];out[5]=a[7];out[6]=a[2];out[7]=a[5];out[8]=a[8]}return out};mat3.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;if(!det){return null}det=1/det;out[0]=b01*det;out[1]=(-a22*a01+a02*a21)*det;out[2]=(a12*a01-a02*a11)*det;out[3]=b11*det;out[4]=(a22*a00-a02*a20)*det;out[5]=(-a12*a00+a02*a10)*det;out[6]=b21*det;out[7]=(-a21*a00+a01*a20)*det;out[8]=(a11*a00-a01*a10)*det;return out};mat3.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];out[0]=a11*a22-a12*a21;out[1]=a02*a21-a01*a22;out[2]=a01*a12-a02*a11;out[3]=a12*a20-a10*a22;out[4]=a00*a22-a02*a20;out[5]=a02*a10-a00*a12;out[6]=a10*a21-a11*a20;out[7]=a01*a20-a00*a21;out[8]=a00*a11-a01*a10;return out};mat3.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)};mat3.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];out[0]=b00*a00+b01*a10+b02*a20;out[1]=b00*a01+b01*a11+b02*a21;out[2]=b00*a02+b01*a12+b02*a22;out[3]=b10*a00+b11*a10+b12*a20;out[4]=b10*a01+b11*a11+b12*a21;out[5]=b10*a02+b11*a12+b12*a22;out[6]=b20*a00+b21*a10+b22*a20;out[7]=b20*a01+b21*a11+b22*a21;out[8]=b20*a02+b21*a12+b22*a22;return out};mat3.mul=mat3.multiply;mat3.translate=function(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a10;out[4]=a11;out[5]=a12;out[6]=x*a00+y*a10+a20;out[7]=x*a01+y*a11+a21;out[8]=x*a02+y*a12+a22;return out};mat3.rotate=function(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);out[0]=c*a00+s*a10;out[1]=c*a01+s*a11;out[2]=c*a02+s*a12;out[3]=c*a10-s*a00;out[4]=c*a11-s*a01;out[5]=c*a12-s*a02;out[6]=a20;out[7]=a21;out[8]=a22;return out};mat3.scale=function(out,a,v){var x=v[0],y=v[1];out[0]=x*a[0];out[1]=x*a[1];out[2]=x*a[2];out[3]=y*a[3];out[4]=y*a[4];out[5]=y*a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.fromTranslation=function(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=v[0];out[7]=v[1];out[8]=1;return out};mat3.fromRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=-s;out[4]=c;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromScaling=function(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=v[1];out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromMat2d=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=0;out[3]=a[2];out[4]=a[3];out[5]=0;out[6]=a[4];out[7]=a[5];out[8]=1;return out};mat3.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-yy-zz;out[3]=yx-wz;out[6]=zx+wy;out[1]=yx+wz;out[4]=1-xx-zz;out[7]=zy-wx;out[2]=zx-wy;out[5]=zy+wx;out[8]=1-xx-yy;return out};mat3.normalFromMat4=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return out};mat3.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};mat3.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};mat3.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];return out};mat3.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=a[8]-b[8];return out};mat3.sub=mat3.subtract;mat3.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;return out};mat3.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;return out};mat3.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};mat3.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=a[6],b7=b[7],b8=b[8];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=glMatrix.EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=glMatrix.EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=glMatrix.EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))};module.exports=mat3},{"./common.js":145}],149:[function(require,module,exports){var glMatrix=require("./common.js");var mat4={scalar:{},SIMD:{}};mat4.create=function(){var out=new glMatrix.ARRAY_TYPE(16);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.clone=function(a){var out=new glMatrix.ARRAY_TYPE(16);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.fromValues=function(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){var out=new glMatrix.ARRAY_TYPE(16);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out};mat4.set=function(out,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out};mat4.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.scalar.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a01;out[6]=a[9];out[7]=a[13];out[8]=a02;out[9]=a12;out[11]=a[14];out[12]=a03;out[13]=a13;out[14]=a23}else{out[0]=a[0];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a[1];out[5]=a[5];out[6]=a[9];out[7]=a[13];out[8]=a[2];out[9]=a[6];out[10]=a[10];out[11]=a[14];out[12]=a[3];out[13]=a[7];out[14]=a[11];out[15]=a[15]}return out};mat4.SIMD.transpose=function(out,a){var a0,a1,a2,a3,tmp01,tmp23,out0,out1,out2,out3;a0=SIMD.Float32x4.load(a,0);a1=SIMD.Float32x4.load(a,4);a2=SIMD.Float32x4.load(a,8);a3=SIMD.Float32x4.load(a,12);tmp01=SIMD.Float32x4.shuffle(a0,a1,0,1,4,5);tmp23=SIMD.Float32x4.shuffle(a2,a3,0,1,4,5);out0=SIMD.Float32x4.shuffle(tmp01,tmp23,0,2,4,6);out1=SIMD.Float32x4.shuffle(tmp01,tmp23,1,3,5,7);SIMD.Float32x4.store(out,0,out0);SIMD.Float32x4.store(out,4,out1);tmp01=SIMD.Float32x4.shuffle(a0,a1,2,3,6,7);tmp23=SIMD.Float32x4.shuffle(a2,a3,2,3,6,7);out2=SIMD.Float32x4.shuffle(tmp01,tmp23,0,2,4,6);out3=SIMD.Float32x4.shuffle(tmp01,tmp23,1,3,5,7);SIMD.Float32x4.store(out,8,out2);SIMD.Float32x4.store(out,12,out3);return out};mat4.transpose=glMatrix.USE_SIMD?mat4.SIMD.transpose:mat4.scalar.transpose;mat4.scalar.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out};mat4.SIMD.invert=function(out,a){var row0,row1,row2,row3,tmp1,minor0,minor1,minor2,minor3,det,a0=SIMD.Float32x4.load(a,0),a1=SIMD.Float32x4.load(a,4),a2=SIMD.Float32x4.load(a,8),a3=SIMD.Float32x4.load(a,12);tmp1=SIMD.Float32x4.shuffle(a0,a1,0,1,4,5);row1=SIMD.Float32x4.shuffle(a2,a3,0,1,4,5);row0=SIMD.Float32x4.shuffle(tmp1,row1,0,2,4,6);row1=SIMD.Float32x4.shuffle(row1,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.shuffle(a0,a1,2,3,6,7);row3=SIMD.Float32x4.shuffle(a2,a3,2,3,6,7);row2=SIMD.Float32x4.shuffle(tmp1,row3,0,2,4,6);row3=SIMD.Float32x4.shuffle(row3,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.mul(row2,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.mul(row1,tmp1);minor1=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row1,tmp1),minor0);minor1=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor1);minor1=SIMD.Float32x4.swizzle(minor1,2,3,0,1);tmp1=SIMD.Float32x4.mul(row1,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor0);minor3=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor3);minor3=SIMD.Float32x4.swizzle(minor3,2,3,0,1);tmp1=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(row1,2,3,0,1),row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);row2=SIMD.Float32x4.swizzle(row2,2,3,0,1);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor0);minor2=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor2);minor2=SIMD.Float32x4.swizzle(minor2,2,3,0,1);tmp1=SIMD.Float32x4.mul(row0,row1);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row2,tmp1),minor3);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row2,tmp1));tmp1=SIMD.Float32x4.mul(row0,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor2);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor1);minor2=SIMD.Float32x4.sub(minor2,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.mul(row0,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor1);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor3);det=SIMD.Float32x4.mul(row0,minor0);det=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(det,2,3,0,1),det);det=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(det,1,0,3,2),det);tmp1=SIMD.Float32x4.reciprocalApproximation(det);det=SIMD.Float32x4.sub(SIMD.Float32x4.add(tmp1,tmp1),SIMD.Float32x4.mul(det,SIMD.Float32x4.mul(tmp1,tmp1)));det=SIMD.Float32x4.swizzle(det,0,0,0,0);if(!det){return null}SIMD.Float32x4.store(out,0,SIMD.Float32x4.mul(det,minor0));SIMD.Float32x4.store(out,4,SIMD.Float32x4.mul(det,minor1));SIMD.Float32x4.store(out,8,SIMD.Float32x4.mul(det,minor2));SIMD.Float32x4.store(out,12,SIMD.Float32x4.mul(det,minor3));return out};mat4.invert=glMatrix.USE_SIMD?mat4.SIMD.invert:mat4.scalar.invert;mat4.scalar.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22);out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22));out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12);out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12));out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22));out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22);out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12));out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12);out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21);out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21));out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11);out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11));out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21));out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21);out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11));out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11);return out};mat4.SIMD.adjoint=function(out,a){var a0,a1,a2,a3;var row0,row1,row2,row3;var tmp1;var minor0,minor1,minor2,minor3;var a0=SIMD.Float32x4.load(a,0);var a1=SIMD.Float32x4.load(a,4);var a2=SIMD.Float32x4.load(a,8);var a3=SIMD.Float32x4.load(a,12);tmp1=SIMD.Float32x4.shuffle(a0,a1,0,1,4,5);row1=SIMD.Float32x4.shuffle(a2,a3,0,1,4,5);row0=SIMD.Float32x4.shuffle(tmp1,row1,0,2,4,6);row1=SIMD.Float32x4.shuffle(row1,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.shuffle(a0,a1,2,3,6,7);row3=SIMD.Float32x4.shuffle(a2,a3,2,3,6,7);row2=SIMD.Float32x4.shuffle(tmp1,row3,0,2,4,6);row3=SIMD.Float32x4.shuffle(row3,tmp1,1,3,5,7);tmp1=SIMD.Float32x4.mul(row2,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.mul(row1,tmp1);minor1=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row1,tmp1),minor0);minor1=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor1);minor1=SIMD.Float32x4.swizzle(minor1,2,3,0,1);tmp1=SIMD.Float32x4.mul(row1,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor0);minor3=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor3);minor3=SIMD.Float32x4.swizzle(minor3,2,3,0,1);tmp1=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(row1,2,3,0,1),row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);row2=SIMD.Float32x4.swizzle(row2,2,3,0,1);minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor0);minor2=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor2);minor2=SIMD.Float32x4.swizzle(minor2,2,3,0,1);tmp1=SIMD.Float32x4.mul(row0,row1);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row2,tmp1),minor3);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row3,tmp1),minor2);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row2,tmp1));tmp1=SIMD.Float32x4.mul(row0,row3);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row2,tmp1));minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor2);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1)
;minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor1);minor2=SIMD.Float32x4.sub(minor2,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.mul(row0,row2);tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor1);minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row1,tmp1));tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1);minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row3,tmp1));minor3=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor3);SIMD.Float32x4.store(out,0,minor0);SIMD.Float32x4.store(out,4,minor1);SIMD.Float32x4.store(out,8,minor2);SIMD.Float32x4.store(out,12,minor3);return out};mat4.adjoint=glMatrix.USE_SIMD?mat4.SIMD.adjoint:mat4.scalar.adjoint;mat4.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06};mat4.SIMD.multiply=function(out,a,b){var a0=SIMD.Float32x4.load(a,0);var a1=SIMD.Float32x4.load(a,4);var a2=SIMD.Float32x4.load(a,8);var a3=SIMD.Float32x4.load(a,12);var b0=SIMD.Float32x4.load(b,0);var out0=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0,3,3,3,3),a3))));SIMD.Float32x4.store(out,0,out0);var b1=SIMD.Float32x4.load(b,4);var out1=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1,3,3,3,3),a3))));SIMD.Float32x4.store(out,4,out1);var b2=SIMD.Float32x4.load(b,8);var out2=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2,3,3,3,3),a3))));SIMD.Float32x4.store(out,8,out2);var b3=SIMD.Float32x4.load(b,12);var out3=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3,3,3,3,3),a3))));SIMD.Float32x4.store(out,12,out3);return out};mat4.scalar.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out};mat4.multiply=glMatrix.USE_SIMD?mat4.SIMD.multiply:mat4.scalar.multiply;mat4.mul=mat4.multiply;mat4.scalar.translate=function(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out};mat4.SIMD.translate=function(out,a,v){var a0=SIMD.Float32x4.load(a,0),a1=SIMD.Float32x4.load(a,4),a2=SIMD.Float32x4.load(a,8),a3=SIMD.Float32x4.load(a,12),vec=SIMD.Float32x4(v[0],v[1],v[2],0);if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11]}a0=SIMD.Float32x4.mul(a0,SIMD.Float32x4.swizzle(vec,0,0,0,0));a1=SIMD.Float32x4.mul(a1,SIMD.Float32x4.swizzle(vec,1,1,1,1));a2=SIMD.Float32x4.mul(a2,SIMD.Float32x4.swizzle(vec,2,2,2,2));var t0=SIMD.Float32x4.add(a0,SIMD.Float32x4.add(a1,SIMD.Float32x4.add(a2,a3)));SIMD.Float32x4.store(out,12,t0);return out};mat4.translate=glMatrix.USE_SIMD?mat4.SIMD.translate:mat4.scalar.translate;mat4.scalar.scale=function(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.SIMD.scale=function(out,a,v){var a0,a1,a2;var vec=SIMD.Float32x4(v[0],v[1],v[2],0);a0=SIMD.Float32x4.load(a,0);SIMD.Float32x4.store(out,0,SIMD.Float32x4.mul(a0,SIMD.Float32x4.swizzle(vec,0,0,0,0)));a1=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(out,4,SIMD.Float32x4.mul(a1,SIMD.Float32x4.swizzle(vec,1,1,1,1)));a2=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(out,8,SIMD.Float32x4.mul(a2,SIMD.Float32x4.swizzle(vec,2,2,2,2)));out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.scale=glMatrix.USE_SIMD?mat4.SIMD.scale:mat4.scalar.scale;mat4.rotate=function(out,a,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22;if(Math.abs(len)<glMatrix.EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;out[0]=a00*b00+a10*b01+a20*b02;out[1]=a01*b00+a11*b01+a21*b02;out[2]=a02*b00+a12*b01+a22*b02;out[3]=a03*b00+a13*b01+a23*b02;out[4]=a00*b10+a10*b11+a20*b12;out[5]=a01*b10+a11*b11+a21*b12;out[6]=a02*b10+a12*b11+a22*b12;out[7]=a03*b10+a13*b11+a23*b12;out[8]=a00*b20+a10*b21+a20*b22;out[9]=a01*b20+a11*b21+a21*b22;out[10]=a02*b20+a12*b21+a22*b22;out[11]=a03*b20+a13*b21+a23*b22;if(a!==out){out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}return out};mat4.scalar.rotateX=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out};mat4.SIMD.rotateX=function(out,a,rad){var s=SIMD.Float32x4.splat(Math.sin(rad)),c=SIMD.Float32x4.splat(Math.cos(rad));if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}var a_1=SIMD.Float32x4.load(a,4);var a_2=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(out,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(a_1,c),SIMD.Float32x4.mul(a_2,s)));SIMD.Float32x4.store(out,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_2,c),SIMD.Float32x4.mul(a_1,s)));return out};mat4.rotateX=glMatrix.USE_SIMD?mat4.SIMD.rotateX:mat4.scalar.rotateX;mat4.scalar.rotateY=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c-a20*s;out[1]=a01*c-a21*s;out[2]=a02*c-a22*s;out[3]=a03*c-a23*s;out[8]=a00*s+a20*c;out[9]=a01*s+a21*c;out[10]=a02*s+a22*c;out[11]=a03*s+a23*c;return out};mat4.SIMD.rotateY=function(out,a,rad){var s=SIMD.Float32x4.splat(Math.sin(rad)),c=SIMD.Float32x4.splat(Math.cos(rad));if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}var a_0=SIMD.Float32x4.load(a,0);var a_2=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(out,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_0,c),SIMD.Float32x4.mul(a_2,s)));SIMD.Float32x4.store(out,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(a_0,s),SIMD.Float32x4.mul(a_2,c)));return out};mat4.rotateY=glMatrix.USE_SIMD?mat4.SIMD.rotateY:mat4.scalar.rotateY;mat4.scalar.rotateZ=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out};mat4.SIMD.rotateZ=function(out,a,rad){var s=SIMD.Float32x4.splat(Math.sin(rad)),c=SIMD.Float32x4.splat(Math.cos(rad));if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}var a_0=SIMD.Float32x4.load(a,0);var a_1=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(out,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(a_0,c),SIMD.Float32x4.mul(a_1,s)));SIMD.Float32x4.store(out,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_1,c),SIMD.Float32x4.mul(a_0,s)));return out};mat4.rotateZ=glMatrix.USE_SIMD?mat4.SIMD.rotateZ:mat4.scalar.rotateZ;mat4.fromTranslation=function(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.fromScaling=function(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=v[1];out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=v[2];out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromRotation=function(out,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t;if(Math.abs(len)<glMatrix.EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;out[0]=x*x*t+c;out[1]=y*x*t+z*s;out[2]=z*x*t-y*s;out[3]=0;out[4]=x*y*t-z*s;out[5]=y*y*t+c;out[6]=z*y*t+x*s;out[7]=0;out[8]=x*z*t+y*s;out[9]=y*z*t-x*s;out[10]=z*z*t+c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromXRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=c;out[6]=s;out[7]=0;out[8]=0;out[9]=-s;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromYRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=0;out[2]=-s;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=s;out[9]=0;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromZRotation=function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=0;out[4]=-s;out[5]=c;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.fromRotationTranslation=function(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.getTranslation=function(out,mat){out[0]=mat[12];out[1]=mat[13];out[2]=mat[14];return out};mat4.getRotation=function(out,mat){var trace=mat[0]+mat[5]+mat[10];var S=0;if(trace>0){S=Math.sqrt(trace+1)*2;out[3]=.25*S;out[0]=(mat[6]-mat[9])/S;out[1]=(mat[8]-mat[2])/S;out[2]=(mat[1]-mat[4])/S}else if(mat[0]>mat[5]&mat[0]>mat[10]){S=Math.sqrt(1+mat[0]-mat[5]-mat[10])*2;out[3]=(mat[6]-mat[9])/S;out[0]=.25*S;out[1]=(mat[1]+mat[4])/S;out[2]=(mat[8]+mat[2])/S}else if(mat[5]>mat[10]){S=Math.sqrt(1+mat[5]-mat[0]-mat[10])*2;out[3]=(mat[8]-mat[2])/S;out[0]=(mat[1]+mat[4])/S;out[1]=.25*S;out[2]=(mat[6]+mat[9])/S}else{S=Math.sqrt(1+mat[10]-mat[0]-mat[5])*2;out[3]=(mat[1]-mat[4])/S;out[0]=(mat[8]+mat[2])/S;out[1]=(mat[6]+mat[9])/S;out[2]=.25*S}return out};mat4.fromRotationTranslationScale=function(out,q,v,s){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2];out[0]=(1-(yy+zz))*sx;out[1]=(xy+wz)*sx;out[2]=(xz-wy)*sx;out[3]=0;out[4]=(xy-wz)*sy;out[5]=(1-(xx+zz))*sy;out[6]=(yz+wx)*sy;out[7]=0;out[8]=(xz+wy)*sz;out[9]=(yz-wx)*sz;out[10]=(1-(xx+yy))*sz;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.fromRotationTranslationScaleOrigin=function(out,q,v,s,o){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2],ox=o[0],oy=o[1],oz=o[2];out[0]=(1-(yy+zz))*sx;out[1]=(xy+wz)*sx;out[2]=(xz-wy)*sx;out[3]=0;out[4]=(xy-wz)*sy;out[5]=(1-(xx+zz))*sy;out[6]=(yz+wx)*sy;out[7]=0;out[8]=(xz+wy)*sz;out[9]=(yz-wx)*sz;out[10]=(1-(xx+yy))*sz;out[11]=0;out[12]=v[0]+ox-(out[0]*ox+out[4]*oy+out[8]*oz);out[13]=v[1]+oy-(out[1]*ox+out[5]*oy+out[9]*oz);out[14]=v[2]+oz-(out[2]*ox+out[6]*oy+out[10]*oz);out[15]=1;return out};mat4.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-yy-zz;out[1]=yx+wz;out[2]=zx-wy;out[3]=0;out[4]=yx-wz;out[5]=1-xx-zz;out[6]=zy+wx;out[7]=0;out[8]=zx+wy;out[9]=zy-wx;out[10]=1-xx-yy;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.frustum=function(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);out[0]=near*2*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=near*2*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near*2*nf;out[15]=0;return out};mat4.perspective=function(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=2*far*near*nf;out[15]=0;return out};mat4.perspectiveFromFieldOfView=function(out,fov,near,far){var upTan=Math.tan(fov.upDegrees*Math.PI/180),downTan=Math.tan(fov.downDegrees*Math.PI/180),leftTan=Math.tan(fov.leftDegrees*Math.PI/180),rightTan=Math.tan(fov.rightDegrees*Math.PI/180),xScale=2/(leftTan+rightTan),yScale=2/(upTan+downTan);out[0]=xScale;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=yScale;out[6]=0;out[7]=0;out[8]=-((leftTan-rightTan)*xScale*.5);out[9]=(upTan-downTan)*yScale*.5;out[10]=far/(near-far);out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near/(near-far);out[15]=0;return out};mat4.ortho=function(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out};mat4.lookAt=function(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];if(Math.abs(eyex-centerx)<glMatrix.EPSILON&&Math.abs(eyey-centery)<glMatrix.EPSILON&&Math.abs(eyez-centerz)<glMatrix.EPSILON){return mat4.identity(out)}z0=eyex-centerx;z1=eyey-centery;z2=eyez-centerz;len=1/Math.sqrt(z0*z0+z1*z1+z2*z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.sqrt(x0*x0+x1*x1+x2*x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.sqrt(y0*y0+y1*y1+y2*y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return out};mat4.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};mat4.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};mat4.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];out[9]=a[9]+b[9];out[10]=a[10]+b[10];out[11]=a[11]+b[11];out[12]=a[12]+b[12];out[13]=a[13]+b[13];out[14]=a[14]+b[14];out[15]=a[15]+b[15];return out};mat4.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=a[8]-b[8];out[9]=a[9]-b[9];out[10]=a[10]-b[10];out[11]=a[11]-b[11];out[12]=a[12]-b[12];out[13]=a[13]-b[13];out[14]=a[14]-b[14];out[15]=a[15]-b[15];return out};mat4.sub=mat4.subtract;mat4.multiplyScalar=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;out[9]=a[9]*b;out[10]=a[10]*b;out[11]=a[11]*b;out[12]=a[12]*b;out[13]=a[13]*b;out[14]=a[14]*b;out[15]=a[15]*b;return out};mat4.multiplyScalarAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;out[9]=a[9]+b[9]*scale;out[10]=a[10]+b[10]*scale;out[11]=a[11]+b[11]*scale;out[12]=a[12]+b[12]*scale;out[13]=a[13]+b[13]*scale;out[14]=a[14]+b[14]*scale;out[15]=a[15]+b[15]*scale;return out};mat4.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};mat4.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8],a9=a[9],a10=a[10],a11=a[11],a12=a[12],a13=a[13],a14=a[14],a15=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8],b9=b[9],b10=b[10],b11=b[11],b12=b[12],b13=b[13],b14=b[14],b15=b[15];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=glMatrix.EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=glMatrix.EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=glMatrix.EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))&&Math.abs(a9-b9)<=glMatrix.EPSILON*Math.max(1,Math.abs(a9),Math.abs(b9))&&Math.abs(a10-b10)<=glMatrix.EPSILON*Math.max(1,Math.abs(a10),Math.abs(b10))&&Math.abs(a11-b11)<=glMatrix.EPSILON*Math.max(1,Math.abs(a11),Math.abs(b11))&&Math.abs(a12-b12)<=glMatrix.EPSILON*Math.max(1,Math.abs(a12),Math.abs(b12))&&Math.abs(a13-b13)<=glMatrix.EPSILON*Math.max(1,Math.abs(a13),Math.abs(b13))&&Math.abs(a14-b14)<=glMatrix.EPSILON*Math.max(1,Math.abs(a14),Math.abs(b14))&&Math.abs(a15-b15)<=glMatrix.EPSILON*Math.max(1,Math.abs(a15),Math.abs(b15))};module.exports=mat4},{"./common.js":145}],150:[function(require,module,exports){var glMatrix=require("./common.js");var mat3=require("./mat3.js");var vec3=require("./vec3.js");var vec4=require("./vec4.js");var quat={};quat.create=function(){var out=new glMatrix.ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.rotationTo=function(){var tmpvec3=vec3.create();var xUnitVec3=vec3.fromValues(1,0,0);var yUnitVec3=vec3.fromValues(0,1,0);return function(out,a,b){var dot=vec3.dot(a,b);if(dot<-.999999){vec3.cross(tmpvec3,xUnitVec3,a);if(vec3.length(tmpvec3)<1e-6)vec3.cross(tmpvec3,yUnitVec3,a);vec3.normalize(tmpvec3,tmpvec3);quat.setAxisAngle(out,tmpvec3,Math.PI);return out}else if(dot>.999999){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out}else{vec3.cross(tmpvec3,a,b);out[0]=tmpvec3[0];out[1]=tmpvec3[1];out[2]=tmpvec3[2];out[3]=1+dot;return quat.normalize(out,out)}}}();quat.setAxes=function(){var matr=mat3.create();return function(out,view,right,up){matr[0]=right[0];matr[3]=right[1];matr[6]=right[2];matr[1]=up[0];matr[4]=up[1];matr[7]=up[2];matr[2]=-view[0];matr[5]=-view[1];matr[8]=-view[2];return quat.normalize(out,quat.fromMat3(out,matr))}}();quat.clone=vec4.clone;quat.fromValues=vec4.fromValues;quat.copy=vec4.copy;quat.set=vec4.set;quat.identity=function(out){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.setAxisAngle=function(out,axis,rad){rad=rad*.5;var s=Math.sin(rad);out[0]=s*axis[0];out[1]=s*axis[1];out[2]=s*axis[2];out[3]=Math.cos(rad);return out};quat.getAxisAngle=function(out_axis,q){var rad=Math.acos(q[3])*2;var s=Math.sin(rad/2);if(s!=0){out_axis[0]=q[0]/s;out_axis[1]=q[1]/s;out_axis[2]=q[2]/s}else{out_axis[0]=1;out_axis[1]=0;out_axis[2]=0}return rad};quat.add=vec4.add;quat.multiply=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];out[0]=ax*bw+aw*bx+ay*bz-az*by;out[1]=ay*bw+aw*by+az*bx-ax*bz;out[2]=az*bw+aw*bz+ax*by-ay*bx;out[3]=aw*bw-ax*bx-ay*by-az*bz;return out};quat.mul=quat.multiply;quat.scale=vec4.scale;quat.rotateX=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+aw*bx;out[1]=ay*bw+az*bx;out[2]=az*bw-ay*bx;out[3]=aw*bw-ax*bx;return out};quat.rotateY=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],by=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw-az*by;out[1]=ay*bw+aw*by;out[2]=az*bw+ax*by;out[3]=aw*bw-ay*by;return out};quat.rotateZ=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bz=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+ay*bz;out[1]=ay*bw-ax*bz;out[2]=az*bw+aw*bz;out[3]=aw*bw-az*bz;return out};quat.calculateW=function(out,a){var x=a[0],y=a[1],z=a[2];out[0]=x;out[1]=y;out[2]=z;out[3]=Math.sqrt(Math.abs(1-x*x-y*y-z*z));return out};quat.dot=vec4.dot;quat.lerp=vec4.lerp;quat.slerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw}if(1-cosom>1e-6){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom}else{scale0=1-t;scale1=t}out[0]=scale0*ax+scale1*bx;out[1]=scale0*ay+scale1*by;out[2]=scale0*az+scale1*bz;out[3]=scale0*aw+scale1*bw;return out};quat.sqlerp=function(){var temp1=quat.create();var temp2=quat.create();return function(out,a,b,c,d,t){quat.slerp(temp1,a,d,t);quat.slerp(temp2,b,c,t);quat.slerp(out,temp1,temp2,2*t*(1-t));return out}}();quat.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;out[0]=-a0*invDot;out[1]=-a1*invDot;out[2]=-a2*invDot;out[3]=a3*invDot;return out};quat.conjugate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];return out};quat.length=vec4.length;quat.len=quat.length;quat.squaredLength=vec4.squaredLength;quat.sqrLen=quat.squaredLength;quat.normalize=vec4.normalize;quat.fromMat3=function(out,m){var fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0){fRoot=Math.sqrt(fTrace+1);out[3]=.5*fRoot;fRoot=.5/fRoot;out[0]=(m[5]-m[7])*fRoot;out[1]=(m[6]-m[2])*fRoot;out[2]=(m[1]-m[3])*fRoot}else{var i=0;if(m[4]>m[0])i=1;if(m[8]>m[i*3+i])i=2;var j=(i+1)%3;var k=(i+2)%3;fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);out[i]=.5*fRoot;fRoot=.5/fRoot;out[3]=(m[j*3+k]-m[k*3+j])*fRoot;out[j]=(m[j*3+i]+m[i*3+j])*fRoot;out[k]=(m[k*3+i]+m[i*3+k])*fRoot}return out};quat.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};quat.exactEquals=vec4.exactEquals;quat.equals=vec4.equals;module.exports=quat},{"./common.js":145,"./mat3.js":148,"./vec3.js":152,"./vec4.js":153}],151:[function(require,module,exports){var glMatrix=require("./common.js");var vec2={};vec2.create=function(){var out=new glMatrix.ARRAY_TYPE(2);out[0]=0;out[1]=0;return out};vec2.clone=function(a){var out=new glMatrix.ARRAY_TYPE(2);out[0]=a[0];out[1]=a[1];return out};vec2.fromValues=function(x,y){var out=new glMatrix.ARRAY_TYPE(2);out[0]=x;out[1]=y;return out};vec2.copy=function(out,a){out[0]=a[0];out[1]=a[1];return out};vec2.set=function(out,x,y){out[0]=x;out[1]=y;return out};vec2.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];return out};vec2.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];return out};vec2.sub=vec2.subtract;vec2.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];return out};vec2.mul=vec2.multiply;vec2.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];return out};vec2.div=vec2.divide;vec2.ceil=function(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);return out};vec2.floor=function(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);return out};vec2.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);return out};vec2.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);return out};vec2.round=function(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);return out};vec2.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;return out};vec2.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;return out};vec2.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)};vec2.dist=vec2.distance;vec2.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y};vec2.sqrDist=vec2.squaredDistance;vec2.length=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)};vec2.len=vec2.length;vec2.squaredLength=function(a){var x=a[0],y=a[1];return x*x+y*y};vec2.sqrLen=vec2.squaredLength;vec2.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];return out};vec2.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];return out};vec2.normalize=function(out,a){var x=a[0],y=a[1];var len=x*x+y*y;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len}return out};vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};vec2.cross=function(out,a,b){var z=a[0]*b[1]-a[1]*b[0];out[0]=out[1]=0;out[2]=z;return out};vec2.lerp=function(out,a,b,t){var ax=a[0],ay=a[1];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);return out};vec2.random=function(out,scale){scale=scale||1;var r=glMatrix.RANDOM()*2*Math.PI;out[0]=Math.cos(r)*scale;out[1]=Math.sin(r)*scale;return out};vec2.transformMat2=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y;out[1]=m[1]*x+m[3]*y;return out};vec2.transformMat2d=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y+m[4];out[1]=m[1]*x+m[3]*y+m[5];return out};vec2.transformMat3=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[3]*y+m[6];out[1]=m[1]*x+m[4]*y+m[7];return out};vec2.transformMat4=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[4]*y+m[12];out[1]=m[1]*x+m[5]*y+m[13];return out};vec2.forEach=function(){var vec=vec2.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=2}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1]}return a}}();vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};vec2.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};vec2.equals=function(a,b){var a0=a[0],a1=a[1];var b0=b[0],b1=b[1];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))};module.exports=vec2},{"./common.js":145}],152:[function(require,module,exports){var glMatrix=require("./common.js");var vec3={};vec3.create=function(){var out=new glMatrix.ARRAY_TYPE(3);out[0]=0;out[1]=0;out[2]=0;return out};vec3.clone=function(a){var out=new glMatrix.ARRAY_TYPE(3);out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.fromValues=function(x,y,z){var out=new glMatrix.ARRAY_TYPE(3);out[0]=x;out[1]=y;out[2]=z;return out};vec3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.set=function(out,x,y,z){out[0]=x;out[1]=y;out[2]=z;return out};vec3.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];return out};vec3.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];return out};vec3.sub=vec3.subtract;vec3.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];return out};vec3.mul=vec3.multiply;vec3.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];return out};vec3.div=vec3.divide;vec3.ceil=function(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);return out};vec3.floor=function(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);return out};vec3.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);return out};vec3.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);return out};vec3.round=function(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);return out};vec3.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;return out};vec3.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;return out};vec3.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.dist=vec3.distance;vec3.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z};vec3.sqrDist=vec3.squaredDistance;vec3.length=function(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.len=vec3.length;vec3.squaredLength=function(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z};vec3.sqrLen=vec3.squaredLength;vec3.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];return out};vec3.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];return out};vec3.normalize=function(out,a){var x=a[0],y=a[1],z=a[2];var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len}return out};vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};vec3.cross=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];out[0]=ay*bz-az*by;out[1]=az*bx-ax*bz;out[2]=ax*by-ay*bx;return out};vec3.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);return out};vec3.hermite=function(out,a,b,c,d,t){var factorTimes2=t*t,factor1=factorTimes2*(2*t-3)+1,factor2=factorTimes2*(t-2)+t,factor3=factorTimes2*(t-1),factor4=factorTimes2*(3-2*t);out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4
;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out};vec3.bezier=function(out,a,b,c,d,t){var inverseFactor=1-t,inverseFactorTimesTwo=inverseFactor*inverseFactor,factorTimes2=t*t,factor1=inverseFactorTimesTwo*inverseFactor,factor2=3*t*inverseFactorTimesTwo,factor3=3*factorTimes2*inverseFactor,factor4=factorTimes2*t;out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out};vec3.random=function(out,scale){scale=scale||1;var r=glMatrix.RANDOM()*2*Math.PI;var z=glMatrix.RANDOM()*2-1;var zScale=Math.sqrt(1-z*z)*scale;out[0]=Math.cos(r)*zScale;out[1]=Math.sin(r)*zScale;out[2]=z*scale;return out};vec3.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2],w=m[3]*x+m[7]*y+m[11]*z+m[15];w=w||1;out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/w;out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w;out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w;return out};vec3.transformMat3=function(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=x*m[0]+y*m[3]+z*m[6];out[1]=x*m[1]+y*m[4]+z*m[7];out[2]=x*m[2]+y*m[5]+z*m[8];return out};vec3.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;return out};vec3.rotateX=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0];r[1]=p[1]*Math.cos(c)-p[2]*Math.sin(c);r[2]=p[1]*Math.sin(c)+p[2]*Math.cos(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.rotateY=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[2]*Math.sin(c)+p[0]*Math.cos(c);r[1]=p[1];r[2]=p[2]*Math.cos(c)-p[0]*Math.sin(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.rotateZ=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0]*Math.cos(c)-p[1]*Math.sin(c);r[1]=p[0]*Math.sin(c)+p[1]*Math.cos(c);r[2]=p[2];out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.forEach=function(){var vec=vec3.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=3}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2]}return a}}();vec3.angle=function(a,b){var tempA=vec3.fromValues(a[0],a[1],a[2]);var tempB=vec3.fromValues(b[0],b[1],b[2]);vec3.normalize(tempA,tempA);vec3.normalize(tempB,tempB);var cosine=vec3.dot(tempA,tempB);if(cosine>1){return 0}else{return Math.acos(cosine)}};vec3.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};vec3.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};vec3.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2];var b0=b[0],b1=b[1],b2=b[2];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))};module.exports=vec3},{"./common.js":145}],153:[function(require,module,exports){var glMatrix=require("./common.js");var vec4={};vec4.create=function(){var out=new glMatrix.ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=0;return out};vec4.clone=function(a){var out=new glMatrix.ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.fromValues=function(x,y,z,w){var out=new glMatrix.ARRAY_TYPE(4);out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.set=function(out,x,y,z,w){out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out};vec4.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out};vec4.sub=vec4.subtract;vec4.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];out[3]=a[3]*b[3];return out};vec4.mul=vec4.multiply;vec4.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];out[3]=a[3]/b[3];return out};vec4.div=vec4.divide;vec4.ceil=function(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);out[3]=Math.ceil(a[3]);return out};vec4.floor=function(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);out[3]=Math.floor(a[3]);return out};vec4.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);out[3]=Math.min(a[3],b[3]);return out};vec4.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);out[3]=Math.max(a[3],b[3]);return out};vec4.round=function(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);out[3]=Math.round(a[3]);return out};vec4.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out};vec4.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out};vec4.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.dist=vec4.distance;vec4.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w};vec4.sqrDist=vec4.squaredDistance;vec4.length=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.len=vec4.length;vec4.squaredLength=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w};vec4.sqrLen=vec4.squaredLength;vec4.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=-a[3];return out};vec4.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];out[3]=1/a[3];return out};vec4.normalize=function(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var len=x*x+y*y+z*z+w*w;if(len>0){len=1/Math.sqrt(len);out[0]=x*len;out[1]=y*len;out[2]=z*len;out[3]=w*len}return out};vec4.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};vec4.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);out[3]=aw+t*(b[3]-aw);return out};vec4.random=function(out,scale){scale=scale||1;out[0]=glMatrix.RANDOM();out[1]=glMatrix.RANDOM();out[2]=glMatrix.RANDOM();out[3]=glMatrix.RANDOM();vec4.normalize(out,out);vec4.scale(out,out,scale);return out};vec4.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out};vec4.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;out[3]=a[3];return out};vec4.forEach=function(){var vec=vec4.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=4}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];vec[3]=a[i+3];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2];a[i+3]=vec[3]}return a}}();vec4.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};vec4.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};vec4.equals=function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))};module.exports=vec4},{"./common.js":145}],154:[function(require,module,exports){(function(global){var win;if(typeof window!=="undefined"){win=window}else if(typeof global!=="undefined"){win=global}else if(typeof self!=="undefined"){win=self}else{win={}}module.exports=win}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],155:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],156:[function(require,module,exports){(function(global){var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]";var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var Symbol=root.Symbol,propertyIsEnumerable=objectProto.propertyIsEnumerable,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined;function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){baseFlatten(value,depth-1,predicate,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,INFINITY):[]}function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}var isArray=Array.isArray;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}module.exports=flattenDeep}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],157:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Queue=[];var Fx=function(){function Fx(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Fx);this.opt=(0,_utils.merge)({delay:0,duration:1e3,transition:function transition(x){return x},onCompute:_utils.noop,onComplete:_utils.noop},options)}_createClass(Fx,[{key:"start",value:function start(options){this.opt=(0,_utils.merge)(this.opt,options||{});this.time=Date.now();this.animating=true;Queue.push(this)}},{key:"step",value:function step(){if(!this.animating){return}var currentTime=Date.now(),time=this.time,opt=this.opt,delay=opt.delay,duration=opt.duration,delta=0;if(currentTime<time+delay){opt.onCompute.call(this,delta);return}if(currentTime<time+delay+duration){delta=opt.transition((currentTime-time-delay)/duration);opt.onCompute.call(this,delta)}else{this.animating=false;opt.onCompute.call(this,1);opt.onComplete.call(this)}}}],[{key:"compute",value:function compute(from,to,delta){return from+(to-from)*delta}}]);return Fx}();exports.default=Fx;Fx.Queue=Queue;Fx.Transition={linear:function linear(p){return p}};var Trans=Fx.Transition;Fx.prototype.time=null;function makeTrans(transition,params){params=(0,_utils.splat)(params);return Object.assign(transition,{easeIn:function easeIn(pos){return transition(pos,params)},easeOut:function easeOut(pos){return 1-transition(1-pos,params)},easeInOut:function easeInOut(pos){return pos<=.5?transition(2*pos,params)/2:(2-transition(2*(1-pos),params))/2}})}var transitions={Pow:function Pow(p,x){return Math.pow(p,x[0]||6)},Expo:function Expo(p){return Math.pow(2,8*(p-1))},Circ:function Circ(p){return 1-Math.sin(Math.acos(p))},Sine:function Sine(p){return 1-Math.sin((1-p)*Math.PI/2)},Back:function Back(p,x){x=x[0]||1.618;return Math.pow(p,2)*((x+1)*p-x)},Bounce:function Bounce(p){var value;for(var a=0,b=1;1;a+=b,b/=2){if(p>=(7-4*a)/11){value=b*b-Math.pow((11-6*a-11*p)/4,2);break}}return value},Elastic:function Elastic(p,x){return Math.pow(2,10*--p)*Math.cos(20*p*Math.PI*(x[0]||1)/3)}};for(var t in transitions){Trans[t]=makeTrans(transitions[t])}["Quad","Cubic","Quart","Quint"].forEach(function(elem,i){Trans[elem]=makeTrans(function(p){return Math.pow(p,[i+2])})});var global;try{global=window}catch(e){global=null}var checkFxQueue=function checkFxQueue(){var oldQueue=Queue;Queue=[];if(oldQueue.length){for(var i=0,l=oldQueue.length,fx;i<l;i++){fx=oldQueue[i];fx.step();if(fx.animating){Queue.push(fx)}}Fx.Queue=Queue}};if(global){var found=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(impl){if(impl in global){Fx.animationTime=function(){return global[impl]};found=true}});if(!found){Fx.animationTime=Date.now}found=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(impl){if(impl in global){Fx.requestAnimationFrame=function(callback){global[impl](function(){checkFxQueue();callback()})};found=true}});if(!found){Fx.requestAnimationFrame=function(callback){setTimeout(function(){checkFxQueue();callback()},1e3/60)}}}},{"../utils":221}],158:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.cancelAnimationFrame=exports.requestAnimationFrame=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");var _webglChecks=require("../webgl/webgl-checks");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var requestAnimationFrame=exports.requestAnimationFrame=function requestAnimationFrame(callback){return _utils.isBrowser?window.requestAnimationFrame(callback):setTimeout(callback,1e3/60)};var cancelAnimationFrame=exports.cancelAnimationFrame=function cancelAnimationFrame(timerId){return _utils.isBrowser?window.cancelAnimationFrame(timerId):clearTimeout(timerId)};var AnimationFrame=function(){function AnimationFrame(){var _this=this;var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,AnimationFrame);var _opts$gl=opts.gl,gl=_opts$gl===undefined?null:_opts$gl,_opts$width=opts.width,width=_opts$width===undefined?null:_opts$width,_opts$height=opts.height,height=_opts$height===undefined?null:_opts$height,_opts$autoResizeViewp=opts.autoResizeViewport,autoResizeViewport=_opts$autoResizeViewp===undefined?true:_opts$autoResizeViewp,_opts$autoResizeCanva=opts.autoResizeCanvas,autoResizeCanvas=_opts$autoResizeCanva===undefined?true:_opts$autoResizeCanva,_opts$autoResizeDrawi=opts.autoResizeDrawingBuffer,autoResizeDrawingBuffer=_opts$autoResizeDrawi===undefined?true:_opts$autoResizeDrawi,_opts$useDevicePixelR=opts.useDevicePixelRatio,useDevicePixelRatio=_opts$useDevicePixelR===undefined?true:_opts$useDevicePixelR;this.start=this.start.bind(this);this.stop=this.stop.bind(this);this._frame=this._frame.bind(this);this.update({autoResizeViewport:autoResizeViewport,autoResizeCanvas:autoResizeCanvas,autoResizeDrawingBuffer:autoResizeDrawingBuffer,useDevicePixelRatio:useDevicePixelRatio});this.width=width;this.height=height;this._startPromise=_utils.pageLoadPromise.then(function(page){_this.gl=gl;return page})}_createClass(AnimationFrame,[{key:"update",value:function update(_ref){var _ref$autoResizeDrawin=_ref.autoResizeDrawingBuffer,autoResizeDrawingBuffer=_ref$autoResizeDrawin===undefined?true:_ref$autoResizeDrawin,_ref$autoResizeCanvas=_ref.autoResizeCanvas,autoResizeCanvas=_ref$autoResizeCanvas===undefined?true:_ref$autoResizeCanvas,_ref$autoResizeViewpo=_ref.autoResizeViewport,autoResizeViewport=_ref$autoResizeViewpo===undefined?true:_ref$autoResizeViewpo,_ref$useDevicePixelRa=_ref.useDevicePixelRatio,useDevicePixelRatio=_ref$useDevicePixelRa===undefined?true:_ref$useDevicePixelRa;this.autoResizeViewport=autoResizeViewport;this.autoResizeCanvas=autoResizeCanvas;this.autoResizeDrawingBuffer=autoResizeDrawingBuffer;this.useDevicePixelRatio=useDevicePixelRatio;return this}},{key:"context",value:function context(onCreateContext){var _this2=this;if(this.gl){throw new Error("AnimationFrame.context - context already provided")}this._startPromise=this._startPromise.then(function(){_this2.gl=onCreateContext();if(!(0,_webglChecks.isWebGLContext)(_this2.gl)){throw new Error("AnimationFrame.context - illegal context returned")}});return this}},{key:"init",value:function init(onInit){var _this3=this;this._startPromise=this._startPromise.then(function(){if(!_this3.gl){throw new Error("AnimationFrame.context - no context provided")}_this3._initializeContext();return onInit(_this3._context)||{}});return this}},{key:"setupFrame",value:function setupFrame(onSetupFrame){this._onSetupFrame=onSetupFrame;return this}},{key:"frame",value:function frame(onRenderFrame){this._onRenderFrame=onRenderFrame;return this}},{key:"start",value:function start(){var _this4=this;this._startPromise.then(function(){var appContext=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_this4._initializeContext(appContext);if(!_this4._animationFrameId){_this4._animationFrameId=requestAnimationFrame(_this4._frame)}});return this}},{key:"stop",value:function stop(){if(this._animationFrameId){cancelAnimationFrame(this._animationFrameId);this._animationFrameId=null}return this}},{key:"resizeCanvas",value:function resizeCanvas(width,height){this._resizeCanvas(width,height);return this}},{key:"_initializeContext",value:function _initializeContext(appContext){if(!this._context){this._context={gl:this.gl,canvas:this.gl.canvas,stop:this.stop,tick:0,tock:0}}this._updateContext();if((typeof appContext==="undefined"?"undefined":_typeof(appContext))==="object"&&appContext!==null){this._context=Object.assign({},appContext,this._context)}}},{key:"_updateContext",value:function _updateContext(){var canvas=this._context.canvas;this._context.width=canvas.width;this._context.height=canvas.height;this._context.aspect=canvas.width/canvas.height}},{key:"_frame",value:function _frame(){var canvas=this._context.canvas;if(this._onSetupFrame){this._onSetupFrame(this._context)}else{this._resizeCanvasDrawingBuffer(canvas);if(this.autoResizeViewport){this.gl.viewport(0,0,canvas.width,canvas.height)}}this._updateContext();this._onRenderFrame(this._context);this._context.tick++;this._animationFrameId=requestAnimationFrame(this._frame)}},{key:"_resizeCanvas",value:function _resizeCanvas(width,height){var canvas=this._context.canvas;if(canvas){if(this.autoResizeDrawingBuffer){var cssToDevicePixels=this.useDevicePixelRatio?window.devicePixelRatio||1:1;var displayWidth=Math.floor(width*cssToDevicePixels);var displayHeight=Math.floor(height*cssToDevicePixels);if(canvas.width!==displayWidth||canvas.height!==displayHeight){canvas.width=displayWidth;canvas.height=displayHeight}}canvas.style.width=width+"px";canvas.style.height=height+"px"}return this}},{key:"_resizeCanvasDrawingBuffer",value:function _resizeCanvasDrawingBuffer(){if(this.autoResizeDrawingBuffer){var canvas=this._context.canvas;var cssToDevicePixels=this.useDevicePixelRatio?window.devicePixelRatio||1:1;var oldWidth=window.innerWidth;var oldHeight=window.innerHeight;var displayWidth=Math.floor(oldWidth*cssToDevicePixels);var displayHeight=Math.floor(oldHeight*cssToDevicePixels);if(oldWidth!==displayWidth||oldHeight!==displayHeight){canvas.width=displayWidth;canvas.height=displayHeight;canvas.style.width=oldWidth;canvas.style.height=oldHeight}}}},{key:"_resizeDrawingBuffer",value:function _resizeDrawingBuffer(width,height){var canvas=this._context.canvas;if(canvas){canvas.width=width;canvas.height=height;this.autoResizeDrawingBuffer=false}return this}}]);return AnimationFrame}();exports.default=AnimationFrame},{"../utils":221,"../webgl/webgl-checks":243}],159:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.OrthoCamera=exports.PerspectiveCamera=exports.Camera=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _deprecated=require("../deprecated");var _utils=require("../utils");function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Camera=exports.Camera=function(){function Camera(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Camera);opts=(0,_utils.merge)({fov:45,near:.1,far:500,aspect:1,position:new _deprecated.Vec3(0,0,0),target:new _deprecated.Vec3(0,0,-1),up:new _deprecated.Vec3(0,1,0)},opts);this.fov=opts.fov;this.near=opts.near;this.far=opts.far;this.aspect=opts.aspect;this.position=opts.position;this.target=opts.target;this.up=opts.up;this.view=new _deprecated.Mat4;this.uniforms={};this.projection=new _deprecated.Mat4;Object.seal(this);this.update()}_createClass(Camera,[{key:"project",value:function project(){return null}},{key:"unproject",value:function unproject(){return null}},{key:"getUniforms",value:function getUniforms(){return this.uniforms}},{key:"_updateUniforms",value:function _updateUniforms(){var viewProjection=this.view.mulMat4(this.projection);var viewProjectionInverse=viewProjection.invert();this.uniforms={cameraPosition:this.position,projectionMatrix:this.projection,viewMatrix:this.view,viewProjectionMatrix:viewProjection,viewInverseMatrix:this.view.invert(),viewProjectionInverseMatrix:viewProjectionInverse}}}]);return Camera}();var PerspectiveCamera=exports.PerspectiveCamera=function(_Camera){_inherits(PerspectiveCamera,_Camera);function PerspectiveCamera(){_classCallCheck(this,PerspectiveCamera);return _possibleConstructorReturn(this,(PerspectiveCamera.__proto__||Object.getPrototypeOf(PerspectiveCamera)).apply(this,arguments))}_createClass(PerspectiveCamera,[{key:"update",value:function update(){this.projection=(new _deprecated.Mat4).perspective(this.fov,this.aspect,this.near,this.far);this.view.lookAt(this.position,this.target,this.up);this._updateUniforms()}}]);return PerspectiveCamera}(Camera);var OrthoCamera=exports.OrthoCamera=function(){function OrthoCamera(){_classCallCheck(this,OrthoCamera)}_createClass(OrthoCamera,[{key:"update",value:function update(){var ymax=this.near*Math.tan(this.fov*Math.PI/360);var ymin=-ymax;var xmin=ymin*this.aspect;var xmax=ymax*this.aspect;this.projection=(new _deprecated.Mat4).ortho(xmin,xmax,ymin,ymax,this.near,this.far);this.view.lookAt(this.position,this.target,this.up);this._updateUniforms()}}]);return OrthoCamera}()},{"../deprecated":165,"../utils":221}],160:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var MAX_TEXTURES=exports.MAX_TEXTURES=10;var MAX_POINT_LIGHTS=exports.MAX_POINT_LIGHTS=4;var PICKING_RES=exports.PICKING_RES=4},{}],161:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Keys=exports.EventsProxy=exports.stop=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.get=get;exports.getWheel=getWheel;exports.getKey=getKey;exports.isRightClick=isRightClick;exports.getPos=getPos;exports.addEvents=addEvents;var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var KEYS={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,delete:46};function toO3D(n){return n!==true?n:false}function _getPos(elem){var bbox=elem.getBoundingClientRect();return{x:bbox.left,y:bbox.top,bbox:bbox}}function get(e,win){win=win||window;return e||win.event}function getWheel(e){return e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3}function getKey(e){var code=e.which||e.keyCode;var key=keyOf(code);var fKey=code-111;if(fKey>0&&fKey<13){key="f"+fKey}key=key||String.fromCharCode(code).toLowerCase();return{code:code,key:key,shift:e.shiftKey,control:e.ctrlKey,alt:e.altKey,meta:e.metaKey}}function isRightClick(e){return e.which===3||e.button===2}function getPos(e,win){win=win||window;e=e||win.event;var doc=win.document;doc=doc.documentElement||doc.body;if(e.touches&&e.touches.length){var touchesPos=[];var l=e.touches.length;var evt=void 0;for(var i=0;i<l;++i){evt=e.touches[i];touchesPos.push({x:evt.pageX||evt.clientX+doc.scrollLeft,y:evt.pageY||evt.clientY+doc.scrollTop})}return touchesPos}var page={x:e.pageX||e.clientX+doc.scrollLeft,y:e.pageY||e.clientY+doc.scrollTop};return[page]}function _stop(e){if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}exports.stop=_stop;var EventsProxy=exports.EventsProxy=function(){function EventsProxy(domElem,opt){_classCallCheck(this,EventsProxy);this.scene=opt.scene;this.domElem=domElem;this.pos=_getPos(domElem);this.opt=this.callbacks=opt;this.size={width:domElem.width||domElem.offsetWidth,height:domElem.height||domElem.offsetHeight};this.attachEvents()}_createClass(EventsProxy,[{key:"attachEvents",value:function attachEvents(){var _this=this;var domElem=this.domElem;var opt=this.opt;if(opt.disableContextMenu){domElem.oncontextmenu=function(){return false}}if(opt.enableMouse){["mouseup","mousedown","mousemove","mouseover","mouseout"].forEach(function(action){domElem.addEventListener(action,function(e,win){_this[action](_this.eventInfo(action,e,win))},false)});var type="";if(!document.getBoxObjectFor&&window.mozInnerScreenX===null){type="mousewheel"}else{type="DOMMouseScroll"}domElem.addEventListener(type,function(e,win){_this["mousewheel"](_this.eventInfo("mousewheel",e,win))},false)}if(opt.enableTouch){["touchstart","touchmove","touchend"].forEach(function(action){domElem.addEventListener(action,function(e,win){_this[action](_this.eventInfo(action,e,win))},false)})}if(opt.enableKeyboard){["keydown","keyup"].forEach(function(action){document.addEventListener(action,function(e,win){_this[action](_this.eventInfo(action,e,win))},false)})}}},{key:"eventInfo",value:function eventInfo(type,e,win){var domElem=this.domElem;var scene=this.scene;var opt=this.opt;var size=this.getSize();var relative=opt.relative;var centerOrigin=opt.centerOrigin;var pos=opt.cachePosition&&this.pos||_getPos(domElem);var ge=get(e,win);var epos=getPos(e,win);var origPos={x:epos[0].x,y:epos[0].y};var evt={};var x=void 0;var y=void 0;for(var i=0,l=epos.length;i<l;++i){x=epos[i].x;y=epos[i].y;if(relative){x-=pos.x;y-=pos.y;if(centerOrigin){x-=size.width/2;y-=size.height/2;y*=-1}}epos[i].x=x;epos[i].y=y}switch(type){case"mousewheel":evt.wheel=getWheel(ge);break;case"keydown":case"keyup":Object.assign(evt,getKey(ge));break;case"mouseup":evt.isRightClick=isRightClick(ge);break;default:break}var cacheTarget=void 0;Object.assign(evt,{x:epos[0].x,y:epos[0].y,posArray:epos,
cache:false,stop:function stop(){_stop(ge)},getTarget:function getTarget(){if(cacheTarget){return cacheTarget}return cacheTarget=opt.picking&&scene.pick(origPos.x-pos.x,origPos.y-pos.y)||true}});evt.event=ge;return evt}},{key:"getSize",value:function getSize(){if(this.cacheSize){return this.size}var domElem=this.domElem;return{width:domElem.width||domElem.offsetWidth,height:domElem.height||domElem.offsetHeight}}},{key:"mouseup",value:function mouseup(e){if(!this.moved){if(e.isRightClick){this.callbacks.onRightClick(e,this.hovered)}else{this.callbacks.onClick(e,toO3D(this.pressed))}}if(this.pressed){if(this.moved){this.callbacks.onDragEnd(e,toO3D(this.pressed))}else{this.callbacks.onDragCancel(e,toO3D(this.pressed))}this.pressed=this.moved=false}}},{key:"mouseout",value:function mouseout(e){var rt=e.relatedTarget;var domElem=this.domElem;while(rt&&rt.parentNode){if(domElem===rt.parentNode){return}rt=rt.parentNode}if(this.hovered){this.callbacks.onMouseLeave(e,this.hovered);this.hovered=false}if(this.pressed&&this.moved){this.callbacks.onDragEnd(e);this.pressed=this.moved=false}}},{key:"mouseover",value:function mouseover(e){}},{key:"mousemove",value:function mousemove(e){if(this.pressed){this.moved=true;this.callbacks.onDragMove(e,toO3D(this.pressed));return}if(this.hovered){var target=toO3D(e.getTarget());if(!target||target.hash!==this.hash){this.callbacks.onMouseLeave(e,this.hovered);this.hovered=target;this.hash=target;if(target){this.hash=target.hash;this.callbacks.onMouseEnter(e,this.hovered)}}else{this.callbacks.onMouseMove(e,this.hovered)}}else{this.hovered=toO3D(e.getTarget());this.hash=this.hovered;if(this.hovered){this.hash=this.hovered.hash;this.callbacks.onMouseEnter(e,this.hovered)}}if(!this.opt.picking){this.callbacks.onMouseMove(e)}}},{key:"mousewheel",value:function mousewheel(e){this.callbacks.onMouseWheel(e)}},{key:"mousedown",value:function mousedown(e){this.pressed=e.getTarget();this.callbacks.onDragStart(e,toO3D(this.pressed))}},{key:"touchstart",value:function touchstart(e){this.touched=e.getTarget();this.touchedLastPosition={x:e.x,y:e.y};this.callbacks.onTouchStart(e,toO3D(this.touched))}},{key:"touchmove",value:function touchmove(e){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(e,toO3D(this.touched))}}},{key:"touchend",value:function touchend(e){if(this.touched){if(this.touchMoved){this.callbacks.onTouchEnd(e,toO3D(this.touched))}else{e.x=isNaN(e.x)?this.touchedLastPosition.x:e.x;e.y=isNaN(e.y)?this.touchedLastPosition.y:e.y;this.callbacks.onTap(e,toO3D(this.touched));this.callbacks.onTouchCancel(e,toO3D(this.touched))}this.touched=this.touchMoved=false}}},{key:"keydown",value:function keydown(e){this.callbacks.onKeyDown(e)}},{key:"keyup",value:function keyup(e){this.callbacks.onKeyUp(e)}}]);return EventsProxy}();Object.assign(EventsProxy.prototype,{hovered:false,pressed:false,touched:false,touchedLastPosition:{x:0,y:0},touchMoved:false,moved:false});var DEFAULT_OPTS={cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,enableTouch:true,enableMouse:true,enableKeyboard:true,onClick:_utils.noop,onRightClick:_utils.noop,onDragStart:_utils.noop,onDragMove:_utils.noop,onDragEnd:_utils.noop,onDragCancel:_utils.noop,onTouchStart:_utils.noop,onTouchMove:_utils.noop,onTouchEnd:_utils.noop,onTouchCancel:_utils.noop,onTap:_utils.noop,onMouseMove:_utils.noop,onMouseEnter:_utils.noop,onMouseLeave:_utils.noop,onMouseWheel:_utils.noop,onKeyDown:_utils.noop,onKeyUp:_utils.noop};var Keys=exports.Keys=KEYS;function keyOf(code){var keyMap=Keys;for(var name in keyMap){if(keyMap[name]===code){return name}}return null}function addEvents(domElement){var opt=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};opt=Object.assign({},DEFAULT_OPTS,opt);var bind=opt.bind;if(bind){for(var name in opt){if(name.match(/^on[a-zA-Z0-9]+$/)){(function(fname,fn){opt[fname]=function f(){fn.apply(bind,Array.prototype.slice.call(arguments))}})(name,opt[name])}}}return new EventsProxy(domElement,opt)}},{"../utils":221}],162:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _model=require("./model");Object.defineProperty(exports,"Model",{enumerable:true,get:function get(){return _interopRequireDefault(_model).default}});var _animationFrame=require("./animation-frame");Object.defineProperty(exports,"AnimationFrame",{enumerable:true,get:function get(){return _interopRequireDefault(_animationFrame).default}});Object.keys(_animationFrame).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _animationFrame[key]}})});var _camera=require("./camera");Object.keys(_camera).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _camera[key]}})});var _event=require("./event");Object.keys(_event).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _event[key]}})});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./animation-frame":158,"./camera":159,"./event":161,"./model":163}],163:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.Material=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("../webgl");var _object3d=require("../deprecated/scenegraph/object-3d");var _object3d2=_interopRequireDefault(_object3d);var _utils=require("../utils");var _geometry=require("../geometry");var _shaders=require("../experimental/shaders");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MSG_INSTANCED_PARAM_DEPRECATED='Warning: Model constructor: parameter "instanced" renamed to "isInstanced".\nThis will become a hard error in a future version of luma.gl.';var MSG_TEXTURES_PARAM_REMOVED='Model: parameter "textures" removed. Use uniforms to set textures';var Material=exports.Material=function Material(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$shininess=_ref.shininess,shininess=_ref$shininess===undefined?0:_ref$shininess,_ref$reflection=_ref.reflection,reflection=_ref$reflection===undefined?0:_ref$reflection,_ref$refraction=_ref.refraction,refraction=_ref$refraction===undefined?0:_ref$refraction;_classCallCheck(this,Material);this.shininess=shininess;this.reflection=reflection;this.refraction=refraction};var Model=function(_Object3D){_inherits(Model,_Object3D);function Model(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Model);opts=(0,_webgl.isWebGLContext)(gl)?Object.assign({},opts,{gl:gl}):gl;var _this=_possibleConstructorReturn(this,(Model.__proto__||Object.getPrototypeOf(Model)).call(this,opts));_this.init(opts);return _this}_createClass(Model,[{key:"init",value:function init(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},program=_ref2.program,_ref2$gl=_ref2.gl,gl=_ref2$gl===undefined?null:_ref2$gl,_ref2$vs=_ref2.vs,vs=_ref2$vs===undefined?_shaders.SHADERS.vs:_ref2$vs,_ref2$fs=_ref2.fs,fs=_ref2$fs===undefined?_shaders.SHADERS.fs:_ref2$fs,defaultUniforms=_ref2.defaultUniforms,geometry=_ref2.geometry,_ref2$material=_ref2.material,material=_ref2$material===undefined?null:_ref2$material,textures=_ref2.textures,_ref2$isInstanced=_ref2.isInstanced,isInstanced=_ref2$isInstanced===undefined?false:_ref2$isInstanced,instanced=_ref2.instanced,_ref2$instanceCount=_ref2.instanceCount,instanceCount=_ref2$instanceCount===undefined?0:_ref2$instanceCount,_ref2$vertexCount=_ref2.vertexCount,vertexCount=_ref2$vertexCount===undefined?undefined:_ref2$vertexCount,_ref2$pickable=_ref2.pickable,pickable=_ref2$pickable===undefined?true:_ref2$pickable,_ref2$pick=_ref2.pick,pick=_ref2$pick===undefined?null:_ref2$pick,_ref2$uniforms=_ref2.uniforms,uniforms=_ref2$uniforms===undefined?{}:_ref2$uniforms,_ref2$attributes=_ref2.attributes,attributes=_ref2$attributes===undefined?{}:_ref2$attributes,_ref2$render=_ref2.render,render=_ref2$render===undefined?null:_ref2$render,_ref2$onBeforeRender=_ref2.onBeforeRender,onBeforeRender=_ref2$onBeforeRender===undefined?function(){}:_ref2$onBeforeRender,_ref2$onAfterRender=_ref2.onAfterRender,onAfterRender=_ref2$onAfterRender===undefined?function(){}:_ref2$onAfterRender,_ref2$timerQueryEnabl=_ref2.timerQueryEnabled,timerQueryEnabled=_ref2$timerQueryEnabl===undefined?false:_ref2$timerQueryEnabl;(0,_assert2.default)(geometry instanceof _geometry.Geometry,"Model needs a geometry");if(vs===_shaders.SHADERS.vs||fs===_shaders.SHADERS.fs&&defaultUniforms===undefined){defaultUniforms=_shaders.SHADERS.defaultUniforms}this.program=program||new _webgl.Program(gl,{vs:vs,fs:fs});(0,_assert2.default)(this.program instanceof _webgl.Program,"Model needs a program");if(instanced){console.warn(MSG_INSTANCED_PARAM_DEPRECATED);isInstanced=isInstanced||instanced}if(textures){throw new Error(MSG_TEXTURES_PARAM_REMOVED)}this.buffers={};this.userData={};this.drawParams={};this.dynamic=false;this.needsRedraw=true;this.material=material;this.setGeometry(geometry);this.attributes={};this.setAttributes(attributes);uniforms=Object.assign({},this.program.defaultUniforms,uniforms);this.uniforms={};this.setUniforms(uniforms);this.isInstanced=isInstanced;this.instanceCount=instanceCount;this.vertexCount=vertexCount;this.pickable=Boolean(pickable);this.pick=pick||function(){return false};this.onBeforeRender=onBeforeRender;this.onAfterRender=onAfterRender;this.timeElapsedQuery=undefined;this.ext=this.program.gl.getExtension("EXT_disjoint_timer_query");this.lastQueryReturned=true;this.accumulatedFrameTime=0;this.averageFrameTime=0;this.profileFrameCount=0;this.timerQueryEnabled=timerQueryEnabled&&this.ext!==null}},{key:"destroy",value:function destroy(){}},{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=redraw;return this}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref3$clearRedrawFlag=_ref3.clearRedrawFlags,clearRedrawFlags=_ref3$clearRedrawFlag===undefined?false:_ref3$clearRedrawFlag;var redraw=false;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;redraw=redraw||this.geometry.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags});return redraw}},{key:"setInstanceCount",value:function setInstanceCount(instanceCount){(0,_assert2.default)(instanceCount!==undefined);this.instanceCount=instanceCount;return this}},{key:"getInstanceCount",value:function getInstanceCount(){return this.instanceCount}},{key:"setVertexCount",value:function setVertexCount(vertexCount){this.vertexCount=vertexCount;return this}},{key:"getVertexCount",value:function getVertexCount(){return this.vertexCount===undefined?this.geometry.getVertexCount():this.vertexCount}},{key:"isPickable",value:function isPickable(){return this.pickable}},{key:"setPickable",value:function setPickable(){var pickable=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.pickable=Boolean(pickable);return this}},{key:"getProgram",value:function getProgram(){return this.program}},{key:"getGeometry",value:function getGeometry(){return this.geometry}},{key:"setGeometry",value:function setGeometry(geometry){this.geometry=geometry;this._createBuffersFromAttributeDescriptors(this.geometry.getAttributes());this.setNeedsRedraw();return this}},{key:"getAttributes",value:function getAttributes(){return this.attributes}},{key:"setAttributes",value:function setAttributes(){var attributes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Object.assign(this.attributes,attributes);this._createBuffersFromAttributeDescriptors(attributes);this.setNeedsRedraw();return this}},{key:"getUniforms",value:function getUniforms(){return this.uniforms}},{key:"setUniforms",value:function setUniforms(){var uniforms=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};(0,_webgl.checkUniformValues)(uniforms,this.id);Object.assign(this.uniforms,uniforms);this.setNeedsRedraw();return this}},{key:"draw",value:function draw(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref4$uniforms=_ref4.uniforms,uniforms=_ref4$uniforms===undefined?{}:_ref4$uniforms,_ref4$attributes=_ref4.attributes,attributes=_ref4$attributes===undefined?{}:_ref4$attributes,_ref4$settings=_ref4.settings,settings=_ref4$settings===undefined?{}:_ref4$settings;return this.render(uniforms)}},{key:"addViewUniforms",value:function addViewUniforms(uniforms){var camera=uniforms.camera,viewMatrix=uniforms.viewMatrix,modelMatrix=uniforms.modelMatrix;var cameraUniforms=camera?camera.getUniforms():{};var viewUniforms=viewMatrix?this.getCoordinateUniforms(viewMatrix,modelMatrix):{};return Object.assign({},uniforms,cameraUniforms,viewUniforms)}},{key:"render",value:function render(){var uniforms=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var resolvedUniforms=this.addViewUniforms(uniforms);this.setUniforms(resolvedUniforms);_utils.log.log(2,">>> RENDERING MODEL "+this.id,this);this.setProgramState();this._logAttributesAndUniforms(3,resolvedUniforms);this.onBeforeRender();var drawParams=this.drawParams;if(drawParams.isInstanced&&!this.isInstanced){_utils.log.warn(0,"Found instanced attributes on non-instanced model")}var isIndexed=drawParams.isIndexed,indexType=drawParams.indexType;var geometry=this.geometry,isInstanced=this.isInstanced,instanceCount=this.instanceCount;if(this.timerQueryEnabled===true&&this.lastQueryReturned===true){this.program.gl.getParameter(this.ext.GPU_DISJOINT_EXT);this.timeElapsedQuery=this.ext.createQueryEXT();this.ext.beginQueryEXT(this.ext.TIME_ELAPSED_EXT,this.timeElapsedQuery)}(0,_webgl.draw)(this.program.gl,{drawMode:geometry.drawMode,vertexCount:this.getVertexCount(),isIndexed:isIndexed,indexType:indexType,isInstanced:isInstanced,instanceCount:instanceCount});if(this.timerQueryEnabled===true){if(this.lastQueryReturned===true){this.ext.endQueryEXT(this.ext.TIME_ELAPSED_EXT);this.profileFrameCount++;this.lastQueryReturned=false}var disjoint=this.program.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(disjoint){this.lastQueryReturned=true}else{var available=this.ext.getQueryObjectEXT(this.timeElapsedQuery,this.ext.QUERY_RESULT_AVAILABLE_EXT);if(available){var timeElapsed=this.ext.getQueryObjectEXT(this.timeElapsedQuery,this.ext.QUERY_RESULT_EXT)/1e6;this.accumulatedFrameTime+=timeElapsed;this.averageFrameTime=this.accumulatedFrameTime/this.profileFrameCount;_utils.log.log(2,"program.id: ",this.program.id);_utils.log.log(2,"last frame time: ",timeElapsed,"ms");_utils.log.log(2,"average frame time: ",this.averageFrameTime,"ms");_utils.log.log(2,"accumulated frame time: ",this.accumulatedFrameTime,"ms");_utils.log.log(2,"profile frame count: ",this.profileFrameCount);this.lastQueryReturned=true}}}this.onAfterRender();this.unsetProgramState();this.setNeedsRedraw(false);_utils.log.log(2,"<<< RENDERING MODEL "+this.id+" - complete");return this}},{key:"setProgramState",value:function setProgramState(){var program=this.program;program.use();this.drawParams={};program.setBuffers(this.buffers,{drawParams:this.drawParams});program.setUniforms(this.uniforms);return this}},{key:"unsetProgramState",value:function unsetProgramState(){this.program.unsetBuffers();return this}},{key:"_createBuffersFromAttributeDescriptors",value:function _createBuffersFromAttributeDescriptors(attributes){var gl=this.program.gl;for(var attributeName in attributes){var attribute=attributes[attributeName];if(attribute instanceof _webgl.Buffer){this.buffers[attributeName]=attribute}else{this.buffers[attributeName]=this.buffers[attributeName]||new _webgl.Buffer(gl);var buffer=this.buffers[attributeName];buffer.setData(Object.assign({},attribute,{data:attribute.value,target:attribute.isIndexed?_webgl.GL.ELEMENT_ARRAY_BUFFER:_webgl.GL.ARRAY_BUFFER}))}}return this}},{key:"_logAttributesAndUniforms",value:function _logAttributesAndUniforms(){var priority=arguments.length>0&&arguments[0]!==undefined?arguments[0]:3;var uniforms=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(_utils.log.priority>=priority){var attributeTable=this._getAttributesTable({header:"Attributes "+this.id,program:this.program,attributes:Object.assign({},this.geometry.attributes,this.attributes)});_utils.log.table(priority,attributeTable);var _getUniformsTable=(0,_webgl.getUniformsTable)({header:"Uniforms "+this.id,program:this.program,uniforms:Object.assign({},this.uniforms,uniforms)}),table=_getUniformsTable.table,unusedTable=_getUniformsTable.unusedTable,unusedCount=_getUniformsTable.unusedCount;_utils.log.table(priority,table);_utils.log.log(priority,(unusedCount||"No")+" unused uniforms ",unusedTable)}}},{key:"_getAttributesTable",value:function _getAttributesTable(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},attributes=_ref5.attributes,_ref5$header=_ref5.header,header=_ref5$header===undefined?"Attributes":_ref5$header,instanced=_ref5.instanced,program=_ref5.program;(0,_assert2.default)(program);var attributeLocations=program._attributeLocations;var table=_defineProperty({},header,{});for(var attributeName in attributeLocations){var attribute=attributes[attributeName];var location=attributeLocations[attributeName];table[attributeName]=this._getAttributeEntry(attribute,location)}for(var _attributeName in attributes){var _attribute=attributes[_attributeName];if(!table[_attributeName]){table[_attributeName]=this._getAttributeEntry(_attribute,null)}}return table}},{key:"_getAttributeEntry",value:function _getAttributeEntry(attribute,location){var round=function round(num){return Math.round(num*10)/10};var type="NOT PROVIDED";var instanced=0;var size="N/A";var verts="N/A";var bytes="N/A";var value="N/A";if(attribute&&location===null){location=attribute.isIndexed?"ELEMENT_ARRAY_BUFFER":"NOT USED"}if(attribute instanceof _webgl.Buffer){var buffer=attribute;type=buffer.layout.type;instanced=buffer.layout.instanced;size=buffer.layout.size;verts=round(buffer.data.length/buffer.layout.size);bytes=buffer.data.length*buffer.data.BYTES_PER_ELEMENT}else if(attribute){type=attribute.value.constructor.name;instanced=attribute.instanced;size=attribute.size;verts=round(attribute.value.length/attribute.size);bytes=attribute.value.length*attribute.value.BYTES_PER_ELEMENT;value=attribute.value}type=String(type).replace("Array","");var isInteger=type.indexOf("nt")!==-1;location=""+location+(instanced?" [instanced]":"");return{Location:location,"Type Size x Verts = Bytes":type+" "+size+" x "+verts+" = "+bytes,Value:(0,_utils.formatValue)(value,{size:size,isInteger:isInteger})}}},{key:"setTextures",value:function setTextures(){var textures=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];throw new Error("model.setTextures replaced: setUniforms({sampler2D: new Texture2D})")}},{key:"hash",get:function get(){return this.id+" "+this.$pickingIndex}}]);return Model}(_object3d2.default);exports.default=Model},{"../deprecated/scenegraph/object-3d":169,"../experimental/shaders":185,"../geometry":191,"../utils":221,"../webgl":231,assert:1}],164:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("../webgl/webgl");var _webglChecks=require("../webgl/webgl-checks");var _framebuffer=require("../webgl/framebuffer");var _framebuffer2=_interopRequireDefault(_framebuffer);var _renderbuffer=require("../webgl/renderbuffer");var _renderbuffer2=_interopRequireDefault(_renderbuffer);var _texture2d=require("../webgl/texture-2d");var _texture2d2=_interopRequireDefault(_texture2d);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FramebufferObject=function(){function FramebufferObject(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$width=_ref.width,width=_ref$width===undefined?1:_ref$width,_ref$height=_ref.height,height=_ref$height===undefined?1:_ref$height,_ref$depth=_ref.depth,depth=_ref$depth===undefined?true:_ref$depth,_ref$minFilter=_ref.minFilter,minFilter=_ref$minFilter===undefined?_webgl.GL.NEAREST:_ref$minFilter,_ref$magFilter=_ref.magFilter,magFilter=_ref$magFilter===undefined?_webgl.GL.NEAREST:_ref$magFilter,_ref$format=_ref.format,format=_ref$format===undefined?_webgl.GL.RGBA:_ref$format,_ref$type=_ref.type,type=_ref$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref$type;_classCallCheck(this,FramebufferObject);(0,_webglChecks.assertWebGLContext)(gl);this.gl=gl;this.depth=depth;this.minFilter=minFilter;this.magFilter=magFilter;this.format=format;this.type=type;this.resize(width,height)}_createClass(FramebufferObject,[{key:"delete",value:function _delete(){}},{key:"resize",value:function resize(width,height){(0,_assert2.default)(width>=0&&height>=0,"Width and height need to be integers");if(width===this.width&&height===this.height){return}var gl=this.gl;var fb=new _framebuffer2.default(gl);var colorBuffer=new _texture2d2.default(gl,{minFilter:this.minFilter,magFilter:this.magFilter}).setImageData({data:null,width:width,height:height,type:this.type,format:this.format});fb.attachTexture({attachment:_webgl.GL.COLOR_ATTACHMENT0,texture:colorBuffer});if(this.colorBuffer){this.colorBuffer.delete()}this.colorBuffer=colorBuffer;if(this.depth){var depthBuffer=new _renderbuffer2.default(gl).storage({internalFormat:_webgl.GL.DEPTH_COMPONENT16,width:width,height:height});fb.attachRenderbuffer({attachment:_webgl.GL.DEPTH_ATTACHMENT,renderbuffer:depthBuffer});if(this.depthBuffer){this.depthBuffer.delete()}this.depthBuffer=depthBuffer}fb.checkStatus();this.width=width;this.height=height;if(this.fb){this.fb.delete()}this.fb=fb}},{key:"bind",value:function bind(){this.fb.bind()}},{key:"unbind",value:function unbind(){this.fb.unbind()}}]);return FramebufferObject}();exports.default=FramebufferObject},{"../webgl/framebuffer":229,"../webgl/renderbuffer":233,"../webgl/texture-2d":235,"../webgl/webgl":247,"../webgl/webgl-checks":243,assert:1}],165:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _math=require("./math");Object.keys(_math).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _math[key]}})});var _fbo=require("./fbo");Object.defineProperty(exports,"FramebufferObject",{enumerable:true,get:function get(){return _interopRequireDefault(_fbo).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./fbo":164,"./math":166}],166:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _extendableBuiltin5(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}function _extendableBuiltin3(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _extendableBuiltin(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}var sqrt=Math.sqrt;var sin=Math.sin;var cos=Math.cos;var tan=Math.tan;var pi=Math.PI;var slice=Array.prototype.slice;var Vec3=exports.Vec3=function(_extendableBuiltin2){_inherits(Vec3,_extendableBuiltin2);function Vec3(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Vec3);var _this=_possibleConstructorReturn(this,(Vec3.__proto__||Object.getPrototypeOf(Vec3)).call(this,3));_this[0]=x;_this[1]=y;_this[2]=z;return _this}_createClass(Vec3,[{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=value}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=value}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=value}}],[{key:"create",value:function create(){return new Vec3(3)}}]);return Vec3}(_extendableBuiltin(Array));var generics={setVec3:function setVec3(dest,vec){dest[0]=vec[0];dest[1]=vec[1];dest[2]=vec[2];return dest},set:function set(dest,x,y,z){dest[0]=x;dest[1]=y;dest[2]=z;return dest},add:function add(dest,vec){return new Vec3(dest[0]+vec[0],dest[1]+vec[1],dest[2]+vec[2])},$add:function $add(dest,vec){dest[0]+=vec[0];dest[1]+=vec[1];dest[2]+=vec[2];return dest},add2:function add2(dest,a,b){dest[0]=a[0]+b[0];dest[1]=a[1]+b[1];dest[2]=a[2]+b[2];return dest},sub:function sub(dest,vec){return new Vec3(dest[0]-vec[0],dest[1]-vec[1],dest[2]-vec[2])},$sub:function $sub(dest,vec){dest[0]-=vec[0];dest[1]-=vec[1];dest[2]-=vec[2];return dest},sub2:function sub2(dest,a,b){dest[0]=a[0]-b[0];dest[1]=a[1]-b[1];dest[2]=a[2]-b[2];return dest},scale:function scale(dest,s){return new Vec3(dest[0]*s,dest[1]*s,dest[2]*s)},$scale:function $scale(dest,s){dest[0]*=s;dest[1]*=s;dest[2]*=s;return dest},neg:function neg(dest){return new Vec3(-dest[0],-dest[1],-dest[2])},$neg:function $neg(dest){dest[0]=-dest[0];dest[1]=-dest[1];dest[2]=-dest[2];return dest},unit:function unit(dest){var len=Vec3.norm(dest);if(len>0){return Vec3.scale(dest,1/len)}return Vec3.clone(dest)},$unit:function $unit(dest){var len=Vec3.norm(dest);if(len>0){return Vec3.$scale(dest,1/len)}return dest},cross:function cross(dest,vec){var dx=dest[0],dy=dest[1],dz=dest[2],vx=vec[0],vy=vec[1],vz=vec[2];return new Vec3(dy*vz-dz*vy,dz*vx-dx*vz,dx*vy-dy*vx)},$cross:function $cross(dest,vec){var dx=dest[0],dy=dest[1],dz=dest[2],vx=vec[0],vy=vec[1],vz=vec[2];dest[0]=dy*vz-dz*vy;dest[1]=dz*vx-dx*vz;dest[2]=dx*vy-dy*vx;return dest},distTo:function distTo(dest,vec){var dx=dest[0]-vec[0],dy=dest[1]-vec[1],dz=dest[2]-vec[2];return sqrt(dx*dx+dy*dy+dz*dz)},distToSq:function distToSq(dest,vec){var dx=dest[0]-vec[0],dy=dest[1]-vec[1],dz=dest[2]-vec[2];return dx*dx+dy*dy+dz*dz},norm:function norm(dest){var dx=dest[0],dy=dest[1],dz=dest[2];return sqrt(dx*dx+dy*dy+dz*dz)},normSq:function normSq(dest){var dx=dest[0],dy=dest[1],dz=dest[2];return dx*dx+dy*dy+dz*dz},dot:function dot(dest,vec){return dest[0]*vec[0]+dest[1]*vec[1]+dest[2]*vec[2]},clone:function clone(dest){if(dest instanceof Vec3){return new Vec3(dest[0],dest[1],dest[2])}return Vec3.setVec3(new Float32Array(3),dest)},toFloat32Array:function toFloat32Array(dest){var ans=dest.typedContainer;if(!ans){return dest}ans[0]=dest[0];ans[1]=dest[1];ans[2]=dest[2];return ans}};var proto=Vec3.prototype;for(var method in generics){Vec3[method]=generics[method];proto[method]=function _(m){return function(){var args=slice.call(arguments);args.unshift(this);return Vec3[m].apply(Vec3,args)}}(method)}var Mat4=exports.Mat4=function(_extendableBuiltin4){_inherits(Mat4,_extendableBuiltin4);function Mat4(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){_classCallCheck(this,Mat4);var _this2=_possibleConstructorReturn(this,(Mat4.__proto__||Object.getPrototypeOf(Mat4)).call(this,16));_this2.length=16;if(typeof n11==="number"){_this2.set(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44)}else{_this2.id()}_this2.typedContainer=new Float32Array(16);return _this2}
_createClass(Mat4,[{key:"copy",value:function copy(src){for(var i=0;i<16;++i){this[i]=src[i]}return this}},{key:"n11",get:function get(){return this[0]},set:function set(val){this[0]=val}},{key:"n12",get:function get(){return this[4]},set:function set(val){this[4]=val}},{key:"n13",get:function get(){return this[8]},set:function set(val){this[8]=val}},{key:"n14",get:function get(){return this[12]},set:function set(val){this[12]=val}},{key:"n21",get:function get(){return this[1]},set:function set(val){this[1]=val}},{key:"n22",get:function get(){return this[5]},set:function set(val){this[5]=val}},{key:"n23",get:function get(){return this[9]},set:function set(val){this[9]=val}},{key:"n24",get:function get(){return this[13]},set:function set(val){this[13]=val}},{key:"n31",get:function get(){return this[2]},set:function set(val){this[2]=val}},{key:"n32",get:function get(){return this[6]},set:function set(val){this[6]=val}},{key:"n33",get:function get(){return this[10]},set:function set(val){this[10]=val}},{key:"n34",get:function get(){return this[14]},set:function set(val){this[14]=val}},{key:"n41",get:function get(){return this[3]},set:function set(val){this[3]=val}},{key:"n42",get:function get(){return this[7]},set:function set(val){this[7]=val}},{key:"n43",get:function get(){return this[11]},set:function set(val){this[11]=val}},{key:"n44",get:function get(){return this[15]},set:function set(val){this[15]=val}}],[{key:"create",value:function create(){return new Array(16)}}]);return Mat4}(_extendableBuiltin3(Array));generics={id:function id(dest){dest[0]=1;dest[1]=0;dest[2]=0;dest[3]=0;dest[4]=0;dest[5]=1;dest[6]=0;dest[7]=0;dest[8]=0;dest[9]=0;dest[10]=1;dest[11]=0;dest[12]=0;dest[13]=0;dest[14]=0;dest[15]=1;return dest},clone:function clone(dest){if(dest instanceof Mat4){return new Mat4(dest[0],dest[4],dest[8],dest[12],dest[1],dest[5],dest[9],dest[13],dest[2],dest[6],dest[10],dest[14],dest[3],dest[7],dest[11],dest[15])}return new typedArray(dest)},set:function set(dest,n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){dest[0]=n11;dest[4]=n12;dest[8]=n13;dest[12]=n14;dest[1]=n21;dest[5]=n22;dest[9]=n23;dest[13]=n24;dest[2]=n31;dest[6]=n32;dest[10]=n33;dest[14]=n34;dest[3]=n41;dest[7]=n42;dest[11]=n43;dest[15]=n44;return dest},mulVec3:function mulVec3(dest,vec){var ans=Vec3.clone(vec);return Mat4.$mulVec3(dest,ans)},$mulVec3:function $mulVec3(dest,vec){var vx=vec[0],vy=vec[1],vz=vec[2],d=1/(dest[3]*vx+dest[7]*vy+dest[11]*vz+dest[15]);vec[0]=(dest[0]*vx+dest[4]*vy+dest[8]*vz+dest[12])*d;vec[1]=(dest[1]*vx+dest[5]*vy+dest[9]*vz+dest[13])*d;vec[2]=(dest[2]*vx+dest[6]*vy+dest[10]*vz+dest[14])*d;return vec},mulMat42:function mulMat42(dest,a,b){var a11=a[0],a12=a[1],a13=a[2],a14=a[3],a21=a[4],a22=a[5],a23=a[6],a24=a[7],a31=a[8],a32=a[9],a33=a[10],a34=a[11],a41=a[12],a42=a[13],a43=a[14],a44=a[15],b11=b[0],b12=b[1],b13=b[2],b14=b[3],b21=b[4],b22=b[5],b23=b[6],b24=b[7],b31=b[8],b32=b[9],b33=b[10],b34=b[11],b41=b[12],b42=b[13],b43=b[14],b44=b[15];dest[0]=b11*a11+b12*a21+b13*a31+b14*a41;dest[1]=b11*a12+b12*a22+b13*a32+b14*a42;dest[2]=b11*a13+b12*a23+b13*a33+b14*a43;dest[3]=b11*a14+b12*a24+b13*a34+b14*a44;dest[4]=b21*a11+b22*a21+b23*a31+b24*a41;dest[5]=b21*a12+b22*a22+b23*a32+b24*a42;dest[6]=b21*a13+b22*a23+b23*a33+b24*a43;dest[7]=b21*a14+b22*a24+b23*a34+b24*a44;dest[8]=b31*a11+b32*a21+b33*a31+b34*a41;dest[9]=b31*a12+b32*a22+b33*a32+b34*a42;dest[10]=b31*a13+b32*a23+b33*a33+b34*a43;dest[11]=b31*a14+b32*a24+b33*a34+b34*a44;dest[12]=b41*a11+b42*a21+b43*a31+b44*a41;dest[13]=b41*a12+b42*a22+b43*a32+b44*a42;dest[14]=b41*a13+b42*a23+b43*a33+b44*a43;dest[15]=b41*a14+b42*a24+b43*a34+b44*a44;return dest},mulMat4:function mulMat4(a,b){var m=Mat4.clone(a);return Mat4.mulMat42(m,a,b)},$mulMat4:function $mulMat4(a,b){return Mat4.mulMat42(a,a,b)},add:function add(dest,m){var copy=Mat4.clone(dest);return Mat4.$add(copy,m)},$add:function $add(dest,m){dest[0]+=m[0];dest[1]+=m[1];dest[2]+=m[2];dest[3]+=m[3];dest[4]+=m[4];dest[5]+=m[5];dest[6]+=m[6];dest[7]+=m[7];dest[8]+=m[8];dest[9]+=m[9];dest[10]+=m[10];dest[11]+=m[11];dest[12]+=m[12];dest[13]+=m[13];dest[14]+=m[14];dest[15]+=m[15];return dest},transpose:function transpose(dest){var m=Mat4.clone(dest);return Mat4.$transpose(m)},$transpose:function $transpose(dest){var n4=dest[4],n8=dest[8],n12=dest[12],n1=dest[1],n9=dest[9],n13=dest[13],n2=dest[2],n6=dest[6],n14=dest[14],n3=dest[3],n7=dest[7],n11=dest[11];dest[1]=n4;dest[2]=n8;dest[3]=n12;dest[4]=n1;dest[6]=n9;dest[7]=n13;dest[8]=n2;dest[9]=n6;dest[11]=n14;dest[12]=n3;dest[13]=n7;dest[14]=n11;return dest},rotateAxis:function rotateAxis(dest,theta,vec){var m=Mat4.clone(dest);return Mat4.$rotateAxis(m,theta,vec)},$rotateAxis:function $rotateAxis(dest,theta,vec){var s=sin(theta),c=cos(theta),nc=1-c,vx=vec[0],vy=vec[1],vz=vec[2],m11=vx*vx*nc+c,m12=vx*vy*nc+vz*s,m13=vx*vz*nc-vy*s,m21=vy*vx*nc-vz*s,m22=vy*vy*nc+c,m23=vy*vz*nc+vx*s,m31=vx*vz*nc+vy*s,m32=vy*vz*nc-vx*s,m33=vz*vz*nc+c,d11=dest[0],d12=dest[1],d13=dest[2],d14=dest[3],d21=dest[4],d22=dest[5],d23=dest[6],d24=dest[7],d31=dest[8],d32=dest[9],d33=dest[10],d34=dest[11],d41=dest[12],d42=dest[13],d43=dest[14],d44=dest[15];dest[0]=d11*m11+d21*m12+d31*m13;dest[1]=d12*m11+d22*m12+d32*m13;dest[2]=d13*m11+d23*m12+d33*m13;dest[3]=d14*m11+d24*m12+d34*m13;dest[4]=d11*m21+d21*m22+d31*m23;dest[5]=d12*m21+d22*m22+d32*m23;dest[6]=d13*m21+d23*m22+d33*m23;dest[7]=d14*m21+d24*m22+d34*m23;dest[8]=d11*m31+d21*m32+d31*m33;dest[9]=d12*m31+d22*m32+d32*m33;dest[10]=d13*m31+d23*m32+d33*m33;dest[11]=d14*m31+d24*m32+d34*m33;return dest},rotateXYZ:function rotateXYZ(dest,rx,ry,rz){var ans=Mat4.clone(dest);return Mat4.$rotateXYZ(ans,rx,ry,rz)},$rotateXYZ:function $rotateXYZ(dest,rx,ry,rz){var d11=dest[0],d12=dest[1],d13=dest[2],d14=dest[3],d21=dest[4],d22=dest[5],d23=dest[6],d24=dest[7],d31=dest[8],d32=dest[9],d33=dest[10],d34=dest[11],crx=cos(rx),cry=cos(ry),crz=cos(rz),srx=sin(rx),sry=sin(ry),srz=sin(rz),m11=cry*crz,m21=-crx*srz+srx*sry*crz,m31=srx*srz+crx*sry*crz,m12=cry*srz,m22=crx*crz+srx*sry*srz,m32=-srx*crz+crx*sry*srz,m13=-sry,m23=srx*cry,m33=crx*cry;dest[0]=d11*m11+d21*m12+d31*m13;dest[1]=d12*m11+d22*m12+d32*m13;dest[2]=d13*m11+d23*m12+d33*m13;dest[3]=d14*m11+d24*m12+d34*m13;dest[4]=d11*m21+d21*m22+d31*m23;dest[5]=d12*m21+d22*m22+d32*m23;dest[6]=d13*m21+d23*m22+d33*m23;dest[7]=d14*m21+d24*m22+d34*m23;dest[8]=d11*m31+d21*m32+d31*m33;dest[9]=d12*m31+d22*m32+d32*m33;dest[10]=d13*m31+d23*m32+d33*m33;dest[11]=d14*m31+d24*m32+d34*m33;return dest},translate:function translate(dest,x,y,z){var m=Mat4.clone(dest);return Mat4.$translate(m,x,y,z)},$translate:function $translate(dest,x,y,z){dest[12]=dest[0]*x+dest[4]*y+dest[8]*z+dest[12];dest[13]=dest[1]*x+dest[5]*y+dest[9]*z+dest[13];dest[14]=dest[2]*x+dest[6]*y+dest[10]*z+dest[14];dest[15]=dest[3]*x+dest[7]*y+dest[11]*z+dest[15];return dest},scale:function scale(dest,x,y,z){var m=Mat4.clone(dest);return Mat4.$scale(m,x,y,z)},$scale:function $scale(dest,x,y,z){dest[0]*=x;dest[1]*=x;dest[2]*=x;dest[3]*=x;dest[4]*=y;dest[5]*=y;dest[6]*=y;dest[7]*=y;dest[8]*=z;dest[9]*=z;dest[10]*=z;dest[11]*=z;return dest},invert:function invert(dest){var m=Mat4.clone(dest);return Mat4.$invert(m)},$invert:function $invert(dest){var x0=dest[0],x1=dest[1],x2=dest[2],x3=dest[3],x4=dest[4],x5=dest[5],x6=dest[6],x7=dest[7],x8=dest[8],x9=dest[9],x10=dest[10],x11=dest[11],x12=dest[12],x13=dest[13],x14=dest[14],x15=dest[15];var a0=x0*x5-x1*x4,a1=x0*x6-x2*x4,a2=x0*x7-x3*x4,a3=x1*x6-x2*x5,a4=x1*x7-x3*x5,a5=x2*x7-x3*x6,b0=x8*x13-x9*x12,b1=x8*x14-x10*x12,b2=x8*x15-x11*x12,b3=x9*x14-x10*x13,b4=x9*x15-x11*x13,b5=x10*x15-x11*x14;var invdet=1/(a0*b5-a1*b4+a2*b3+a3*b2-a4*b1+a5*b0);dest[0]=(+x5*b5-x6*b4+x7*b3)*invdet;dest[1]=(-x1*b5+x2*b4-x3*b3)*invdet;dest[2]=(+x13*a5-x14*a4+x15*a3)*invdet;dest[3]=(-x9*a5+x10*a4-x11*a3)*invdet;dest[4]=(-x4*b5+x6*b2-x7*b1)*invdet;dest[5]=(+x0*b5-x2*b2+x3*b1)*invdet;dest[6]=(-x12*a5+x14*a2-x15*a1)*invdet;dest[7]=(+x8*a5-x10*a2+x11*a1)*invdet;dest[8]=(+x4*b4-x5*b2+x7*b0)*invdet;dest[9]=(-x0*b4+x1*b2-x3*b0)*invdet;dest[10]=(+x12*a4-x13*a2+x15*a0)*invdet;dest[11]=(-x8*a4+x9*a2-x11*a0)*invdet;dest[12]=(-x4*b3+x5*b1-x6*b0)*invdet;dest[13]=(+x0*b3-x1*b1+x2*b0)*invdet;dest[14]=(-x12*a3+x13*a1-x14*a0)*invdet;dest[15]=(+x8*a3-x9*a1+x10*a0)*invdet;return dest},lookAt:function lookAt(dest,eye,center,up){var z=Vec3.sub(eye,center);z.$unit();var x=Vec3.cross(up,z);x.$unit();var y=Vec3.cross(z,x);y.$unit();return Mat4.set(dest,x[0],x[1],x[2],-x.dot(eye),y[0],y[1],y[2],-y.dot(eye),z[0],z[1],z[2],-z.dot(eye),0,0,0,1)},frustum:function frustum(dest,left,right,bottom,top,near,far){var rl=right-left,tb=top-bottom,fn=far-near;dest[0]=near*2/rl;dest[1]=0;dest[2]=0;dest[3]=0;dest[4]=0;dest[5]=near*2/tb;dest[6]=0;dest[7]=0;dest[8]=(right+left)/rl;dest[9]=(top+bottom)/tb;dest[10]=-(far+near)/fn;dest[11]=-1;dest[12]=0;dest[13]=0;dest[14]=-(far*near*2)/fn;dest[15]=0;return dest},perspective:function perspective(dest,fov,aspect,near,far){var ymax=near*tan(fov*pi/360),ymin=-ymax,xmin=ymin*aspect,xmax=ymax*aspect;return Mat4.frustum(dest,xmin,xmax,ymin,ymax,near,far)},ortho:function ortho(dest,left,right,top,bottom,near,far){var te=this.elements,w=right-left,h=top-bottom,p=far-near,x=(right+left)/w,y=(top+bottom)/h,z=(far+near)/p;dest[0]=2/w;dest[4]=0;dest[8]=0;dest[12]=-x;dest[1]=0;dest[5]=2/h;dest[9]=0;dest[13]=-y;dest[2]=0;dest[6]=0;dest[10]=-2/p;dest[14]=-z;dest[3]=0;dest[7]=0;dest[11]=0;dest[15]=1;return dest},toFloat32Array:function toFloat32Array(dest){var ans=dest.typedContainer;if(!ans){return dest}ans[0]=dest[0];ans[1]=dest[1];ans[2]=dest[2];ans[3]=dest[3];ans[4]=dest[4];ans[5]=dest[5];ans[6]=dest[6];ans[7]=dest[7];ans[8]=dest[8];ans[9]=dest[9];ans[10]=dest[10];ans[11]=dest[11];ans[12]=dest[12];ans[13]=dest[13];ans[14]=dest[14];ans[15]=dest[15];return ans}};proto=Mat4.prototype;for(method in generics){Mat4[method]=generics[method];proto[method]=function(m){return function(){var args=slice.call(arguments);args.unshift(this);return Mat4[m].apply(Mat4,args)}}(method)}var Quat=exports.Quat=function(_extendableBuiltin6){_inherits(Quat,_extendableBuiltin6);function Quat(x,y,z,w){_classCallCheck(this,Quat);var _this3=_possibleConstructorReturn(this,(Quat.__proto__||Object.getPrototypeOf(Quat)).call(this,4));_this3[0]=x||0;_this3[1]=y||0;_this3[2]=z||0;_this3[3]=w||0;_this3.typedContainer=new Float32Array(4);return _this3}_createClass(Quat,null,[{key:"create",value:function create(){return new Array(4)}},{key:"fromVec3",value:function fromVec3(v,r){return new Quat(v[0],v[1],v[2],r||0)}},{key:"fromMat4",value:function fromMat4(m){var u;var v;var w;if(m[0]>m[5]&&m[0]>m[10]){u=0;v=1;w=2}else if(m[5]>m[0]&&m[5]>m[10]){u=1;v=2;w=0}else{u=2;v=0;w=1}var r=sqrt(1+m[u*5]-m[v*5]-m[w*5]);var q=new Quat;q[u]=.5*r;q[v]=.5*(m["n"+v+""+u]+m["n"+u+""+v])/r;q[w]=.5*(m["n"+u+""+w]+m["n"+w+""+u])/r;q[3]=.5*(m["n"+v+""+w]-m["n"+w+""+v])/r;return q}},{key:"fromXRotation",value:function fromXRotation(angle){return new Quat(sin(angle/2),0,0,cos(angle/2))}},{key:"fromYRotation",value:function fromYRotation(angle){return new Quat(0,sin(angle/2),0,cos(angle/2))}},{key:"fromZRotation",value:function fromZRotation(angle){return new Quat(0,0,sin(angle/2),cos(angle/2))}},{key:"fromAxisRotation",value:function fromAxisRotation(vec,angle){var x=vec[0],y=vec[1],z=vec[2],d=1/sqrt(x*x+y*y+z*z),s=sin(angle/2),c=cos(angle/2);return new Quat(s*x*d,s*y*d,s*z*d,c)}}]);return Quat}(_extendableBuiltin5(Array));generics={setQuat:function setQuat(dest,q){dest[0]=q[0];dest[1]=q[1];dest[2]=q[2];dest[3]=q[3];return dest},set:function set(dest,x,y,z,w){dest[0]=x||0;dest[1]=y||0;dest[2]=z||0;dest[3]=w||0;return dest},clone:function clone(dest){if(dest instanceof Quat){return new Quat(dest[0],dest[1],dest[2],dest[3])}return Quat.setQuat(new typedArray(4),dest)},neg:function neg(dest){return new Quat(-dest[0],-dest[1],-dest[2],-dest[3])},$neg:function $neg(dest){dest[0]=-dest[0];dest[1]=-dest[1];dest[2]=-dest[2];dest[3]=-dest[3];return dest},add:function add(dest,q){return new Quat(dest[0]+q[0],dest[1]+q[1],dest[2]+q[2],dest[3]+q[3])},$add:function $add(dest,q){dest[0]+=q[0];dest[1]+=q[1];dest[2]+=q[2];dest[3]+=q[3];return dest},sub:function sub(dest,q){return new Quat(dest[0]-q[0],dest[1]-q[1],dest[2]-q[2],dest[3]-q[3])},$sub:function $sub(dest,q){dest[0]-=q[0];dest[1]-=q[1];dest[2]-=q[2];dest[3]-=q[3];return dest},scale:function scale(dest,s){return new Quat(dest[0]*s,dest[1]*s,dest[2]*s,dest[3]*s)},$scale:function $scale(dest,s){dest[0]*=s;dest[1]*=s;dest[2]*=s;dest[3]*=s;return dest},mulQuat:function mulQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];return new Quat(aW*bX+aX*bW+aY*bZ-aZ*bY,aW*bY+aY*bW+aZ*bX-aX*bZ,aW*bZ+aZ*bW+aX*bY-aY*bX,aW*bW-aX*bX-aY*bY-aZ*bZ)},$mulQuat:function $mulQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];dest[0]=aW*bX+aX*bW+aY*bZ-aZ*bY;dest[1]=aW*bY+aY*bW+aZ*bX-aX*bZ;dest[2]=aW*bZ+aZ*bW+aX*bY-aY*bX;dest[3]=aW*bW-aX*bX-aY*bY-aZ*bZ;return dest},divQuat:function divQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];var d=1/(bW*bW+bX*bX+bY*bY+bZ*bZ);return new Quat((aX*bW-aW*bX-aY*bZ+aZ*bY)*d,(aX*bZ-aW*bY+aY*bW-aZ*bX)*d,(aY*bX+aZ*bW-aW*bZ-aX*bY)*d,(aW*bW+aX*bX+aY*bY+aZ*bZ)*d)},$divQuat:function $divQuat(dest,q){var aX=dest[0],aY=dest[1],aZ=dest[2],aW=dest[3],bX=q[0],bY=q[1],bZ=q[2],bW=q[3];var d=1/(bW*bW+bX*bX+bY*bY+bZ*bZ);dest[0]=(aX*bW-aW*bX-aY*bZ+aZ*bY)*d;dest[1]=(aX*bZ-aW*bY+aY*bW-aZ*bX)*d;dest[2]=(aY*bX+aZ*bW-aW*bZ-aX*bY)*d;dest[3]=(aW*bW+aX*bX+aY*bY+aZ*bZ)*d;return dest},invert:function invert(dest){var q0=dest[0],q1=dest[1],q2=dest[2],q3=dest[3];var d=1/(q0*q0+q1*q1+q2*q2+q3*q3);return new Quat(-q0*d,-q1*d,-q2*d,q3*d)},$invert:function $invert(dest){var q0=dest[0],q1=dest[1],q2=dest[2],q3=dest[3];var d=1/(q0*q0+q1*q1+q2*q2+q3*q3);dest[0]=-q0*d;dest[1]=-q1*d;dest[2]=-q2*d;dest[3]=q3*d;return dest},norm:function norm(dest){var a=dest[0],b=dest[1],c=dest[2],d=dest[3];return sqrt(a*a+b*b+c*c+d*d)},normSq:function normSq(dest){var a=dest[0],b=dest[1],c=dest[2],d=dest[3];return a*a+b*b+c*c+d*d},unit:function unit(dest){return Quat.scale(dest,1/Quat.norm(dest))},$unit:function $unit(dest){return Quat.$scale(dest,1/Quat.norm(dest))},conjugate:function conjugate(dest){return new Quat(-dest[0],-dest[1],-dest[2],dest[3])},$conjugate:function $conjugate(dest){dest[0]=-dest[0];dest[1]=-dest[1];dest[2]=-dest[2];return dest}};proto=Quat.prototype={};for(method in generics){Quat[method]=generics[method];proto[method]=function(m){return function(){var args=slice.call(arguments);args.unshift(this);return Quat[m].apply(Quat,args)}}(method)}Vec3.fromQuat=function(q){return new Vec3(q[0],q[1],q[2])};Mat4.fromQuat=function(q){var a=q[3],b=q[0],c=q[1],d=q[2];return new Mat4(a*a+b*b-c*c-d*d,2*b*c-2*a*d,2*b*d+2*a*c,0,2*b*c+2*a*d,a*a-b*b+c*c-d*d,2*c*d-2*a*b,0,2*b*d-2*a*c,2*c*d+2*a*b,a*a-b*b-c*c+d*d,0,0,0,0,1)}},{}],167:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _object3d=require("./object-3d");var _object3d2=_interopRequireDefault(_object3d);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Group=function(_Object3D){_inherits(Group,_Object3D);function Group(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Group);var _opts$children=opts.children,children=_opts$children===undefined?[]:_opts$children;children.every(function(child){return(0,_assert2.default)(child instanceof _object3d2.default)});var _this=_possibleConstructorReturn(this,(Group.__proto__||Object.getPrototypeOf(Group)).call(this,opts));_this.children=children;return _this}_createClass(Group,[{key:"add",value:function add(){for(var _len=arguments.length,children=Array(_len),_key=0;_key<_len;_key++){children[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var child=_step.value;if(Array.isArray(child)){this.add.apply(this,_toConsumableArray(child))}else{this.children.push(child)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return this}},{key:"remove",value:function remove(child){var children=this.children;var indexOf=children.indexOf(child);if(indexOf>-1){children.splice(indexOf,1)}return this}},{key:"removeAll",value:function removeAll(){this.children=[];return this}}]);return Group}(_object3d2.default);exports.default=Group},{"./object-3d":169,assert:1}],168:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _object3d=require("./object-3d");Object.defineProperty(exports,"Object3D",{enumerable:true,get:function get(){return _interopRequireDefault(_object3d).default}});var _group=require("./group");Object.defineProperty(exports,"Group",{enumerable:true,get:function get(){return _interopRequireDefault(_group).default}});var _scene=require("./scene");Object.defineProperty(exports,"Scene",{enumerable:true,get:function get(){return _interopRequireDefault(_scene).default}});var _pick=require("./pick");Object.defineProperty(exports,"pickModels",{enumerable:true,get:function get(){return _pick.pickModels}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./group":167,"./object-3d":169,"./pick":170,"./scene":171}],169:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../../utils");var _math=require("../math");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Object3D=function(){function Object3D(_ref){var id=_ref.id,_ref$display=_ref.display,display=_ref$display===undefined?true:_ref$display;_classCallCheck(this,Object3D);this.position=new _math.Vec3;this.rotation=new _math.Vec3;this.scale=new _math.Vec3(1,1,1);this.matrix=new _math.Mat4;this.id=id||(0,_utils.uid)(this.constructor.name);this.display=true;this.userData={}}_createClass(Object3D,[{key:"setPosition",value:function setPosition(position){(0,_assert2.default)(position.length===3,"setPosition requires vector argument");this.position=position;return this}},{key:"setRotation",value:function setRotation(rotation){(0,_assert2.default)(rotation.length===3,"setRotation requires vector argument");this.rotation=rotation;return this}},{key:"setScale",value:function setScale(scale){(0,_assert2.default)(scale.length===3,"setScale requires vector argument");this.scale=scale;return this}},{key:"setMatrixComponents",value:function setMatrixComponents(_ref2){var position=_ref2.position,rotation=_ref2.rotation,scale=_ref2.scale,_ref2$update=_ref2.update,update=_ref2$update===undefined?true:_ref2$update;if(position){this.setPosition(position)}if(rotation){this.setRotation(rotation)}if(scale){this.setScale(scale)}if(update){this.updateMatrix()}return this}},{key:"updateMatrix",value:function updateMatrix(){var pos=this.position;var rot=this.rotation;var scale=this.scale;this.matrix.id();this.matrix.$translate(pos[0],pos[1],pos[2]);this.matrix.$rotateXYZ(rot[0],rot[1],rot[2]);this.matrix.$scale(scale[0],scale[1],scale[2]);return this}},{key:"update",value:function update(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},position=_ref3.position,rotation=_ref3.rotation,scale=_ref3.scale;if(position){this.setPosition(position)}if(rotation){this.setRotation(rotation)}if(scale){this.setScale(scale)}this.updateMatrix();return this}},{key:"getCoordinateUniforms",value:function getCoordinateUniforms(viewMatrix,modelMatrix){(0,_assert2.default)(viewMatrix);modelMatrix=modelMatrix||this.matrix;var worldMatrix=(new _math.Mat4).copy(viewMatrix).mulMat4(modelMatrix);var worldInverse=worldMatrix.invert();var worldInverseTranspose=worldInverse.transpose();return{viewMatrix:viewMatrix,modelMatrix:modelMatrix,objectMatrix:modelMatrix,worldMatrix:worldMatrix,worldInverseMatrix:worldInverse,worldInverseTransposeMatrix:worldInverseTranspose}}},{key:"transform",value:function transform(){if(!this.parent){this.endPosition.setVec3(this.position);this.endRotation.setVec3(this.rotation);this.endScale.setVec3(this.scale)}else{var parent=this.parent;this.endPosition.setVec3(this.position.add(parent.endPosition));this.endRotation.setVec3(this.rotation.add(parent.endRotation));this.endScale.setVec3(this.scale.add(parent.endScale))}var ch=this.children;for(var i=0;i<ch.length;++i){ch[i].transform()}return this}}]);return Object3D}();exports.default=Object3D},{"../../utils":221,"../math":166,assert:1}],170:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pickModels=pickModels;var _webgl=require("../../webgl");var _webglChecks=require("../../webgl/webgl-checks");var _group=require("./group");var _group2=_interopRequireDefault(_group);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ILLEGAL_ARG="Illegal argument to pick";function pickModels(gl,_ref){var group=_ref.group,uniforms=_ref.uniforms,x=_ref.x,y=_ref.y,_ref$framebuffer=_ref.framebuffer,framebuffer=_ref$framebuffer===undefined?null:_ref$framebuffer,_ref$pickingFBO=_ref.pickingFBO,pickingFBO=_ref$pickingFBO===undefined?null:_ref$pickingFBO,_ref$pickingProgram=_ref.pickingProgram,pickingProgram=_ref$pickingProgram===undefined?null:_ref$pickingProgram,_ref$pickingColors=_ref.pickingColors,pickingColors=_ref$pickingColors===undefined?null:_ref$pickingColors;(0,_webglChecks.assertWebGLContext)(gl);(0,_assert2.default)(group instanceof _group2.default,ILLEGAL_ARG);var dpr=typeof window!=="undefined"?window.devicePixelRatio:1;var deviceX=x*dpr;var deviceY=gl.canvas.height-y*dpr;framebuffer=framebuffer||pickingFBO||new _webgl.Framebuffer(gl,{width:gl.canvas.width,height:gl.canvas.height});framebuffer.resize({width:gl.canvas.width,height:gl.canvas.height});return(0,_webgl.glContextWithState)(gl,{framebuffer:framebuffer,scissorTest:{x:deviceX,y:deviceY,w:1,h:1}},function(){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=group.traverseReverse()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var model=_step.value;if(model.isPickable()){gl.clear(_webgl.GL.COLOR_BUFFER_BIT|_webgl.GL.DEPTH_BUFFER_BIT);model.setUniforms({renderPickingBuffer:1,enablePicking:true});model.render(uniforms);model.setUniforms({renderPickingBuffer:false,enablePicking:false});var color=new Uint8Array(4);gl.readPixels(deviceX,deviceY,1,1,gl.RGBA,gl.UNSIGNED_BYTE,color);var isPicked=color[0]!==0||color[1]!==0||color[2]!==0||color[3]!==0;if(isPicked){return{model:model,color:color,x:x,y:y,deviceX:deviceX,deviceY:deviceY}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return null})}},{"../../webgl":231,"../../webgl/webgl-checks":243,"./group":167,assert:1}],171:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _config=require("../../core/config");var config=_interopRequireWildcard(_config);var _math=require("../../packages/math");var _utils=require("../../utils");var _group=require("./group");var _group2=_interopRequireDefault(_group);var _pick=require("./pick");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var INVALID_ARGUMENT="LumaGL.Scene invalid argument";var DEFAULT_SCENE_OPTS={lights:{enable:false,ambient:{r:.2,g:.2,b:.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false},clearColor:true,clearDepth:true,backgroundColor:{r:0,g:0,b:0,a:1},backgroundDepth:1};var Scene=function(_Group){_inherits(Scene,_Group);function Scene(gl,opts){_classCallCheck(this,Scene);(0,_assert2.default)(gl,INVALID_ARGUMENT);opts=(0,_utils.merge)(DEFAULT_SCENE_OPTS,opts);var _this=_possibleConstructorReturn(this,(Scene.__proto__||Object.getPrototypeOf(Scene)).call(this,opts));_this.gl=gl;_this.config=opts;_this.needsRedraw=false;Object.seal(_this);return _this}_createClass(Scene,[{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=redraw;return this}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$clearRedrawFlags=_ref.clearRedrawFlags,clearRedrawFlags=_ref$clearRedrawFlags===undefined?false:_ref$clearRedrawFlags;var redraw=false;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.traverse()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var model=_step.value;redraw=redraw||model.getNeedsRedraw({clearRedrawFlags:clearRedrawFlags})}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return redraw}},{key:"clear",value:function clear(){var gl=this.gl;if(this.config.clearColor){var bg=this.config.backgroundColor;gl.clearColor(bg.r,bg.g,bg.b,bg.a)}if(this.config.clearDepth){gl.clearDepth(this.config.backgroundDepth)}if(this.config.clearColor&&this.config.clearDepth){gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)}else if(this.config.clearColor){gl.clear(gl.COLOR_BUFFER_BIT)}else if(this.config.clearDepth){gl.clear(gl.DEPTH_BUFFER_BIT)}return this}},{key:"render",value:function render(){var uniforms=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.clear();var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.traverse()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var model=_step2.value;if(model.display){this.renderObject({model:model,uniforms:uniforms})}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return this}},{key:"renderObject",value:function renderObject(_ref2){var model=_ref2.model,uniforms=_ref2.uniforms;model.render(Object.assign({},this.getSceneUniforms(),{uniforms:uniforms}));return this}},{key:"pickModels",value:function pickModels(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var x=opts.x,y=opts.y,_opts$uniforms=opts.uniforms,uniforms=_opts$uniforms===undefined?{}:_opts$uniforms;return(0,_pick.pickModels)(this.gl,Object.assign({group:this,x:x,y:y,uniforms:uniforms},opts))}},{key:"getSceneUniforms",value:function getSceneUniforms(){var _config$lights=this.config.lights,enable=_config$lights.enable,ambient=_config$lights.ambient,directional=_config$lights.directional,points=_config$lights.points;return Object.assign({},this.getEffectsUniforms(),{enableLights:enable},enable&&ambient?this.getAmbientUniforms(ambient):{},enable&&directional?this.getDirectionalUniforms(directional):{},enable&&points?this.getPointUniforms(points):{})}},{key:"getAmbientUniforms",value:function getAmbientUniforms(ambient){return{ambientColor:[ambient.r,ambient.g,ambient.b]}}},{key:"getDirectionalUniforms",value:function getDirectionalUniforms(directional){var color=directional.color,direction=directional.direction;var dir=new _math.Vector3(direction.x,direction.y,direction.z).normalize().scale(-1,-1,-1)
;return{directionalColor:[color.r,color.g,color.b],lightingDirection:[dir.x,dir.y,dir.z]}}},{key:"getPointUniforms",value:function getPointUniforms(points){points=points instanceof Array?points:[points];var numberPoints=points.length;var uniforms={numberPoints:numberPoints};var pointLocations=[];var pointColors=[];var enableSpecular=[];var pointSpecularColors=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=points[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var point=_step3.value;var position=point.position,color=point.color,diffuse=point.diffuse,specular=point.specular;var pointColor=color||diffuse;pointLocations.push(position.x,position.y,position.z);pointColors.push(pointColor.r,pointColor.g,pointColor.b);enableSpecular.push(Number(Boolean(specular)));if(specular){pointSpecularColors.push(specular.r,specular.g,specular.b)}else{pointSpecularColors.push(0,0,0)}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}if(pointLocations.length){Object.assign(uniforms,{pointLocation:pointLocations,pointColor:pointColors,enableSpecular:enableSpecular,pointSpecularColor:pointSpecularColors})}return uniforms}},{key:"getEffectsUniforms",value:function getEffectsUniforms(){var fog=this.config.effects.fog;if(fog){var _fog$color=fog.color,color=_fog$color===undefined?{r:.5,g:.5,b:.5}:_fog$color;return{hasFog:true,fogNear:fog.near,fogFar:fog.far,fogColor:[color.r,color.g,color.b]}}return{hasFog:false}}}]);return Scene}(_group2.default);exports.default=Scene;Scene.MAX_TEXTURES=config.MAX_TEXTURES;Scene.MAX_POINT_LIGHTS=config.MAX_POINT_LIGHTS;Scene.PICKING_RES=config.PICKING_RES},{"../../core/config":160,"../../packages/math":209,"../../utils":221,"./group":167,"./pick":170,assert:1}],172:[function(require,module,exports){"use strict";module.exports={hasTexture1:false,hasTextureCube1:false,enableLights:false,useReflection:false,enablePicking:false,hasPickingColors:false,hasFog:false}},{}],173:[function(require,module,exports){"use strict";var _path=require("path");var vs="#define SHADER_NAME luma-default-vertex\n\n#define LIGHT_MAX 4\n\n// object attributes\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 colors;\nattribute vec4 pickingColors;\nattribute vec2 texCoords;\n\n// camera and object matrices\nuniform mat4 viewMatrix;\nuniform mat4 viewInverseMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\n\n// objectMatrix * viewMatrix = worldMatrix\nuniform mat4 worldMatrix;\nuniform mat4 worldInverseMatrix;\nuniform mat4 worldInverseTransposeMatrix;\nuniform mat4 objectMatrix;\nuniform vec3 cameraPosition;\n\n// lighting configuration\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\n\n// point lights configuration\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\n\n// reflection / refraction configuration\nuniform bool useReflection;\n\n// varyings\nvarying vec3 vReflection;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec4 vNormal;\nvarying vec3 lightWeighting;\n\nvoid main(void) {\n  vec4 mvPosition = worldMatrix * vec4(positions, 1.0);\n  vec4 transformedNormal = worldInverseTransposeMatrix * vec4(normals, 1.0);\n\n  // lighting code\n  if(!enableLights) {\n    lightWeighting = vec3(1.0, 1.0, 1.0);\n  } else {\n    vec3 plightDirection;\n    vec3 pointWeight = vec3(0.0, 0.0, 0.0);\n    float directionalLightWeighting =\n      max(dot(transformedNormal.xyz, lightingDirection), 0.0);\n    for (int i = 0; i < LIGHT_MAX; i++) {\n      if (i < numberPoints) {\n        plightDirection = normalize(\n          (viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\n         pointWeight += max(\n          dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n       } else {\n         break;\n       }\n     }\n\n    lightWeighting = ambientColor +\n      (directionalColor * directionalLightWeighting) + pointWeight;\n  }\n\n  // refraction / reflection code\n  if (useReflection) {\n    vReflection =\n      (viewInverseMatrix[3] - (worldMatrix * vec4(positions, 1.0))).xyz;\n  } else {\n    vReflection = vec3(1.0, 1.0, 1.0);\n  }\n\n  // pass results to varyings\n  vColor = colors;\n  vPickingColor = pickingColors;\n  vTexCoord = texCoords;\n  vNormal = transformedNormal;\n  gl_Position = projectionMatrix * worldMatrix * vec4(positions, 1.0);\n}\n";var fs="#define SHADER_NAME luma-default-fragment\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\n// varyings\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvarying vec3 vReflection;\nvarying vec4 vNormal;\n\n// texture configs\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool hasTextureCube1;\nuniform samplerCube samplerCube1;\n\n// picking configs\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\n\n// reflection / refraction configs\nuniform float reflection;\nuniform float refraction;\n\n// fog configuration\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n\nvoid main(){\n  // set color from texture\n  if (!hasTexture1) {\n    gl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n  } else {\n    gl_FragColor =\n      vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb *\n      lightWeighting, 1.0);\n  }\n\n  // has cube texture then apply reflection\n  // if (hasTextureCube1) {\n  //   vec3 nReflection = normalize(vReflection);\n  //   vec3 reflectionValue;\n  //   if (refraction > 0.0) {\n  //    reflectionValue = refract(nReflection, vNormal.xyz, refraction);\n  //   } else {\n  //    reflectionValue = -reflect(nReflection, vNormal.xyz);\n  //   }\n\n  //   // TODO(nico): check whether this is right.\n  //   vec4 cubeColor = textureCube(samplerCube1,\n  //       vec3(-reflectionValue.x, -reflectionValue.y, reflectionValue.z));\n  //   gl_FragColor = vec4(mix(gl_FragColor.xyz, cubeColor.xyz, reflection), 1.0);\n  // }\n\n  // set picking\n  if (enablePicking) {\n    if (hasPickingColors) {\n      gl_FragColor = vPickingColor;\n    } else {\n      gl_FragColor = vec4(pickColor, 1.0);\n    }\n  }\n\n  // handle fog\n  // if (hasFog) {\n  //   float depth = gl_FragCoord.z / gl_FragCoord.w;\n  //   float fogFactor = smoothstep(fogNear, fogFar, depth);\n  //   gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n  // }\n}\n";var defaultUniforms=require("./default-uniforms");module.exports={default:{vs:vs,fs:fs,defaultUniforms:defaultUniforms}}},{"./default-uniforms":172,path:250}],174:[function(require,module,exports){(function(Buffer){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fragmentShader=exports.vertexShader=exports.name=undefined;exports.getUniforms=getUniforms;var _path=require("path");var name=exports.name="fog";var vertexShader=exports.vertexShader="";var fragmentShader=exports.fragmentShader=Buffer("Ly8gZm9nIGNvbmZpZ3VyYXRpb24KdW5pZm9ybSBib29sIGZvZ191RW5hYmxlOwp1bmlmb3JtIHZlYzMgZm9nX3VDb2xvcjsKdW5pZm9ybSBmbG9hdCBmb2dfdU5lYXI7CnVuaWZvcm0gZmxvYXQgZm9nX3VGYXI7CgovKgogKiBBcHBsaWVzIGxpbmVhciBmb2cgdG8gYSBjb2xvcgogKiBwYXJhbSAtIHVuZm9nZ2VkIGNvbG9yCiAqIHJldHVybiAtIGZvZ2dlZCBjb2xvcgogKi8KdmVjNCBmb2dfZmlsdGVyQ29sb3IodmVjNCBjb2xvcikgewogIGlmIChmb2dfdUVuYWJsZSkgewogICAgZmxvYXQgZGVwdGggPSBnbF9GcmFnQ29vcmQueiAvIGdsX0ZyYWdDb29yZC53OwogICAgZmxvYXQgZm9nRmFjdG9yID0gc21vb3Roc3RlcChmb2dfdU5lYXIsIGZvZ191RmFyLCBkZXB0aCk7CiAgICByZXR1cm4gbWl4KGNvbG9yLCB2ZWM0KGZvZ191Q29sb3IsIGdsX0ZyYWdDb2xvci53KSwgZm9nRmFjdG9yKTsKICB9IGVsc2UgewogIAlyZXR1cm4gY29sb3I7CiAgfQp9CgovLyBPdGhlciBmb2cgc2hhZGVycywgZXhwb25lbnRpYWwgZXRjLCBzZWUKLy8gaHR0cDovL2luMmdwdS5jb20vMjAxNC8wNy8yMi9jcmVhdGUtZm9nLXNoYWRlci8K","base64");function getUniforms(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$fogEnable=_ref.fogEnable,fogEnable=_ref$fogEnable===undefined?false:_ref$fogEnable,_ref$fogColor=_ref.fogColor,fogColor=_ref$fogColor===undefined?[.5,.5,.5]:_ref$fogColor,_ref$fogNear=_ref.fogNear,fogNear=_ref$fogNear===undefined?1:_ref$fogNear,_ref$fogFar=_ref.fogFar,fogFar=_ref$fogFar===undefined?100:_ref$fogFar;return{fog_uEnable:fogEnable,fog_uColor:fogColor,fog_uNear:fogNear,fog_uFar:fogFar}}}).call(this,require("buffer").Buffer)},{buffer:3,path:250}],175:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.vertexShader=exports.name=undefined;var _mathFp=require("./math-fp64");Object.keys(_mathFp).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _mathFp[key]}})});var _path=require("path");var name=exports.name="fp64";var vertexShader=exports.vertexShader='// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nuniform float ONE;\n\nconst vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);\nconst vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);\nconst vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);\nconst vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);\nconst vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);\nconst vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);\nconst vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);\nconst vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);\nconst vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);\n\nconst vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);\nconst vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);\nconst vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);\nconst vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);\n\nconst vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);\nconst vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);\nconst vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);\nconst vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);\n\nconst vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09); // 1/3!\nconst vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09); // 1/4!\nconst vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10); // 1/5!\nconst vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11); // 1/6!\nconst vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12); // 1/7!\nconst vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13); // 1/8!\nconst vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14); // 1/9!\nconst vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15); // 1/10!\n\nfloat nint(float d) {\n    if (d == floor(d)) return d;\n    return floor(d + 0.5);\n}\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n  return vec2(a_hi, a_lo);\n}\n#else\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n  return vec2(a_hi, a_lo);\n}\n#endif\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\nvec2 quickTwoSum(float a, float b) {\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n  return vec2(sum, err);\n}\n#else\nvec2 quickTwoSum(float a, float b) {\n  float sum = a + b;\n  float err = b - (sum - a);\n  return vec2(sum, err);\n}\n#endif\n\nvec2 nint_fp64(vec2 a) {\n    float hi = nint(a.x);\n    float lo;\n    vec2 tmp;\n    if (hi == a.x) {\n        lo = nint(a.y);\n        tmp = quickTwoSum(hi, lo);\n    } else {\n        lo = 0.0;\n        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {\n            hi -= 1.0;\n        }\n        tmp = vec2(hi, lo);\n    }\n    return tmp;\n}\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\nvec2 twoSum(float a, float b) {\n  float s = (a + b) * ONE;\n  float v = (s - a);\n  float err = (a - (s - v) * ONE) * ONE + (b - v);\n  return vec2(s, err);\n}\n#else\nvec2 twoSum(float a, float b) {\n  float s = a + b;\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n  return vec2(s, err);\n}\n#endif\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\nvec2 twoSub(float a, float b) {\n  float s = (a - b) * ONE;\n  float v = (s - a);\n  float err = (a - (s - v) * ONE) * ONE - (b + v);\n  return vec2(s, err);\n}\n#else\nvec2 twoSub(float a, float b) {\n  float s = a - b;\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n  return vec2(s, err);\n}\n#endif\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x * a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n  return vec2(prod, err);\n}\n#else\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n  return vec2(prod, err);\n}\n#endif\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n  prod.y += a.y * b.x;\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n  vec2 yn = a * xn;\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n  return sum_fp64(vec2(yn, 0.0), prod);\n}\n\nvec2 exp_fp64(vec2 a) {\n  const float k = 512.0;\n  const float inv_k = 1.0 / k;\n\n  if (a.x <= -88.0) return vec2(0.0, 0.0);\n  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);\n  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);\n  if (a.x == 1.0 && a.y == 0.0) return E_FP64;\n\n  // Range reduction using assume a = kr + m * log(2), k and m being integers.\n  // Set k = 9 (we can choose other k to trade accuracy with performance.\n  // we only need to calculate exp(r) and using exp(a) = 2^m * exp(r)^k\n\n  float m = floor(a.x / LOG2_FP64.x + 0.5);\n  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;\n  vec2 s, t, p;\n\n  p = mul_fp64(r, r);\n  s = sum_fp64(r, p * 0.5);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_6_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_7_FP64);\n\n  s = sum_fp64(s, t);\n\n  // At this point, s = exp(r) - 1; but after following 4 recursions, we will get exp(r) ^ 512 - 1.\n\n  s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  s = sum_fp64(s * 2.0, mul_fp64(s, s));\n\n  // We can add more iterations here and increase k.\n  s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  s = sum_fp64(s * 2.0, mul_fp64(s, s));\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = sum_fp64(s, vec2(1.0, 0.0) * ONE);\n#else\n  s = sum_fp64(s, vec2(1.0, 0.0));\n#endif\n\n  return s * pow(2.0, m);\n//   return r;\n}\n\nvec2 log_fp64(vec2 a)\n{\n  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n  vec2 x = vec2(log(a.x), 0.0);\n  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), vec2(1.0, 0.0));\n  return x;\n}\n\nvec2 sin_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(0.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  s = a;\n  r = a;\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_7_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_9_FP64);\n  s = sum_fp64(s, t);\n\n  return s;\n}\n\nvec2 cos_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(1.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  r = x;\n  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_8_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_10_FP64);\n  s = sum_fp64(s, t);\n\n  return s;\n}\n\nvoid sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {\n  if (a.x == 0.0 && a.y == 0.0) {\n    sin_t = vec2(0.0, 0.0);\n    cos_t = vec2(1.0, 0.0);\n  }\n\n  sin_t = sin_taylor_fp64(a);\n  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));\n}\n\nvec2 sin_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return sin_taylor_fp64(t);\n        } else if (j == 1) {\n            return cos_taylor_fp64(t);\n        } else if (j == -1) {\n            return -cos_taylor_fp64(t);\n        } else {\n            return -sin_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else if (k == 3) {\n        t = sub_fp64(t, PI_16_3_FP64);\n    } else if (k == -3) {\n        t = sum_fp64(t, PI_16_3_FP64);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 cos_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(1.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return cos_taylor_fp64(t);\n        } else if (j == 1) {\n            return -sin_taylor_fp64(t);\n        } else if (j == -1) {\n            return sin_taylor_fp64(t);\n        } else {\n            return -cos_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else if (k == 3) {\n        t = sub_fp64(t, PI_16_3_FP64);\n    } else if (k == -3) {\n        t = sum_fp64(t, PI_16_3_FP64);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 tan_fp64(vec2 a) {\n    vec2 sin_a;\n    vec2 cos_a;\n\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    // We just can\'t get PI/16 * 3.0 very accurately.\n    // so let\'s just store it\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else if (k == 3) {\n        t = sub_fp64(t, PI_16_3_FP64);\n    } else if (k == -3) {\n        t = sum_fp64(t, PI_16_3_FP64);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n    vec2 sin_t, cos_t;\n    vec2 s, c;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n#if defined(NVIDIA_EQUATION_WORKAROUND) || defined(INTEL_EQUATION_WORKAROUND)\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#else\n        if (abs_k == 1) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs_k == 2) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs_k == 3) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs_k == 4) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#endif\n        if (k > 0) {\n            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return div_fp64(sin_a, cos_a);\n}\n\nvec2 radians_fp64(vec2 degree) {\n  return div_fp64(mul_fp64(degree, PI_FP64), vec2(180.0, 0.0));\n}\n\n// Vector functions\n// vec2 functions\nvoid vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sum_fp64(a[0], b[0]);\n    out_val[1] = sum_fp64(a[1], b[1]);\n}\n\nvoid vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sub_fp64(a[0], b[0]);\n    out_val[1] = sub_fp64(a[1], b[1]);\n}\n\nvoid vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {\n  vec2 range[2];\n  vec2_sub_fp64(y, x, range);\n  vec2 portion[2];\n  portion[0] = range[0] * a;\n  portion[1] = range[1] * a;\n  vec2_sum_fp64(x, portion, out_val);\n}\n\nvec2 vec2_length_fp64(vec2 x[2]) {\n  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));\n}\n\nvec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {\n  vec2 diff[2];\n  vec2_sub_fp64(x, y, diff);\n  return vec2_length_fp64(diff);\n}\n\n// vec3 functions\nvoid vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvec2 vec3_length_fp64(vec2 x[3]) {\n  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])), mul_fp64(x[2], x[2])));\n}\n\nvec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {\n  vec2 diff[3];\n  vec3_sub_fp64(x, y, diff);\n  return vec3_length_fp64(diff);\n}\n\n// vec4 functions\nvoid vec4_fp64(vec4 a, out vec2 out_val[4]) {\n  out_val[0].x = a[0];\n  out_val[0].y = 0.0;\n\n  out_val[1].x = a[1];\n  out_val[1].y = 0.0;\n\n  out_val[2].x = a[2];\n  out_val[2].y = 0.0;\n\n  out_val[3].x = a[3];\n  out_val[3].y = 0.0;\n}\n\nvoid vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {\n  out_val[0] = mul_fp64(a[0], b);\n  out_val[1] = mul_fp64(a[1], b);\n  out_val[2] = mul_fp64(a[2], b);\n  out_val[3] = mul_fp64(a[3], b);\n}\n\nvoid vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {\n  for (int i = 0; i < 4; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {\n  vec2 v[4];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n  v[2] = mul_fp64(a[2], b[2]);\n  v[3] = mul_fp64(a[3], b[3]);\n\n  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));\n}\n\nvoid mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {\n  vec2 tmp[4];\n\n  for (int i = 0; i < 4; i++)\n  {\n    for (int j = 0; j < 4; j++)\n    {\n      tmp[j] = b[j + i * 4];\n    }\n    vec4_dot_fp64(a, tmp, out_val[i]);\n  }\n}\n'},{"./math-fp64":176,path:250}],176:[function(require,module,exports){"use strict"
;Object.defineProperty(exports,"__esModule",{value:true});exports.fp64ify=fp64ify;function fp64ify(a){var hi=Math.fround(a);var lo=a-Math.fround(a);return new Float32Array([hi,lo])}},{}],177:[function(require,module,exports){"use strict";var _shaderTools=require("../shader-tools");var _fp=require("./fp64");var fp64=_interopRequireWildcard(_fp);var _fog=require("./fog");var fog=_interopRequireWildcard(_fog);var _picking=require("./picking");var picking=_interopRequireWildcard(_picking);var _material=require("./material");var material=_interopRequireWildcard(_material);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}(0,_shaderTools.registerShaderModules)([fp64,fog,picking,material])},{"../shader-tools":181,"./fog":174,"./fp64":175,"./material":178,"./picking":179}],178:[function(require,module,exports){(function(Buffer){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fragmentShader=exports.vertexShader=exports.name=undefined;exports.getUniforms=getUniforms;var _path=require("path");var name=exports.name="material";var vertexShader=exports.vertexShader=Buffer("Ci8qIFNldCB0aGUgVVYgY29vcmRpbmF0ZSBmcm9tIGF0dHJpYnV0ZXMgKi8Kdm9pZCBtYXRlcmlhbF9zZXRVVnMoZGlmZnVzZVVWLCBzcGVjdWxhclVWKSB7CiAgbWF0ZXJpYWxfdkRpZmZ1c2VVViA9IGRpZmZ1c2VVVjsKICBtYXRlcmlhbF92U3BlY3VsYXJVViA9IHNwZWN1bGFyVVY7Cn0K","base64");var fragmentShader=exports.fragmentShader=Buffer("dW5pZm9ybSB2ZWMzIG1hdGVyaWFsX3VBbWJpZW50Q29sb3I7CnVuaWZvcm0gdmVjMyBtYXRlcmlhbF91RGlmZnVzZUNvbG9yOwp1bmlmb3JtIHZlYzMgbWF0ZXJpYWxfdVNwZWN1bGFyQ29sb3I7CnVuaWZvcm0gdmVjMyBtYXRlcmlhbF91RW1pc3NpdmVDb2xvcjsKCi8vIHJlZmxlY3Rpb24gLyByZWZyYWN0aW9uIGNvbmZpZ3MKdW5pZm9ybSBmbG9hdCBtYXRlcmlhbF91UmVmbGVjdGlvbjsKdW5pZm9ybSBmbG9hdCBtYXRlcmlhbF91UmVmcmFjdGlvbjsKCnVuaWZvcm0gYm9vbCBtYXRlcmlhbF9lbmFibGVEaWZmdXNlTWFwOwp1bmlmb3JtIGJvb2wgbWF0ZXJpYWxfZW5hYmxlU3BlY3VsYXJNYXA7CnVuaWZvcm0gYm9vbCBtYXRlcmlhbF9lbmFibGVFbnZpcm9ubWVudE1hcDsKCnVuaWZvcm0gc2FtcGxlcjJEIG1hdGVyaWFsX2RpZmZ1c2VNYXA7CnVuaWZvcm0gc2FtcGxlcjJEIG1hdGVyaWFsX3NwZWN1bGFyTWFwOwp1bmlmb3JtIHNhbXBsZXJDdWJlIG1hdGVyaWFsX2Vudmlyb25tZW50TWFwOwoKdmFyeWluZyB2ZWMyIG1hdGVyaWFsX3ZEaWZmdXNlVGV4dHVyZUNvb3JkaW5hdGU7CnZhcnlpbmcgdmVjMiBtYXRlcmlhbF92U3BlY3VsYXJUZXh0dXJlQ29vcmRpbmF0ZTsKCi8vIEdldCBzaGluaW5lc3MgZnJvbSB1bmlmb3JtIG9yIHNwZWN1bGFyIG1hcApmbG9hdCBtYXRlcmlhbF9nZXRTaGluaW5lc3MoKSB7CiAgZmxvYXQgc2hpbmluZXNzID0gbWF0ZXJpYWxfdVNoaW5pbmVzczsKICBpZiAobWF0ZXJpYWxfZW5hYmxlU3BlY3VsYXJNYXApIHsKICAgIHNoaW5pbmVzcyA9IHRleHR1cmUyRChzYW1wbGVyMiwgdmVjMih2VGV4Q29vcmQxLnMsIHZUZXhDb29yZDEudCkpLnIgKiAyNTUuMDsKICB9CgogIGlmIChzaGluaW5lc3NWYWwgPiAyNTUuMCkgewogICAgc2hpbmluZXNzVmFsID0gc2hpbmluZXNzOwogIH0KCiAgcmV0dXJuIHNoaW5pbmVzczsKfQoKLy8gSWYgd2UgaGF2ZSBhIHN0YW5kYXJkIChkaWZmdXNlKSB0ZXh0dXJlLCBzZXQgY29sb3IgdG8gdGV4dHVyZQp2ZWM0IG1hdGVyaWFsX2ZpbHRlckNvbG9yX2RpZmZ1c2VNYXAodmVjNCBjb2xvcikgewogIGlmIChtYXRlcmlhbF9lbmFibGVEaWZmdXNlVGV4dHVyZSkgewogICAgY29sb3IgPSB0ZXh0dXJlMkQobWF0ZXJpYWxfdURpZmZ1c2VUZXh0dXJlLCBtYXRlcmlhbF92RGlmZnVzZVRleHR1cmVDb29yZGluYXRlKTsKICB9CiAgcmV0dXJuIGNvbG9yOwp9CgovLyBFbnZpcm9ubWVudCBtYXAgLSBjdWJlIHRleHR1cmUKdmVjNCBtYXRlcmlhbF9maWx0ZXJDb2xvcl9lbnZpcm9ubWVudE1hcChjb2xvcikKICBpZiAobWF0ZXJpYWxfZW5hYmxlRW52aXJvbm1lbnRNYXApIHsKICAgIHZlYzMgblJlZmxlY3Rpb24gPSBub3JtYWxpemUobWF0ZXJpYWxfdlJlZmxlY3Rpb24pOwogICAgdmVjMyByZWZsZWN0aW9uVmFsdWU7CiAgICBpZiAobWF0ZXJpYWxfdVJlZnJhY3Rpb24gPiAwLjApIHsKICAgICByZWZsZWN0aW9uVmFsdWUgPSByZWZyYWN0KG5SZWZsZWN0aW9uLCBtYXRlcmlhbF92Tm9ybWFsLCBtYXRlcmlhbF91UmVmcmFjdGlvbik7CiAgICB9IGVsc2UgewogICAgIHJlZmxlY3Rpb25WYWx1ZSA9IC1yZWZsZWN0KG5SZWZsZWN0aW9uLCBtYXRlcmlhbF92Tm9ybWFsKTsKICAgIH0KCiAgICB2ZWM0IGN1YmVDb2xvciA9IHRleHR1cmVDdWJlKG1hdGVyaWFsX3VFbnZpcm9ubWVudE1hcCwKICAgICAgdmVjMygtcmVmbGVjdGlvblZhbHVlLngsIC1yZWZsZWN0aW9uVmFsdWUueSwgcmVmbGVjdGlvblZhbHVlLnopKTsKICAgIGNvbG9yID0gdmVjNChtaXgoY29sb3IucmdiLCBjdWJlQ29sb3IucmdiLCByZWZsZWN0aW9uKSwgY29sb3IuYSk7CiAgfQogIHJldHVybiBjb2xvcjsKfQoKdmVjNCBtYXRlcmlhbF9maWx0ZXJDb2xvcih2ZWM0IGNvbG9yKSB7CiAgY29sb3IgPSBtYXRlcmlhbF9maWx0ZXJDb2xvcl9kaWZmdXNlTWFwKGNvbG9yKTsKICBjb2xvciA9IG1hdGVyaWFsX2ZpbHRlckNvbG9yX2Vudmlyb25tZW50TWFwKGNvbG9yKTsKICByZXR1cm4gY29sb3I7Cn0K","base64");function getUniforms(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$enable=_ref.enable,enable=_ref$enable===undefined?true:_ref$enable;return{picking_enable:enable}}}).call(this,require("buffer").Buffer)},{buffer:3,path:250}],179:[function(require,module,exports){(function(Buffer){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fragmentShader=exports.vertexShader=exports.name=undefined;exports.getUniforms=getUniforms;var _path=require("path");var name=exports.name="picking";var vertexShader=exports.vertexShader=Buffer("dmFyeWluZyB2ZWM0IHZDb2xvcjsKdmFyeWluZyB2ZWM0IHBpY2tpbmdfdkNvbG9yOwoKLy8gU3RvcmVzIHRoZSBwaWNraW5nIGNvbG9yCnZvaWQgcGlja2luZ19zZXRQaWNraW5nQ29sb3IodmVjMyBwaWNraW5nQ29sb3IpIHsKICB2UGlja2luZ0NvbG9yID0gcGlja2luZ0NvbG9yczsKfQo=","base64");var fragmentShader=exports.fragmentShader=Buffer("Ly8gcGlja2luZyBjb25maWdzCnVuaWZvcm0gYm9vbCBwaWNraW5nX3VFbmFibGVkOwp2YXJ5aW5nIHZlYzMgcGlja2luZ192UGlja2luZ0NvbG9yOwoKLyoKICogUmV0dXJucyBwaWNraW5nIGNvbG9yIGlmIHBpY2tpbmcgZW5hYmxlZAogKiBOb3RlOiBTaG91bGQgYmUgY2FsbGVkIGxhc3QsIHBpY2tpbmcgY29sb3IgbXVzdCBub3QgYmUgbW9kaWZpZWQuCiAqLwp2ZWM0IHBpY2tpbmdfZmlsdGVyQ29sb3IodmVjNCBjb2xvcikgewogIC8vIHNldCBwaWNraW5nCiAgaWYgKHBpY2tpbmdfdUVuYWJsZWQpIHsKICAJcmV0dXJuIHBpY2tpbmdfdlBpY2tpbmdDb2xvcjsKICB9IGVsc2UgewogIAlyZXR1cm4gY29sb3I7CiAgfQp9Cg==","base64");function getUniforms(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$enable=_ref.enable,enable=_ref$enable===undefined?true:_ref$enable;return{picking_enable:enable}}}).call(this,require("buffer").Buffer)},{buffer:3,path:250}],180:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkRendererVendor=checkRendererVendor;exports.getPlatformShaderDefines=getPlatformShaderDefines;exports.assembleShaders=assembleShaders;var _registerShaders=require("./register-shaders");var _webgl=require("../../webgl");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var VERTEX_SHADER="vertexShader";var FRAGMENT_SHADER="fragmentShader";function checkRendererVendor(debugInfo,gpuVendor){var vendor=debugInfo.vendor,renderer=debugInfo.renderer;var result=void 0;switch(gpuVendor){case"nvidia":result=vendor.match(/NVIDIA/i)||renderer.match(/NVIDIA/i);break;case"intel":result=vendor.match(/INTEL/i)||renderer.match(/INTEL/i);break;case"amd":result=vendor.match(/AMD/i)||renderer.match(/AMD/i)||vendor.match(/ATI/i)||renderer.match(/ATI/i);break;default:result=false}return result}function getPlatformShaderDefines(gl){var platformDefines="";var debugInfo=(0,_webgl.glGetDebugInfo)(gl);if(checkRendererVendor(debugInfo,"nvidia")){platformDefines+="#define NVIDIA_GPU\n#define NVIDIA_FP64_WORKAROUND 1\n#define NVIDIA_EQUATION_WORKAROUND 1\n"}else if(checkRendererVendor(debugInfo,"intel")){platformDefines+="#define INTEL_GPU\n#define INTEL_FP64_WORKAROUND 1\n#define NVIDIA_EQUATION_WORKAROUND 1\n #define INTEL_TAN_WORKAROUND 1\n"}else if(checkRendererVendor(debugInfo,"amd")){platformDefines+="#define AMD_GPU\n"}else{platformDefines+="#define DEFAULT_GPU\n"}return platformDefines}function assembleShader(gl,_ref){var source=_ref.source,type=_ref.type,_ref$modules=_ref.modules,modules=_ref$modules===undefined?[]:_ref$modules;(0,_assert2.default)(typeof source==="string","shader source must be a string");var assembledSource=getPlatformShaderDefines(gl)+"\n";var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=modules[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var moduleName=_step.value;var shaderModule=(0,_registerShaders.getShaderModule)(moduleName);if(!shaderModule){(0,_assert2.default)(shaderModule,"shader module is not defined")}var moduleSource=shaderModule[type];assembledSource+="// BEGIN SHADER MODULE "+moduleName+"\n#define MODULE_"+moduleName.toUpperCase()+"\n"+moduleSource+"\n// END SHADER MODULE "+moduleName}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}assembledSource+=source;return assembledSource}function assembleShaders(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var vs=opts.vs,fs=opts.fs;var modules=(0,_registerShaders.getShaderDependencies)(opts.modules||[]);return{gl:gl,vs:assembleShader(gl,Object.assign({},opts,{source:vs,type:VERTEX_SHADER,modules:modules})),fs:assembleShader(gl,Object.assign({},opts,{source:fs,type:FRAGMENT_SHADER,modules:modules}))}}},{"../../webgl":231,"./register-shaders":182,assert:1}],181:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _registerShaders=require("./register-shaders");Object.defineProperty(exports,"registerShaderModules",{enumerable:true,get:function get(){return _registerShaders.registerShaderModules}});var _assembleShaders=require("./assemble-shaders");Object.defineProperty(exports,"assembleShaders",{enumerable:true,get:function get(){return _assembleShaders.assembleShaders}});var _shaderCache=require("./shader-cache");Object.defineProperty(exports,"ShaderCache",{enumerable:true,get:function get(){return _interopRequireDefault(_shaderCache).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./assemble-shaders":180,"./register-shaders":182,"./shader-cache":183}],182:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.registerShaderModules=registerShaderModules;exports.getShaderModule=getShaderModule;exports.getShaderDependencies=getShaderDependencies;var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var shaderModules={};function registerShaderModules(shaderModuleList){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=shaderModuleList[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var shaderModule=_step.value;(0,_assert2.default)(shaderModule.name,"shader module has no name");if(shaderModules[shaderModule.name]){throw new Error("shader module "+shaderModule.name+" already registered")}shaderModules[shaderModule.name]=shaderModule;shaderModule.dependencies=shaderModule.dependencies||[]}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}function getShaderModule(moduleName){var shaderModule=shaderModules[moduleName];if(!shaderModule){(0,_assert2.default)(false,"Unknown shader module "+moduleName)}return shaderModule}function getShaderDependencies(moduleNames){var result={};getDependencyGraph({moduleNames:moduleNames,level:0,result:result});return Object.keys(result).sort(function(a,b){return result[a]-result[b]})}function getDependencyGraph(_ref){var moduleNames=_ref.moduleNames,level=_ref.level,result=_ref.result;if(level>=5){throw new Error("Possible loop in shader dependency graph")}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=moduleNames[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var moduleName=_step2.value;result[moduleName]=level}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=moduleNames[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _moduleName=_step3.value;var shaderModule=getShaderModule(_moduleName);getDependencyGraph({moduleNames:shaderModule.dependencies,level:level,result:result})}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}return result}},{assert:1}],183:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("../../webgl");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ERR_SOURCE="ShaderCache expects source strings";var ERR_CONTEXT="ShaderCache does not support caching across multiple contexts";var ShaderCache=function(){function ShaderCache(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},gl=_ref.gl;_classCallCheck(this,ShaderCache);this.gl=gl;this.vertexShaders={};this.fragmentShaders={}}_createClass(ShaderCache,[{key:"delete",value:function _delete(){return this}},{key:"getVertexShader",value:function getVertexShader(gl,source){(0,_assert2.default)(typeof source==="string",ERR_SOURCE);var shader=this.vertexShaders[source];(0,_assert2.default)(!shader||shader.gl===gl,ERR_CONTEXT);if(!shader){shader=new _webgl.VertexShader(gl,source);this.vertexShaders[source]=shader}return shader}},{key:"getFragmentShader",value:function getFragmentShader(gl,source){(0,_assert2.default)(typeof source==="string",ERR_SOURCE);var shader=this.fragmentShaders[source];(0,_assert2.default)(!shader||shader.gl===gl,ERR_CONTEXT);if(!shader){shader=new _webgl.FragmentShader(gl,source);this.fragmentShaders[source]=shader}return shader}}]);return ShaderCache}();exports.default=ShaderCache},{"../../webgl":231,assert:1}],184:[function(require,module,exports){"use strict";module.exports={hasTexture1:false,hasTextureCube1:false,enableLights:false,useReflection:false,enablePicking:false,hasPickingColors:false,hasFog:false}},{}],185:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SHADERS=undefined;var _path=require("path");var vs="#define SHADER_NAME luma-default-vs\n\n#define LIGHT_MAX 4\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec2 texCoord1;\n\nuniform mat4 worldMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldInverseTransposeMatrix;\n\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\n\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\n\nvarying vec4 vColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\n\nvoid main(void) {\n  vec4 mvPosition = worldMatrix * vec4(position, 1.0);\n\n  if(!enableLights) {\n    lightWeighting = vec3(1.0, 1.0, 1.0);\n  } else {\n    vec3 plightDirection;\n    vec3 pointWeight = vec3(0.0, 0.0, 0.0);\n    vec4 transformedNormal = worldInverseTransposeMatrix * vec4(normal, 1.0);\n    float directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\n    for (int i = 0; i < LIGHT_MAX; i++) {\n      if (i < numberPoints) {\n        plightDirection = normalize((viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\n        pointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n      } else {\n        break;\n      }\n    }\n\n    lightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n  }\n\n  vColor = color;\n  vTexCoord = texCoord1;\n  gl_Position = projectionMatrix * worldMatrix * vec4(position, 1.0);\n}\n";var fs="#ifdef GL_ES\nprecision highp float;\n#endif\n\n#define SHADER_NAME luma-default-fs\n\nvarying vec4 vColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\n\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\n\nuniform bool enablePicking;\nuniform vec3 pickColor;\n\nuniform bool hasFog;\nuniform vec3 fogColor;\n\nuniform float fogNear;\nuniform float fogFar;\n\nvoid main() {\n  if(!hasTexture1) {\n    gl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n  } else {\n    gl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n  }\n\n  if (enablePicking) {\n    gl_FragColor = vec4(pickColor, 1.0);\n  }\n\n  /* handle fog */\n  if (hasFog) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n  }\n}\n";var defaultUniforms=require("./default-uniforms");var SHADERS=exports.SHADERS={vs:vs,fs:fs,defaultUniforms:defaultUniforms}},{"./default-uniforms":184,path:250}],186:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _truncatedConeGeometry=require("./truncated-cone-geometry");var _truncatedConeGeometry2=_interopRequireDefault(_truncatedConeGeometry);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ConeGeometry=function(_TruncatedConeGeometr){_inherits(ConeGeometry,_TruncatedConeGeometr);function ConeGeometry(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,ConeGeometry);var _opts$radius=opts.radius,radius=_opts$radius===undefined?1:_opts$radius,_opts$cap=opts.cap,cap=_opts$cap===undefined?true:_opts$cap;return _possibleConstructorReturn(this,(ConeGeometry.__proto__||Object.getPrototypeOf(ConeGeometry)).call(this,Object.assign({},opts,{topRadius:0,topCap:Boolean(cap),bottomCap:Boolean(cap),bottomRadius:radius})))}return ConeGeometry}(_truncatedConeGeometry2.default);exports.default=ConeGeometry},{"./truncated-cone-geometry":194}],187:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _geometry=require("./geometry");var _geometry2=_interopRequireDefault(_geometry);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CubeGeometry=function(_Geometry){_inherits(CubeGeometry,_Geometry);function CubeGeometry(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,CubeGeometry);var _opts$id=opts.id,id=_opts$id===undefined?(0,_utils.uid)("cube-geometry"):_opts$id;return _possibleConstructorReturn(this,(CubeGeometry.__proto__||Object.getPrototypeOf(CubeGeometry)).call(this,Object.assign({},opts,{id:id,attributes:getCubeAttributes()})))}return CubeGeometry}(_geometry2.default);exports.default=CubeGeometry;var CUBE_INDICES=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);var CUBE_POSITIONS=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]);var CUBE_NORMALS=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);var CUBE_TEX_COORDS=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]);function getCubeAttributes(){return{indices:new Uint16Array(CUBE_INDICES),positions:new Float32Array(CUBE_POSITIONS),normals:new Float32Array(CUBE_NORMALS),texCoords:new Float32Array(CUBE_TEX_COORDS)}}},{"../utils":221,"./geometry":189}],188:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _truncatedConeGeometry=require("./truncated-cone-geometry");var _truncatedConeGeometry2=_interopRequireDefault(_truncatedConeGeometry);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CylinderGeometry=function(_TruncatedConeGeometr){_inherits(CylinderGeometry,_TruncatedConeGeometr);function CylinderGeometry(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,CylinderGeometry);var _opts$radius=opts.radius,radius=_opts$radius===undefined?1:_opts$radius;return _possibleConstructorReturn(this,(CylinderGeometry.__proto__||Object.getPrototypeOf(CylinderGeometry)).call(this,Object.assign({},opts,{bottomRadius:radius,topRadius:radius})))}return CylinderGeometry}(_truncatedConeGeometry2.default);exports.default=CylinderGeometry},{"./truncated-cone-geometry":194}],189:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ILLEGAL_ARG="Geometry: Illegal argument";var Geometry=function(){function Geometry(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Geometry);var id=opts.id,_opts$drawMode=opts.drawMode,drawMode=_opts$drawMode===undefined?"TRIANGLES":_opts$drawMode,_opts$vertexCount=opts.vertexCount,vertexCount=_opts$vertexCount===undefined?undefined:_opts$vertexCount,attributes=opts.attributes;(0,_assert2.default)(drawMode,ILLEGAL_ARG);this.id=id||(0,_utils.uid)(this.constructor.name);this.drawMode=drawMode;this.vertexCount=vertexCount;this.attributes={};this.needsRedraw=true;this.userData={};Object.seal(this);if(attributes){this.setAttributes(attributes)}else{_utils.log.once('Geometry: top-level attributes are deprecated, use "attributes" param');delete opts.id;delete opts.drawMode;delete opts.vertexCount;delete opts.attributes;this.setAttributes(opts)}}_createClass(Geometry,[{key:"setNeedsRedraw",value:function setNeedsRedraw(){var redraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.needsRedraw=redraw;return this}},{key:"getNeedsRedraw",value:function getNeedsRedraw(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$clearRedrawFlags=_ref.clearRedrawFlags,clearRedrawFlags=_ref$clearRedrawFlags===undefined?false:_ref$clearRedrawFlags;var redraw=false;redraw=redraw||this.needsRedraw;this.needsRedraw=this.needsRedraw&&!clearRedrawFlags;return redraw}},{key:"setVertexCount",value:function setVertexCount(vertexCount){this.vertexCount=vertexCount}},{key:"getVertexCount",value:function getVertexCount(){if(this.vertexCount!==undefined){return this.vertexCount}else if(this.attributes.indices){return this.attributes.indices.value.length}else if(this.attributes.vertices){return this.attributes.vertices.value.length/3}else if(this.attributes.positions){return this.attributes.positions.value.length/3}return false}},{key:"hasAttribute",value:function hasAttribute(attributeName){return Boolean(this.attributes[attributeName])}},{key:"getAttribute",value:function getAttribute(attributeName){var attribute=this.attributes[attributeName];(0,_assert2.default)(attribute);return attribute.value}},{key:"getArray",value:function getArray(attributeName){var attribute=this.attributes[attributeName];(0,_assert2.default)(attribute);return attribute.value}},{key:"getAttributes",value:function getAttributes(){return this.attributes}},{key:"setAttributes",value:function setAttributes(attributes){for(var attributeName in attributes){var attribute=attributes[attributeName];attribute=ArrayBuffer.isView(attribute)?{value:attribute}:attribute;(0,_assert2.default)(ArrayBuffer.isView(attribute.value),this._print(attributeName)+": must be typed array or object with value as typed array");this._autoDetectAttribute(attributeName,attribute);this.attributes[attributeName]=Object.assign({},attribute,{instanced:attribute.instanced||0})}this.setNeedsRedraw();return this}},{key:"_autoDetectAttribute",value:function _autoDetectAttribute(attributeName,attribute){var category=void 0;switch(attributeName){case"indices":category=category||"indices";break;case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":category="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":category="vectors";break}switch(category){case"vectors":attribute.size=attribute.size||3;break;case"uvs":attribute.size=attribute.size||2;break;case"indices":attribute.size=attribute.size||1;attribute.isIndexed=attribute.isIndexed||true;(0,_assert2.default)(attribute.value instanceof Uint16Array||attribute.value instanceof Uint32Array,'attribute array for "indices" must be of integer type');break}(0,_assert2.default)(attribute.size,"attribute "+attributeName+" needs size")}},{key:"_print",value:function _print(attributeName){return"Geometry "+this.id+" attribute "+attributeName}}]);return Geometry}();exports.default=Geometry},{"../utils":221,assert:1}],190:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _geometry=require("./geometry");var _geometry2=_interopRequireDefault(_geometry);var _math=require("../packages/math");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ICO_POSITIONS=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0];var ICO_INDICES=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1];var IcoSphereGeometry=function(_Geometry){_inherits(IcoSphereGeometry,_Geometry);function IcoSphereGeometry(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,IcoSphereGeometry);var _ref={},_ref$iterations=_ref.iterations,iterations=_ref$iterations===undefined?0:_ref$iterations;var PI=Math.PI;var PI2=PI*2;var positions=[].concat(ICO_POSITIONS);var indices=[].concat(ICO_INDICES);positions.push();indices.push();var getMiddlePoint=function(){var pointMemo={};return function(i1,i2){i1*=3;i2*=3;var mini=i1<i2?i1:i2;var maxi=i1>i2?i1:i2;var key=mini+"|"+maxi;if(key in pointMemo){return pointMemo[key]}var x1=positions[i1];var y1=positions[i1+1];var z1=positions[i1+2];var x2=positions[i2];var y2=positions[i2+1];var z2=positions[i2+2];var xm=(x1+x2)/2;var ym=(y1+y2)/2;var zm=(z1+z2)/2;var len=Math.sqrt(xm*xm+ym*ym+zm*zm);xm/=len;ym/=len;zm/=len;positions.push(xm,ym,zm);return pointMemo[key]=positions.length/3-1}}();for(var i=0;i<iterations;i++){var indices2=[];for(var j=0;j<indices.length;j+=3){var a=getMiddlePoint(indices[j+0],indices[j+1]);var b=getMiddlePoint(indices[j+1],indices[j+2]);var c=getMiddlePoint(indices[j+2],indices[j+0]);indices2.push(c,indices[j+0],a,a,indices[j+1],b,b,indices[j+2],c,a,b,c)}indices=indices2}var normals=new Array(indices.length*3);var texCoords=new Array(indices.length*2);var l=indices.length;for(var _i=l-3;_i>=0;_i-=3){var i1=indices[_i+0];var i2=indices[_i+1];var i3=indices[_i+2];var in1=i1*3;var in2=i2*3;var in3=i3*3;var iu1=i1*2;var iu2=i2*2;var iu3=i3*2;var x1=positions[in1+0];var y1=positions[in1+1];var z1=positions[in1+2]
;var theta1=Math.acos(z1/Math.sqrt(x1*x1+y1*y1+z1*z1));var phi1=Math.atan2(y1,x1)+PI;var v1=theta1/PI;var u1=1-phi1/PI2;var x2=positions[in2+0];var y2=positions[in2+1];var z2=positions[in2+2];var theta2=Math.acos(z2/Math.sqrt(x2*x2+y2*y2+z2*z2));var phi2=Math.atan2(y2,x2)+PI;var v2=theta2/PI;var u2=1-phi2/PI2;var x3=positions[in3+0];var y3=positions[in3+1];var z3=positions[in3+2];var theta3=Math.acos(z3/Math.sqrt(x3*x3+y3*y3+z3*z3));var phi3=Math.atan2(y3,x3)+PI;var v3=theta3/PI;var u3=1-phi3/PI2;var vec1=[x3-x2,y3-y2,z3-z2];var vec2=[x1-x2,y1-y2,z1-z2];var normal=_math.Vector3.cross(vec1,vec2).normalize();var newIndex=void 0;if((u1===0||u2===0||u3===0)&&(u1===0||u1>.5)&&(u2===0||u2>.5)&&(u3===0||u3>.5)){positions.push(positions[in1+0],positions[in1+1],positions[in1+2]);newIndex=positions.length/3-1;indices.push(newIndex);texCoords[newIndex*2+0]=1;texCoords[newIndex*2+1]=v1;normals[newIndex*3+0]=normal.x;normals[newIndex*3+1]=normal.y;normals[newIndex*3+2]=normal.z;positions.push(positions[in2+0],positions[in2+1],positions[in2+2]);newIndex=positions.length/3-1;indices.push(newIndex);texCoords[newIndex*2+0]=1;texCoords[newIndex*2+1]=v2;normals[newIndex*3+0]=normal.x;normals[newIndex*3+1]=normal.y;normals[newIndex*3+2]=normal.z;positions.push(positions[in3+0],positions[in3+1],positions[in3+2]);newIndex=positions.length/3-1;indices.push(newIndex);texCoords[newIndex*2+0]=1;texCoords[newIndex*2+1]=v3;normals[newIndex*3+0]=normal.x;normals[newIndex*3+1]=normal.y;normals[newIndex*3+2]=normal.z}normals[in1+0]=normals[in2+0]=normals[in3+0]=normal.x;normals[in1+1]=normals[in2+1]=normals[in3+1]=normal.y;normals[in1+2]=normals[in2+2]=normals[in3+2]=normal.z;texCoords[iu1+0]=u1;texCoords[iu1+1]=v1;texCoords[iu2+0]=u2;texCoords[iu2+1]=v2;texCoords[iu3+0]=u3;texCoords[iu3+1]=v3}return _possibleConstructorReturn(this,(IcoSphereGeometry.__proto__||Object.getPrototypeOf(IcoSphereGeometry)).call(this,Object.assign({},opts,{attributes:{positions:new Float32Array(positions),normals:new Float32Array(normals),texCoords:new Float32Array(texCoords),indices:new Uint16Array(indices)}})))}return IcoSphereGeometry}(_geometry2.default);exports.default=IcoSphereGeometry},{"../packages/math":209,"./geometry":189}],191:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _geometry=require("./geometry");Object.defineProperty(exports,"Geometry",{enumerable:true,get:function get(){return _interopRequireDefault(_geometry).default}});var _coneGeometry=require("./cone-geometry");Object.defineProperty(exports,"ConeGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_coneGeometry).default}});var _cubeGeometry=require("./cube-geometry");Object.defineProperty(exports,"CubeGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_cubeGeometry).default}});var _cylinderGeometry=require("./cylinder-geometry");Object.defineProperty(exports,"CylinderGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_cylinderGeometry).default}});var _icoSphereGeometry=require("./ico-sphere-geometry");Object.defineProperty(exports,"IcoSphereGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_icoSphereGeometry).default}});var _planeGeometry=require("./plane-geometry");Object.defineProperty(exports,"PlaneGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_planeGeometry).default}});var _sphereGeometry=require("./sphere-geometry");Object.defineProperty(exports,"SphereGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_sphereGeometry).default}});var _truncatedConeGeometry=require("./truncated-cone-geometry");Object.defineProperty(exports,"TruncatedConeGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_truncatedConeGeometry).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./cone-geometry":186,"./cube-geometry":187,"./cylinder-geometry":188,"./geometry":189,"./ico-sphere-geometry":190,"./plane-geometry":192,"./sphere-geometry":193,"./truncated-cone-geometry":194}],192:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _geometry=require("./geometry");var _geometry2=_interopRequireDefault(_geometry);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PlaneGeometry=function(_Geometry){_inherits(PlaneGeometry,_Geometry);function PlaneGeometry(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,PlaneGeometry);var _opts$type=opts.type,type=_opts$type===undefined?"x,y":_opts$type,_opts$offset=opts.offset,offset=_opts$offset===undefined?0:_opts$offset,_opts$flipCull=opts.flipCull,flipCull=_opts$flipCull===undefined?false:_opts$flipCull,_opts$unpack=opts.unpack,unpack=_opts$unpack===undefined?false:_opts$unpack,_opts$id=opts.id,id=_opts$id===undefined?(0,_utils.uid)("plane-geometry"):_opts$id;var coords=type.split(",");var c1len=opts[coords[0]+"len"];var c2len=opts[coords[1]+"len"];var subdivisions1=opts["n"+coords[0]]||1;var subdivisions2=opts["n"+coords[1]]||1;var numVertices=(subdivisions1+1)*(subdivisions2+1);var positions=new Float32Array(numVertices*3);var normals=new Float32Array(numVertices*3);var texCoords=new Float32Array(numVertices*2);if(flipCull){c1len=-c1len}var i2=0;var i3=0;for(var z=0;z<=subdivisions2;z++){for(var x=0;x<=subdivisions1;x++){var u=x/subdivisions1;var v=z/subdivisions2;texCoords[i2+0]=flipCull?1-u:u;texCoords[i2+1]=v;switch(type){case"x,y":positions[i3+0]=c1len*u-c1len*.5;positions[i3+1]=c2len*v-c2len*.5;positions[i3+2]=offset;normals[i3+0]=0;normals[i3+1]=0;normals[i3+2]=flipCull?1:-1;break;case"x,z":positions[i3+0]=c1len*u-c1len*.5;positions[i3+1]=offset;positions[i3+2]=c2len*v-c2len*.5;normals[i3+0]=0;normals[i3+1]=flipCull?1:-1;normals[i3+2]=0;break;case"y,z":positions[i3+0]=offset;positions[i3+1]=c1len*u-c1len*.5;positions[i3+2]=c2len*v-c2len*.5;normals[i3+0]=flipCull?1:-1;normals[i3+1]=0;normals[i3+2]=0;break;default:break}i2+=2;i3+=3}}var numVertsAcross=subdivisions1+1;var indices=new Uint16Array(subdivisions1*subdivisions2*6);for(var _z=0;_z<subdivisions2;_z++){for(var _x2=0;_x2<subdivisions1;_x2++){var index=(_z*subdivisions1+_x2)*6;indices[index+0]=(_z+0)*numVertsAcross+_x2;indices[index+1]=(_z+1)*numVertsAcross+_x2;indices[index+2]=(_z+0)*numVertsAcross+_x2+1;indices[index+3]=(_z+1)*numVertsAcross+_x2;indices[index+4]=(_z+1)*numVertsAcross+_x2+1;indices[index+5]=(_z+0)*numVertsAcross+_x2+1}}if(unpack){var positions2=new Float32Array(indices.length*3);var normals2=new Float32Array(indices.length*3);var texCoords2=new Float32Array(indices.length*2);for(var _x3=0;_x3<indices.length;++_x3){var _index=indices[_x3];positions2[_x3*3+0]=positions[_index*3+0];positions2[_x3*3+1]=positions[_index*3+1];positions2[_x3*3+2]=positions[_index*3+2];normals2[_x3*3+0]=normals[_index*3+0];normals2[_x3*3+1]=normals[_index*3+1];normals2[_x3*3+2]=normals[_index*3+2];texCoords2[_x3*2+0]=texCoords[_index*2+0];texCoords2[_x3*2+1]=texCoords[_index*2+1]}positions=positions2;normals=normals2;texCoords=texCoords2;indices=undefined}var attributes={positions:positions,normals:normals,texCoords:texCoords};if(indices){attributes.indices=indices}return _possibleConstructorReturn(this,(PlaneGeometry.__proto__||Object.getPrototypeOf(PlaneGeometry)).call(this,Object.assign({},opts,{attributes:attributes,id:id})))}return PlaneGeometry}(_geometry2.default);exports.default=PlaneGeometry},{"../utils":221,"./geometry":189}],193:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _geometry=require("./geometry");var _geometry2=_interopRequireDefault(_geometry);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SphereGeometry=function(_Geometry){_inherits(SphereGeometry,_Geometry);function SphereGeometry(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,SphereGeometry);var _opts$nlat=opts.nlat,nlat=_opts$nlat===undefined?10:_opts$nlat,_opts$nlong=opts.nlong,nlong=_opts$nlong===undefined?10:_opts$nlong,_opts$radius=opts.radius,radius=_opts$radius===undefined?1:_opts$radius,_opts$id=opts.id,id=_opts$id===undefined?(0,_utils.uid)("sphere-geometry"):_opts$id;return _possibleConstructorReturn(this,(SphereGeometry.__proto__||Object.getPrototypeOf(SphereGeometry)).call(this,Object.assign({},opts,{id:id,attributes:getSphereAttributes(nlat,nlong,radius)})))}return SphereGeometry}(_geometry2.default);exports.default=SphereGeometry;function getSphereAttributes(nlat,nlong,radius){var startLat=0;var endLat=Math.PI;var latRange=endLat-startLat;var startLong=0;var endLong=2*Math.PI;var longRange=endLong-startLong;var numVertices=(nlat+1)*(nlong+1);if(typeof radius==="number"){var value=radius;radius=function radius(n1,n2,n3,u,v){return value}}var positions=new Float32Array(numVertices*3);var normals=new Float32Array(numVertices*3);var texCoords=new Float32Array(numVertices*2);var indices=new Uint16Array(nlat*nlong*6);for(var y=0;y<=nlat;y++){for(var x=0;x<=nlong;x++){var u=x/nlong;var v=y/nlat;var index=x+y*(nlong+1);var i2=index*2;var i3=index*3;var theta=longRange*u;var phi=latRange*v;var sinTheta=Math.sin(theta);var cosTheta=Math.cos(theta);var sinPhi=Math.sin(phi);var cosPhi=Math.cos(phi);var ux=cosTheta*sinPhi;var uy=cosPhi;var uz=sinTheta*sinPhi;var r=radius(ux,uy,uz,u,v);positions[i3+0]=r*ux;positions[i3+1]=r*uy;positions[i3+2]=r*uz;normals[i3+0]=ux;normals[i3+1]=uy;normals[i3+2]=uz;texCoords[i2+0]=u;texCoords[i2+1]=v}}var numVertsAround=nlat+1;for(var _x2=0;_x2<nlat;_x2++){for(var _y=0;_y<nlong;_y++){var _index=(_x2*nlong+_y)*6;indices[_index+0]=_y*numVertsAround+_x2;indices[_index+1]=_y*numVertsAround+_x2+1;indices[_index+2]=(_y+1)*numVertsAround+_x2;indices[_index+3]=(_y+1)*numVertsAround+_x2;indices[_index+4]=_y*numVertsAround+_x2+1;indices[_index+5]=(_y+1)*numVertsAround+_x2+1}}return{positions:positions,indices:indices,normals:normals,texCoords:texCoords}}},{"../utils":221,"./geometry":189}],194:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _geometry=require("./geometry");var _geometry2=_interopRequireDefault(_geometry);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TruncatedConeGeometry=function(_Geometry){_inherits(TruncatedConeGeometry,_Geometry);function TruncatedConeGeometry(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,TruncatedConeGeometry);var _opts$bottomRadius=opts.bottomRadius,bottomRadius=_opts$bottomRadius===undefined?0:_opts$bottomRadius,_opts$topRadius=opts.topRadius,topRadius=_opts$topRadius===undefined?0:_opts$topRadius,_opts$height=opts.height,height=_opts$height===undefined?1:_opts$height,_opts$nradial=opts.nradial,nradial=_opts$nradial===undefined?10:_opts$nradial,_opts$nvertical=opts.nvertical,nvertical=_opts$nvertical===undefined?10:_opts$nvertical,_opts$topCap=opts.topCap,topCap=_opts$topCap===undefined?false:_opts$topCap,_opts$bottomCap=opts.bottomCap,bottomCap=_opts$bottomCap===undefined?false:_opts$bottomCap;var extra=(topCap?2:0)+(bottomCap?2:0);var numVertices=(nradial+1)*(nvertical+1+extra);var slant=Math.atan2(bottomRadius-topRadius,height);var msin=Math.sin;var mcos=Math.cos;var mpi=Math.PI;var cosSlant=mcos(slant);var sinSlant=msin(slant);var start=topCap?-2:0;var end=nvertical+(bottomCap?2:0);var vertsAroundEdge=nradial+1;var positions=new Float32Array(numVertices*3);var normals=new Float32Array(numVertices*3);var texCoords=new Float32Array(numVertices*2);var indices=new Uint16Array(nradial*(nvertical+extra)*6);var i3=0;var i2=0;for(var i=start;i<=end;i++){var v=i/nvertical;var y=height*v;var ringRadius=void 0;if(i<0){y=0;v=1;ringRadius=bottomRadius}else if(i>nvertical){y=height;v=1;ringRadius=topRadius}else{ringRadius=bottomRadius+(topRadius-bottomRadius)*(i/nvertical)}if(i===-2||i===nvertical+2){ringRadius=0;v=0}y-=height/2;for(var j=0;j<vertsAroundEdge;j++){var sin=msin(j*mpi*2/nradial);var cos=mcos(j*mpi*2/nradial);positions[i3+0]=sin*ringRadius;positions[i3+1]=y;positions[i3+2]=cos*ringRadius;normals[i3+0]=i<0||i>nvertical?0:sin*cosSlant;normals[i3+1]=i<0?-1:i>nvertical?1:sinSlant;normals[i3+2]=i<0||i>nvertical?0:cos*cosSlant;texCoords[i2+0]=j/nradial;texCoords[i2+1]=v;i2+=2;i3+=3}}for(var _i=0;_i<nvertical+extra;_i++){for(var _j=0;_j<nradial;_j++){var index=(_i*nradial+_j)*6;indices[index+0]=vertsAroundEdge*(_i+0)+0+_j;indices[index+1]=vertsAroundEdge*(_i+0)+1+_j;indices[index+2]=vertsAroundEdge*(_i+1)+1+_j;indices[index+3]=vertsAroundEdge*(_i+0)+0+_j;indices[index+4]=vertsAroundEdge*(_i+1)+1+_j;indices[index+5]=vertsAroundEdge*(_i+1)+0+_j}}return _possibleConstructorReturn(this,(TruncatedConeGeometry.__proto__||Object.getPrototypeOf(TruncatedConeGeometry)).call(this,Object.assign({},opts,{attributes:{positions:positions,normals:normals,texCoords:texCoords,indices:indices}})))}return TruncatedConeGeometry}(_geometry2.default);exports.default=TruncatedConeGeometry},{"./geometry":189}],195:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Fx=exports.Shaders=exports.FramebufferObject=exports.pickModels=exports.Scene=exports.Group=exports.Object3D=exports.Mat4=exports.Vec4=exports.Vec3=exports.experimental=exports.parseModel=exports.loadModel=exports.loadProgram=exports.loadTextures=exports.loadImages=exports.loadFiles=exports.loadImage=exports.loadFile=exports.Euler=exports.Quaternion=exports.Matrix4=exports.Vector4=exports.Vector3=exports.Vector2=exports.degrees=exports.radians=exports.ClipSpaceQuad=exports.TruncatedCone=exports.Sphere=exports.Plane=exports.IcoSphere=exports.Cylinder=exports.Cube=exports.Cone=exports.TruncatedConeGeometry=exports.SphereGeometry=exports.PlaneGeometry=exports.IcoSphereGeometry=exports.CylinderGeometry=exports.CubeGeometry=exports.ConeGeometry=exports.Geometry=exports.addEvents=exports.AnimationFrame=exports.Model=exports.VertexArrayObject=exports.TimerQuery=exports.isWebGL2Context=exports.isWebGLContext=exports.draw=exports.TextureCube=exports.Texture2D=exports.Renderbuffer=exports.Framebuffer=exports.Program=exports.FragmentShader=exports.VertexShader=exports.Shader=exports.Buffer=exports.glGetDebugInfo=exports.glContextWithState=exports.getGLExtension=exports.createGLContext=exports.GL=undefined;var _webglConstants=require("./webgl/webgl-constants");Object.defineProperty(exports,"GL",{enumerable:true,get:function get(){return _interopRequireDefault(_webglConstants).default}});var _context=require("./webgl/context");Object.defineProperty(exports,"createGLContext",{enumerable:true,get:function get(){return _context.createGLContext}});Object.defineProperty(exports,"getGLExtension",{enumerable:true,get:function get(){return _context.getGLExtension}});Object.defineProperty(exports,"glContextWithState",{enumerable:true,get:function get(){return _context.glContextWithState}});Object.defineProperty(exports,"glGetDebugInfo",{enumerable:true,get:function get(){return _context.glGetDebugInfo}});var _buffer=require("./webgl/buffer");Object.defineProperty(exports,"Buffer",{enumerable:true,get:function get(){return _interopRequireDefault(_buffer).default}});var _shader=require("./webgl/shader");Object.defineProperty(exports,"Shader",{enumerable:true,get:function get(){return _interopRequireDefault(_shader).default}});Object.defineProperty(exports,"VertexShader",{enumerable:true,get:function get(){return _shader.VertexShader}});Object.defineProperty(exports,"FragmentShader",{enumerable:true,get:function get(){return _shader.FragmentShader}});var _program=require("./webgl/program");Object.defineProperty(exports,"Program",{enumerable:true,get:function get(){return _interopRequireDefault(_program).default}});var _framebuffer=require("./webgl/framebuffer");Object.defineProperty(exports,"Framebuffer",{enumerable:true,get:function get(){return _interopRequireDefault(_framebuffer).default}});var _renderbuffer=require("./webgl/renderbuffer");Object.defineProperty(exports,"Renderbuffer",{enumerable:true,get:function get(){return _interopRequireDefault(_renderbuffer).default}});var _texture2d=require("./webgl/texture-2d");Object.defineProperty(exports,"Texture2D",{enumerable:true,get:function get(){return _interopRequireDefault(_texture2d).default}});var _textureCube=require("./webgl/texture-cube");Object.defineProperty(exports,"TextureCube",{enumerable:true,get:function get(){return _interopRequireDefault(_textureCube).default}});var _draw=require("./webgl/draw");Object.defineProperty(exports,"draw",{enumerable:true,get:function get(){return _draw.draw}});var _webglChecks=require("./webgl/webgl-checks");Object.defineProperty(exports,"isWebGLContext",{enumerable:true,get:function get(){return _webglChecks.isWebGLContext}});Object.defineProperty(exports,"isWebGL2Context",{enumerable:true,get:function get(){return _webglChecks.isWebGL2Context}});var _timerQuery=require("./webgl/timer-query");Object.defineProperty(exports,"TimerQuery",{enumerable:true,get:function get(){return _interopRequireDefault(_timerQuery).default}});var _vertexArrayObject=require("./webgl/vertex-array-object");Object.defineProperty(exports,"VertexArrayObject",{enumerable:true,get:function get(){return _interopRequireDefault(_vertexArrayObject).default}});var _model=require("./core/model");Object.defineProperty(exports,"Model",{enumerable:true,get:function get(){return _interopRequireDefault(_model).default}});var _animationFrame=require("./core/animation-frame");Object.defineProperty(exports,"AnimationFrame",{enumerable:true,get:function get(){return _interopRequireDefault(_animationFrame).default}});var _event=require("./core/event");Object.defineProperty(exports,"addEvents",{enumerable:true,get:function get(){return _event.addEvents}});var _geometry=require("./geometry/geometry");Object.defineProperty(exports,"Geometry",{enumerable:true,get:function get(){return _interopRequireDefault(_geometry).default}});var _coneGeometry=require("./geometry/cone-geometry");Object.defineProperty(exports,"ConeGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_coneGeometry).default}});var _cubeGeometry=require("./geometry/cube-geometry");Object.defineProperty(exports,"CubeGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_cubeGeometry).default}});var _cylinderGeometry=require("./geometry/cylinder-geometry");Object.defineProperty(exports,"CylinderGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_cylinderGeometry).default}});var _icoSphereGeometry=require("./geometry/ico-sphere-geometry");Object.defineProperty(exports,"IcoSphereGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_icoSphereGeometry).default}});var _planeGeometry=require("./geometry/plane-geometry");Object.defineProperty(exports,"PlaneGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_planeGeometry).default}});var _sphereGeometry=require("./geometry/sphere-geometry");Object.defineProperty(exports,"SphereGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_sphereGeometry).default}});var _truncatedConeGeometry=require("./geometry/truncated-cone-geometry");Object.defineProperty(exports,"TruncatedConeGeometry",{enumerable:true,get:function get(){return _interopRequireDefault(_truncatedConeGeometry).default}});var _cone=require("./models/cone");Object.defineProperty(exports,"Cone",{enumerable:true,get:function get(){return _interopRequireDefault(_cone).default}});var _cube=require("./models/cube");Object.defineProperty(exports,"Cube",{enumerable:true,get:function get(){return _interopRequireDefault(_cube).default}});var _cylinder=require("./models/cylinder");Object.defineProperty(exports,"Cylinder",{enumerable:true,get:function get(){return _interopRequireDefault(_cylinder).default}});var _icoSphere=require("./models/ico-sphere");Object.defineProperty(exports,"IcoSphere",{enumerable:true,get:function get(){return _interopRequireDefault(_icoSphere).default}});var _plane=require("./models/plane");Object.defineProperty(exports,"Plane",{enumerable:true,get:function get(){return _interopRequireDefault(_plane).default}});var _sphere=require("./models/sphere");Object.defineProperty(exports,"Sphere",{enumerable:true,get:function get(){return _interopRequireDefault(_sphere).default}});var _truncatedCone=require("./models/truncated-cone");Object.defineProperty(exports,"TruncatedCone",{enumerable:true,get:function get(){return _interopRequireDefault(_truncatedCone).default}});var _clipSpaceQuad=require("./models/clip-space-quad");Object.defineProperty(exports,"ClipSpaceQuad",{enumerable:true,get:function get(){return _interopRequireDefault(_clipSpaceQuad).default}});var _common=require("./packages/math/src/common");Object.defineProperty(exports,"radians",{enumerable:true,get:function get(){return _common.radians}});Object.defineProperty(exports,"degrees",{enumerable:true,get:function get(){return _common.degrees}});var _vector=require("./packages/math/src/vector2");Object.defineProperty(exports,"Vector2",{enumerable:true,get:function get(){return _interopRequireDefault(_vector).default}});var _vector2=require("./packages/math/src/vector3");Object.defineProperty(exports,"Vector3",{enumerable:true,get:function get(){return _interopRequireDefault(_vector2).default}});var _vector3=require("./packages/math/src/vector4");Object.defineProperty(exports,"Vector4",{enumerable:true,get:function get(){return _interopRequireDefault(_vector3).default}});var _matrix=require("./packages/math/src/matrix4");Object.defineProperty(exports,"Matrix4",{enumerable:true,get:function get(){return _interopRequireDefault(_matrix).default}});var _quaternion=require("./packages/math/src/quaternion");Object.defineProperty(exports,"Quaternion",{enumerable:true,get:function get(){return _interopRequireDefault(_quaternion).default}});var _euler=require("./packages/math/src/euler");Object.defineProperty(exports,"Euler",{enumerable:true,get:function get(){return _interopRequireDefault(_euler).default}});var _io=require("./io");Object.defineProperty(exports,"loadFile",{enumerable:true,get:function get(){return _io.loadFile}});Object.defineProperty(exports,"loadImage",{enumerable:true,get:function get(){return _io.loadImage}});Object.defineProperty(exports,"loadFiles",{enumerable:true,get:function get(){return _io.loadFiles}});Object.defineProperty(exports,"loadImages",{enumerable:true,get:function get(){return _io.loadImages}});Object.defineProperty(exports,"loadTextures",{enumerable:true,get:function get(){return _io.loadTextures}});Object.defineProperty(exports,"loadProgram",{enumerable:true,get:function get(){return _io.loadProgram}});Object.defineProperty(exports,"loadModel",{enumerable:true,get:function get(){return _io.loadModel}});Object.defineProperty(exports,"parseModel",{enumerable:true,get:function get(){return _io.parseModel}});var _math=require("./deprecated/math");Object.defineProperty(exports,"Vec3",{enumerable:true,get:function get(){return _math.Vec3}});Object.defineProperty(exports,"Vec4",{enumerable:true,get:function get(){return _math.Vec4}});Object.defineProperty(exports,"Mat4",{enumerable:true,get:function get(){return _math.Mat4}});var _scenegraph=require("./deprecated/scenegraph");Object.defineProperty(exports,"Object3D",{enumerable:true,get:function get(){return _scenegraph.Object3D}});Object.defineProperty(exports,"Group",{enumerable:true,get:function get(){return _scenegraph.Group}});Object.defineProperty(exports,"Scene",{enumerable:true,get:function get(){return _scenegraph.Scene}});Object.defineProperty(exports,"pickModels",{enumerable:true,get:function get(){return _scenegraph.pickModels}});var _fbo=require("./deprecated/fbo");Object.defineProperty(exports,"FramebufferObject",{enumerable:true,get:function get(){return _interopRequireDefault(_fbo).default}});var _shaderlib=require("./deprecated/shaderlib");Object.defineProperty(exports,"Shaders",{enumerable:true,get:function get(){return _interopRequireDefault(_shaderlib).default}});var _fx=require("./addons/fx");Object.defineProperty(exports,"Fx",{enumerable:true,get:function get(){return _interopRequireDefault(_fx).default}});require("./init");var _shaderTools=require("./experimental/shader-tools");require("./experimental/shader-modules");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var experimental=exports.experimental={registerShaderModules:_shaderTools.registerShaderModules,assembleShaders:_shaderTools.assembleShaders,ShaderCache:_shaderTools.ShaderCache}},{"./addons/fx":157,"./core/animation-frame":158,"./core/event":161,"./core/model":163,"./deprecated/fbo":164,"./deprecated/math":166,"./deprecated/scenegraph":168,"./deprecated/shaderlib":173,"./experimental/shader-modules":177,"./experimental/shader-tools":181,"./geometry/cone-geometry":186,"./geometry/cube-geometry":187,"./geometry/cylinder-geometry":188,"./geometry/geometry":189,"./geometry/ico-sphere-geometry":190,"./geometry/plane-geometry":192,"./geometry/sphere-geometry":193,"./geometry/truncated-cone-geometry":194,"./init":196,"./io":199,"./models/clip-space-quad":201,"./models/cone":202,"./models/cube":203,"./models/cylinder":204,"./models/ico-sphere":205,"./models/plane":206,"./models/sphere":207,"./models/truncated-cone":208,"./packages/math/src/common":210,"./packages/math/src/euler":211,"./packages/math/src/matrix4":213,"./packages/math/src/quaternion":214,"./packages/math/src/vector2":216,"./packages/math/src/vector3":217,"./packages/math/src/vector4":218,"./webgl/buffer":226,"./webgl/context":227,"./webgl/draw":228,"./webgl/framebuffer":229,"./webgl/program":232,"./webgl/renderbuffer":233,"./webgl/shader":234,"./webgl/texture-2d":235,"./webgl/texture-cube":236,"./webgl/timer-query":238,"./webgl/vertex-array-object":240,"./webgl/webgl-checks":243,"./webgl/webgl-constants":244}],196:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.global=undefined;var _isBrowser=require("./utils/is-browser");var _globals=require("./utils/globals");var _log=require("./utils/log");var _log2=_interopRequireDefault(_log);var _package=require("../package.json");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var STARTUP_MESSAGE="Assign luma.log.priority in console to control logging: 0: none, 1: minimal, 2: verbose, 3: attribute/uniforms, 4: gl logs\nluma.log.break[], set to gl funcs, luma.log.profile[] set to model names";if(_globals.global.luma&&_globals.global.luma.VERSION!==_package.version){throw new Error("luma.gl - multiple versions detected: "+_globals.global.luma.VERSION+" vs "+_package.version)}if(!_globals.global.luma){if(_isBrowser.isBrowser){console.log("luma.gl "+_package.version+" - "+STARTUP_MESSAGE)}_globals.global.luma=_globals.global.luma||{VERSION:_package.version,version:_package.version,log:_log2.default,globals:{headlessGL:null,headlessTypes:null,modules:{},nodeIO:{}}}}exports.global=_globals.global;exports.default=_globals.global.luma},{"../package.json":248,"./utils/globals":220,"./utils/is-browser":222,"./utils/log":223}],197:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.loadFile=loadFile;exports.loadImage=loadImage;var _browserRequestFile=require("./browser-request-file");function loadFile(opts){return(0,_browserRequestFile.requestFile)(opts)}function loadImage(url){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{crossOrigin:"anonymous"};return new Promise(function(resolve,reject){try{var image=new Image;image.onload=function(){return resolve(image)};image.onerror=function(){return reject(new Error("Could not load image "+url+"."))};image.crossOrigin=opts.crossOrigin;image.src=url}catch(error){reject(error)}})}},{"./browser-request-file":198}],198:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.requestFile=requestFile;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function noop(){}var XHR_STATES={UNINITIALIZED:0,LOADING:1,LOADED:2,INTERACTIVE:3,COMPLETED:4};var XHR=function(){function XHR(_ref){
var url=_ref.url,_ref$path=_ref.path,path=_ref$path===undefined?null:_ref$path,_ref$method=_ref.method,method=_ref$method===undefined?"GET":_ref$method,_ref$asynchronous=_ref.asynchronous,asynchronous=_ref$asynchronous===undefined?true:_ref$asynchronous,_ref$noCache=_ref.noCache,noCache=_ref$noCache===undefined?false:_ref$noCache,_ref$sendAsBinary=_ref.sendAsBinary,sendAsBinary=_ref$sendAsBinary===undefined?false:_ref$sendAsBinary,_ref$responseType=_ref.responseType,responseType=_ref$responseType===undefined?false:_ref$responseType,_ref$onProgress=_ref.onProgress,onProgress=_ref$onProgress===undefined?noop:_ref$onProgress,_ref$onError=_ref.onError,onError=_ref$onError===undefined?noop:_ref$onError,_ref$onAbort=_ref.onAbort,onAbort=_ref$onAbort===undefined?noop:_ref$onAbort,_ref$onComplete=_ref.onComplete,onComplete=_ref$onComplete===undefined?noop:_ref$onComplete;_classCallCheck(this,XHR);this.url=path?path.join(path,url):url;this.method=method;this.async=asynchronous;this.noCache=noCache;this.sendAsBinary=sendAsBinary;this.responseType=responseType;this.req=new XMLHttpRequest;this.req.onload=function(e){return onComplete(e)};this.req.onerror=function(e){return onError(e)};this.req.onabort=function(e){return onAbort(e)};this.req.onprogress=function(e){if(e.lengthComputable){onProgress(e,Math.round(e.loaded/e.total*100))}else{onProgress(e,-1)}}}_createClass(XHR,[{key:"setRequestHeader",value:function setRequestHeader(header,value){this.req.setRequestHeader(header,value);return this}},{key:"sendAsync",value:function sendAsync(){var _this=this;var body=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.body||null;return new Promise(function(resolve,reject){try{var req=_this.req,method=_this.method,noCache=_this.noCache,sendAsBinary=_this.sendAsBinary,responseType=_this.responseType;var url=noCache?_this.url+(_this.url.indexOf("?")>=0?"&":"?")+Date.now():_this.url;req.open(method,url,_this.async);if(responseType){req.responseType=responseType}if(_this.async){req.onreadystatechange=function(e){if(req.readyState===XHR_STATES.COMPLETED){if(req.status===200){resolve(req.responseType?req.response:req.responseText)}else{reject(new Error(req.status+": "+url))}}}}if(sendAsBinary){req.sendAsBinary(body)}else{req.send(body)}if(!_this.async){if(req.status===200){resolve(req.responseType?req.response:req.responseText)}else{reject(new Error(req.status+": "+url))}}}catch(error){reject(error)}})}}]);return XHR}();function requestFile(opts){var xhr=new XHR(opts);return xhr.sendAsync()}},{}],199:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _browserLoad=require("./browser-load");Object.defineProperty(exports,"loadFile",{enumerable:true,get:function get(){return _browserLoad.loadFile}});Object.defineProperty(exports,"loadImage",{enumerable:true,get:function get(){return _browserLoad.loadImage}});var _loadFiles=require("./load-files");Object.defineProperty(exports,"loadFiles",{enumerable:true,get:function get(){return _loadFiles.loadFiles}});Object.defineProperty(exports,"loadImages",{enumerable:true,get:function get(){return _loadFiles.loadImages}});Object.defineProperty(exports,"loadTextures",{enumerable:true,get:function get(){return _loadFiles.loadTextures}});Object.defineProperty(exports,"loadProgram",{enumerable:true,get:function get(){return _loadFiles.loadProgram}});Object.defineProperty(exports,"loadModel",{enumerable:true,get:function get(){return _loadFiles.loadModel}});Object.defineProperty(exports,"parseModel",{enumerable:true,get:function get(){return _loadFiles.parseModel}})},{"./browser-load":197,"./load-files":200}],200:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.loadFiles=loadFiles;exports.loadImages=loadImages;exports.loadTextures=loadTextures;exports.loadProgram=loadProgram;exports.loadModel=loadModel;exports.parseModel=parseModel;var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _browserLoad=require("./browser-load");var _webgl=require("../webgl");var _core=require("../core");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function noop(){}function loadFiles(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var urls=opts.urls,_opts$onProgress=opts.onProgress,onProgress=_opts$onProgress===undefined?noop:_opts$onProgress;(0,_assert2.default)(urls.every(function(url){return typeof url==="string"}),"loadImages: {urls} must be array of strings");var count=0;return Promise.all(urls.map(function(url){var promise=(0,_browserLoad.loadFile)(Object.assign({url:url},opts));promise.then(function(file){return onProgress({progress:++count/urls.length,count:count,total:urls.length,url:url})});return promise}))}function loadImages(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var urls=opts.urls,_opts$onProgress2=opts.onProgress,onProgress=_opts$onProgress2===undefined?noop:_opts$onProgress2;(0,_assert2.default)(urls.every(function(url){return typeof url==="string"}),"loadImages: {urls} must be array of strings");var count=0;return Promise.all(urls.map(function(url){var promise=(0,_browserLoad.loadImage)(url);promise.then(function(file){return onProgress({progress:++count/urls.length,count:count,total:urls.length,url:url})});return promise}))}function loadTextures(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var urls=opts.urls,_opts$onProgress3=opts.onProgress,onProgress=_opts$onProgress3===undefined?noop:_opts$onProgress3;(0,_assert2.default)(urls.every(function(url){return typeof url==="string"}),"loadTextures: {urls} must be array of strings");return loadImages(Object.assign({urls:urls,onProgress:onProgress},opts)).then(function(images){return images.map(function(img,i){var params=Array.isArray(opts.parameters)?opts.parameters[i]:opts.parameters;params=params===undefined?{}:params;return new _webgl.Texture2D(gl,Object.assign({id:urls[i]},params,{data:img}))})})}function loadProgram(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var vs=opts.vs,fs=opts.fs,_opts$onProgress4=opts.onProgress,onProgress=_opts$onProgress4===undefined?noop:_opts$onProgress4;return loadFiles(Object.assign({urls:[vs,fs],onProgress:onProgress},opts)).then(function(_ref){var _ref2=_slicedToArray(_ref,2),vsText=_ref2[0],fsText=_ref2[1];return new _webgl.Program(gl,Object.assign({vs:vsText,fs:fsText},opts))})}function loadModel(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var url=opts.url,_opts$onProgress5=opts.onProgress,onProgress=_opts$onProgress5===undefined?noop:_opts$onProgress5;return loadFiles(Object.assign({urls:[url],onProgress:onProgress},opts)).then(function(_ref3){var _ref4=_slicedToArray(_ref3,1),file=_ref4[0];return parseModel(gl,Object.assign({file:file},opts))})}function parseModel(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var file=opts.file,_opts$program=opts.program,program=_opts$program===undefined?new _webgl.Program(gl):_opts$program;var json=typeof file==="string"?parseJSON(file):file;var attributes={};var modelOptions={};for(var key in json){var value=json[key];if(Array.isArray(value)){attributes[key]=key==="indices"?new Uint16Array(value):new Float32Array(value)}else{modelOptions[key]=value}}return new _core.Model(Object.assign({program:program,geometry:new _core.Geometry({attributes:attributes})},modelOptions,opts))}function parseJSON(file){try{return JSON.parse(file)}catch(error){throw new Error("Failed to parse JSON: "+error)}}},{"../core":162,"../webgl":231,"./browser-load":197,assert:1}],201:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _core=require("../core");var _geometry=require("../geometry");var _webgl=require("../webgl");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CLIPSPACE_QUAD_VERTEX_SHADER="attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n";var POSITIONS=[-1,-1,1,-1,-1,1,1,1];var TEX_COORDS=POSITIONS.map(function(coord){return coord===-1?0:coord});var ClipSpaceQuad=function(_Model){_inherits(ClipSpaceQuad,_Model);function ClipSpaceQuad(opts){_classCallCheck(this,ClipSpaceQuad);var _this=_possibleConstructorReturn(this,(ClipSpaceQuad.__proto__||Object.getPrototypeOf(ClipSpaceQuad)).call(this,Object.assign({},opts,{vs:CLIPSPACE_QUAD_VERTEX_SHADER,geometry:new _geometry.Geometry({drawMode:_webgl.GL.TRIANGLE_STRIP,attributes:{aClipSpacePosition:{value:new Float32Array(POSITIONS),size:2},aTexCoord:{value:new Float32Array(TEX_COORDS),size:2},aCoordinate:{value:new Float32Array(TEX_COORDS),size:2}}})})));_this.setVertexCount(4);return _this}return ClipSpaceQuad}(_core.Model);exports.default=ClipSpaceQuad},{"../core":162,"../geometry":191,"../webgl":231}],202:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _geometry=require("../geometry");var _core=require("../core");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Cone=function(_Model){_inherits(Cone,_Model);function Cone(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Cone);return _possibleConstructorReturn(this,(Cone.__proto__||Object.getPrototypeOf(Cone)).call(this,Object.assign({},opts,{geometry:new _geometry.ConeGeometry(opts)})))}return Cone}(_core.Model);exports.default=Cone},{"../core":162,"../geometry":191}],203:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _geometry=require("../geometry");var _core=require("../core");var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Cube=function(_Model){_inherits(Cube,_Model);function Cube(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Cube);var _opts$id=opts.id,id=_opts$id===undefined?(0,_utils.uid)("cube"):_opts$id;return _possibleConstructorReturn(this,(Cube.__proto__||Object.getPrototypeOf(Cube)).call(this,Object.assign({},opts,{id:id,geometry:new _geometry.CubeGeometry(opts)})))}return Cube}(_core.Model);exports.default=Cube},{"../core":162,"../geometry":191,"../utils":221}],204:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _geometry=require("../geometry");var _model=require("../core/model");var _model2=_interopRequireDefault(_model);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Cylinder=function(_Model){_inherits(Cylinder,_Model);function Cylinder(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Cylinder);return _possibleConstructorReturn(this,(Cylinder.__proto__||Object.getPrototypeOf(Cylinder)).call(this,Object.assign({},opts,{geometry:new _geometry.CylinderGeometry(opts)})))}return Cylinder}(_model2.default);exports.default=Cylinder},{"../core/model":163,"../geometry":191}],205:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _core=require("../core");var _geometry=require("../geometry");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var IcoSphere=function(_Model){_inherits(IcoSphere,_Model);function IcoSphere(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,IcoSphere);return _possibleConstructorReturn(this,(IcoSphere.__proto__||Object.getPrototypeOf(IcoSphere)).call(this,Object.assign({},opts,{geometry:new _geometry.IcoSphereGeometry(opts)})))}return IcoSphere}(_core.Model);exports.default=IcoSphere},{"../core":162,"../geometry":191}],206:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _geometry=require("../geometry");var _model=require("../core/model");var _model2=_interopRequireDefault(_model);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plane=function(_Model){_inherits(Plane,_Model);function Plane(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Plane);var _opts$id=opts.id,id=_opts$id===undefined?(0,_utils.uid)("plane"):_opts$id;return _possibleConstructorReturn(this,(Plane.__proto__||Object.getPrototypeOf(Plane)).call(this,Object.assign({},opts,{id:id,geometry:new _geometry.PlaneGeometry(opts)})))}return Plane}(_model2.default);exports.default=Plane},{"../core/model":163,"../geometry":191,"../utils":221}],207:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _core=require("../core");var _geometry=require("../geometry");var _utils=require("../utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Sphere=function(_Model){_inherits(Sphere,_Model);function Sphere(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Sphere);var _opts$id=opts.id,id=_opts$id===undefined?(0,_utils.uid)("sphere"):_opts$id;return _possibleConstructorReturn(this,(Sphere.__proto__||Object.getPrototypeOf(Sphere)).call(this,Object.assign({},opts,{id:id,geometry:new _geometry.SphereGeometry(opts)})))}return Sphere}(_core.Model);exports.default=Sphere},{"../core":162,"../geometry":191,"../utils":221}],208:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _geometry=require("../geometry");var _core=require("../core");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TruncatedCone=function(_Model){_inherits(TruncatedCone,_Model);function TruncatedCone(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,TruncatedCone);return _possibleConstructorReturn(this,(TruncatedCone.__proto__||Object.getPrototypeOf(TruncatedCone)).call(this,Object.assign({},opts,{geometry:new _geometry.TruncatedConeGeometry(opts)})))}return TruncatedCone}(_core.Model);exports.default=TruncatedCone},{"../core":162,"../geometry":191}],209:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _common=require("./src/common");Object.keys(_common).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _common[key]}})});var _vector=require("./src/vector2");Object.defineProperty(exports,"Vector2",{enumerable:true,get:function get(){return _interopRequireDefault(_vector).default}});var _vector2=require("./src/vector3");Object.defineProperty(exports,"Vector3",{enumerable:true,get:function get(){return _interopRequireDefault(_vector2).default}});var _vector3=require("./src/vector4");Object.defineProperty(exports,"Vector4",{enumerable:true,get:function get(){return _interopRequireDefault(_vector3).default}});var _matrix=require("./src/matrix4");Object.defineProperty(exports,"Matrix4",{enumerable:true,get:function get(){return _interopRequireDefault(_matrix).default}});var _quaternion=require("./src/quaternion");Object.defineProperty(exports,"Quaternion",{enumerable:true,get:function get(){return _interopRequireDefault(_quaternion).default}});var _euler=require("./src/euler");Object.defineProperty(exports,"Euler",{enumerable:true,get:function get(){return _interopRequireDefault(_euler).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./src/common":210,"./src/euler":211,"./src/matrix4":213,"./src/quaternion":214,"./src/vector2":216,"./src/vector3":217,"./src/vector4":218}],210:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.glMatrix=undefined;exports.configure=configure;exports.formatValue=formatValue;exports.isArray=isArray;exports.clone=clone;exports.radians=radians;exports.degrees=degrees;exports.sin=sin;exports.cos=cos;exports.tan=tan;exports.asin=asin;exports.acos=acos;exports.atan=atan;exports.clamp=clamp;exports.equals=equals;var _glMatrix=require("gl-matrix");_glMatrix.glMatrix.debug=true;_glMatrix.glMatrix.printRowMajor=true;exports.glMatrix=_glMatrix.glMatrix;function configure(options){if("epsilon"in options){_glMatrix.glMatrix.EPSILON=options.epsilon}if("debug"in options){_glMatrix.glMatrix.debug=options.debug}}function formatValue(value){var precision=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_glMatrix.glMatrix.precision||4;return parseFloat(value.toPrecision(precision))}function isArray(value){return Array.isArray(value)||ArrayBuffer.isView(value)&&value.length!==undefined}function clone(array){return array.clone?array.clone():new Array(array)}function map(value,func){if(isArray(value)){var result=clone(value);for(var i=0;i<result.length;++i){result[i]=func(result[i],i,result)}return result}return func(value)}function radians(degrees){return map(degrees,function(degrees){return degrees/180*Math.PI})}function degrees(radians){return map(radians,function(radians){return radians*180/Math.PI})}function sin(radians){return map(radians,function(angle){return Math.sin(angle)})}function cos(radians){return map(radians,function(angle){return Math.cos(angle)})}function tan(radians){return map(radians,function(angle){return Math.tan(angle)})}function asin(radians){return map(radians,function(angle){return Math.asin(angle)})}function acos(radians){return map(radians,function(angle){return Math.acos(angle)})}function atan(radians){return map(radians,function(angle){return Math.atan(angle)})}function clamp(value,min,max){return Math.max(min,Math.min(max,value))}function equals(a,b){return Math.abs(a-b)<=_glMatrix.glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))}},{"gl-matrix":144}],211:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _matrix=require("./matrix4");var _quaternion=require("./quaternion");var _vector=require("./vector3");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ERR_UNKNOWN_ORDER="Unknown Euler angle order";var ALMOST_ONE=.99999;function validateOrder(value){return value>=0&&value<6}function checkOrder(value){if(value<0&&value>=6){throw new Error(ERR_UNKNOWN_ORDER)}return value}var Euler=function(_MathArray){_inherits(Euler,_MathArray);_createClass(Euler,[{key:"ELEMENTS",get:function get(){return 4}}],[{key:"rotationOrder",value:function rotationOrder(order){return Euler.RotationOrders[order]}},{key:"ZYX",get:function get(){return 0}},{key:"YXZ",get:function get(){return 1}},{key:"XZY",get:function get(){return 2}},{key:"ZXY",get:function get(){return 3}},{key:"YZX",get:function get(){return 4}},{key:"XYZ",get:function get(){return 5}},{key:"RollPitchYaw",get:function get(){return 0}},{key:"DefaultOrder",get:function get(){return Euler.ZYX}},{key:"RotationOrders",get:function get(){return["ZYX","YXZ","XZY","ZXY","YZX","XYZ"]}}]);function Euler(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var order=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Euler.DefaultOrder;_classCallCheck(this,Euler);var _this=_possibleConstructorReturn(this,(Euler.__proto__||Object.getPrototypeOf(Euler)).call(this));if(arguments.length>0&&Array.isArray(arguments[0])){_this.fromVector3.apply(_this,arguments)}else{_this.set(x,y,z,order)}return _this}_createClass(Euler,[{key:"copy",value:function copy(array){for(var i=0;i<3;++i){this[i]=array[i]}this[3]=Number.isFinite(array[3])||this.order;this.check();return this}},{key:"set",value:function set(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var order=arguments[3];this[0]=x;this[1]=y;this[2]=z;this[3]=Number.isFinite(order)?order:this[3];this.check();return this}},{key:"validate",value:function validate(){return validateOrder(this[3])&&Number.isFinite(this[0])&&Number.isFinite(this[1])&&Number.isFinite(this[2])}},{key:"toArray",value:function toArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;array[offset]=this[0];array[offset+1]=this[1];array[offset+2]=this[2];return array}},{key:"toArray4",value:function toArray4(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;array[offset]=this[0];array[offset+1]=this[1];array[offset+2]=this[2];array[offset+3]=this[3];return array}},{key:"toVector3",value:function toVector3(optionalResult){if(optionalResult){return optionalResult.set(this[0],this[1],this[2])}return new _vector.Vector3(this[0],this[1],this[2])}},{key:"fromVector3",value:function fromVector3(v,order){return this.set(v[0],v[1],v[2],Number.isFinite(order)?order:this[3])}},{key:"fromArray",value:function fromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this[0]=array[0+offset];this[1]=array[1+offset];this[2]=array[2+offset];if(array[3]!==undefined){this[3]=array[3]}this.check();return this}},{key:"fromRollPitchYaw",value:function fromRollPitchYaw(roll,pitch,yaw){return this.set(roll,pitch,yaw,Euler.ZYX)}},{key:"fromQuaternion",value:function fromQuaternion(q,order){this._fromRotationMatrix(_matrix.Matrix4.fromQuaternion(q),order);this.check();return this}},{key:"fromRotationMatrix",value:function fromRotationMatrix(m){var order=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Euler.DefaultOrder;this._fromRotationMatrix(m,order);this.check();return this}},{key:"getRotationMatrix",value:function getRotationMatrix(){var m=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new _matrix.Matrix4;this._getRotationMatrix(m);return m}},{key:"getQuaternion",value:function getQuaternion(){var q=new _quaternion.Quaternion;switch(this[4]){case Euler.XYZ:return q.rotateX(this[0]).rotateY(this[1]).rotateZ(this[2]);case Euler.YXZ:return q.rotateY(this[0]).rotateX(this[1]).rotateZ(this[2]);case Euler.ZXY:return q.rotateZ(this[0]).rotateX(this[1]).rotateY(this[2]);case Euler.ZYX:return q.rotateZ(this[0]).rotateY(this[1]).rotateX(this[2]);case Euler.YZX:return q.rotateY(this[0]).rotateZ(this[1]).rotateX(this[2]);case Euler.XZY:return q.rotateX(this[0]).rotateZ(this[1]).rotateY(this[2]);default:throw new Error(ERR_UNKNOWN_ORDER)}}},{key:"_fromRotationMatrix",value:function _fromRotationMatrix(m){var order=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Euler.DefaultOrder;var te=m.elements;var m11=te[0],m12=te[4],m13=te[8];var m21=te[1],m22=te[5],m23=te[9];var m31=te[2],m32=te[6],m33=te[10];order=order||this[3];switch(order){case Euler.XYZ:this[1]=Math.asin((0,_common.clamp)(m13,-1,1));if(Math.abs(m13)<ALMOST_ONE){this[0]=Math.atan2(-m23,m33);this[2]=Math.atan2(-m12,m11)}else{this[0]=Math.atan2(m32,m22);this[2]=0}break;case Euler.YXZ:this[0]=Math.asin(-(0,_common.clamp)(m23,-1,1));if(Math.abs(m23)<ALMOST_ONE){this[1]=Math.atan2(m13,m33);this[2]=Math.atan2(m21,m22)}else{this[1]=Math.atan2(-m31,m11);this[2]=0}break;case Euler.ZXY:this[0]=Math.asin((0,_common.clamp)(m32,-1,1));if(Math.abs(m32)<ALMOST_ONE){
this[1]=Math.atan2(-m31,m33);this[2]=Math.atan2(-m12,m22)}else{this[1]=0;this[2]=Math.atan2(m21,m11)}break;case Euler.ZYX:this[1]=Math.asin(-(0,_common.clamp)(m31,-1,1));if(Math.abs(m31)<ALMOST_ONE){this[0]=Math.atan2(m32,m33);this[2]=Math.atan2(m21,m11)}else{this[0]=0;this[2]=Math.atan2(-m12,m22)}break;case Euler.YZX:this[2]=Math.asin((0,_common.clamp)(m21,-1,1));if(Math.abs(m21)<ALMOST_ONE){this[0]=Math.atan2(-m23,m22);this[1]=Math.atan2(-m31,m11)}else{this[0]=0;this[1]=Math.atan2(m13,m33)}break;case Euler.XZY:this[2]=Math.asin(-(0,_common.clamp)(m12,-1,1));if(Math.abs(m12)<ALMOST_ONE){this[0]=Math.atan2(m32,m22);this[1]=Math.atan2(m13,m11)}else{this[0]=Math.atan2(-m23,m33);this[1]=0}break;default:throw new Error(ERR_UNKNOWN_ORDER)}this[3]=order;return this}},{key:"_getRotationMatrix",value:function _getRotationMatrix(){var te=new _matrix.Matrix4;var x=this.x,y=this.y,z=this.z;var a=Math.cos(x);var c=Math.cos(y);var e=Math.cos(z);var b=Math.sin(x);var d=Math.sin(y);var f=Math.sin(z);switch(this[3]){case Euler.XYZ:{var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=-c*f;te[8]=d;te[1]=af+be*d;te[5]=ae-bf*d;te[9]=-b*c;te[2]=bf-ae*d;te[6]=be+af*d;te[10]=a*c;break}case Euler.YXZ:{var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b;te[4]=de*b-cf;te[8]=a*d;te[1]=a*f;te[5]=a*e;te[9]=-b;te[2]=cf*b-de;te[6]=df+ce*b;te[10]=a*c;break}case Euler.ZXY:{var _ce=c*e,_cf=c*f,_de=d*e,_df=d*f;te[0]=_ce-_df*b;te[4]=-a*f;te[8]=_de+_cf*b;te[1]=_cf+_de*b;te[5]=a*e;te[9]=_df-_ce*b;te[2]=-a*d;te[6]=b;te[10]=a*c;break}case Euler.ZYX:{var _ae=a*e,_af=a*f,_be=b*e,_bf=b*f;te[0]=c*e;te[4]=_be*d-_af;te[8]=_ae*d+_bf;te[1]=c*f;te[5]=_bf*d+_ae;te[9]=_af*d-_be;te[2]=-d;te[6]=b*c;te[10]=a*c;break}case Euler.YZX:{var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=bd-ac*f;te[8]=bc*f+ad;te[1]=f;te[5]=a*e;te[9]=-b*e;te[2]=-d*e;te[6]=ad*f+bc;te[10]=ac-bd*f;break}case Euler.XZY:{var _ac=a*c,_ad=a*d,_bc=b*c,_bd=b*d;te[0]=c*e;te[4]=-f;te[8]=d*e;te[1]=_ac*f+_bd;te[5]=a*e;te[9]=_ad*f-_bc;te[2]=_bc*f-_ad;te[6]=b*e;te[10]=_bd*f+_ac;break}default:throw new Error(ERR_UNKNOWN_ORDER)}te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"alpha",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"beta",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"gamma",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"phi",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"theta",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"psi",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"order",get:function get(){return this[3]},set:function set(value){return this[3]=checkOrder(value)}}]);return Euler}(_mathArray2.default);exports.default=Euler},{"./common":210,"./math-array":212,"./matrix4":213,"./quaternion":214,"./vector3":217}],212:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _common=require("./common");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _extendableBuiltin(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));Object.setPrototypeOf(instance,Object.getPrototypeOf(this));return instance}ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:false,writable:true,configurable:true}});if(Object.setPrototypeOf){Object.setPrototypeOf(ExtendableBuiltin,cls)}else{ExtendableBuiltin.__proto__=cls}return ExtendableBuiltin}var MathArray=function(_extendableBuiltin2){_inherits(MathArray,_extendableBuiltin2);function MathArray(){_classCallCheck(this,MathArray);return _possibleConstructorReturn(this,(MathArray.__proto__||Object.getPrototypeOf(MathArray)).apply(this,arguments))}_createClass(MathArray,[{key:"clone",value:function clone(){var Subclass=this.constructor;var clone=(new Subclass).copy(this);clone.check();return clone}},{key:"copy",value:function copy(array){for(var i=0;i<this.ELEMENTS;++i){this[i]=array[i]}this.check();return this}},{key:"set",value:function set(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}for(var i=0;i<this.ELEMENTS;++i){this[i]=args[i]||0}this.check();return this}},{key:"fromArray",value:function fromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;for(var i=0;i<this.ELEMENTS;++i){this[i]=array[i+offset]}this.check();return this}},{key:"toString",value:function toString(){var string="";for(var i=0;i<this.ELEMENTS;++i){string+=(i>0?", ":"")+(0,_common.formatValue)(this[i])}return this.constructor.name+"("+string+")"}},{key:"toArray",value:function toArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;for(var i=0;i<this.ELEMENTS;++i){array[offset+i]=this[i]}return array}},{key:"toFloat32Array",value:function toFloat32Array(){return new Float32Array(this)}},{key:"equals",value:function equals(array){if(this.length!==array.length){return false}for(var i=0;i<this.ELEMENTS;++i){if(!(0,_common.equals)(this[i],array[i])){return false}}return true}},{key:"exactEquals",value:function exactEquals(array){if(this.length!==array.length){return false}for(var i=0;i<this.ELEMENTS;++i){if(this[i]!==array[i]){return false}}return true}},{key:"validate",value:function validate(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this;var valid=array.length===this.ELEMENTS;for(var i=0;i<this.ELEMENTS;++i){valid=valid&&Number.isFinite(array[i])}return valid}},{key:"check",value:function check(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this;if(_common.glMatrix.debug&&!this.validate(array)){throw new Error("Invalid "+this.constructor.name)}}}]);return MathArray}(_extendableBuiltin(Array));exports.default=MathArray},{"./common":210}],213:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _vector=require("./vector2");var _vector2=_interopRequireDefault(_vector);var _vector3=require("./vector3");var _vector4=_interopRequireDefault(_vector3);var _vector5=require("./vector4");var _vector6=_interopRequireDefault(_vector5);var _glMatrix=require("gl-matrix");var _validators=require("./utils/validators");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Matrix4=function(_MathArray){_inherits(Matrix4,_MathArray);function Matrix4(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_classCallCheck(this,Matrix4);var _this=_possibleConstructorReturn(this,(Matrix4.__proto__||Object.getPrototypeOf(Matrix4)).call(this));if(Array.isArray(args[0])&&arguments.length===1){_this.copy(args[0])}else{_this.identity()}return _this}_createClass(Matrix4,[{key:"setRowMajor",value:function setRowMajor(){var m00=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var m10=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var m20=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var m30=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var m01=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var m11=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;var m21=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var m31=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var m02=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var m12=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var m22=arguments.length>10&&arguments[10]!==undefined?arguments[10]:1;var m32=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;var m03=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var m13=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;var m23=arguments.length>14&&arguments[14]!==undefined?arguments[14]:0;var m33=arguments.length>15&&arguments[15]!==undefined?arguments[15]:1;_glMatrix.mat4.set(this,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33);this.check();return this}},{key:"setColumnMajor",value:function setColumnMajor(){var m00=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var m01=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var m02=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var m03=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var m10=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var m11=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;var m12=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var m13=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var m20=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var m21=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var m22=arguments.length>10&&arguments[10]!==undefined?arguments[10]:1;var m23=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;var m30=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var m31=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;var m32=arguments.length>14&&arguments[14]!==undefined?arguments[14]:0;var m33=arguments.length>15&&arguments[15]!==undefined?arguments[15]:1;_glMatrix.mat4.set(this,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33);this.check();return this}},{key:"equals",value:function equals(a){return _glMatrix.mat4.equals(this,a)}},{key:"exactEquals",value:function exactEquals(a){return _glMatrix.mat4.exactEquals(this,a)}},{key:"toString",value:function toString(){if(_common.glMatrix.printRowMajor){_glMatrix.mat4.str(this)}else{_glMatrix.mat4.str(this)}}},{key:"determinant",value:function determinant(){return _glMatrix.mat4.determinant(this)}},{key:"getRotation",value:function getRotation(){throw new Error("Not implemented")}},{key:"identity",value:function identity(){_glMatrix.mat4.identity(this);this.check();return this}},{key:"frustum",value:function frustum(_ref){var left=_ref.left,right=_ref.right,bottom=_ref.bottom,top=_ref.top,near=_ref.near,far=_ref.far;_glMatrix.mat4.frustum(this,left,right,bottom,top,near,far);this.check();return this}},{key:"lookAt",value:function lookAt(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},eye=_ref2.eye,_ref2$center=_ref2.center,center=_ref2$center===undefined?[0,0,0]:_ref2$center,_ref2$up=_ref2.up,up=_ref2$up===undefined?[0,1,0]:_ref2$up;_glMatrix.mat4.lookAt(this,eye,center,up);this.check();return this}},{key:"ortho",value:function ortho(_ref3){var left=_ref3.left,right=_ref3.right,bottom=_ref3.bottom,top=_ref3.top,_ref3$near=_ref3.near,near=_ref3$near===undefined?.1:_ref3$near,_ref3$far=_ref3.far,far=_ref3$far===undefined?500:_ref3$far;_glMatrix.mat4.ortho(this,left,right,bottom,top,near,far);this.check();return this}},{key:"perspective",value:function perspective(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref4$fov=_ref4.fov,fov=_ref4$fov===undefined?45*Math.PI/180:_ref4$fov,_ref4$aspect=_ref4.aspect,aspect=_ref4$aspect===undefined?1:_ref4$aspect,_ref4$near=_ref4.near,near=_ref4$near===undefined?.1:_ref4$near,_ref4$far=_ref4.far,far=_ref4$far===undefined?500:_ref4$far;if(fov>Math.PI*2){throw Error("radians")}_glMatrix.mat4.perspective(this,fov,aspect,near,far);this.check();return this}},{key:"perspectiveFromFieldOfView",value:function perspectiveFromFieldOfView(out,fov,near,far){_glMatrix.mat4.perspectiveFromFieldOfView(out,fov,near,far);this.check();return this}},{key:"fromQuaternion",value:function fromQuaternion(q){_glMatrix.mat4.fromQuat(this,q);this.check();return this}},{key:"fromRotation",value:function fromRotation(rad,axis){_glMatrix.mat4.fromRotation(this,rad,axis);this.check();return this}},{key:"fromRotationTranslation",value:function fromRotationTranslation(q,v){_glMatrix.mat4.fromRotationTranslation(this,q,v);this.check();return this}},{key:"fromRotationTranslationScale",value:function fromRotationTranslationScale(q,v,s){_glMatrix.mat4.fromRotationTranslationScale(this,q,v,s);this.check();return this}},{key:"fromRotationTranslationScaleOrigin",value:function fromRotationTranslationScaleOrigin(q,v,s,o){_glMatrix.mat4.fromRotationTranslationScaleOrigin(this,q,v,s,o);this.check();return this}},{key:"fromScaling",value:function fromScaling(v){_glMatrix.mat4.fromScaling(this,v);this.check();return this}},{key:"fromTranslation",value:function fromTranslation(v){_glMatrix.mat4.fromTranslation(this,v);this.check();return this}},{key:"fromXRotation",value:function fromXRotation(rad){_glMatrix.mat4.fromXRotation(this,rad);this.check();return this}},{key:"fromYRotation",value:function fromYRotation(rad){_glMatrix.mat4.fromYRotation(this,rad);this.check();return this}},{key:"fromZRotation",value:function fromZRotation(rad){_glMatrix.mat4.fromZRotation(this,rad);this.check();return this}},{key:"transpose",value:function transpose(){_glMatrix.mat4.transpose(this,this);this.check();return this}},{key:"invert",value:function invert(){_glMatrix.mat4.invert(this,this);this.check();return this}},{key:"adjoint",value:function adjoint(){_glMatrix.mat4.adjoint(this,this);this.check();return this}},{key:"add",value:function add(a,b){_glMatrix.mat4.add(this,this,a);this.check();return this}},{key:"multiplyLeft",value:function multiplyLeft(a){_glMatrix.mat4.multiply(this,a,this);this.check();return this}},{key:"multiplyRight",value:function multiplyRight(a){_glMatrix.mat4.multiply(this,this,a);this.check();return this}},{key:"rotateX",value:function rotateX(radians){_glMatrix.mat4.rotateX(this,this,radians);this.check();return this}},{key:"rotateY",value:function rotateY(radians){_glMatrix.mat4.rotateY(this,this,radians);this.check();return this}},{key:"rotateZ",value:function rotateZ(radians){_glMatrix.mat4.rotateZ(this,this,radians);this.check();return this}},{key:"rotateXYZ",value:function rotateXYZ(_ref5){var _ref6=_slicedToArray(_ref5,3),rx=_ref6[0],ry=_ref6[1],rz=_ref6[2];var d11=this[0];var d12=this[1];var d13=this[2];var d14=this[3];var d21=this[4];var d22=this[5];var d23=this[6];var d24=this[7];var d31=this[8];var d32=this[9];var d33=this[10];var d34=this[11];var crx=Math.cos(rx);var cry=Math.cos(ry);var crz=Math.cos(rz);var srx=Math.sin(rx);var sry=Math.sin(ry);var srz=Math.sin(rz);var m11=cry*crz;var m21=-crx*srz+srx*sry*crz;var m31=srx*srz+crx*sry*crz;var m12=cry*srz;var m22=crx*crz+srx*sry*srz;var m32=-srx*crz+crx*sry*srz;var m13=-sry;var m23=srx*cry;var m33=crx*cry;this[0]=d11*m11+d21*m12+d31*m13;this[1]=d12*m11+d22*m12+d32*m13;this[2]=d13*m11+d23*m12+d33*m13;this[3]=d14*m11+d24*m12+d34*m13;this[4]=d11*m21+d21*m22+d31*m23;this[5]=d12*m21+d22*m22+d32*m23;this[6]=d13*m21+d23*m22+d33*m23;this[7]=d14*m21+d24*m22+d34*m23;this[8]=d11*m31+d21*m32+d31*m33;this[9]=d12*m31+d22*m32+d32*m33;this[10]=d13*m31+d23*m32+d33*m33;this[11]=d14*m31+d24*m32+d34*m33;this.check();return this}},{key:"scale",value:function scale(vec){_glMatrix.mat4.scale(this,this,vec);this.check();return this}},{key:"translate",value:function translate(vec){_glMatrix.mat4.translate(this,this,vec);this.check();return this}},{key:"transformVector2",value:function transformVector2(vector){var out=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new _vector2.default;_glMatrix.vec2.transformMat4(out,vector,this);(0,_validators.checkVector2)(out);return out}},{key:"transformVector3",value:function transformVector3(vector){var out=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new _vector4.default;_glMatrix.vec3.transformMat4(out,vector,this);(0,_validators.checkVector3)(out);return out}},{key:"transformVector4",value:function transformVector4(vector){var out=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new _vector6.default;_glMatrix.vec4.transformMat4(out,vector,this);(0,_validators.checkVector4)(out);return out}},{key:"transformVector",value:function transformVector(vector){switch(vector.length){case 2:return this.transformVector2(vector);case 3:return this.transformVector3(vector);case 4:return this.transformVector4(vector);default:throw new Error("Illegal vector")}}},{key:"ELEMENTS",get:function get(){return 16}},{key:"m00",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"m01",get:function get(){return this[4]},set:function set(value){return this[4]=(0,_common.checkNumber)(value)}},{key:"m02",get:function get(){return this[8]},set:function set(value){return this[8]=(0,_common.checkNumber)(value)}},{key:"m03",get:function get(){return this[12]},set:function set(value){return this[12]=(0,_common.checkNumber)(value)}},{key:"m10",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"m11",get:function get(){return this[5]},set:function set(value){return this[5]=(0,_common.checkNumber)(value)}},{key:"m12",get:function get(){return this[9]},set:function set(value){return this[9]=(0,_common.checkNumber)(value)}},{key:"m13",get:function get(){return this[13]},set:function set(value){return this[13]=(0,_common.checkNumber)(value)}},{key:"m20",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"m21",get:function get(){return this[6]},set:function set(value){return this[6]=(0,_common.checkNumber)(value)}},{key:"m22",get:function get(){return this[10]},set:function set(value){return this[10]=(0,_common.checkNumber)(value)}},{key:"m23",get:function get(){return this[14]},set:function set(value){return this[14]=(0,_common.checkNumber)(value)}},{key:"m30",get:function get(){return this[3]},set:function set(value){return this[3]=(0,_common.checkNumber)(value)}},{key:"m31",get:function get(){return this[7]},set:function set(value){return this[7]=(0,_common.checkNumber)(value)}},{key:"m32",get:function get(){return this[11]},set:function set(value){return this[11]=(0,_common.checkNumber)(value)}},{key:"m33",get:function get(){return this[15]},set:function set(value){return this[15]=(0,_common.checkNumber)(value)}}],[{key:"equals",value:function equals(a,b){return _glMatrix.mat4.equals(a,b)}},{key:"exactEquals",value:function exactEquals(a,b){return _glMatrix.mat4.exactEquals(a,b)}},{key:"determinant",value:function determinant(m){return _glMatrix.mat4.determinant(m)}},{key:"frustum",value:function frustum(opts){return(new Matrix4).frustum(opts)}},{key:"lookAt",value:function lookAt(opts){return(new Matrix4).lookAt(opts)}},{key:"ortho",value:function ortho(opts){return(new Matrix4).ortho(opts)}},{key:"perspective",value:function perspective(opts){return(new Matrix4).perspective(opts)}},{key:"perspectiveFromFieldOfView",value:function perspectiveFromFieldOfView(opts){return(new Matrix4).perspectiveFromFieldOfView(opts)}},{key:"fromQuaternion",value:function fromQuaternion(q){return(new Matrix4).fromQuaternion(q)}}]);return Matrix4}(_mathArray2.default);exports.default=Matrix4},{"./common":210,"./math-array":212,"./utils/validators":215,"./vector2":216,"./vector3":217,"./vector4":218,"gl-matrix":144}],214:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Quaternion=function(_MathArray){_inherits(Quaternion,_MathArray);function Quaternion(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var w=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,Quaternion);var _this=_possibleConstructorReturn(this,(Quaternion.__proto__||Object.getPrototypeOf(Quaternion)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y,z,w)}return _this}_createClass(Quaternion,[{key:"fromMatrix3",value:function fromMatrix3(m){_glMatrix.quat.fromMat3(this,m);this.check();return this}},{key:"fromValues",value:function fromValues(x,y,z,w){return this.set(x,y,z,w)}},{key:"identity",value:function identity(){_glMatrix.quat.identity(this);this.check();return this}},{key:"equals",value:function equals(quaternion){return _glMatrix.quat.equals(this,quaternion)}},{key:"exactEquals",value:function exactEquals(quaternion){return _glMatrix.quat.exactEquals(this,quaternion)}},{key:"length",value:function length(){return _glMatrix.quat.length(this)}},{key:"squaredLength",value:function squaredLength(a){return _glMatrix.quat.squaredLength(this)}},{key:"dot",value:function dot(a,b){if(b!==undefined){throw new Error("Quaternion.dot only takes one argument")}return _glMatrix.quat.dot(this,a)}},{key:"getAxisAngle",value:function getAxisAngle(){var axis=[];var angle=_glMatrix.quat.getAxisAngle(axis,this);return{axis:axis,angle:angle}}},{key:"rotationTo",value:function rotationTo(vectorA,vectorB){_glMatrix.quat.rotationTo(this,vectorA,vectorB);this.check();return this}},{key:"add",value:function add(a,b){if(b!==undefined){throw new Error("Quaternion.add only takes one argument")}_glMatrix.quat.add(this,a);this.check();return this}},{key:"calculateW",value:function calculateW(){_glMatrix.quat.calculateW(this,this);this.check();return this}},{key:"conjugate",value:function conjugate(){_glMatrix.quat.conjugate(this,this);this.check();return this}},{key:"invert",value:function invert(){_glMatrix.quat.invert(this,this);this.check();return this}},{key:"lerp",value:function lerp(a,b,t){_glMatrix.quat.lerp(this,a,b,t);this.check();return this}},{key:"multiply",value:function multiply(a,b){if(b!==undefined){throw new Error("Quaternion.multiply only takes one argument")}_glMatrix.quat.multiply(this,this,b);this.check();return this}},{key:"normalize",value:function normalize(){_glMatrix.quat.normalize(this,this);this.check();return this}},{key:"rotateX",value:function rotateX(rad){_glMatrix.quat.rotateX(this,this,rad);this.check();return this}},{key:"rotateY",value:function rotateY(rad){_glMatrix.quat.rotateY(this,this,rad);this.check();return this}},{key:"rotateZ",value:function rotateZ(rad){_glMatrix.quat.rotateZ(this,this,rad);this.check();return this}},{key:"scale",value:function scale(b){_glMatrix.quat.scale(this,this,b);this.check();return this}},{key:"set",value:function set(i,j,k,l){_glMatrix.quat.set(this,i,j,k,l);this.check();return this}},{key:"setAxisAngle",value:function setAxisAngle(axis,rad){_glMatrix.quat.setAxisAngle(this,axis,rad);this.check();return this}},{key:"slerp",value:function slerp(a,b,t){_glMatrix.quat.slerp(this,a,b,t);this.check();return this}},{key:"ELEMENTS",get:function get(){return 4}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"w",get:function get(){return this[3]},set:function set(value){return this[3]=(0,_common.checkNumber)(value)}}]);return Quaternion}(_mathArray2.default);exports.default=Quaternion},{"./common":210,"./math-array":212,"gl-matrix":144}],215:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkArguments=checkArguments;exports.validateVector2=validateVector2;exports.checkVector2=checkVector2;exports.validateVector3=validateVector3;exports.checkVector3=checkVector3;exports.validateVector4=validateVector4;exports.checkVector4=checkVector4;exports.validateQuaternion=validateQuaternion;exports.checkQuaternion=checkQuaternion;exports.validateMatrix2=validateMatrix2;exports.checkMatrix2=checkMatrix2;exports.validateMatrix2d=validateMatrix2d;exports.checkMatrix2d=checkMatrix2d;exports.validateMatrix3=validateMatrix3;exports.checkMatrix3=checkMatrix3;exports.validateMatrix4=validateMatrix4;exports.checkMatrix4=checkMatrix4;var _glMatrix=require("gl-matrix");function checkArguments(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}for(var i=0;i<args.length;++i){if(args[i]===undefined){throw new Error("Invalid math argument")}}}function validateVector2(v){return v.length===2&&Number.isFinite(v[0])&&Number.isFinite(v[1])}function checkVector2(v){if(_glMatrix.glMatrix.debug&&!validateVector2(v)){throw new Error("Invalid Vector2")}}function validateVector3(v){return v.length===3&&Number.isFinite(v[0])&&Number.isFinite(v[1])&&Number.isFinite(v[2])}function checkVector3(v){if(_glMatrix.glMatrix.debug&&!validateVector3(v)){throw new Error("Invalid Vector3")}}function validateVector4(v){return v.length===4&&Number.isFinite(v[0])&&Number.isFinite(v[1])&&Number.isFinite(v[2])&&Number.isFinite(v[3])}function checkVector4(v){if(_glMatrix.glMatrix.debug&&!validateVector4(v)){throw new Error("Invalid Vector4")}}function validateQuaternion(q){return q.length===4&&Number.isFinite(q[0])&&Number.isFinite(q[1])&&Number.isFinite(q[2])&&Number.isFinite(q[3])}function checkQuaternion(q){if(_glMatrix.glMatrix.debug&&!validateQuaternion(q)){throw new Error("Invalid Quaternion")}}function validateMatrix2(m){return m.length===4&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])}function checkMatrix2(m){if(_glMatrix.glMatrix.debug&&!validateMatrix2(m)){throw new Error("Invalid Matrix2")}}function validateMatrix2d(m){return m.length===6&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])&&Number.isFinite(m[4])&&Number.isFinite(m[5])}function checkMatrix2d(m){if(_glMatrix.glMatrix.debug&&!validateMatrix2d(m)){throw new Error("Invalid Matrix2d")}}function validateMatrix3(m){return m.length===9&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])&&Number.isFinite(m[4])&&Number.isFinite(m[5])&&Number.isFinite(m[6])&&Number.isFinite(m[7])&&Number.isFinite(m[8])}function checkMatrix3(m){if(_glMatrix.glMatrix.debug&&!validateMatrix3(m)){throw new Error("Invalid Matrix3")}}function validateMatrix4(m){return m.length===16&&Number.isFinite(m[0])&&Number.isFinite(m[1])&&Number.isFinite(m[2])&&Number.isFinite(m[3])&&Number.isFinite(m[4])&&Number.isFinite(m[5])&&Number.isFinite(m[6])&&Number.isFinite(m[7])&&Number.isFinite(m[8])&&Number.isFinite(m[9])&&Number.isFinite(m[10])&&Number.isFinite(m[11])&&Number.isFinite(m[12])&&Number.isFinite(m[13])&&Number.isFinite(m[14])&&Number.isFinite(m[15])}function checkMatrix4(m){
if(_glMatrix.glMatrix.debug&&!validateMatrix4(m)){throw new Error("Invalid Matrix4")}}},{"gl-matrix":144}],216:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Vector2=function(_MathArray){_inherits(Vector2,_MathArray);function Vector2(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Vector2);var _this=_possibleConstructorReturn(this,(Vector2.__proto__||Object.getPrototypeOf(Vector2)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y)}return _this}_createClass(Vector2,[{key:"set",value:function set(x,y){_glMatrix.vec2.set(this,x,y);this.check();return this}},{key:"equals",value:function equals(vector){return _glMatrix.vec2.equals(this,vector)}},{key:"exactEquals",value:function exactEquals(vector){return _glMatrix.vec2.exactEquals(this,vector)}},{key:"add",value:function add(){for(var _len=arguments.length,vectors=Array(_len),_key=0;_key<_len;_key++){vectors[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=vectors[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var vector=_step.value;_glMatrix.vec2.add(this,vector)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return this}},{key:"ELEMENTS",get:function get(){return 2}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}}]);return Vector2}(_mathArray2.default);exports.default=Vector2},{"./common":210,"./math-array":212,"gl-matrix":144}],217:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Vector3=function(_MathArray){_inherits(Vector3,_MathArray);function Vector3(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Vector3);var _this=_possibleConstructorReturn(this,(Vector3.__proto__||Object.getPrototypeOf(Vector3)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y,z)}return _this}_createClass(Vector3,[{key:"set",value:function set(x,y,z){_glMatrix.vec3.set(this,x,y,z);this.check();return this}},{key:"equals",value:function equals(vector){return _glMatrix.vec3.equals(this,vector)}},{key:"exactEquals",value:function exactEquals(vector){return _glMatrix.vec3.exactEquals(this,vector)}},{key:"distance",value:function distance(vector){return _glMatrix.vec3.distance(vector)}},{key:"dist",value:function dist(vector){return _glMatrix.vec3.dist(vector)}},{key:"angle",value:function angle(vector){return _glMatrix.vec3.angle(vector)}},{key:"add",value:function add(){for(var _len=arguments.length,vectors=Array(_len),_key=0;_key<_len;_key++){vectors[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=vectors[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var vector=_step.value;_glMatrix.vec3.add(this,vector)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.check();return this}},{key:"subtract",value:function subtract(){for(var _len2=arguments.length,vectors=Array(_len2),_key2=0;_key2<_len2;_key2++){vectors[_key2]=arguments[_key2]}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=vectors[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var vector=_step2.value;_glMatrix.vec3.subtract(this,vector)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.check();return this}},{key:"multiply",value:function multiply(){for(var _len3=arguments.length,vectors=Array(_len3),_key3=0;_key3<_len3;_key3++){vectors[_key3]=arguments[_key3]}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=vectors[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var vector=_step3.value;_glMatrix.vec3.multiply(this,vector)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}this.check();return this}},{key:"divide",value:function divide(){for(var _len4=arguments.length,vectors=Array(_len4),_key4=0;_key4<_len4;_key4++){vectors[_key4]=arguments[_key4]}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=vectors[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var vector=_step4.value;_glMatrix.vec3.divide(this,vector)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}this.check();return this}},{key:"ceil",value:function ceil(){_glMatrix.vec3.ceil(this,this);this.check();return this}},{key:"floor",value:function floor(){_glMatrix.vec3.floor(this,this);this.check();return this}},{key:"min",value:function min(){_glMatrix.vec3.min(this,this);this.check();return this}},{key:"max",value:function max(){_glMatrix.vec3.max(this,this);this.check();return this}},{key:"scale",value:function scale(_scale){_glMatrix.vec3.scale(this,this,_scale);this.check();return this}},{key:"scaleAndAdd",value:function scaleAndAdd(vector,scale){_glMatrix.vec3.scaleAndAdd(this,this,vector,scale);this.check();return this}},{key:"negate",value:function negate(){_glMatrix.vec3.negate(this,this);this.check();return this}},{key:"inverse",value:function inverse(){_glMatrix.vec3.inverse(this,this);this.check();return this}},{key:"normalize",value:function normalize(){_glMatrix.vec3.normalize(this,this);this.check();return this}},{key:"dot",value:function dot(vector){_glMatrix.vec3.dot(this,this,vector);this.check();return this}},{key:"cross",value:function cross(vector){_glMatrix.vec3.cross(this,this,vector);this.check();return this}},{key:"lerp",value:function lerp(scale){_glMatrix.vec3.lerp(this,this,scale);this.check();return this}},{key:"hermite",value:function hermite(scale){_glMatrix.vec3.hermite(this,this,scale);this.check();return this}},{key:"bezier",value:function bezier(scale){_glMatrix.vec3.bezier(this,this,scale);this.check();return this}},{key:"random",value:function random(scale){_glMatrix.vec3.cross(this,this,scale);this.check();return this}},{key:"rotateX",value:function rotateX(origin,angle){_glMatrix.vec3.rotateX(this,this,origin,angle);this.check();return this}},{key:"rotateY",value:function rotateY(origin,angle){_glMatrix.vec3.rotateY(this,this,origin,angle);this.check();return this}},{key:"rotateZ",value:function rotateZ(origin,angle){_glMatrix.vec3.rotateZ(this,this,origin,angle);this.check();return this}},{key:"ELEMENTS",get:function get(){return 3}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}}],[{key:"fromArray",value:function fromArray(array){if(array instanceof Vector3){return array}return new(Function.prototype.bind.apply(Vector3,[null].concat(_toConsumableArray(array))))}},{key:"dot",value:function dot(a,b){return Vector3.fromArray(a).dot(b)}},{key:"cross",value:function cross(a,b){return Vector3.fromArray(a).cross(b)}}]);return Vector3}(_mathArray2.default);exports.default=Vector3},{"./common":210,"./math-array":212,"gl-matrix":144}],218:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _mathArray=require("./math-array");var _mathArray2=_interopRequireDefault(_mathArray);var _common=require("./common");var _glMatrix=require("gl-matrix");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Vector4=function(_MathArray){_inherits(Vector4,_MathArray);function Vector4(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var w=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Vector4);var _this=_possibleConstructorReturn(this,(Vector4.__proto__||Object.getPrototypeOf(Vector4)).call(this));if(Array.isArray(x)&&arguments.length===1){_this.copy(x)}else{_this.set(x,y,z,w)}return _this}_createClass(Vector4,[{key:"set",value:function set(x,y,z,w){_glMatrix.vec4.set(this,x,y,z,w);this.check();return this}},{key:"equals",value:function equals(vector){return _glMatrix.vec4.equals(this,vector)}},{key:"exactEquals",value:function exactEquals(vector){return _glMatrix.vec4.exactEquals(this,vector)}},{key:"distance",value:function distance(vector){return _glMatrix.vec4.distance(vector)}},{key:"dist",value:function dist(vector){return _glMatrix.vec4.dist(vector)}},{key:"angle",value:function angle(vector){return _glMatrix.vec4.angle(vector)}},{key:"add",value:function add(){for(var _len=arguments.length,vectors=Array(_len),_key=0;_key<_len;_key++){vectors[_key]=arguments[_key]}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=vectors[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var vector=_step.value;_glMatrix.vec4.add(this,vector)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.check();return this}},{key:"subtract",value:function subtract(){for(var _len2=arguments.length,vectors=Array(_len2),_key2=0;_key2<_len2;_key2++){vectors[_key2]=arguments[_key2]}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=vectors[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var vector=_step2.value;_glMatrix.vec4.subtract(this,vector)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.check();return this}},{key:"multiply",value:function multiply(){for(var _len3=arguments.length,vectors=Array(_len3),_key3=0;_key3<_len3;_key3++){vectors[_key3]=arguments[_key3]}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=vectors[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var vector=_step3.value;_glMatrix.vec4.multiply(this,vector)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}this.check();return this}},{key:"divide",value:function divide(){for(var _len4=arguments.length,vectors=Array(_len4),_key4=0;_key4<_len4;_key4++){vectors[_key4]=arguments[_key4]}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=vectors[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var vector=_step4.value;_glMatrix.vec4.divide(this,vector)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}this.check();return this}},{key:"ceil",value:function ceil(){_glMatrix.vec4.ceil(this,this);this.check();return this}},{key:"floor",value:function floor(){_glMatrix.vec4.floor(this,this);this.check();return this}},{key:"min",value:function min(){_glMatrix.vec4.min(this,this);this.check();return this}},{key:"max",value:function max(){_glMatrix.vec4.max(this,this);this.check();return this}},{key:"scale",value:function scale(_scale){_glMatrix.vec4.scale(this,this,_scale);this.check();return this}},{key:"scaleAndAdd",value:function scaleAndAdd(vector,scale){_glMatrix.vec4.scaleAndAdd(this,this,vector,scale);this.check();return this}},{key:"negate",value:function negate(){_glMatrix.vec4.negate(this,this);this.check();return this}},{key:"inverse",value:function inverse(){_glMatrix.vec4.inverse(this,this);this.check();return this}},{key:"normalize",value:function normalize(){_glMatrix.vec4.normalize(this,this);this.check();return this}},{key:"dot",value:function dot(scale){_glMatrix.vec4.dot(this,this,scale);this.check();return this}},{key:"cross",value:function cross(scale){_glMatrix.vec4.cross(this,this,scale);this.check();return this}},{key:"lerp",value:function lerp(scale){_glMatrix.vec4.lerp(this,this,scale);this.check();return this}},{key:"hermite",value:function hermite(scale){_glMatrix.vec4.hermite(this,this,scale);this.check();return this}},{key:"bezier",value:function bezier(scale){_glMatrix.vec4.bezier(this,this,scale);this.check();return this}},{key:"random",value:function random(scale){_glMatrix.vec4.random(this,this,scale);this.check();return this}},{key:"rotateX",value:function rotateX(origin,angle){_glMatrix.vec4.rotateX(this,this,origin,angle);this.check();return this}},{key:"rotateY",value:function rotateY(origin,angle){_glMatrix.vec4.rotateY(this,this,origin,angle);this.check();return this}},{key:"rotateZ",value:function rotateZ(origin,angle){_glMatrix.vec4.rotateZ(this,this,origin,angle);this.check();return this}},{key:"ELEMENTS",get:function get(){return 4}},{key:"x",get:function get(){return this[0]},set:function set(value){return this[0]=(0,_common.checkNumber)(value)}},{key:"y",get:function get(){return this[1]},set:function set(value){return this[1]=(0,_common.checkNumber)(value)}},{key:"z",get:function get(){return this[2]},set:function set(value){return this[2]=(0,_common.checkNumber)(value)}},{key:"w",get:function get(){return this[3]},set:function set(value){return this[3]=(0,_common.checkNumber)(value)}}]);return Vector4}(_mathArray2.default);exports.default=Vector4},{"./common":210,"./math-array":212,"gl-matrix":144}],219:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pageLoadPromise=exports.isPageLoaded=undefined;var _isBrowser=require("./is-browser");var _isBrowser2=_interopRequireDefault(_isBrowser);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var isPageLoaded=exports.isPageLoaded=false;var pageLoadPromise=exports.pageLoadPromise=_isBrowser2.default?new Promise(function(resolve,reject){window.onload=function(){exports.isPageLoaded=isPageLoaded=true;resolve(document)}}):Promise.resolve({})},{"./is-browser":222}],220:[function(require,module,exports){(function(global){"use strict";module.exports={window:typeof window!=="undefined"?window:global,global:typeof global!=="undefined"?global:window,document:typeof document!=="undefined"?document:{}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],221:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _isBrowser=require("./is-browser");Object.keys(_isBrowser).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _isBrowser[key]}})});var _browserUtils=require("./browser-utils");Object.keys(_browserUtils).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _browserUtils[key]}})});var _promiseUtils=require("./promise-utils");Object.keys(_promiseUtils).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _promiseUtils[key]}})});var _utils=require("./utils");Object.keys(_utils).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _utils[key]}})});var _log=require("./log");Object.keys(_log).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _log[key]}})});Object.defineProperty(exports,"log",{enumerable:true,get:function get(){return _interopRequireDefault(_log).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./browser-utils":219,"./is-browser":222,"./log":223,"./promise-utils":224,"./utils":225}],222:[function(require,module,exports){(function(process){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var isNode=exports.isNode=(typeof process==="undefined"?"undefined":_typeof(process))==="object"&&String(process)==="[object process]"&&!process.browser;var isBrowser=exports.isBrowser=!isNode;exports.default=isBrowser}).call(this,require("_process"))},{_process:252}],223:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.formatValue=formatValue;var cache={};var _log={priority:0,table:function table(priority,_table){if(priority<=_log.priority&&_table){console.table(_table)}},log:function log(priority){if(priority<=_log.priority){var _console;for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}(_console=console).debug.apply(_console,args)}},info:function info(priority){if(priority<=_log.priority){var _console2;for(var _len2=arguments.length,args=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){args[_key2-1]=arguments[_key2]}(_console2=console).log.apply(_console2,args)}},warn:function warn(priority){if(priority<=_log.priority){var _console3;for(var _len3=arguments.length,args=Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){args[_key3-1]=arguments[_key3]}(_console3=console).warn.apply(_console3,args)}},once:function once(priority,arg){if(!cache[arg]){for(var _len4=arguments.length,args=Array(_len4>2?_len4-2:0),_key4=2;_key4<_len4;_key4++){args[_key4-2]=arguments[_key4]}_log.log.apply(_log,[priority,arg].concat(args))}cache[arg]=true}};function formatArrayValue(v,opts){var _opts$maxElts=opts.maxElts,maxElts=_opts$maxElts===undefined?16:_opts$maxElts,_opts$size=opts.size,size=_opts$size===undefined?1:_opts$size;var string="[";for(var i=0;i<v.length&&i<maxElts;++i){if(i>0){string+=","+(i%size===0?" ":"")}string+=formatValue(v[i],opts)}var terminator=v.length>maxElts?"...":"]";return""+string+terminator}function formatValue(v){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _opts$isInteger=opts.isInteger,isInteger=_opts$isInteger===undefined?false:_opts$isInteger;if(Array.isArray(v)||ArrayBuffer.isView(v)){return formatArrayValue(v,opts)}if(!Number.isFinite(v)){return String(v)}if(isInteger){return v.toFixed(0)}if(Math.abs(v)>100&&Math.abs(v)<1e4){return v.toFixed(0)}var string=v.toPrecision(2);var decimal=string.indexOf(".0");return decimal===string.length-2?string.slice(0,-1):string}exports.default=_log},{}],224:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.promisify=promisify;function promisify(func){return function promisifiedFunction(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return new Promise(function(resolve,reject){function callback(error,data){try{if(error){reject(error)}else{resolve(data)}}catch(e){reject(e)}}func.apply(undefined,args.concat([callback]))})}}},{}],225:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.splat=splat;exports.noop=noop;exports.uid=uid;exports.merge=merge;function splat(a){return a?Array.isArray(a)?a:[a]:[]}function noop(){}var uidCounters={};function uid(){var id=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"id";uidCounters[id]=uidCounters[id]||1;var count=uidCounters[id]++;return id+"-"+count}function merge(objects){var mix={};for(var i=0,l=arguments.length;i<l;i++){var object=arguments[i];if(!object||object.constructor.name!=="Object"){continue}for(var key in object){var op=object[key];var mp=mix[key];if(mp&&op.constructor.name==="Object"&&mp.constructor.name==="Object"){mix[key]=merge(mp,op)}else{mix[key]=detach(op)}}}return mix}function detach(elem){var t=elem.constructor.name;var ans=void 0;if(t==="Object"){ans={};for(var p in elem){ans[p]=detach(elem[p])}}else if(t==="Array"){ans=[];for(var i=0,l=elem.length;i<l;i++){ans[i]=detach(elem[i])}}else{ans=elem}return ans}},{}],226:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.BufferLayout=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var BufferLayout=exports.BufferLayout=function BufferLayout(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},type=_ref.type,_ref$size=_ref.size,size=_ref$size===undefined?1:_ref$size,_ref$offset=_ref.offset,offset=_ref$offset===undefined?0:_ref$offset,_ref$stride=_ref.stride,stride=_ref$stride===undefined?0:_ref$stride,_ref$normalized=_ref.normalized,normalized=_ref$normalized===undefined?false:_ref$normalized,_ref$integer=_ref.integer,integer=_ref$integer===undefined?false:_ref$integer,_ref$instanced=_ref.instanced,instanced=_ref$instanced===undefined?0:_ref$instanced;_classCallCheck(this,BufferLayout);this.type=type;this.size=size;this.offset=offset;this.stride=stride;this.normalized=normalized;this.integer=integer;this.instanced=instanced};var Buffer=function(){_createClass(Buffer,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Buffer?object:new Buffer(gl).setData({handle:object.handle||object})}}]);function Buffer(){var gl=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},id=_ref2.id,handle=_ref2.handle;_classCallCheck(this,Buffer);(0,_webglChecks.assertWebGLContext)(gl);handle=handle||gl.createBuffer();if(!(handle instanceof _webgl.WebGLBuffer)){throw new Error("Failed to create WebGLBuffer")}this.gl=gl;this.handle=handle;this.id=id;this.bytes=undefined;this.data=null;this.target=_webgl.GL.ARRAY_BUFFER;this.layout=null;this.userData={};Object.seal(this)}_createClass(Buffer,[{key:"delete",value:function _delete(){var gl=this.gl;if(this.handle){gl.deleteBuffer(this.handle);this.handle=null}return this}},{key:"setData",value:function setData(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},data=_ref3.data,bytes=_ref3.bytes,_ref3$target=_ref3.target,target=_ref3$target===undefined?_webgl.GL.ARRAY_BUFFER:_ref3$target,_ref3$usage=_ref3.usage,usage=_ref3$usage===undefined?_webgl.GL.STATIC_DRAW:_ref3$usage,layout=_ref3.layout,type=_ref3.type,_ref3$size=_ref3.size,size=_ref3$size===undefined?1:_ref3$size,_ref3$offset=_ref3.offset,offset=_ref3$offset===undefined?0:_ref3$offset,_ref3$stride=_ref3.stride,stride=_ref3$stride===undefined?0:_ref3$stride,_ref3$normalized=_ref3.normalized,normalized=_ref3$normalized===undefined?false:_ref3$normalized,_ref3$integer=_ref3.integer,integer=_ref3$integer===undefined?false:_ref3$integer,_ref3$instanced=_ref3.instanced,instanced=_ref3$instanced===undefined?0:_ref3$instanced;var gl=this.gl;(0,_assert2.default)(data||bytes>=0,"Buffer.setData needs data or bytes");type=type||(0,_webgl.glTypeFromArray)(data);if(data){(0,_webglChecks.assertArrayTypeMatch)(data,type,"in Buffer.setData")}this.bytes=bytes;this.data=data;this.target=target;this.layout=layout||new BufferLayout({type:type,size:size,offset:offset,stride:stride,normalized:normalized,integer:integer,instanced:instanced});this.bind({target:target});gl.bufferData(target,data||bytes,usage);this.unbind({target:target});return this}},{key:"subData",value:function subData(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},data=_ref4.data,_ref4$offset=_ref4.offset,offset=_ref4$offset===undefined?0:_ref4$offset;var gl=this.gl;(0,_assert2.default)(data,"Buffer.updateData needs data");this.bind({target:_webgl.GL.ARRAY_BUFFER});gl.bufferSubData(_webgl.GL.ARRAY_BUFFER,offset,data);this.unbind({target:_webgl.GL.ARRAY_BUFFER});return this}},{key:"bind",value:function bind(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref5$target=_ref5.target,target=_ref5$target===undefined?this.target:_ref5$target;this.gl.bindBuffer(target,this.handle);return this}},{key:"unbind",value:function unbind(){var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref6$target=_ref6.target,target=_ref6$target===undefined?this.target:_ref6$target;return this}},{key:"bindBase",value:function bindBase(){
var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref7$target=_ref7.target,target=_ref7$target===undefined?this.target:_ref7$target,index=_ref7.index;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferBase(target,index,this.handle);return this}},{key:"unbindBase",value:function unbindBase(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref8$target=_ref8.target,target=_ref8$target===undefined?this.target:_ref8$target,index=_ref8.index;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferBase(target,index,null);return this}},{key:"bindRange",value:function bindRange(){var _ref9=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref9$target=_ref9.target,target=_ref9$target===undefined?this.target:_ref9$target,index=_ref9.index,_ref9$offset=_ref9.offset,offset=_ref9$offset===undefined?0:_ref9$offset,size=_ref9.size;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferRange(target,index,this.handle,offset,size);return this}},{key:"unbindRange",value:function unbindRange(){var _ref10=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref10$target=_ref10.target,target=_ref10$target===undefined?this.target:_ref10$target,index=_ref10.index;(0,_webglChecks.assertWebGL2Context)(this.gl);this.gl.bindBufferBase(target,index,null);return this}}]);return Buffer}();exports.default=Buffer},{"./webgl":247,"./webgl-checks":243,assert:1}],227:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createGLContext=createGLContext;exports.getGLExtension=getGLExtension;exports.poll=poll;exports.glContextWithState=glContextWithState;exports.glGetDebugInfo=glGetDebugInfo;var _webglDebug=require("webgl-debug");var _webglDebug2=_interopRequireDefault(_webglDebug);var _webglTypes=require("./webgl-types");var _webglChecks=require("./webgl-checks");var _queryManager=require("./helpers/query-manager");var _queryManager2=_interopRequireDefault(_queryManager);var _utils=require("../utils");var _globals=require("../utils/globals");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var luma=_globals.global.luma;var ERR_WEBGL_MISSING_BROWSER="WebGL API is missing. Check your if your browser supports WebGL or\ninstall a recent version of a major browser.";var ERR_WEBGL_MISSING_NODE="WebGL API is missing. To run luma.gl under Node.js, please \"npm install gl\"\nand import 'luma.gl/headless' before importing 'luma.gl'.";var ERR_HEADLESSGL_NOT_AVAILABLE="Cannot create headless WebGL context, headlessGL not available";var ERR_HEADLESSGL_FAILED="headlessGL failed to create headless WebGL context";function createGLContext(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var canvas=opts.canvas;var _opts$width=opts.width,width=_opts$width===undefined?800:_opts$width,_opts$height=opts.height,height=_opts$height===undefined?600:_opts$height,_opts$webgl=opts.webgl2,webgl2=_opts$webgl===undefined?false:_opts$webgl,_opts$debug=opts.debug,debug=_opts$debug===undefined?true:_opts$debug;var gl=void 0;if(!_utils.isBrowser){gl=_createHeadlessContext(width,height,opts)}else{if(!_webglTypes.webGLTypesAvailable){throw new Error(ERR_WEBGL_MISSING_BROWSER)}canvas=canvas;if(typeof canvas==="string"){if(!_utils.isPageLoaded){throw new Error("createGLContext called on canvas '"+canvas+"' before page was loaded")}canvas=document.getElementById(canvas)}if(!canvas){canvas=_createCanvas()}canvas.addEventListener("webglcontextcreationerror",function(e){_utils.log.log(0,e.statusMessage||"Unknown error")},false);if(webgl2){gl=gl||canvas.getContext("webgl2",opts);gl=gl||canvas.getContext("experimental-webgl2",opts)}else{gl=gl||canvas.getContext("webgl",opts);gl=gl||canvas.getContext("experimental-webgl",opts)}(0,_assert2.default)(gl,"Failed to create WebGLRenderingContext")}if(_utils.isBrowser&&debug){var debugGL=_webglDebug2.default.makeDebugContext(gl,throwOnError,validateArgsAndLog);var WebGLDebugContext=function WebGLDebugContext(){_classCallCheck(this,WebGLDebugContext)};Object.assign(WebGLDebugContext.prototype,debugGL);gl=debugGL;gl.debug=true;_utils.log.priority=_utils.log.priority<1?1:_utils.log.priority;logInfo(gl)}return gl}function _createCanvas(){var canvas=document.createElement("canvas");canvas.id="lumagl-canvas";canvas.style.width="100%";canvas.style.height="100%";_utils.pageLoadPromise.then(function(document){var body=document.body;body.insertBefore(canvas,body.firstChild)});return canvas}function _createHeadlessContext(width,height,opts){if(!_webglTypes.webGLTypesAvailable){throw new Error(ERR_WEBGL_MISSING_NODE)}if(!luma.globals.headlessGL){throw new Error(ERR_HEADLESSGL_NOT_AVAILABLE)}var gl=luma.globals.headlessGL(width,height,opts);if(!gl){throw new Error(ERR_HEADLESSGL_FAILED)}return gl}function getGLExtension(gl,extensionName){var ERROR="Illegal arg to getExtension";(0,_assert2.default)(gl instanceof _webglTypes.WebGLRenderingContext,ERROR);(0,_assert2.default)(typeof extensionName==="string",ERROR);var extension=gl.getExtension(extensionName);(0,_assert2.default)(extension,extensionName+" not supported!");return extension}function poll(gl){(0,_webglChecks.assertWebGLContext)(gl);_queryManager2.default.poll(gl)}function glContextWithState(gl,_ref,func){var scissorTest=_ref.scissorTest,framebuffer=_ref.framebuffer;var scissorTestWasEnabled=void 0;if(scissorTest){scissorTestWasEnabled=gl.isEnabled(gl.SCISSOR_TEST);var x=scissorTest.x,y=scissorTest.y,w=scissorTest.w,h=scissorTest.h;gl.enable(gl.SCISSOR_TEST);gl.scissor(x,y,w,h)}if(framebuffer){framebuffer.bind()}var value=void 0;try{value=func(gl)}finally{if(!scissorTestWasEnabled){gl.disable(gl.SCISSOR_TEST)}if(framebuffer){gl.bindFramebuffer(gl.FRAMEBUFFER,null)}}return value}function glGetDebugInfo(gl){var info=gl.getExtension("WEBGL_debug_renderer_info");return{vendor:info&&info.UNMASKED_VENDOR_WEBGL?gl.getParameter(info.UNMASKED_VENDOR_WEBGL):"unknown",renderer:info&&info.UNMASKED_RENDERER_WEBGL?gl.getParameter(info.UNMASKED_RENDERER_WEBGL):"unknown"}}function logInfo(gl){var webGL=(0,_webglChecks.isWebGL2Context)(gl)?"WebGL2":"WebGL1";var info=glGetDebugInfo(gl);var driver=info?"("+info.vendor+" "+info.renderer+")":"";var debug=gl.debug?"debug":"";_utils.log.log(0,"luma.gl: Created "+webGL+" "+debug+" context "+driver,gl)}function getFunctionString(functionName,functionArgs){var args=_webglDebug2.default.glFunctionArgsToString(functionName,functionArgs);args=""+args.slice(0,100)+(args.length>100?"...":"");return"gl."+functionName+"("+args+")"}function throwOnError(err,functionName,args){var errorMessage=_webglDebug2.default.glEnumToString(err);var functionArgs=_webglDebug2.default.glFunctionArgsToString(functionName,args);throw new Error(errorMessage+" was caused by call to: "+("gl."+functionName+"("+functionArgs+")"))}function validateArgsAndLog(functionName,functionArgs){var functionString=void 0;if(_utils.log.priority>=4){functionString=getFunctionString(functionName,functionArgs);_utils.log.info(4,""+functionString)}var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=functionArgs[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var arg=_step.value;if(arg===undefined){functionString=functionString||getFunctionString(functionName,functionArgs);throw new Error("Undefined argument: "+functionString)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(_utils.log.break){functionString=functionString||getFunctionString(functionName,functionArgs);var isBreakpoint=_utils.log.break&&_utils.log.break.every(function(breakString){return functionString.indexOf(breakString)!==-1});if(isBreakpoint){debugger}}}},{"../utils":221,"../utils/globals":220,"./helpers/query-manager":230,"./webgl-checks":243,"./webgl-types":246,assert:1,"webgl-debug":301}],228:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.draw=draw;var _context=require("./context");var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function draw(gl,_ref){var _ref$drawMode=_ref.drawMode,drawMode=_ref$drawMode===undefined?_webgl.GL.TRIANGLES:_ref$drawMode,vertexCount=_ref.vertexCount,_ref$offset=_ref.offset,offset=_ref$offset===undefined?0:_ref$offset,_ref$isIndexed=_ref.isIndexed,isIndexed=_ref$isIndexed===undefined?false:_ref$isIndexed,_ref$indexType=_ref.indexType,indexType=_ref$indexType===undefined?_webgl.GL.UNSIGNED_SHORT:_ref$indexType,_ref$isInstanced=_ref.isInstanced,isInstanced=_ref$isInstanced===undefined?false:_ref$isInstanced,_ref$instanceCount=_ref.instanceCount,instanceCount=_ref$instanceCount===undefined?0:_ref$instanceCount;(0,_webglChecks.assertWebGLContext)(gl);drawMode=(0,_webgl.glGet)(drawMode);indexType=(0,_webgl.glGet)(indexType);(0,_webglChecks.assertDrawMode)(drawMode,"in draw");if(isIndexed){(0,_webglChecks.assertIndexType)(indexType,"in draw")}if(isInstanced){var webgl2=(0,_webglChecks.isWebGL2Context)(gl);var extension=gl.getExtension("ANGLE_instanced_arrays");var context=webgl2?gl:extension;var suffix=webgl2?"":"ANGLE";var drawElements="drawElementsInstanced"+suffix;var drawArrays="drawArraysInstanced"+suffix;if(isIndexed){context[drawElements](drawMode,vertexCount,indexType,offset,instanceCount)}else{context[drawArrays](drawMode,offset,vertexCount,instanceCount)}}else if(isIndexed){gl.drawElements(drawMode,vertexCount,indexType,offset)}else{gl.drawArrays(drawMode,offset,vertexCount)}}},{"./context":227,"./webgl":247,"./webgl-checks":243,assert:1}],229:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _texture2d=require("./texture-2d");var _texture2d2=_interopRequireDefault(_texture2d);var _renderbuffer=require("./renderbuffer");var _renderbuffer2=_interopRequireDefault(_renderbuffer);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);var _utils=require("../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function glFormatToComponents(format){switch(format){case _webgl.GL.ALPHA:return 1;case _webgl.GL.RGB:return 3;case _webgl.GL.RGBA:return 4;default:throw new Error("Unknown format")}}var Framebuffer=function(){_createClass(Framebuffer,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Framebuffer?object:new Framebuffer(gl,{handle:object.handle||object})}}]);function Framebuffer(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Framebuffer);(0,_webglChecks.assertWebGLContext)(gl);var id=opts.id;var handle=gl.createFramebuffer();if(!handle){throw new Error("Failed to create WebGL Framebuffer")}this.gl=gl;this.id=(0,_utils.uid)(id);this.handle=handle;this.colorBuffer=null;this.depthBuffer=null;this.stencilBuffer=null;this.texture=null;this.userData={};this.width=0;this.height=0;Object.seal(this);this.resize(opts)}_createClass(Framebuffer,[{key:"delete",value:function _delete(){var gl=this.gl;gl.deleteFramebuffer(this.handle)}},{key:"resize",value:function resize(_ref){var width=_ref.width,height=_ref.height;this.update({width:width,height:height})}},{key:"update",value:function update(_ref2){var _ref2$width=_ref2.width,width=_ref2$width===undefined?1:_ref2$width,_ref2$height=_ref2.height,height=_ref2$height===undefined?1:_ref2$height,_ref2$depth=_ref2.depth,depth=_ref2$depth===undefined?true:_ref2$depth,_ref2$minFilter=_ref2.minFilter,minFilter=_ref2$minFilter===undefined?_webgl.GL.NEAREST:_ref2$minFilter,_ref2$magFilter=_ref2.magFilter,magFilter=_ref2$magFilter===undefined?_webgl.GL.NEAREST:_ref2$magFilter,_ref2$format=_ref2.format,format=_ref2$format===undefined?_webgl.GL.RGBA:_ref2$format,_ref2$type=_ref2.type,type=_ref2$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref2$type;(0,_assert2.default)(width>=0&&height>=0,"Width and height need to be integers");if(width===this.width&&height===this.height){return}_utils.log.log(2,"Resizing framebuffer "+this.id+" to "+width+"x"+height);var gl=this.gl;var colorBuffer=new _texture2d2.default(gl,{minFilter:this.minFilter,magFilter:this.magFilter}).setImageData({data:null,width:width,height:height,type:type,format:format});this.attachTexture({attachment:_webgl.GL.COLOR_ATTACHMENT0,texture:colorBuffer});if(this.colorBuffer){this.colorBuffer.delete()}this.colorBuffer=colorBuffer;this.texture=colorBuffer;if(depth){var depthBuffer=new _renderbuffer2.default(gl).storage({internalFormat:_webgl.GL.DEPTH_COMPONENT16,width:width,height:height});this.attachRenderbuffer({attachment:_webgl.GL.DEPTH_ATTACHMENT,renderbuffer:depthBuffer});if(this.depthBuffer){this.depthBuffer.delete()}this.depthBuffer=depthBuffer}this.checkStatus();this.width=width;this.height=height}},{key:"bind",value:function bind(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref3$target=_ref3.target,target=_ref3$target===undefined?_webgl.GL.FRAMEBUFFER:_ref3$target;var gl=this.gl;gl.bindFramebuffer(target,this.handle);return this}},{key:"unbind",value:function unbind(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref4$target=_ref4.target,target=_ref4$target===undefined?_webgl.GL.FRAMEBUFFER:_ref4$target;var gl=this.gl;gl.bindFramebuffer(target,null);return this}},{key:"readPixels",value:function readPixels(_ref5){var _ref5$x=_ref5.x,x=_ref5$x===undefined?0:_ref5$x,_ref5$y=_ref5.y,y=_ref5$y===undefined?0:_ref5$y,width=_ref5.width,height=_ref5.height,_ref5$format=_ref5.format,format=_ref5$format===undefined?_webgl.GL.RGBA:_ref5$format,type=_ref5.type,_ref5$pixelArray=_ref5.pixelArray,pixelArray=_ref5$pixelArray===undefined?null:_ref5$pixelArray;var gl=this.gl;if(!pixelArray){type=type||_webgl.GL.UNSIGNED_BYTE;var ArrayType=(0,_webgl.glTypeToArray)(type);var components=glFormatToComponents(format);pixelArray=pixelArray||new ArrayType(width*height*components)}type=type||(0,_webgl.glTypeFromArray)(pixelArray);this.bind();gl.readPixels(x,y,width,height,format,type,pixelArray);this.unbind();return pixelArray}},{key:"attachTexture",value:function attachTexture(){var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref6$texture=_ref6.texture,texture=_ref6$texture===undefined?null:_ref6$texture,_ref6$target=_ref6.target,target=_ref6$target===undefined?_webgl.GL.FRAMEBUFFER:_ref6$target,_ref6$attachment=_ref6.attachment,attachment=_ref6$attachment===undefined?_webgl.GL.COLOR_ATTACHMENT0:_ref6$attachment,_ref6$textureTarget=_ref6.textureTarget,textureTarget=_ref6$textureTarget===undefined?_webgl.GL.TEXTURE_2D:_ref6$textureTarget,_ref6$mipmapLevel=_ref6.mipmapLevel,mipmapLevel=_ref6$mipmapLevel===undefined?0:_ref6$mipmapLevel;var gl=this.gl;texture=texture&&_texture2d2.default.makeFrom(gl,texture);this.bind({target:target});gl.framebufferTexture2D(target,(0,_webgl.glGet)(attachment),(0,_webgl.glGet)(textureTarget),texture.handle,mipmapLevel);this.unbind();return this}},{key:"attachRenderbuffer",value:function attachRenderbuffer(){var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref7$renderbuffer=_ref7.renderbuffer,renderbuffer=_ref7$renderbuffer===undefined?null:_ref7$renderbuffer,_ref7$attachment=_ref7.attachment,attachment=_ref7$attachment===undefined?_webgl.GL.COLOR_ATTACHMENT0:_ref7$attachment,_ref7$target=_ref7.target,target=_ref7$target===undefined?_webgl.GL.FRAMEBUFFER:_ref7$target,_ref7$renderbufferTar=_ref7.renderbufferTarget,renderbufferTarget=_ref7$renderbufferTar===undefined?_webgl.GL.RENDERBUFFER:_ref7$renderbufferTar;var gl=this.gl;renderbuffer=renderbuffer&&_renderbuffer2.default.makeFrom(gl,renderbuffer);this.bind({target:target});gl.framebufferRenderbuffer(target,(0,_webgl.glGet)(attachment),(0,_webgl.glGet)(renderbufferTarget),renderbuffer.handle);this.unbind({target:target});return this}},{key:"checkStatus",value:function checkStatus(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref8$target=_ref8.target,target=_ref8$target===undefined?_webgl.GL.FRAMEBUFFER:_ref8$target;var gl=this.gl;this.bind({target:target});var status=gl.checkFramebufferStatus(target);this.unbind({target:target});if(status!==gl.FRAMEBUFFER_COMPLETE){throw new Error(this._getFrameBufferStatus(status))}return this}},{key:"blit",value:function blit(_ref9){var srcX0=_ref9.srcX0,srcY0=_ref9.srcY0,srcX1=_ref9.srcX1,srcY1=_ref9.srcY1,dstX0=_ref9.dstX0,dstY0=_ref9.dstY0,dstX1=_ref9.dstX1,dstY1=_ref9.dstY1,mask=_ref9.mask,_ref9$filter=_ref9.filter,filter=_ref9$filter===undefined?_webgl.GL.NEAREST:_ref9$filter;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);gl.blitFramebuffer(srcX0,srcY0,srcX1,srcY1,dstX0,dstY0,dstX1,dstY1,mask,filter);return this}},{key:"textureLayer",value:function textureLayer(){var _ref10=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref10$target=_ref10.target,target=_ref10$target===undefined?_webgl.GL.FRAMEBUFFER:_ref10$target,attachment=_ref10.attachment,texture=_ref10.texture,level=_ref10.level,layer=_ref10.layer;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);gl.framebufferTextureLayer(target,attachment,texture,level,layer);return this}},{key:"invalidate",value:function invalidate(_ref11){var _ref11$target=_ref11.target,target=_ref11$target===undefined?_webgl.GL.FRAMEBUFFER:_ref11$target,_ref11$attachments=_ref11.attachments,attachments=_ref11$attachments===undefined?[]:_ref11$attachments;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);gl.invalidateFramebuffer(target,attachments);return this}},{key:"invalidateSub",value:function invalidateSub(_ref12){var _ref12$target=_ref12.target,target=_ref12$target===undefined?_webgl.GL.FRAMEBUFFER:_ref12$target,_ref12$attachments=_ref12.attachments,attachments=_ref12$attachments===undefined?[]:_ref12$attachments,_ref12$x=_ref12.x,x=_ref12$x===undefined?0:_ref12$x,_ref12$y=_ref12.y,y=_ref12$y===undefined?0:_ref12$y,width=_ref12.width,height=_ref12.height;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);gl.invalidateFramebuffer(target,attachments,x,y,width,height);return this}},{key:"readBuffer",value:function readBuffer(_ref13){var src=_ref13.src;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);gl.readBuffer(src);return this}},{key:"alphaSize",value:function alphaSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE)}},{key:"blueSize",value:function blueSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE)}},{key:"colorEncoding",value:function colorEncoding(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING)}},{key:"componentType",value:function componentType(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE)}},{key:"depthSize",value:function depthSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE)}},{key:"greenSize",value:function greenSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE)}},{key:"objectName",value:function objectName(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME)}},{key:"objectType",value:function objectType(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE)}},{key:"redSize",value:function redSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_RED_SIZE)}},{key:"stencilSize",value:function stencilSize(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE)}},{key:"cubeMapFace",value:function cubeMapFace(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE)}},{key:"layer",value:function layer(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER)}},{key:"level",value:function level(){return this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL)}},{key:"getParameters",value:function getParameters(){return{redSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_RED_SIZE),greenSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE),blueSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE),alphaSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE),depthSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE),stencilSize:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE),colorEncoding:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING),componentType:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE),objectName:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME),objectType:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE),cubeMapFace:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE),layer:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER),level:this.getAttachmentParameter(_webgl.GL.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL)}}},{key:"getAttachmentParameter",value:function getAttachmentParameter(){var _ref14=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},pname=_ref14.pname,target=_ref14.target,attachment=_ref14.attachment;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);var value=gl.getFramebufferAttachmentParameter(target,attachment,pname);return value}},{key:"_getFrameBufferStatus",value:function _getFrameBufferStatus(status){var error=void 0;switch(status){case _webgl.GL.FRAMEBUFFER_COMPLETE:error="Success. Framebuffer is correctly set up";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:error="The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:error="There is no attachment.";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:error="Height and width of the attachment are not the same.";break;case _webgl.GL.FRAMEBUFFER_UNSUPPORTED:error="The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.";break;case _webgl.GL.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:error="The values of GL.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.";break;default:error="Framebuffer error "+status;break}return error}}]);return Framebuffer}();exports.default=Framebuffer},{"../utils":221,"./renderbuffer":233,"./texture-2d":235,"./webgl":247,"./webgl-checks":243,assert:1}],230:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ERR_DELETED="Query was deleted before result was available";var ERR_CANCEL="Query was canceled before result was available";var noop=function noop(x){return x};var QueryManager=function(){function QueryManager(){_classCallCheck(this,QueryManager);this.pendingQueries=new Set;this.invalidQueryType=null;this.invalidErrorMessage="";this.checkInvalid=function(){return false}}_createClass(QueryManager,[{key:"poll",value:function poll(gl){this.cancelInvalidQueries(gl);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.pendingQueries.values()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var query=_step.value;var resultAvailable=query.isResultAvailable();if(resultAvailable){var result=query.getResult();this.resolveQuery(query,result)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"setInvalidator",value:function setInvalidator(_ref){var queryType=_ref.queryType,errorMessage=_ref.errorMessage,checkInvalid=_ref.checkInvalid;this.invalidQueryType=queryType;this.invalidErrorMessage=errorMessage;this.checkInvalid=checkInvalid}},{key:"beginQuery",value:function beginQuery(query){var onComplete=arguments.length>1&&arguments[1]!==undefined?arguments[1]:noop;var onError=arguments.length>2&&arguments[2]!==undefined?arguments[2]:noop;this.cancelInvalidQueries(query.gl);this.cancelQuery(query);var resolvers={};query.promise=new Promise(function(resolve,reject){resolvers.resolve=resolve;resolvers.reject=reject});Object.assign(query.promise,resolvers);this.pendingQueries.add(query);return query.promise.then(onComplete).catch(onError)}},{key:"resolveQuery",value:function resolveQuery(query,result){this.pendingQueries.delete(query);query.promise.resolve(result)}},{key:"rejectQuery",value:function rejectQuery(query,errorMessage){this.pendingQueries.delete(query);if(query.promise){query.promise.reject(new Error(errorMessage))}}},{key:"deleteQuery",value:function deleteQuery(query){return this.rejectQuery(query,ERR_DELETED)}},{key:"cancelQuery",value:function cancelQuery(query){return this.rejectQuery(query,ERR_CANCEL)}},{key:"invalidateQuery",value:function invalidateQuery(query){if(query instanceof this.invalidQueryType){this.rejectQuery(query,this.invalidErrorMessage)}}},{key:"cancelInvalidQueries",value:function cancelInvalidQueries(gl){if(this.checkInvalid(gl)){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.pendingQueries.values()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var query=_step2.value;this.invalidateQuery(query)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}}]);return QueryManager}();exports.default=new QueryManager},{}],231:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VertexArrayObject=exports.TimerQuery=exports.VertexAttributes=exports.TextureCube=exports.Texture2D=exports.Renderbuffer=exports.Framebuffer=exports.Program=exports.FragmentShader=exports.VertexShader=exports.Shader=exports.Buffer=exports.isWebGL2Context=exports.isWebGLContext=undefined;var _webgl=require("./webgl");Object.keys(_webgl).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webgl[key]}})});var _context=require("./context");Object.keys(_context).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _context[key]}})});var _webglChecks=require("./webgl-checks");Object.defineProperty(exports,"isWebGLContext",{enumerable:true,get:function get(){return _webglChecks.isWebGLContext}});Object.defineProperty(exports,"isWebGL2Context",{enumerable:true,get:function get(){return _webglChecks.isWebGL2Context}});var _buffer=require("./buffer");Object.defineProperty(exports,"Buffer",{enumerable:true,get:function get(){return _interopRequireDefault(_buffer).default}});var _shader=require("./shader");Object.defineProperty(exports,"Shader",{enumerable:true,get:function get(){return _interopRequireDefault(_shader).default}});Object.defineProperty(exports,"VertexShader",{enumerable:true,get:function get(){return _shader.VertexShader}});Object.defineProperty(exports,"FragmentShader",{enumerable:true,get:function get(){return _shader.FragmentShader}});var _program=require("./program");Object.defineProperty(exports,"Program",{enumerable:true,get:function get(){return _interopRequireDefault(_program).default}});var _framebuffer=require("./framebuffer");Object.defineProperty(exports,"Framebuffer",{enumerable:true,get:function get(){return _interopRequireDefault(_framebuffer).default}});var _renderbuffer=require("./renderbuffer");Object.defineProperty(exports,"Renderbuffer",{enumerable:true,get:function get(){return _interopRequireDefault(_renderbuffer).default}});var _texture2d=require("./texture-2d");Object.defineProperty(exports,"Texture2D",{enumerable:true,get:function get(){return _interopRequireDefault(_texture2d).default}});var _textureCube=require("./texture-cube");Object.defineProperty(exports,"TextureCube",{enumerable:true,get:function get(){return _interopRequireDefault(_textureCube).default}});var _timerQuery=require("./timer-query");Object.defineProperty(exports,"TimerQuery",{enumerable:true,get:function get(){return _interopRequireDefault(_timerQuery).default}});var _draw=require("./draw");Object.keys(_draw).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _draw[key]}})});var _uniforms=require("./uniforms");Object.keys(_uniforms).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _uniforms[key]}})});var _vertexArrayObject=require("./vertex-array-object");Object.defineProperty(exports,"VertexArrayObject",{enumerable:true,get:function get(){return _interopRequireDefault(_vertexArrayObject).default}});var _vertexAttributes=require("./vertex-attributes");var VertexAttributes=_interopRequireWildcard(_vertexAttributes);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.VertexAttributes=VertexAttributes},{"./buffer":226,"./context":227,"./draw":228,"./framebuffer":229,"./program":232,"./renderbuffer":233,"./shader":234,"./texture-2d":235,"./texture-cube":236,"./timer-query":238,"./uniforms":239,"./vertex-array-object":240,"./vertex-attributes":241,"./webgl":247,
"./webgl-checks":243}],232:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.getUniformDescriptors=getUniformDescriptors;var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _vertexAttributes=require("./vertex-attributes");var VertexAttributes=_interopRequireWildcard(_vertexAttributes);var _buffer2=require("./buffer");var _buffer3=_interopRequireDefault(_buffer2);var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);var _uniforms=require("./uniforms");var _shader=require("./shader");var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Program=function(){_createClass(Program,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Program?object:new Program(gl).setData({handle:object.handle||object})}}]);function Program(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},id=_ref.id,vs=_ref.vs,fs=_ref.fs,defaultUniforms=_ref.defaultUniforms,handle=_ref.handle;_classCallCheck(this,Program);(0,_webglChecks.assertWebGLContext)(gl);this.vs=typeof vs==="string"?new _shader.VertexShader(gl,vs):vs;this.fs=typeof vs==="string"?new _shader.FragmentShader(gl,fs):fs;(0,_assert2.default)(this.vs instanceof _shader.VertexShader,"Program: bad vertex shader");(0,_assert2.default)(this.fs instanceof _shader.FragmentShader,"Program: bad fragment shader");var programName=this.vs.getName()||this.fs.getName();programName=programName?programName+"-program":"program";this.id=id||(0,_utils.uid)(programName);this.gl=gl;this.defaultUniforms=defaultUniforms;this.handle=handle;if(!this.handle){this.handle=gl.createProgram();this._compileAndLink()}if(!this.handle){throw new Error("Failed to create program")}this._attributeLocations=this._getAttributeLocations();this._attributeCount=this.getAttributeCount();this._warn=[];this._filledLocations={};this._uniformSetters=this._getUniformSetters();this._uniformCount=this.getUniformCount();this._textureIndexCounter=0;this.userData={};Object.seal(this)}_createClass(Program,[{key:"delete",value:function _delete(){var gl=this.gl;if(this.handle){gl.deleteProgram(this.handle)}this.handle=null;return this}},{key:"use",value:function use(){var gl=this.gl;gl.useProgram(this.handle);return this}},{key:"clearBuffers",value:function clearBuffers(){this._filledLocations={};return this}},{key:"_print",value:function _print(bufferName){return"Program "+this.id+": Attribute "+bufferName}},{key:"setBuffers",value:function setBuffers(buffers){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$clear=_ref2.clear,clear=_ref2$clear===undefined?true:_ref2$clear,_ref2$check=_ref2.check,check=_ref2$check===undefined?true:_ref2$check,_ref2$drawParams=_ref2.drawParams,drawParams=_ref2$drawParams===undefined?{}:_ref2$drawParams;var gl=this.gl;if(Array.isArray(buffers)){throw new Error("Program.setBuffers expects map of buffers")}if(clear){this.clearBuffers()}drawParams.isInstanced=false;drawParams.isIndexed=false;drawParams.indexType=null;var _sortBuffersByLocatio=this._sortBuffersByLocation(buffers),locations=_sortBuffersByLocatio.locations,elements=_sortBuffersByLocatio.elements;for(var location=0;location<locations.length;++location){var bufferName=locations[location];var buffer=buffers[bufferName];if(!buffer){VertexAttributes.disable(gl,location)}else{var divisor=buffer.layout.instanced?1:0;VertexAttributes.enable(gl,location);VertexAttributes.setBuffer({gl:gl,location:location,buffer:buffer});VertexAttributes.setDivisor(gl,location,divisor);drawParams.isInstanced=buffer.layout.instanced>0;this._filledLocations[bufferName]=true}}if(elements){var _buffer=buffers[elements];_buffer.bind();drawParams.isIndexed=true;drawParams.indexType=_buffer.layout.type}if(check){this.checkBuffers()}return this}},{key:"checkBuffers",value:function checkBuffers(){for(var attributeName in this._attributeLocations){if(!this._filledLocations[attributeName]&&!this._warn[attributeName]){var location=this._attributeLocations[attributeName];_utils.log.warn(0,"Program "+this.id+": "+("Attribute "+location+":"+attributeName+" not supplied"));this._warn[attributeName]=true}}return this}},{key:"unsetBuffers",value:function unsetBuffers(){var gl=this.gl;var length=this._attributeCount;for(var i=1;i<length;++i){VertexAttributes.disable(gl,i)}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);return this}},{key:"setUniforms",value:function setUniforms(uniforms){for(var uniformName in uniforms){var uniform=uniforms[uniformName];var uniformSetter=this._uniformSetters[uniformName];if(uniformSetter){if(uniform instanceof _texture2.default){if(uniformSetter.textureIndex===undefined){uniformSetter.textureIndex=this._textureIndexCounter++}var texture=uniform;var textureIndex=uniformSetter.textureIndex;texture.bind(textureIndex);uniformSetter(textureIndex)}else{uniformSetter(uniform)}}}return this}},{key:"getAttachedShadersCount",value:function getAttachedShadersCount(){return this.getProgramParameter(_webgl.GL.ATTACHED_SHADERS)}},{key:"getAttributeCount",value:function getAttributeCount(){return this.getProgramParameter(_webgl.GL.ACTIVE_ATTRIBUTES)}},{key:"getAttributeInfo",value:function getAttributeInfo(location){return this.gl.getActiveAttrib(this.handle,location)}},{key:"getAttributeName",value:function getAttributeName(location){return this.getAttributeInfo(location).name}},{key:"getAttributeLocation",value:function getAttributeLocation(attributeName){return this.gl.getAttribLocation(this.handle,attributeName)}},{key:"getUniformCount",value:function getUniformCount(){return this.getProgramParameter(_webgl.GL.ACTIVE_UNIFORMS)}},{key:"getUniformInfo",value:function getUniformInfo(index){return this.gl.getActiveUniform(this.handle,index)}},{key:"getUniformLocation",value:function getUniformLocation(name){return this.gl.getUniformLocation(this.handle,name)}},{key:"getUniformValue",value:function getUniformValue(location){return this.gl.getUniform(this.handle,location)}},{key:"isFlaggedForDeletion",value:function isFlaggedForDeletion(){return this.getProgramParameter(_webgl.GL.DELETE_STATUS)}},{key:"getLastLinkStatus",value:function getLastLinkStatus(){return this.getProgramParameter(_webgl.GL.LINK_STATUS)}},{key:"getLastValidationStatus",value:function getLastValidationStatus(){return this.getProgramParameter(_webgl.GL.VALIDATE_STATUS)}},{key:"getTransformFeedbackBufferMode",value:function getTransformFeedbackBufferMode(){(0,_webglChecks.assertWebGL2Context)(this.gl);return this.getProgramParameter(this.gl.TRANSFORM_FEEDBACK_BUFFER_MODE)}},{key:"getTransformFeedbackVaryingsCount",value:function getTransformFeedbackVaryingsCount(){(0,_webglChecks.assertWebGL2Context)(this.gl);return this.getProgramParameter(this.gl.TRANSFORM_FEEDBACK_VARYINGS)}},{key:"getActiveUniformBlocksCount",value:function getActiveUniformBlocksCount(){(0,_webglChecks.assertWebGL2Context)(this.gl);return this.getProgramParameter(this.gl.ACTIVE_UNIFORM_BLOCKS)}},{key:"getFragDataLocation",value:function getFragDataLocation(varyingName){(0,_webglChecks.assertWebGL2Context)(this.gl);return this.gl.getFragDataLocation(this.handle,varyingName)}},{key:"getProgramParameter",value:function getProgramParameter(pname){return this.gl.getProgramParameter(this.handle,pname)}},{key:"_compileAndLink",value:function _compileAndLink(){var gl=this.gl;gl.attachShader(this.handle,this.vs.handle);gl.attachShader(this.handle,this.fs.handle);gl.linkProgram(this.handle);gl.validateProgram(this.handle);var linked=gl.getProgramParameter(this.handle,gl.LINK_STATUS);if(!linked){throw new Error("Error linking "+gl.getProgramInfoLog(this.handle))}}},{key:"_sortBuffersByLocation",value:function _sortBuffersByLocation(buffers){var elements=null;var locations=new Array(this._attributeCount);for(var bufferName in buffers){var buffer=_buffer3.default.makeFrom(this.gl,buffers[bufferName]);var location=this._attributeLocations[bufferName];if(location===undefined){if(buffer.target===_webgl.GL.ELEMENT_ARRAY_BUFFER&&elements){throw new Error(this._print(bufferName)+" duplicate gl.ELEMENT_ARRAY_BUFFER")}else if(buffer.target===_webgl.GL.ELEMENT_ARRAY_BUFFER){elements=bufferName}else if(!this._warn[bufferName]){_utils.log.warn(2,this._print(bufferName)+" not used");this._warn[bufferName]=true}}else{if(buffer.target===_webgl.GL.ELEMENT_ARRAY_BUFFER){throw new Error(this._print(bufferName)+":"+location+" "+"has both location and type gl.ELEMENT_ARRAY_BUFFER")}locations[location]=bufferName}}return{locations:locations,elements:elements}}},{key:"_areAllAttributesEnabled",value:function _areAllAttributesEnabled(){var gl=this.gl;var length=this._attributeCount;for(var i=0;i<length;++i){if(!VertexAttributes.isEnabled(gl,i)){return false}}return true}},{key:"_getAttributeLocations",value:function _getAttributeLocations(){var attributeLocations={};var length=this.getAttributeCount();for(var location=0;location<length;location++){var name=this.getAttributeName(location);attributeLocations[name]=this.getAttributeLocation(name)}return attributeLocations}},{key:"_getUniformSetters",value:function _getUniformSetters(){var gl=this.gl;var uniformSetters={};var length=this.getUniformCount();for(var i=0;i<length;i++){var info=this.getUniformInfo(i);var parsedName=(0,_uniforms.parseUniformName)(info.name);var location=this.getUniformLocation(parsedName.name);uniformSetters[parsedName.name]=(0,_uniforms.getUniformSetter)(gl,location,info,parsedName.isArray)}return uniformSetters}}]);return Program}();exports.default=Program;function getUniformDescriptors(gl,program){var uniformDescriptors={};var length=program.getUniformCount();for(var i=0;i<length;i++){var info=program.getUniformInfo(i);var location=program.getUniformLocation(info.name);var descriptor=(0,_uniforms.getUniformSetter)(gl,location,info);uniformDescriptors[descriptor.name]=descriptor}return uniformDescriptors}},{"../utils":221,"./buffer":226,"./shader":234,"./texture":237,"./uniforms":239,"./vertex-attributes":241,"./webgl":247,"./webgl-checks":243,assert:1}],233:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webgl2=_interopRequireDefault(_webgl);var _webglChecks=require("./webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Renderbuffer=function(){_createClass(Renderbuffer,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Renderbuffer?object:new Renderbuffer(gl,{handle:object.handle||object})}}]);function Renderbuffer(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Renderbuffer);(0,_webglChecks.assertWebGLContext)(gl);this.gl=gl;this.handle=gl.createRenderbuffer();if(!this.handle){throw new Error("Failed to create WebGL Renderbuffer")}}_createClass(Renderbuffer,[{key:"delete",value:function _delete(){this.gl.deleteRenderbuffer(this.handle);return this}},{key:"bind",value:function bind(){this.gl.bindRenderbuffer(_webgl2.default.RENDERBUFFER,this.handle);return this}},{key:"unbind",value:function unbind(){this.gl.bindRenderbuffer(_webgl2.default.RENDERBUFFER,null);return this}},{key:"storage",value:function storage(_ref){var internalFormat=_ref.internalFormat,width=_ref.width,height=_ref.height;var gl=this.gl;(0,_assert2.default)(internalFormat,"Needs internalFormat");this.bind();gl.renderbufferStorage(_webgl2.default.RENDERBUFFER,(0,_webgl.glGet)(internalFormat),width,height);this.unbind();return this}},{key:"getParameter",value:function getParameter(pname){var gl=this.gl;this.bind();var value=gl.getRenderbufferParameter(_webgl2.default.RENDERBUFFER,(0,_webgl.glGet)(pname));this.unbind();return value}},{key:"storageMultisample",value:function storageMultisample(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},samples=_ref2.samples,internalformat=_ref2.internalformat,width=_ref2.width,height=_ref2.height;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);gl.renderbufferStorageMultisample(_webgl2.default.RENDERBUFFER,samples,internalformat,width,height);return this}},{key:"getInternalformatParameter",value:function getInternalformatParameter(_ref3){var internalformat=_ref3.internalformat,_ref3$pname=_ref3.pname,pname=_ref3$pname===undefined?"SAMPLES":_ref3$pname;var gl=this.gl;(0,_webglChecks.assertWebGL2Context)(gl);return gl.getInternalformatParameter(_webgl2.default.RENDERBUFFER,internalformat,pname)}},{key:"width",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_WIDTH)}},{key:"height",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_HEIGHT)}},{key:"internalFormat",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_INTERNAL_FORMAT)}},{key:"greenSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_GREEN_SIZE)}},{key:"blueSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_BLUE_SIZE)}},{key:"redSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_RED_SIZE)}},{key:"alphaSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_ALPHA_SIZE)}},{key:"depthSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_DEPTH_SIZE)}},{key:"stencilSize",get:function get(){return this.getParameter(_webgl2.default.RENDERBUFFER_STENCIL_SIZE)}},{key:"samples",get:function get(){return this.getParameter(this.gl.RENDERBUFFER_SAMPLES)}}]);return Renderbuffer}();exports.default=Renderbuffer},{"./webgl":247,"./webgl-checks":243,assert:1}],234:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FragmentShader=exports.VertexShader=exports.Shader=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _webglFormatGlslError=require("./webgl-format-glsl-error");var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ERR_SOURCE="Shader: GLSL source code must be a JavaScript string";var Shader=exports.Shader=function(){function Shader(gl,source,shaderType){_classCallCheck(this,Shader);(0,_webglChecks.assertWebGLContext)(gl);(0,_assert2.default)(typeof source==="string",ERR_SOURCE);this.id=(0,_webglFormatGlslError.getShaderName)(source)||(0,_utils.uid)(this.getTypeName(shaderType));this.gl=gl;this.shaderType=shaderType;this.source=source;this.handle=gl.createShader(shaderType);if(this.handle===null){throw new Error("Error creating shader with type "+shaderType)}this.compile()}_createClass(Shader,[{key:"delete",value:function _delete(){var gl=this.gl;if(this.handle){gl.deleteShader(this.handle);this.handle=null}}},{key:"toString",value:function toString(){return this.getTypeName(this.shaderType)+":"+this.id}},{key:"getName",value:function getName(){return(0,_webglFormatGlslError.getShaderName)(this.source)}},{key:"getTypeName",value:function getTypeName(shaderType){switch(shaderType){case _webgl.GL.VERTEX_SHADER:return"vertex-shader";case _webgl.GL.FRAGMENT_SHADER:return"fragment-shader";default:return"shader"}}},{key:"compile",value:function compile(){var gl=this.gl;gl.shaderSource(this.handle,this.source);gl.compileShader(this.handle);var compiled=gl.getShaderParameter(this.handle,_webgl.GL.COMPILE_STATUS);if(!compiled){var infoLog=gl.getShaderInfoLog(this.handle);var error=(0,_webglFormatGlslError.formatGLSLCompilerError)(infoLog,this.source,this.shaderType);this.delete();throw new Error("Error while compiling the shader "+error)}}},{key:"copyToClipboard",value:function copyToClipboard(text){if(_utils.isBrowser){var input=document.createElement("textarea");document.body.appendChild(input);input.value=text;input.focus();input.select();if(!document.execCommand("copy")){console.log("Failed to copy to clipboard")}input.remove()}}}]);return Shader}();var VertexShader=exports.VertexShader=function(_Shader){_inherits(VertexShader,_Shader);function VertexShader(gl,source){_classCallCheck(this,VertexShader);return _possibleConstructorReturn(this,(VertexShader.__proto__||Object.getPrototypeOf(VertexShader)).call(this,gl,source,_webgl.GL.VERTEX_SHADER))}return VertexShader}(Shader);var FragmentShader=exports.FragmentShader=function(_Shader2){_inherits(FragmentShader,_Shader2);function FragmentShader(gl,source){_classCallCheck(this,FragmentShader);return _possibleConstructorReturn(this,(FragmentShader.__proto__||Object.getPrototypeOf(FragmentShader)).call(this,gl,source,_webgl.GL.FRAGMENT_SHADER))}return FragmentShader}(Shader)},{"../utils":221,"./webgl":247,"./webgl-checks":243,"./webgl-format-glsl-error":245,assert:1}],235:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectDestructuringEmpty(obj){if(obj==null)throw new TypeError("Cannot destructure undefined")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Texture2D=function(_Texture){_inherits(Texture2D,_Texture);_createClass(Texture2D,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof Texture2D?object:new Texture2D(gl,{handle:object.handle||object})}},{key:"makeFromSolidColor",value:function makeFromSolidColor(gl,_ref){var _ref2=_slicedToArray(_ref,4),_ref2$=_ref2[0],r=_ref2$===undefined?0:_ref2$,_ref2$2=_ref2[1],g=_ref2$2===undefined?0:_ref2$2,_ref2$3=_ref2[2],b=_ref2$3===undefined?0:_ref2$3,_ref2$4=_ref2[3],a=_ref2$4===undefined?1:_ref2$4;return new Texture2D(gl,{pixels:new Uint8Array([r,g,b,a]),width:1,format:gl.RGBA,magFilter:gl.NEAREST,minFilter:gl.NEAREST})}},{key:"makeFromPixelArray",value:function makeFromPixelArray(gl,opts){var dataArray=opts.dataArray,_opts$format=opts.format,format=_opts$format===undefined?_webgl.GL.RGBA:_opts$format,_opts$width=opts.width,width=_opts$width===undefined?1:_opts$width,height=opts.height;var dataTypedArray=new Uint8Array(dataArray);return new Texture2D(gl,Object.assign({pixels:dataTypedArray,width:width,height:height,format:format},opts))}}]);function Texture2D(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Texture2D);(0,_webglChecks.assertWebGLContext)(gl);var _this=_possibleConstructorReturn(this,(Texture2D.__proto__||Object.getPrototypeOf(Texture2D)).call(this,gl,Object.assign({},opts,{target:gl.TEXTURE_2D})));_this.width=null;_this.height=null;Object.seal(_this);_this.setImageData(opts);if(opts.generateMipmap){_this.generateMipmap()}return _this}_createClass(Texture2D,[{key:"bind",value:function bind(){var textureUnit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.textureUnit;var gl=this.gl;if(textureUnit===undefined){throw new Error("Texture.bind: must specify texture unit")}this.textureUnit=textureUnit;gl.activeTexture(gl.TEXTURE0+textureUnit);gl.bindTexture(this.target,this.handle);return textureUnit}},{key:"unbind",value:function unbind(){var gl=this.gl;if(this.textureUnit===undefined){throw new Error("Texture.unbind: texture unit not specified")}gl.activeTexture(gl.TEXTURE0+this.textureUnit);gl.bindTexture(this.target,null);return this.textureUnit}},{key:"getActiveUnit",value:function getActiveUnit(){return this.gl.getParameter(_webgl.GL.ACTIVE_TEXTURE)-_webgl.GL.TEXTURE0}},{key:"setPixels",value:function setPixels(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var buffer=opts.buffer,_opts$width2=opts.width,width=_opts$width2===undefined?null:_opts$width2,_opts$height=opts.height,height=_opts$height===undefined?null:_opts$height,_opts$mipmapLevel=opts.mipmapLevel,mipmapLevel=_opts$mipmapLevel===undefined?0:_opts$mipmapLevel,_opts$format2=opts.format,format=_opts$format2===undefined?_webgl.GL.RGBA:_opts$format2,_opts$type=opts.type,type=_opts$type===undefined?_webgl.GL.UNSIGNED_BYTE:_opts$type,_opts$border=opts.border,border=_opts$border===undefined?0:_opts$border;var gl=this.gl;gl.bindBuffer(_webgl.GL.PIXEL_UNPACK_BUFFER,buffer.target);this.bind();gl.texImage2D(gl.TEXTURE_2D,mipmapLevel,format,width,height,border,format,type,buffer.target);this.unbind();gl.bindBuffer(_webgl.GL.GL_PIXEL_UNPACK_BUFFER,null);return this}},{key:"setImageDataFromCompressedBuffer",value:function setImageDataFromCompressedBuffer(opts){var buffer=opts.buffer,_opts$width3=opts.width,width=_opts$width3===undefined?null:_opts$width3,_opts$height2=opts.height,height=_opts$height2===undefined?null:_opts$height2,_opts$mipmapLevel2=opts.mipmapLevel,mipmapLevel=_opts$mipmapLevel2===undefined?0:_opts$mipmapLevel2,_opts$internalFormat=opts.internalFormat,internalFormat=_opts$internalFormat===undefined?_webgl.GL.RGBA:_opts$internalFormat,_opts$border2=opts.border,border=_opts$border2===undefined?0:_opts$border2;var gl=this.gl;gl.compressedTexImage2D(this.target,mipmapLevel,internalFormat,width,height,border,buffer);return this}},{key:"copyImageFromFramebuffer",value:function copyImageFromFramebuffer(opts){var framebuffer=opts.framebuffer,x=opts.x,y=opts.y,width=opts.width,height=opts.height,_opts$mipmapLevel3=opts.mipmapLevel,mipmapLevel=_opts$mipmapLevel3===undefined?0:_opts$mipmapLevel3,_opts$internalFormat2=opts.internalFormat,internalFormat=_opts$internalFormat2===undefined?_webgl.GL.RGBA:_opts$internalFormat2,_opts$border3=opts.border,border=_opts$border3===undefined?0:_opts$border3;var gl=this.gl;framebuffer.bind();this.bind();gl.copyTexImage2D(this.target,mipmapLevel,internalFormat,x,y,width,height,border);this.unbind();framebuffer.unbind()}},{key:"copySubImage",value:function copySubImage(opts){_objectDestructuringEmpty(opts)}}]);return Texture2D}(_texture2.default);exports.default=Texture2D},{"./texture":237,"./webgl":247,"./webgl-checks":243}],236:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TextureCube=function(_Texture){_inherits(TextureCube,_Texture);_createClass(TextureCube,null,[{key:"makeFrom",value:function makeFrom(gl){var object=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return object instanceof TextureCube?object:new TextureCube(gl,{handle:object.handle||object})}}]);function TextureCube(gl){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,TextureCube);(0,_webglChecks.assertWebGLContext)(gl);var _this=_possibleConstructorReturn(this,(TextureCube.__proto__||Object.getPrototypeOf(TextureCube)).call(this,gl,Object.assign({},opts,{target:_webgl.GL.TEXTURE_CUBE_MAP})));_this.setCubeMapImageData(opts);return _this}_createClass(TextureCube,[{key:"bind",value:function bind(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},index=_ref.index;var gl=this.gl;if(index!==undefined){gl.activeTexture(_webgl.GL.TEXTURE0+index)}gl.bindTexture(_webgl.GL.TEXTURE_CUBE_MAP,this.handle);if(index===undefined){var result=gl.getParameter(gl.ACTIVE_TEXTURE)-_webgl.GL.TEXTURE0;return result}return index}},{key:"unbind",value:function unbind(){var gl=this.gl;gl.bindTexture(_webgl.GL.TEXTURE_CUBE_MAP,null)}},{key:"setCubeMapImageData",value:function setCubeMapImageData(_ref2){var width=_ref2.width,height=_ref2.height,pixels=_ref2.pixels,data=_ref2.data,_ref2$border=_ref2.border,border=_ref2$border===undefined?0:_ref2$border,_ref2$format=_ref2.format,format=_ref2$format===undefined?_webgl.GL.RGBA:_ref2$format,_ref2$type=_ref2.type,type=_ref2$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref2$type,_ref2$generateMipmap=_ref2.generateMipmap,generateMipmap=_ref2$generateMipmap===undefined?false:_ref2$generateMipmap;var gl=this.gl;pixels=pixels||data;this.bind();if(this.width||this.height){gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_X,0,format,width,height,border,format,type,pixels.pos.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Y,0,format,width,height,border,format,type,pixels.pos.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Z,0,format,width,height,border,format,type,pixels.pos.z);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_X,0,format,width,height,border,format,type,pixels.neg.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,format,width,height,border,format,type,pixels.neg.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,format,width,height,border,format,type,pixels.neg.z)}else{gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_X,0,format,format,type,pixels.pos.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Y,0,format,format,type,pixels.pos.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_POSITIVE_Z,0,format,format,type,pixels.pos.z);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_X,0,format,format,type,pixels.neg.x);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,format,format,type,pixels.neg.y);gl.texImage2D(_webgl.GL.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,format,format,type,pixels.neg.z)}this.unbind();if(generateMipmap){this.generateMipmap()}return this}}]);return TextureCube}(_texture2.default);exports.default=TextureCube},{"./texture":237,"./webgl":247,"./webgl-checks":243}],
237:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _buffer=require("./buffer");var _buffer2=_interopRequireDefault(_buffer);var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Texture=function(){function Texture(gl,opts){_classCallCheck(this,Texture);var _opts$id=opts.id,id=_opts$id===undefined?(0,_utils.uid)("texture"):_opts$id,_opts$unpackFlipY=opts.unpackFlipY,unpackFlipY=_opts$unpackFlipY===undefined?true:_opts$unpackFlipY,_opts$magFilter=opts.magFilter,magFilter=_opts$magFilter===undefined?_webgl.GL.NEAREST:_opts$magFilter,_opts$minFilter=opts.minFilter,minFilter=_opts$minFilter===undefined?_webgl.GL.NEAREST:_opts$minFilter,_opts$wrapS=opts.wrapS,wrapS=_opts$wrapS===undefined?_webgl.GL.CLAMP_TO_EDGE:_opts$wrapS,_opts$wrapT=opts.wrapT,wrapT=_opts$wrapT===undefined?_webgl.GL.CLAMP_TO_EDGE:_opts$wrapT,_opts$target=opts.target,target=_opts$target===undefined?_webgl.GL.TEXTURE_2D:_opts$target,handle=opts.handle;(0,_webglChecks.assertWebGLContext)(gl);this.handle=handle||gl.createTexture();this.id=id;this.gl=gl;this.target=target;this.hasFloatTexture=gl.getExtension("OES_texture_float");this.width=null;this.height=null;this.textureUnit=undefined;this.userData={};this.setPixelStorageModes(Object.assign({},opts,{unpackFlipY:unpackFlipY}));this.setParameters(Object.assign({},opts,{magFilter:magFilter,minFilter:minFilter,wrapS:wrapS,wrapT:wrapT}))}_createClass(Texture,[{key:"delete",value:function _delete(){if(this.handle){this.gl.deleteTexture(this.handle);this.handle=null}return this}},{key:"toString",value:function toString(){return"Texture("+this.id+","+this.width+"x"+this.height+")"}},{key:"generateMipmap",value:function generateMipmap(){this.gl.bindTexture(this.target,this.handle);this.gl.generateMipmap(this.target);this.gl.bindTexture(this.target,null);return this}},{key:"setImageData",value:function setImageData(_ref){var _ref$target=_ref.target,target=_ref$target===undefined?this.target:_ref$target,_ref$pixels=_ref.pixels,pixels=_ref$pixels===undefined?null:_ref$pixels,_ref$data=_ref.data,data=_ref$data===undefined?null:_ref$data,width=_ref.width,height=_ref.height,_ref$mipmapLevel=_ref.mipmapLevel,mipmapLevel=_ref$mipmapLevel===undefined?0:_ref$mipmapLevel,_ref$format=_ref.format,format=_ref$format===undefined?_webgl.GL.RGBA:_ref$format,type=_ref.type,_ref$offset=_ref.offset,offset=_ref$offset===undefined?0:_ref$offset,_ref$border=_ref.border,border=_ref$border===undefined?0:_ref$border;var gl=this.gl;pixels=pixels||data;if(pixels&&pixels.data){var ndarray=pixels;pixels=ndarray.data;width=ndarray.shape[0];height=ndarray.shape[1]}gl.bindTexture(this.target,this.handle);if(pixels===null){width=width||1;height=height||1;type=type||_webgl.GL.UNSIGNED_BYTE;gl.texImage2D(target,mipmapLevel,format,width,height,border,format,type,pixels);this.width=width;this.height=height}else if(ArrayBuffer.isView(pixels)){(0,_assert2.default)(width>0&&height>0,"Texture2D: Width and height required");type=type||(0,_webgl.glTypeFromArray)(pixels);if(type===gl.FLOAT&&!this.hasFloatTexture){throw new Error("floating point textures are not supported.")}gl.texImage2D(target,mipmapLevel,format,width,height,border,format,type,pixels);this.width=width;this.height=height}else if(pixels instanceof _webgl.WebGLBuffer||pixels instanceof _buffer2.default){(0,_assert2.default)(gl instanceof _webgl.WebGL2RenderingContext,"Requires WebGL2");type=type||_webgl.GL.UNSIGNED_BYTE;var buffer=_buffer2.default.makeFrom(pixels);gl.bindBuffer(_webgl.GL.PIXEL_UNPACK_BUFFER,buffer.handle);gl.texImage2D(target,mipmapLevel,format,width,height,border,format,type,offset);gl.bindBuffer(_webgl.GL.GL_PIXEL_UNPACK_BUFFER,null);this.width=width;this.height=height}else{var imageSize=this._deduceImageSize(pixels);(0,_assert2.default)(width===undefined&&height===undefined,"Texture2D.setImageData: Width and height must not be provided");type=type||_webgl.GL.UNSIGNED_BYTE;gl.texImage2D(target,mipmapLevel,format,format,type,pixels);this.width=imageSize.width;this.height=imageSize.height}gl.bindTexture(this.target,null);return this}},{key:"_deduceImageSize",value:function _deduceImageSize(image){if(typeof ImageData!=="undefined"&&image instanceof ImageData){return{width:image.width,height:image.height}}else if(typeof HTMLImageElement!=="undefined"&&image instanceof HTMLImageElement){return{width:image.naturalWidth,height:image.naturalHeight}}else if(typeof HTMLCanvasElement!=="undefined"&&image instanceof HTMLCanvasElement){return{width:image.width,height:image.height}}else if(typeof HTMLVideoElement!=="undefined"&&image instanceof HTMLVideoElement){return{width:image.videoWidth,height:image.videoHeight}}throw new Error("Unknown image data format. Failed to deduce image size")}},{key:"setPixelStorageModes",value:function setPixelStorageModes(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},packAlignment=_ref2.packAlignment,unpackAlignment=_ref2.unpackAlignment,unpackFlipY=_ref2.unpackFlipY,unpackPremultiplyAlpha=_ref2.unpackPremultiplyAlpha,unpackColorspaceConversion=_ref2.unpackColorspaceConversion,packRowLength=_ref2.packRowLength,packSkipPixels=_ref2.packSkipPixels,packSkipRows=_ref2.packSkipRows,unpackRowLength=_ref2.unpackRowLength,unpackImageHeight=_ref2.unpackImageHeight,unpackSkipPixels=_ref2.unpackSkipPixels,unpackSkipRows=_ref2.unpackSkipRows,unpackSkipImages=_ref2.unpackSkipImages;var gl=this.gl;gl.bindTexture(this.target,this.handle);if(packAlignment){gl.pixelStorei(gl.PACK_ALIGNMENT,packAlignment)}if(unpackAlignment){gl.pixelStorei(gl.UNPACK_ALIGNMENT,unpackAlignment)}if(unpackFlipY){gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,unpackFlipY)}if(unpackPremultiplyAlpha){gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,unpackPremultiplyAlpha)}if(unpackColorspaceConversion){gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,unpackColorspaceConversion)}if(packRowLength){gl.pixelStorei(gl.PACK_ROW_LENGTH,packRowLength)}if(packSkipPixels){gl.pixelStorei(gl.PACK_SKIP_PIXELS,packSkipPixels)}if(packSkipRows){gl.pixelStorei(gl.PACK_SKIP_ROWS,packSkipRows)}if(unpackRowLength){gl.pixelStorei(gl.UNPACK_ROW_LENGTH,unpackRowLength)}if(unpackImageHeight){gl.pixelStorei(gl.UNPACK_IMAGE_HEIGHT,unpackImageHeight)}if(unpackSkipPixels){gl.pixelStorei(gl.UNPACK_SKIP_PIXELS,unpackSkipPixels)}if(unpackSkipRows){gl.pixelStorei(gl.UNPACK_SKIP_ROWS,unpackSkipRows)}if(unpackSkipImages){gl.pixelStorei(gl.UNPACK_SKIP_IMAGES,unpackSkipImages)}gl.bindTexture(this.target,null);return this}},{key:"setParameters",value:function setParameters(_ref3){var magFilter=_ref3.magFilter,minFilter=_ref3.minFilter,wrapS=_ref3.wrapS,wrapT=_ref3.wrapT,wrapR=_ref3.wrapR,baseLevel=_ref3.baseLevel,maxLevel=_ref3.maxLevel,minLOD=_ref3.minLOD,maxLOD=_ref3.maxLOD,compareFunc=_ref3.compareFunc,compareMode=_ref3.compareMode;var gl=this.gl;gl.bindTexture(this.target,this.handle);if(magFilter){gl.texParameteri(this.target,gl.TEXTURE_MAG_FILTER,magFilter)}if(minFilter){gl.texParameteri(this.target,gl.TEXTURE_MIN_FILTER,minFilter)}if(wrapS){gl.texParameteri(this.target,gl.TEXTURE_WRAP_S,wrapS)}if(wrapT){gl.texParameteri(this.target,gl.TEXTURE_WRAP_T,wrapT)}if(wrapR){gl.texParameteri(this.target,gl.TEXTURE_WRAP_R,wrapR)}if(baseLevel){gl.texParameteri(this.target,gl.TEXTURE_BASE_LEVEL,baseLevel)}if(maxLevel){gl.texParameteri(this.target,gl.TEXTURE_MAX_LEVEL,maxLevel)}if(compareFunc){gl.texParameteri(this.target,gl.TEXTURE_COMPARE_FUNC,compareFunc)}if(compareMode){gl.texParameteri(this.target,gl.TEXTURE_COMPARE_MODE,compareMode)}if(minLOD){gl.texParameterf(this.target,gl.TEXTURE_MIN_LOD,minLOD)}if(maxLOD){gl.texParameterf(this.target,gl.TEXTURE_MAX_LOD,maxLOD)}gl.bindTexture(this.target,null);return this}},{key:"getParameters",value:function getParameters(){var gl=this.gl;gl.bindTexture(this.target,this.handle);var webglParams={magFilter:gl.getTexParameter(this.target,gl.TEXTURE_MAG_FILTER),minFilter:gl.getTexParameter(this.target,gl.TEXTURE_MIN_FILTER),wrapS:gl.getTexParameter(this.target,gl.TEXTURE_WRAP_S),wrapT:gl.getTexParameter(this.target,gl.TEXTURE_WRAP_T)};gl.bindTexture(this.target,null);return webglParams}},{key:"image2D",value:function image2D(_ref4){var pixels=_ref4.pixels,_ref4$format=_ref4.format,format=_ref4$format===undefined?_webgl.GL.RGBA:_ref4$format,_ref4$type=_ref4.type,type=_ref4$type===undefined?_webgl.GL.UNSIGNED_BYTE:_ref4$type;if(type===_webgl.GL.FLOAT&&!this.hasFloatTexture){throw new Error("floating point textures are not supported.")}this.gl.bindTexture(this.target,this.handle);this.gl.texImage2D(_webgl.GL.TEXTURE_2D,0,format,format,type,pixels);this.gl.bindTexture(this.target,null);return this}},{key:"update",value:function update(opts){throw new Error("Texture.update() is deprecated()")}}]);return Texture}();exports.default=Texture},{"../utils":221,"./buffer":226,"./webgl":247,"./webgl-checks":243,assert:1}],238:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _webglChecks=require("../webgl/webgl-checks");var _queryManager=require("./helpers/query-manager");var _queryManager2=_interopRequireDefault(_queryManager);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var GL_QUERY_COUNTER_BITS_EXT=34916;var GL_QUERY_RESULT_EXT=34918;var GL_QUERY_RESULT_AVAILABLE_EXT=34919;var GL_TIME_ELAPSED_EXT=35007;var GL_TIMESTAMP_EXT=36392;var GL_GPU_DISJOINT_EXT=36795;var noop=function noop(x){return x};var ERR_GPU_DISJOINT="Disjoint GPU operation invalidated timer queries";var ERR_TIMER_QUERY_NOT_SUPPORTED='Timer queries require "EXT_disjoint_timer_query" extension';var TimerQuery=function(){_createClass(TimerQuery,null,[{key:"isSupported",value:function isSupported(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$requireTimestamp=_ref.requireTimestamps,requireTimestamps=_ref$requireTimestamp===undefined?false:_ref$requireTimestamp;(0,_webglChecks.assertWebGLContext)(gl);var ext=gl.getExtension("EXT_disjoint_timer_query");var queryCounterBits=ext?ext.getQueryEXT(GL_TIMESTAMP_EXT,GL_QUERY_COUNTER_BITS_EXT):0;var timestampsSupported=queryCounterBits>0;return Boolean(ext)&&(!requireTimestamps||timestampsSupported)}}]);function TimerQuery(gl){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$onComplete=_ref2.onComplete,onComplete=_ref2$onComplete===undefined?noop:_ref2$onComplete,_ref2$onError=_ref2.onError,onError=_ref2$onError===undefined?noop:_ref2$onError;_classCallCheck(this,TimerQuery);(0,_webglChecks.assertWebGLContext)(gl);this.gl=gl;this.ext=this.gl.getExtension("EXT_disjoint_timer_query");this.handle=this.ext?this.ext.createQueryEXT():null;this.target=null;this.userData={};this.onComplete=onComplete;this.onError=onError;this.promise=null;Object.seal(this)}_createClass(TimerQuery,[{key:"delete",value:function _delete(){if(this.handle){_queryManager2.default.deleteQuery(this);this.ext.deleteQueryEXT(this.handle);(0,_webglChecks.glCheckError)(this.gl);this.handle=null}return this}},{key:"begin",value:function begin(){_queryManager2.default.beginQuery(this,this.onComplete,this.onError);if(this.ext){this.target=GL_TIME_ELAPSED_EXT;this.ext.beginQueryEXT(this.target,this.handle)}else{_queryManager2.default.rejectQuery(this,ERR_TIMER_QUERY_NOT_SUPPORTED)}return this}},{key:"end",value:function end(){if(this.target){this.ext.endQueryEXT(this.target);this.target=null}return this}},{key:"timestamp",value:function timestamp(){_queryManager2.default.beginQuery(this,this.onComplete,this.onError);if(this.ext){this.ext.queryCounterEXT(this.handle,GL_TIMESTAMP_EXT)}else{_queryManager2.default.rejectQuery(this,ERR_TIMER_QUERY_NOT_SUPPORTED)}return this}},{key:"cancel",value:function cancel(){this.end();_queryManager2.default.cancelQuery(this);return this}},{key:"isResultAvailable",value:function isResultAvailable(){return this.ext&&this.ext.getQueryObjectEXT(this.handle,GL_QUERY_RESULT_AVAILABLE_EXT)}},{key:"getResult",value:function getResult(){return this.ext?this.ext.getQueryObjectEXT(this.handle,GL_QUERY_RESULT_EXT)/1e6:0}}]);return TimerQuery}();exports.default=TimerQuery;_queryManager2.default.setInvalidator({queryType:TimerQuery,errorMessage:ERR_GPU_DISJOINT,checkInvalid:function checkInvalid(gl){return gl.getParameter(GL_GPU_DISJOINT_EXT)}})},{"../webgl/webgl-checks":243,"./helpers/query-manager":230}],239:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _UNIFORM_BASE_DESCRIP;exports.parseUniformName=parseUniformName;exports.getUniformSetter=getUniformSetter;exports.checkUniformValues=checkUniformValues;exports.getUniformsTable=getUniformsTable;var _webgl=require("./webgl");var _texture=require("./texture");var _texture2=_interopRequireDefault(_texture);var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var UNIFORM_BASE_DESCRIPTORS=(_UNIFORM_BASE_DESCRIP={},_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT,{function:"uniform1f",type:Float32Array}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT,{function:"uniform1i",type:Uint16Array}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL,{function:"uniform1i",type:Uint16Array}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_VEC2,{function:"uniform2fv",type:Float32Array,elements:2}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_VEC3,{function:"uniform3fv",type:Float32Array,elements:3}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_VEC4,{function:"uniform4fv",type:Float32Array,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT_VEC2,{function:"uniform2iv",type:Uint16Array,elements:2}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT_VEC3,{function:"uniform3iv",type:Uint16Array,elements:3}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.INT_VEC4,{function:"uniform4iv",type:Uint16Array,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL_VEC2,{function:"uniform2iv",type:Uint16Array,elements:2}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL_VEC3,{function:"uniform3fv",type:Uint16Array,elements:3}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.BOOL_VEC4,{function:"uniform4iv",type:Uint16Array,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_MAT2,{function:"uniformMatrix2fv",type:Float32Array,matrix:true,elements:4}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_MAT3,{mfunction:"uniformMatrix3fv",type:Float32Array,matrix:true,elements:9}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.FLOAT_MAT4,{function:"uniformMatrix4fv",type:Float32Array,matrix:true,elements:16}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.SAMPLER_2D,{function:"uniform1i",type:Uint16Array,texture:true}),_defineProperty(_UNIFORM_BASE_DESCRIP,_webgl.GL.SAMPLER_CUBE,{function:"uniform1i",type:Uint16Array,texture:true}),_UNIFORM_BASE_DESCRIP);function parseUniformName(name){var UNIFORM_NAME_REGEXP=/([^\[]*)(\[[0-9]+\])?/;var matches=name.match(UNIFORM_NAME_REGEXP);if(!matches||matches.length<2){throw new Error("Failed to parse GLSL uniform name "+name)}return{name:matches[1],length:matches[2]||1,isArray:Boolean(matches[2])}}function getUniformSetter(gl,location,info){var descriptor=UNIFORM_BASE_DESCRIPTORS[info.type];if(!descriptor){throw new Error("Unknown GLSL uniform type "+info.type)}var glFunction=gl[descriptor.function].bind(gl);var TypedArray=descriptor.type;var flatArrayLength=info.size*(descriptor.elements||1);var setter=void 0;if(flatArrayLength>1){setter=function setter(val){if(!(val instanceof TypedArray)){var typedArray=new TypedArray(flatArrayLength);typedArray.set(val);val=typedArray}(0,_assert2.default)(val.length===flatArrayLength);if(descriptor.matrix){glFunction(location,false,val)}else{glFunction(location,val)}}}else{setter=function setter(val){return glFunction(location,val)}}return setter}function checkUniformValues(uniforms,source){for(var uniformName in uniforms){var value=uniforms[uniformName];if(!checkUniformValue(value)){source=source?source+" ":"";console.error(source+" Bad uniform "+uniformName,value);throw new Error(source+" Bad uniform "+uniformName)}}return true}function checkUniformValue(value){var ok=true;if(value instanceof _texture2.default){ok=true}else if(Array.isArray(value)){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=value[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var element=_step.value;if(!isFinite(element)){ok=false}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}ok=ok&&value.length>0}else if(ArrayBuffer.isView(value)){ok=value.length>0}else if(!isFinite(value)){ok=false}return ok}function getUniformsTable(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$header=_ref.header,header=_ref$header===undefined?"Uniforms":_ref$header,program=_ref.program,uniforms=_ref.uniforms;(0,_assert2.default)(program);var uniformLocations=program._uniformSetters;var table=_defineProperty({},header,{});for(var uniformName in uniformLocations){var uniform=uniforms[uniformName];if(uniform!==undefined){table[uniformName]={Type:uniform,Value:(0,_utils.formatValue)(uniform)}}}for(var _uniformName in uniformLocations){var _uniform=uniforms[_uniformName];if(_uniform===undefined){table[_uniformName]={Type:"NOT PROVIDED",Value:"N/A"}}}var unusedTable={};var unusedCount=0;for(var _uniformName2 in uniforms){var _uniform2=uniforms[_uniformName2];if(!table[_uniformName2]){unusedCount++;unusedTable[_uniformName2]={Type:"NOT USED: "+_uniform2,Value:(0,_utils.formatValue)(_uniform2)}}}return{table:table,unusedTable:unusedTable,unusedCount:unusedCount}}},{"../utils":221,"./texture":237,"./webgl":247,assert:1}],240:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.isVertexArray=isVertexArray;var _webglTypes=require("../webgl/webgl-types");var _webglChecks=require("../webgl/webgl-checks");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var OES_vertex_array_object="OES_vertex_array_object";var VertexArrayObject=function(){_createClass(VertexArrayObject,null,[{key:"isSupported",value:function isSupported(gl){(0,_webglChecks.assertWebGLContext)(gl);return gl instanceof _webglTypes.WebGL2RenderingContext||gl.getExtension("OES_vertex_array_object")}},{key:"wrap",value:function wrap(gl,object){return object instanceof VertexArrayObject?object:new VertexArrayObject(gl,{handle:object.handle||object})}}]);function VertexArrayObject(gl){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},handle=_ref.handle;_classCallCheck(this,VertexArrayObject);(0,_webglChecks.assertWebGLContext)(gl);(0,_assert2.default)(VertexArrayObject.isSupported(gl),"VertexArrayObject: WebGL2 or OES_vertex_array_object required");handle=handle||createVertexArray(gl);if(!handle){throw new Error("Could not create VertexArrayObject")}this.gl=gl;this.handle=handle;this.userData={};Object.seal(this)}_createClass(VertexArrayObject,[{key:"delete",value:function _delete(){deleteVertexArray(this.gl,this.handle);return this}},{key:"bind",value:function bind(){bindVertexArray(this.gl,this.handle);return this}},{key:"unbind",value:function unbind(){bindVertexArray(this.gl,null);return this}}]);return VertexArrayObject}();exports.default=VertexArrayObject;function createVertexArray(gl){if(gl instanceof _webglTypes.WebGL2RenderingContext){return gl.createVertexArray()}var ext=gl.getExtension(OES_vertex_array_object);if(ext){return ext.createVertexArrayOES()}return null}function deleteVertexArray(gl,vertexArray){if(gl instanceof _webglTypes.WebGL2RenderingContext){gl.deleteVertexArray(vertexArray)}var ext=gl.getExtension(OES_vertex_array_object);if(ext){ext.deleteVertexArrayOES(vertexArray)}}function isVertexArray(gl,vertexArray){if(gl instanceof _webglTypes.WebGL2RenderingContext){return gl.isVertexArray(vertexArray)}var ext=gl.getExtension(OES_vertex_array_object);if(ext){return ext.isVertexArrayOES(vertexArray)}return false}function bindVertexArray(gl,vertexArray){if(gl instanceof _webglTypes.WebGL2RenderingContext){gl.bindVertexArray(vertexArray)}var ext=gl.getExtension(OES_vertex_array_object);if(ext){ext.bindVertexArrayOES(vertexArray)}}},{"../webgl/webgl-checks":243,"../webgl/webgl-types":246,assert:1}],241:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getMaxAttributes=getMaxAttributes;exports.hasDivisor=hasDivisor;exports.isEnabled=isEnabled;exports.getBuffer=getBuffer;exports.getGeneric=getGeneric;exports.getSize=getSize;exports.getType=getType;exports.isNormalized=isNormalized;exports.isInteger=isInteger;exports.getStride=getStride;exports.getOffset=getOffset;exports.enable=enable;exports.disable=disable;exports.setDivisor=setDivisor;exports.getDivisor=getDivisor;exports.setBuffer=setBuffer;exports.setGeneric=setGeneric;exports.setGenericValues=setGenericValues;var _webgl=require("./webgl");var _webglChecks=require("./webgl-checks");var _buffer=require("./buffer");var _buffer2=_interopRequireDefault(_buffer);var _utils=require("../utils");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function glGetLumaInfo(gl){if(!gl.luma){gl.luma={extensions:{}}}if(gl.luma.extensions["ANGLE_instanced_arrays"]===undefined){gl.luma.extensions["ANGLE_instanced_arrays"]=gl.getExtension("ANGLE_instanced_arrays")}return gl.luma}function getMaxAttributes(gl){(0,_webglChecks.assertWebGLContext)(gl);return gl.getParameter(gl.MAX_VERTEX_ATTRIBS)}function hasDivisor(gl){(0,_webglChecks.assertWebGLContext)(gl);return Boolean((0,_webglChecks.isWebGL2Context)(gl)||gl.getExtension(gl,"ANGLE_instanced_arrays"))}function isEnabled(gl,location){return Boolean(get(gl,location,gl.VERTEX_ATTRIB_ARRAY_ENABLED))}function getBuffer(gl,location){return get(gl,location,gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING)}function getGeneric(gl,location){return get(gl,gl.CURRENT_VERTEX_ATTRIB)}function getSize(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_SIZE)}function getType(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_TYPE)}function isNormalized(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_NORMALIZED)}function isInteger(gl,location){(0,_webglChecks.assertWebGL2Context)(gl);return get(location,gl.VERTEX_ATTRIB_ARRAY_INTEGER)}function getStride(gl,location){return get(location,gl.VERTEX_ATTRIB_ARRAY_STRIDE)}function getOffset(gl,location){var pname=arguments.length>2&&arguments[2]!==undefined?arguments[2]:gl.VERTEX_ATTRIB_ARRAY_POINTER;return gl.getVertexAttribOffset(location,pname)}function get(gl,location,pname){(0,_webglChecks.assertWebGLContext)(gl);return gl.getVertexAttrib(location,pname)}function enable(gl,location){gl.enableVertexAttribArray(location)}function disable(gl,location){if(location>0){gl.disableVertexAttribArray(location)}}function setDivisor(gl,location,divisor){if((0,_webglChecks.isWebGL2Context)(gl)){gl.vertexAttribDivisor(location,divisor);return}var ext=glGetLumaInfo(gl).extensions["ANGLE_instanced_arrays"];if(ext){ext.vertexAttribDivisorANGLE(location,divisor);return}if(divisor!==0){throw new Error("WebGL instanced rendering not supported")}}function getDivisor(gl,location){(0,_assert2.default)(location>0);if((0,_webglChecks.isWebGL2Context)(gl)){var divisor=get(location,gl.VERTEX_ATTRIB_ARRAY_DIVISOR);return divisor}var ext=glGetLumaInfo(gl).extensions["ANGLE_instanced_arrays"];if(ext){var _divisor=get(location,ext.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE);return _divisor}return 0}function setBuffer(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},gl=_ref.gl,location=_ref.location,buffer=_ref.buffer,target=_ref.target,layout=_ref.layout;(0,_webglChecks.assertWebGLContext)(gl);buffer=_buffer2.default.makeFrom(gl,buffer);target=(0,_webgl.glGet)(target!==undefined?target:buffer.target);layout=layout!==undefined?layout:buffer.layout;(0,_assert2.default)(target,"setBuffer needs target");(0,_assert2.default)(layout,"setBuffer called on uninitialized buffer");buffer.bind({target:gl.ARRAY_BUFFER});if(!layout.integer){gl.vertexAttribPointer(location,layout.size,(0,_webgl.glGet)(layout.type),layout.normalized,layout.stride,layout.offset)}else{(0,_webglChecks.assertWebGL2Context)(gl);gl.vertexAttribIPointer(location,layout.size,(0,_webgl.glGet)(layout.type),layout.stride,layout.offset)}buffer.unbind({target:gl.ARRAY_BUFFER})}function setGeneric(_ref2){var gl=_ref2.gl,location=_ref2.location,array=_ref2.array;_utils.log.warn(0,"VertexAttributes.setGeneric is not well tested");if(array instanceof Float32Array){gl.vertexAttrib4fv(location,array)}else if(array instanceof Int32Array){(0,_webglChecks.assertWebGL2Context)(gl);gl.vertexAttribI4iv(location,array)}else if(array instanceof Uint32Array){(0,_webglChecks.assertWebGL2Context)(gl);gl.vertexAttribI4uiv(location,array)}}function setGenericValues(gl,location,v0,v1,v2,v3){_utils.log.warn(0,"VertexAttributes.setGenericValues is not well tested");switch(arguments.length-1){case 1:gl.vertexAttrib1f(location,v0);break;case 2:gl.vertexAttrib2f(location,v0,v1);break;case 3:gl.vertexAttrib3f(location,v0,v1,v2);break;case 4:gl.vertexAttrib4f(location,v0,v1,v2,v3);break;default:throw new Error("vertex attribute size must be between 1 and 4")}}},{"../utils":221,"./buffer":226,"./webgl":247,"./webgl-checks":243,assert:1}],242:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.glArrayFromType=undefined;exports.glTypeFromArray=glTypeFromArray;exports.glTypeToArray=glTypeToArray;var _webglConstants=require("./webgl-constants");var _webglConstants2=_interopRequireDefault(_webglConstants);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function glTypeFromArray(arrayOrType){var type=ArrayBuffer.isView(arrayOrType)?arrayOrType.constructor:arrayOrType;switch(type){case Float32Array:return _webglConstants2.default.FLOAT;case Uint16Array:return _webglConstants2.default.UNSIGNED_SHORT;case Uint32Array:return _webglConstants2.default.UNSIGNED_INT;case Uint8Array:return _webglConstants2.default.UNSIGNED_BYTE;case Uint8ClampedArray:return _webglConstants2.default.UNSIGNED_BYTE;case Int8Array:return _webglConstants2.default.BYTE;case Int16Array:return _webglConstants2.default.SHORT;case Int32Array:return _webglConstants2.default.INT;default:throw new Error("Failed to deduce type from array/array type")}}function glTypeToArray(glType){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$clamped=_ref.clamped,clamped=_ref$clamped===undefined?true:_ref$clamped;switch(glType){case _webglConstants2.default.FLOAT:return Float32Array;case _webglConstants2.default.UNSIGNED_SHORT:case _webglConstants2.default.UNSIGNED_SHORT_5_6_5:case _webglConstants2.default.UNSIGNED_SHORT_4_4_4_4:case _webglConstants2.default.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case _webglConstants2.default.UNSIGNED_INT:return Uint32Array;case _webglConstants2.default.UNSIGNED_BYTE:return clamped?Uint8ClampedArray:Uint8Array;case _webglConstants2.default.BYTE:return Int8Array;case _webglConstants2.default.SHORT:return Int16Array;case _webglConstants2.default.INT:return Int32Array;default:throw new Error("Failed to deduce type from array")}}exports.glArrayFromType=glTypeToArray},{"./webgl-constants":244}],243:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GL_BUFFER_USAGE=exports.GL_TARGETS=exports.GL_DRAW_MODES=exports.GL_INDEX_TYPES=undefined;exports.isWebGLContext=isWebGLContext;exports.isWebGL2Context=isWebGL2Context;exports.assertWebGLContext=assertWebGLContext;exports.assertWebGL2Context=assertWebGL2Context;exports.isIndexType=isIndexType;exports.assertIndexType=assertIndexType;exports.isDrawMode=isDrawMode;exports.assertDrawMode=assertDrawMode;exports.assertArrayTypeMatch=assertArrayTypeMatch;exports.glGetError=glGetError;exports.glCheckError=glCheckError;var _webglTypes=require("./webgl-types");var _webglConstants=require("./webgl-constants");var _webglConstants2=_interopRequireDefault(_webglConstants);var _webglArrays=require("./webgl-arrays");var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ERR_CONTEXT="Invalid WebGLRenderingContext";var ERR_WEBGL2="Requires WebGL2";function isWebGLContext(gl){return gl instanceof _webglTypes.WebGLRenderingContext||gl&&gl.ARRAY_BUFFER===34962}function isWebGL2Context(gl){return gl instanceof _webglTypes.WebGL2RenderingContext||gl&&gl.TEXTURE_BINDING_3D===32874}function assertWebGLContext(gl){(0,_assert2.default)(isWebGLContext(gl),ERR_CONTEXT)}function assertWebGL2Context(gl){(0,_assert2.default)(isWebGL2Context(gl),ERR_WEBGL2)}var GL_INDEX_TYPES=exports.GL_INDEX_TYPES=[_webglConstants2.default.UNSIGNED_BYTE,_webglConstants2.default.UNSIGNED_SHORT,_webglConstants2.default.UNSIGNED_INT];function isIndexType(type){return GL_INDEX_TYPES.indexOf(type)!==-1}function assertIndexType(glType,source){(0,
_assert2.default)(isIndexType(glType),"Bad index type "+(0,_webglConstants.glKey)(glType)+" "+source)}var GL_DRAW_MODES=exports.GL_DRAW_MODES=[_webglConstants2.default.POINTS,_webglConstants2.default.LINE_STRIP,_webglConstants2.default.LINE_LOOP,_webglConstants2.default.LINES,_webglConstants2.default.TRIANGLE_STRIP,_webglConstants2.default.TRIANGLE_FAN,_webglConstants2.default.TRIANGLES];function isDrawMode(glMode){return GL_DRAW_MODES.indexOf(glMode)!==-1}function assertDrawMode(glType,source){(0,_assert2.default)(isDrawMode(glType),"Bad draw mode "+(0,_webglConstants.glKey)(glType)+" "+source)}var GL_TARGETS=exports.GL_TARGETS=[_webglConstants2.default.ARRAY_BUFFER,_webglConstants2.default.ELEMENT_ARRAY_BUFFER,_webglConstants2.default.COPY_READ_BUFFER,_webglConstants2.default.COPY_WRITE_BUFFER,_webglConstants2.default.TRANSFORM_FEEDBACK_BUFFER,_webglConstants2.default.UNIFORM_BUFFER,_webglConstants2.default.PIXEL_PACK_BUFFER,_webglConstants2.default.PIXEL_UNPACK_BUFFER];var GL_BUFFER_USAGE=exports.GL_BUFFER_USAGE=[_webglConstants2.default.STATIC_DRAW,_webglConstants2.default.DYNAMIC_DRAW,_webglConstants2.default.STREAM_DRAW,_webglConstants2.default.STATIC_READ,_webglConstants2.default.DYNAMIC_READ,_webglConstants2.default.STREAM_READ,_webglConstants2.default.STATIC_COPY,_webglConstants2.default.DYNAMIC_COPY,_webglConstants2.default.STREAM_COPY];function assertArrayTypeMatch(array,type,source){(0,_assert2.default)(type===(0,_webglArrays.glTypeFromArray)(array),(array.constructor.name||"Array")+" "+("does not match element type "+(0,_webglConstants.glKey)(type)+" "+source))}function glGetError(gl){var errorStack=[];var glError=gl.getError();while(glError!==gl.NO_ERROR){errorStack.push(glGetErrorMessage(gl,glError));glError=gl.getError()}return errorStack.length?new Error(errorStack.join("\n")):null}function glCheckError(gl){if(gl.debug){var error=glGetError(gl);if(error){throw error}}}function glGetErrorMessage(gl,glError){switch(glError){case _webglConstants2.default.CONTEXT_LOST_WEBGL:return"WebGL context lost";case _webglConstants2.default.INVALID_ENUM:return"WebGL invalid enumerated argument";case _webglConstants2.default.INVALID_VALUE:return"WebGL invalid value";case _webglConstants2.default.INVALID_OPERATION:return"WebGL invalid operation";case _webglConstants2.default.INVALID_FRAMEBUFFER_OPERATION:return"WebGL invalid framebuffer operation";case _webglConstants2.default.OUT_OF_MEMORY:return"WebGL out of memory";default:return"WebGL unknown error "+glError}}},{"./webgl-arrays":242,"./webgl-constants":244,"./webgl-types":246,assert:1}],244:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GL=undefined;exports.glGet=glGet;exports.glKey=glKey;var _glConstants=require("gl-constants");var _glConstants2=_interopRequireDefault(_glConstants);var _assert=require("assert");var _assert2=_interopRequireDefault(_assert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.GL=_glConstants2.default;exports.default=_glConstants2.default;function glGet(name){var value=name;if(typeof name==="string"){value=_glConstants2.default[name];(0,_assert2.default)(value!==undefined,"Accessing GL."+name)}return value}function glKey(value){for(var key in _glConstants2.default){if(_glConstants2.default[key]===value){return"GL."+key}}return String(value)}},{assert:1,"gl-constants":143}],245:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getShaderName=getShaderName;exports.formatGLSLCompilerError=formatGLSLCompilerError;var _webglConstants=require("./webgl-constants");var _webglConstants2=_interopRequireDefault(_webglConstants);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getShaderName(shader){return"unnamed"}function formatGLSLCompilerError(errLog,src,shaderType){var errorStrings=errLog.split(/\r?\n/);var errors={};for(var i=0;i<errorStrings.length;i++){var errorString=errorStrings[i];if(errorString.length<=1){continue}var lineNo=parseInt(errorString.split(":")[2],10);if(isNaN(lineNo)){return"Could not parse GLSL compiler error: "+errLog}errors[lineNo]=errorString}var message="";var lines=addLineNumbers(src).split(/\r?\n/);for(var _i=0;_i<lines.length;_i++){var line=lines[_i];if(!errors[_i+3]&&!errors[_i+2]&&!errors[_i+1]){continue}message+=line+"\n";if(errors[_i+1]){var e=errors[_i+1];e=e.substr(e.split(":",3).join(":").length+1).trim();message+="^^^ "+e+"\n\n"}}var name=getShaderName(src)||"unknown name";var type=getShaderTypeName(shaderType);return"GLSL error in "+type+" shader "+name+"\n"+message}function addLineNumbers(string){var start=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var delim=arguments.length>2&&arguments[2]!==undefined?arguments[2]:": ";var lines=string.split(/\r?\n/);var maxDigits=String(lines.length+start-1).length;return lines.map(function(line,i){var lineNumber=i+start;var digits=String(lineNumber).length;var prefix=padLeft(lineNumber,maxDigits-digits);return prefix+delim+line}).join("\n")}function padLeft(string,digits){var result="";for(var i=0;i<digits;++i){result+=" "}return""+result+string}function getShaderTypeName(type){switch(type){case _webglConstants2.default.FRAGMENT_SHADER:return"fragment";case _webglConstants2.default.VERTEX_SHADER:return"vertex";default:return"unknown type"}}},{"./webgl-constants":244}],246:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WebGL2RenderingContext=exports.WebGLShaderPrecisionFormat=exports.WebGLActiveInfo=exports.WebGLUniformLocation=exports.WebGLTexture=exports.WebGLRenderbuffer=exports.WebGLFramebuffer=exports.WebGLBuffer=exports.WebGLShader=exports.WebGLProgram=exports.WebGLRenderingContext=exports.Image=exports.webGLTypesAvailable=undefined;var _init=require("../init");var _init2=_interopRequireDefault(_init);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DummyType=function DummyType(){_classCallCheck(this,DummyType)};var _ref=_init2.default.globals.headlessTypes||_init.global,_ref$WebGLRenderingCo=_ref.WebGLRenderingContext,WebGLRenderingContext=_ref$WebGLRenderingCo===undefined?DummyType:_ref$WebGLRenderingCo,_ref$WebGLProgram=_ref.WebGLProgram,WebGLProgram=_ref$WebGLProgram===undefined?DummyType:_ref$WebGLProgram,_ref$WebGLShader=_ref.WebGLShader,WebGLShader=_ref$WebGLShader===undefined?DummyType:_ref$WebGLShader,_ref$WebGLBuffer=_ref.WebGLBuffer,WebGLBuffer=_ref$WebGLBuffer===undefined?DummyType:_ref$WebGLBuffer,_ref$WebGLFramebuffer=_ref.WebGLFramebuffer,WebGLFramebuffer=_ref$WebGLFramebuffer===undefined?DummyType:_ref$WebGLFramebuffer,_ref$WebGLRenderbuffe=_ref.WebGLRenderbuffer,WebGLRenderbuffer=_ref$WebGLRenderbuffe===undefined?DummyType:_ref$WebGLRenderbuffe,_ref$WebGLTexture=_ref.WebGLTexture,WebGLTexture=_ref$WebGLTexture===undefined?DummyType:_ref$WebGLTexture,_ref$WebGLUniformLoca=_ref.WebGLUniformLocation,WebGLUniformLocation=_ref$WebGLUniformLoca===undefined?DummyType:_ref$WebGLUniformLoca,_ref$WebGLActiveInfo=_ref.WebGLActiveInfo,WebGLActiveInfo=_ref$WebGLActiveInfo===undefined?DummyType:_ref$WebGLActiveInfo,_ref$WebGLShaderPreci=_ref.WebGLShaderPrecisionFormat,WebGLShaderPrecisionFormat=_ref$WebGLShaderPreci===undefined?DummyType:_ref$WebGLShaderPreci;var webGLTypesAvailable=exports.webGLTypesAvailable=WebGLRenderingContext!==DummyType&&WebGLProgram!==DummyType&&WebGLShader!==DummyType&&WebGLBuffer!==DummyType&&WebGLFramebuffer!==DummyType&&WebGLRenderbuffer!==DummyType&&WebGLTexture!==DummyType&&WebGLUniformLocation!==DummyType&&WebGLActiveInfo!==DummyType&&WebGLShaderPrecisionFormat!==DummyType;function getWebGL2RenderingContext(){var WebGL2RenderingContextNotSupported=function WebGL2RenderingContextNotSupported(){_classCallCheck(this,WebGL2RenderingContextNotSupported)};return _init.global.WebGL2RenderingContext||WebGL2RenderingContextNotSupported}function getImage(){var ImageNotSupported=function ImageNotSupported(){_classCallCheck(this,ImageNotSupported)};return _init.global.Image||ImageNotSupported}var WebGL2RenderingContext=getWebGL2RenderingContext();var Image=getImage();exports.Image=Image;exports.WebGLRenderingContext=WebGLRenderingContext;exports.WebGLProgram=WebGLProgram;exports.WebGLShader=WebGLShader;exports.WebGLBuffer=WebGLBuffer;exports.WebGLFramebuffer=WebGLFramebuffer;exports.WebGLRenderbuffer=WebGLRenderbuffer;exports.WebGLTexture=WebGLTexture;exports.WebGLUniformLocation=WebGLUniformLocation;exports.WebGLActiveInfo=WebGLActiveInfo;exports.WebGLShaderPrecisionFormat=WebGLShaderPrecisionFormat;exports.WebGL2RenderingContext=WebGL2RenderingContext},{"../init":196}],247:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _webglTypes=require("./webgl-types");Object.keys(_webglTypes).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webglTypes[key]}})});var _webglArrays=require("./webgl-arrays");Object.keys(_webglArrays).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webglArrays[key]}})});var _webglConstants=require("./webgl-constants");Object.keys(_webglConstants).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _webglConstants[key]}})});Object.defineProperty(exports,"default",{enumerable:true,get:function get(){return _interopRequireDefault(_webglConstants).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./webgl-arrays":242,"./webgl-constants":244,"./webgl-types":246}],248:[function(require,module,exports){module.exports={name:"luma.gl",version:"3.0.1",description:"A WebGL JavaScript visualization library.",license:"MIT",contributors:["Ib Green <ib@uber.com>","Nicolas Belmonte <nico@uber.com>","Rye Terrell <ryeterrell@ryeterrell.net","Shan He <shan@uber.com>","Mikola Lysenko <mikolalysenko@gmail.com","Wesam Manassra <manassra@uber.com>"],repository:{type:"git",url:"https://github.com/uber/luma.gl"},keywords:["webgl","visualization","animation","3d"],main:"dist/index.js",module:"dist-es6/index.js",files:["src","dist","dist-es6","headless.js"],scripts:{"start-webpack":"(cd examples/main && yarn && npm run start-local)",start:"npm run build-watch && budo dist/bundle.js:dist/lumagl.js --live --open --port 3000 --watch-glob '**/*.{html,css,js,glsl}' ","build-watch":"babel src -d dist --source-maps inline --copy-files --watch & babel examples -d dist --source-maps inline --copy-files --watch &","build-clean":"rm -fr dist dist-es6 && mkdir -p dist dist-es6 ","build-es6":"rm -fr dist-es6 && babel src --out-dir dist-es6 --plugins=static-fs --source-maps inline","build-es5":"rm -fr dist && babel src --out-dir dist --plugins=static-fs,transform-es2015-modules-commonjs --source-maps inline","build-buble":"rm -fr dist-buble && mkdir -p dist-buble && buble src -o dist-buble --no modules --y dangerousForOf --objectAssign",build:"npm run build-es6 && npm run build-es5","build-shaders":'find . -name \'*.glsl\' -type f -exec bash -c \'echo "export default `\\" "$1" "`;"\' -- {} \\;',"build-shaders2":'find . -name \'*.glsl\' -type f -exec bash -c \'echo "export default `\\" ; cat "$1" ; echo "`;" "${1/glsl/glsl.js}"\' -- {} \\;',"build-shader":"echo 'export default `\\' ; cat \"$1\" ; echo '`;'",lint:"eslint src test","publish-prod":"npm run build && npm run test-fast && npm publish","publish-beta":"npm run build && npm run test-fast && npm publish --tag beta",test:"npm run lint && npm run test-node","test-fast":"npm run lint && node test/node.js | faucet","test-node":"node test/node.js","test-browser":"webpack-dev-server --config webpack.config.test-browser.js --progress --hot --open","test-shader":"npm run build-dist && budo src/test/fp64-shader.spec.js:build/test-bundle.js --dir test --live --open --port 3001 --watch-glob '**/*.{html,css,scss,js,glsl}' -- -t babelify -t brfs-babel",docs:"npm run docs-build && open ./_docs/docs/index.html","docs-build":"rm -fr _docs/* && jekyll build --config=docs/_config.yml --layouts docs/_layouts","docs-gh-pages":"git subtree push --prefix _docs origin gh-pages","docs-gh-pages-force":"git push origin `git subtree split --prefix _docs dev`:gh-pages --force","docs-publish":"npm run docs-build && git add _docs -f && git commit -m 'UPDATE DOCS' --no-verify && npm run docs-gh-pages"},dependencies:{"gl-constants":"^1.0.0","gl-matrix":"^2.3.2","webgl-debug":"^1.0.2"},devDependencies:{"babel-cli":"^6.18","babel-core":"^6.18","babel-eslint":"^6.0.0","babel-plugin-static-fs":"^1.1.0","babel-plugin-transform-builtin-extend":"^1.1.0","babel-plugin-transform-decorators-legacy":"^1.3.4","babel-preset-es2015":"^6.18","babel-preset-stage-2":"^6.18",babelify:"^7.2.0","blue-tape":"^0.2.0","brfs-babel":"^1.0.0",browserify:"^13.0.0",buble:"^0.15.1","buble-loader":"^0.4.0",budo:"^8.0.3",disc:"^1.3.2","electron-prebuilt":"^0.37.2",eslint:"^3.0","eslint-config-uber-es2015":"^3.0.0","eslint-config-uber-jsx":"^3.0.0","eslint-plugin-babel":"^4.0.0","eslint-plugin-react":"~6.7.0",faucet:"0.0.1",gl:"^4.0.2",jsdom:"^9.9.1","luma.gl":"3.0.0-alpha.3",mkdirp:"^0.5.1","module-alias":"^2.0.0","pre-commit":"^1.2.2","raw-loader":"^0.5.1",react:"^15.4.0","react-addons-test-utils":"^15.4.2","react-dom":"^15.4.0",reify:"^0.4.4",sinon:"^1.17.7","source-map-support":"^0.4.2","tap-browser-color":"^0.1.2",tape:"^4.6.3","tape-catch":"^1.0.4","tape-promise":"^1.1.0",testron:"^1.2.0","transform-loader":"^0.2.3","uglify-js":"^2.6.1",webpack:"^2.2.0-rc.3","webpack-dev-server":"^2.2.0-rc.0"}}},{}],249:[function(require,module,exports){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}function shouldUseNative(){try{if(!Object.assign){return false}var test1=new String("abc");test1[5]="de";if(Object.getOwnPropertyNames(test1)[0]==="5"){return false}var test2={};for(var i=0;i<10;i++){test2["_"+String.fromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789"){return false}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if(Object.keys(Object.assign({},test3)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(err){return false}}module.exports=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to}},{}],250:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:252}],251:[function(require,module,exports){(function(process){(function(){var getNanoSeconds,hrtime,loadTime;if(typeof performance!=="undefined"&&performance!==null&&performance.now){module.exports=function(){return performance.now()}}else if(typeof process!=="undefined"&&process!==null&&process.hrtime){module.exports=function(){return(getNanoSeconds()-loadTime)/1e6};hrtime=process.hrtime;getNanoSeconds=function(){var hr;hr=hrtime();return hr[0]*1e9+hr[1]};loadTime=getNanoSeconds()}else if(Date.now){module.exports=function(){return Date.now()-loadTime};loadTime=Date.now()}else{module.exports=function(){return(new Date).getTime()-loadTime};loadTime=(new Date).getTime()}}).call(this)}).call(this,require("_process"))},{_process:252}],252:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],253:[function(require,module,exports){(function(process){"use strict";if(process.env.NODE_ENV!=="production"){var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var ReactPropTypesSecret=require("./lib/ReactPropTypesSecret");var loggedTypeFailures={}}function checkPropTypes(typeSpecs,values,location,componentName,getStack){if(process.env.NODE_ENV!=="production"){for(var typeSpecName in typeSpecs){if(typeSpecs.hasOwnProperty(typeSpecName)){var error;try{invariant(typeof typeSpecs[typeSpecName]==="function","%s: %s type `%s` is invalid; it must be a function, usually from "+"React.PropTypes.",componentName||"React class",location,typeSpecName);error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret)}catch(ex){error=ex}warning(!error||error instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker "+"function must return `null` or an `Error` but returned a %s. "+"You may have forgotten to pass an argument to the type checker "+"creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and "+"shape all require an argument).",componentName||"React class",location,typeSpecName,typeof error);if(error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=true;var stack=getStack?getStack():"";warning(false,"Failed %s type: %s%s",location,error.message,stack!=null?stack:"")}}}}}module.exports=checkPropTypes}).call(this,require("_process"))},{"./lib/ReactPropTypesSecret":258,_process:252,"fbjs/lib/invariant":140,"fbjs/lib/warning":142}],254:[function(require,module,exports){"use strict";var factory=require("./factoryWithTypeCheckers");module.exports=function(isValidElement){var throwOnDirectAccess=false;return factory(isValidElement,throwOnDirectAccess)}},{"./factoryWithTypeCheckers":256}],255:[function(require,module,exports){"use strict";var emptyFunction=require("fbjs/lib/emptyFunction");var invariant=require("fbjs/lib/invariant");module.exports=function(){function shim(){invariant(false,"Calling PropTypes validators directly is not supported by the `prop-types` package. "+"Use PropTypes.checkPropTypes() to call them. "+"Read more at http://fb.me/use-check-prop-types")}shim.isRequired=shim;function getShim(){return shim}var ReactPropTypes={array:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim};ReactPropTypes.checkPropTypes=emptyFunction;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes}},{"fbjs/lib/emptyFunction":138,"fbjs/lib/invariant":140}],256:[function(require,module,exports){(function(process){"use strict";var emptyFunction=require("fbjs/lib/emptyFunction");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var ReactPropTypesSecret=require("./lib/ReactPropTypesSecret");var checkPropTypes=require("./checkPropTypes");module.exports=function(isValidElement,throwOnDirectAccess){var ITERATOR_SYMBOL=typeof Symbol==="function"&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn==="function"){return iteratorFn}}var ANONYMOUS="<<anonymous>>";var ReactPropTypes={array:createPrimitiveTypeChecker("array"),bool:createPrimitiveTypeChecker("boolean"),func:createPrimitiveTypeChecker("function"),number:createPrimitiveTypeChecker("number"),object:createPrimitiveTypeChecker("object"),string:createPrimitiveTypeChecker("string"),symbol:createPrimitiveTypeChecker("symbol"),any:createAnyTypeChecker(),arrayOf:createArrayOfTypeChecker,element:createElementTypeChecker(),instanceOf:createInstanceTypeChecker,node:createNodeChecker(),objectOf:createObjectOfTypeChecker,oneOf:createEnumTypeChecker,oneOfType:createUnionTypeChecker,shape:createShapeTypeChecker};function is(x,y){if(x===y){return x!==0||1/x===1/y}else{return x!==x&&y!==y}}function PropTypeError(message){this.message=message;this.stack=""}PropTypeError.prototype=Error.prototype;function createChainableTypeChecker(validate){if(process.env.NODE_ENV!=="production"){var manualPropTypeCallCache={};var manualPropTypeWarningCount=0}function checkType(isRequired,props,propName,componentName,location,propFullName,secret){componentName=componentName||ANONYMOUS;propFullName=propFullName||propName;if(secret!==ReactPropTypesSecret){if(throwOnDirectAccess){invariant(false,"Calling PropTypes validators directly is not supported by the `prop-types` package. "+"Use `PropTypes.checkPropTypes()` to call them. "+"Read more at http://fb.me/use-check-prop-types")}else if(process.env.NODE_ENV!=="production"&&typeof console!=="undefined"){var cacheKey=componentName+":"+propName;if(!manualPropTypeCallCache[cacheKey]&&manualPropTypeWarningCount<3){warning(false,"You are manually calling a React.PropTypes validation "+"function for the `%s` prop on `%s`. This is deprecated "+"and will throw in the standalone `prop-types` package. "+"You may be seeing this warning due to a third-party PropTypes "+"library. See https://fb.me/react-warning-dont-call-proptypes "+"for details.",propFullName,componentName);manualPropTypeCallCache[cacheKey]=true;manualPropTypeWarningCount++}}}if(props[propName]==null){if(isRequired){if(props[propName]===null){return new PropTypeError("The "+location+" `"+propFullName+"` is marked as required "+("in `"+componentName+"`, but its value is `null`."))}return new PropTypeError("The "+location+" `"+propFullName+"` is marked as required in "+("`"+componentName+"`, but its value is `undefined`."))}return null}else{return validate(props,propName,componentName,location,propFullName)}}var chainedCheckType=checkType.bind(null,false);chainedCheckType.isRequired=checkType.bind(null,true);return chainedCheckType}function createPrimitiveTypeChecker(expectedType){function validate(props,propName,componentName,location,propFullName,secret){var propValue=props[propName];var propType=getPropType(propValue);if(propType!==expectedType){var preciseType=getPreciseType(propValue);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+preciseType+"` supplied to `"+componentName+"`, expected ")+("`"+expectedType+"`."))}return null}return createChainableTypeChecker(validate)}function createAnyTypeChecker(){return createChainableTypeChecker(emptyFunction.thatReturnsNull)}function createArrayOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=="function"){return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside arrayOf.")}var propValue=props[propName];if(!Array.isArray(propValue)){var propType=getPropType(propValue);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected an array."))}for(var i=0;i<propValue.length;i++){var error=typeChecker(propValue,i,componentName,location,propFullName+"["+i+"]",ReactPropTypesSecret);if(error instanceof Error){return error}}return null}return createChainableTypeChecker(validate)}function createElementTypeChecker(){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];if(!isValidElement(propValue)){var propType=getPropType(propValue);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected a single ReactElement."))}return null}return createChainableTypeChecker(validate)}function createInstanceTypeChecker(expectedClass){function validate(props,propName,componentName,location,propFullName){if(!(props[propName]instanceof expectedClass)){var expectedClassName=expectedClass.name||ANONYMOUS;var actualClassName=getClassName(props[propName]);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+actualClassName+"` supplied to `"+componentName+"`, expected ")+("instance of `"+expectedClassName+"`."))}return null}return createChainableTypeChecker(validate)}function createEnumTypeChecker(expectedValues){if(!Array.isArray(expectedValues)){process.env.NODE_ENV!=="production"?warning(false,"Invalid argument supplied to oneOf, expected an instance of array."):void 0;return emptyFunction.thatReturnsNull}function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];for(var i=0;i<expectedValues.length;i++){if(is(propValue,expectedValues[i])){return null}}var valuesString=JSON.stringify(expectedValues);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of value `"+propValue+"` "+("supplied to `"+componentName+"`, expected one of "+valuesString+"."))}return createChainableTypeChecker(validate)}function createObjectOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=="function"){return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside objectOf.")}var propValue=props[propName];var propType=getPropType(propValue);if(propType!=="object"){return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected an object."))}for(var key in propValue){if(propValue.hasOwnProperty(key)){var error=typeChecker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error instanceof Error){return error}}}return null}return createChainableTypeChecker(validate)}function createUnionTypeChecker(arrayOfTypeCheckers){if(!Array.isArray(arrayOfTypeCheckers)){process.env.NODE_ENV!=="production"?warning(false,"Invalid argument supplied to oneOfType, expected an instance of array."):void 0;return emptyFunction.thatReturnsNull}
function validate(props,propName,componentName,location,propFullName){for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if(checker(props,propName,componentName,location,propFullName,ReactPropTypesSecret)==null){return null}}return new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to "+("`"+componentName+"`."))}return createChainableTypeChecker(validate)}function createNodeChecker(){function validate(props,propName,componentName,location,propFullName){if(!isNode(props[propName])){return new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to "+("`"+componentName+"`, expected a ReactNode."))}return null}return createChainableTypeChecker(validate)}function createShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];var propType=getPropType(propValue);if(propType!=="object"){return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` "+("supplied to `"+componentName+"`, expected `object`."))}for(var key in shapeTypes){var checker=shapeTypes[key];if(!checker){continue}var error=checker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error){return error}}return null}return createChainableTypeChecker(validate)}function isNode(propValue){switch(typeof propValue){case"number":case"string":case"undefined":return true;case"boolean":return!propValue;case"object":if(Array.isArray(propValue)){return propValue.every(isNode)}if(propValue===null||isValidElement(propValue)){return true}var iteratorFn=getIteratorFn(propValue);if(iteratorFn){var iterator=iteratorFn.call(propValue);var step;if(iteratorFn!==propValue.entries){while(!(step=iterator.next()).done){if(!isNode(step.value)){return false}}}else{while(!(step=iterator.next()).done){var entry=step.value;if(entry){if(!isNode(entry[1])){return false}}}}}else{return false}return true;default:return false}}function isSymbol(propType,propValue){if(propType==="symbol"){return true}if(propValue["@@toStringTag"]==="Symbol"){return true}if(typeof Symbol==="function"&&propValue instanceof Symbol){return true}return false}function getPropType(propValue){var propType=typeof propValue;if(Array.isArray(propValue)){return"array"}if(propValue instanceof RegExp){return"object"}if(isSymbol(propType,propValue)){return"symbol"}return propType}function getPreciseType(propValue){var propType=getPropType(propValue);if(propType==="object"){if(propValue instanceof Date){return"date"}else if(propValue instanceof RegExp){return"regexp"}}return propType}function getClassName(propValue){if(!propValue.constructor||!propValue.constructor.name){return ANONYMOUS}return propValue.constructor.name}ReactPropTypes.checkPropTypes=checkPropTypes;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes}}).call(this,require("_process"))},{"./checkPropTypes":253,"./lib/ReactPropTypesSecret":258,_process:252,"fbjs/lib/emptyFunction":138,"fbjs/lib/invariant":140,"fbjs/lib/warning":142}],257:[function(require,module,exports){(function(process){if(process.env.NODE_ENV!=="production"){var REACT_ELEMENT_TYPE=typeof Symbol==="function"&&Symbol.for&&Symbol.for("react.element")||60103;var isValidElement=function(object){return typeof object==="object"&&object!==null&&object.$$typeof===REACT_ELEMENT_TYPE};var throwOnDirectAccess=true;module.exports=require("./factoryWithTypeCheckers")(isValidElement,throwOnDirectAccess)}else{module.exports=require("./factoryWithThrowingShims")()}}).call(this,require("_process"))},{"./factoryWithThrowingShims":255,"./factoryWithTypeCheckers":256,_process:252}],258:[function(require,module,exports){"use strict";var ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";module.exports=ReactPropTypesSecret},{}],259:[function(require,module,exports){(function(global){var now=require("performance-now"),root=typeof window==="undefined"?global:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix];for(var i=0;!raf&&i<vendors.length;i++){raf=root[vendors[i]+"Request"+suffix];caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix]}if(!raf||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf=function(callback){if(queue.length===0){var _now=now(),next=Math.max(0,frameDuration-(_now-last));last=next+_now;setTimeout(function(){var cp=queue.slice(0);queue.length=0;for(var i=0;i<cp.length;i++){if(!cp[i].cancelled){try{cp[i].callback(last)}catch(e){setTimeout(function(){throw e},0)}}}},Math.round(next))}queue.push({handle:++id,callback:callback,cancelled:false});return id};caf=function(handle){for(var i=0;i<queue.length;i++){if(queue[i].handle===handle){queue[i].cancelled=true}}}}module.exports=function(fn){return raf.call(root,fn)};module.exports.cancel=function(){caf.apply(root,arguments)};module.exports.polyfill=function(){root.requestAnimationFrame=raf;root.cancelAnimationFrame=caf}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"performance-now":251}],260:[function(require,module,exports){"use strict";var shallowEqual=require("fbjs/lib/shallowEqual");function shallowCompare(instance,nextProps,nextState){return!shallowEqual(instance.props,nextProps)||!shallowEqual(instance.state,nextState)}module.exports=shallowCompare},{"fbjs/lib/shallowEqual":141}],261:[function(require,module,exports){"use strict";exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _mapToZero=require("./mapToZero");var _mapToZero2=_interopRequireDefault(_mapToZero);var _stripStyle=require("./stripStyle");var _stripStyle2=_interopRequireDefault(_stripStyle);var _stepper3=require("./stepper");var _stepper4=_interopRequireDefault(_stepper3);var _performanceNow=require("performance-now");var _performanceNow2=_interopRequireDefault(_performanceNow);var _raf=require("raf");var _raf2=_interopRequireDefault(_raf);var _shouldStopAnimation=require("./shouldStopAnimation");var _shouldStopAnimation2=_interopRequireDefault(_shouldStopAnimation);var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _createReactClass=require("create-react-class");var _createReactClass2=_interopRequireDefault(_createReactClass);var msPerFrame=1e3/60;var Motion=_createReactClass2["default"]({propTypes:{defaultStyle:_propTypes2["default"].objectOf(_propTypes2["default"].number),style:_propTypes2["default"].objectOf(_propTypes2["default"].oneOfType([_propTypes2["default"].number,_propTypes2["default"].object])).isRequired,children:_propTypes2["default"].func.isRequired,onRest:_propTypes2["default"].func},getInitialState:function getInitialState(){var _props=this.props;var defaultStyle=_props.defaultStyle;var style=_props.style;var currentStyle=defaultStyle||_stripStyle2["default"](style);var currentVelocity=_mapToZero2["default"](currentStyle);return{currentStyle:currentStyle,currentVelocity:currentVelocity,lastIdealStyle:currentStyle,lastIdealVelocity:currentVelocity}},wasAnimating:false,animationID:null,prevTime:0,accumulatedTime:0,unreadPropStyle:null,clearUnreadPropStyle:function clearUnreadPropStyle(destStyle){var dirty=false;var _state=this.state;var currentStyle=_state.currentStyle;var currentVelocity=_state.currentVelocity;var lastIdealStyle=_state.lastIdealStyle;var lastIdealVelocity=_state.lastIdealVelocity;for(var key in destStyle){if(!Object.prototype.hasOwnProperty.call(destStyle,key)){continue}var styleValue=destStyle[key];if(typeof styleValue==="number"){if(!dirty){dirty=true;currentStyle=_extends({},currentStyle);currentVelocity=_extends({},currentVelocity);lastIdealStyle=_extends({},lastIdealStyle);lastIdealVelocity=_extends({},lastIdealVelocity)}currentStyle[key]=styleValue;currentVelocity[key]=0;lastIdealStyle[key]=styleValue;lastIdealVelocity[key]=0}}if(dirty){this.setState({currentStyle:currentStyle,currentVelocity:currentVelocity,lastIdealStyle:lastIdealStyle,lastIdealVelocity:lastIdealVelocity})}},startAnimationIfNecessary:function startAnimationIfNecessary(){var _this=this;this.animationID=_raf2["default"](function(timestamp){var propsStyle=_this.props.style;if(_shouldStopAnimation2["default"](_this.state.currentStyle,propsStyle,_this.state.currentVelocity)){if(_this.wasAnimating&&_this.props.onRest){_this.props.onRest()}_this.animationID=null;_this.wasAnimating=false;_this.accumulatedTime=0;return}_this.wasAnimating=true;var currentTime=timestamp||_performanceNow2["default"]();var timeDelta=currentTime-_this.prevTime;_this.prevTime=currentTime;_this.accumulatedTime=_this.accumulatedTime+timeDelta;if(_this.accumulatedTime>msPerFrame*10){_this.accumulatedTime=0}if(_this.accumulatedTime===0){_this.animationID=null;_this.startAnimationIfNecessary();return}var currentFrameCompletion=(_this.accumulatedTime-Math.floor(_this.accumulatedTime/msPerFrame)*msPerFrame)/msPerFrame;var framesToCatchUp=Math.floor(_this.accumulatedTime/msPerFrame);var newLastIdealStyle={};var newLastIdealVelocity={};var newCurrentStyle={};var newCurrentVelocity={};for(var key in propsStyle){if(!Object.prototype.hasOwnProperty.call(propsStyle,key)){continue}var styleValue=propsStyle[key];if(typeof styleValue==="number"){newCurrentStyle[key]=styleValue;newCurrentVelocity[key]=0;newLastIdealStyle[key]=styleValue;newLastIdealVelocity[key]=0}else{var newLastIdealStyleValue=_this.state.lastIdealStyle[key];var newLastIdealVelocityValue=_this.state.lastIdealVelocity[key];for(var i=0;i<framesToCatchUp;i++){var _stepper=_stepper4["default"](msPerFrame/1e3,newLastIdealStyleValue,newLastIdealVelocityValue,styleValue.val,styleValue.stiffness,styleValue.damping,styleValue.precision);newLastIdealStyleValue=_stepper[0];newLastIdealVelocityValue=_stepper[1]}var _stepper2=_stepper4["default"](msPerFrame/1e3,newLastIdealStyleValue,newLastIdealVelocityValue,styleValue.val,styleValue.stiffness,styleValue.damping,styleValue.precision);var nextIdealX=_stepper2[0];var nextIdealV=_stepper2[1];newCurrentStyle[key]=newLastIdealStyleValue+(nextIdealX-newLastIdealStyleValue)*currentFrameCompletion;newCurrentVelocity[key]=newLastIdealVelocityValue+(nextIdealV-newLastIdealVelocityValue)*currentFrameCompletion;newLastIdealStyle[key]=newLastIdealStyleValue;newLastIdealVelocity[key]=newLastIdealVelocityValue}}_this.animationID=null;_this.accumulatedTime-=framesToCatchUp*msPerFrame;_this.setState({currentStyle:newCurrentStyle,currentVelocity:newCurrentVelocity,lastIdealStyle:newLastIdealStyle,lastIdealVelocity:newLastIdealVelocity});_this.unreadPropStyle=null;_this.startAnimationIfNecessary()})},componentDidMount:function componentDidMount(){this.prevTime=_performanceNow2["default"]();this.startAnimationIfNecessary()},componentWillReceiveProps:function componentWillReceiveProps(props){if(this.unreadPropStyle!=null){this.clearUnreadPropStyle(this.unreadPropStyle)}this.unreadPropStyle=props.style;if(this.animationID==null){this.prevTime=_performanceNow2["default"]();this.startAnimationIfNecessary()}},componentWillUnmount:function componentWillUnmount(){if(this.animationID!=null){_raf2["default"].cancel(this.animationID);this.animationID=null}},render:function render(){var renderedChildren=this.props.children(this.state.currentStyle);return renderedChildren&&_react2["default"].Children.only(renderedChildren)}});exports["default"]=Motion;module.exports=exports["default"]},{"./mapToZero":264,"./shouldStopAnimation":269,"./stepper":271,"./stripStyle":272,"create-react-class":5,"performance-now":251,"prop-types":257,raf:259,react:297}],262:[function(require,module,exports){"use strict";exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _mapToZero=require("./mapToZero");var _mapToZero2=_interopRequireDefault(_mapToZero);var _stripStyle=require("./stripStyle");var _stripStyle2=_interopRequireDefault(_stripStyle);var _stepper3=require("./stepper");var _stepper4=_interopRequireDefault(_stepper3);var _performanceNow=require("performance-now");var _performanceNow2=_interopRequireDefault(_performanceNow);var _raf=require("raf");var _raf2=_interopRequireDefault(_raf);var _shouldStopAnimation=require("./shouldStopAnimation");var _shouldStopAnimation2=_interopRequireDefault(_shouldStopAnimation);var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _createReactClass=require("create-react-class");var _createReactClass2=_interopRequireDefault(_createReactClass);var msPerFrame=1e3/60;function shouldStopAnimationAll(currentStyles,styles,currentVelocities){for(var i=0;i<currentStyles.length;i++){if(!_shouldStopAnimation2["default"](currentStyles[i],styles[i],currentVelocities[i])){return false}}return true}var StaggeredMotion=_createReactClass2["default"]({propTypes:{defaultStyles:_propTypes2["default"].arrayOf(_propTypes2["default"].objectOf(_propTypes2["default"].number)),styles:_propTypes2["default"].func.isRequired,children:_propTypes2["default"].func.isRequired},getInitialState:function getInitialState(){var _props=this.props;var defaultStyles=_props.defaultStyles;var styles=_props.styles;var currentStyles=defaultStyles||styles().map(_stripStyle2["default"]);var currentVelocities=currentStyles.map(function(currentStyle){return _mapToZero2["default"](currentStyle)});return{currentStyles:currentStyles,currentVelocities:currentVelocities,lastIdealStyles:currentStyles,lastIdealVelocities:currentVelocities}},animationID:null,prevTime:0,accumulatedTime:0,unreadPropStyles:null,clearUnreadPropStyle:function clearUnreadPropStyle(unreadPropStyles){var _state=this.state;var currentStyles=_state.currentStyles;var currentVelocities=_state.currentVelocities;var lastIdealStyles=_state.lastIdealStyles;var lastIdealVelocities=_state.lastIdealVelocities;var someDirty=false;for(var i=0;i<unreadPropStyles.length;i++){var unreadPropStyle=unreadPropStyles[i];var dirty=false;for(var key in unreadPropStyle){if(!Object.prototype.hasOwnProperty.call(unreadPropStyle,key)){continue}var styleValue=unreadPropStyle[key];if(typeof styleValue==="number"){if(!dirty){dirty=true;someDirty=true;currentStyles[i]=_extends({},currentStyles[i]);currentVelocities[i]=_extends({},currentVelocities[i]);lastIdealStyles[i]=_extends({},lastIdealStyles[i]);lastIdealVelocities[i]=_extends({},lastIdealVelocities[i])}currentStyles[i][key]=styleValue;currentVelocities[i][key]=0;lastIdealStyles[i][key]=styleValue;lastIdealVelocities[i][key]=0}}}if(someDirty){this.setState({currentStyles:currentStyles,currentVelocities:currentVelocities,lastIdealStyles:lastIdealStyles,lastIdealVelocities:lastIdealVelocities})}},startAnimationIfNecessary:function startAnimationIfNecessary(){var _this=this;this.animationID=_raf2["default"](function(timestamp){var destStyles=_this.props.styles(_this.state.lastIdealStyles);if(shouldStopAnimationAll(_this.state.currentStyles,destStyles,_this.state.currentVelocities)){_this.animationID=null;_this.accumulatedTime=0;return}var currentTime=timestamp||_performanceNow2["default"]();var timeDelta=currentTime-_this.prevTime;_this.prevTime=currentTime;_this.accumulatedTime=_this.accumulatedTime+timeDelta;if(_this.accumulatedTime>msPerFrame*10){_this.accumulatedTime=0}if(_this.accumulatedTime===0){_this.animationID=null;_this.startAnimationIfNecessary();return}var currentFrameCompletion=(_this.accumulatedTime-Math.floor(_this.accumulatedTime/msPerFrame)*msPerFrame)/msPerFrame;var framesToCatchUp=Math.floor(_this.accumulatedTime/msPerFrame);var newLastIdealStyles=[];var newLastIdealVelocities=[];var newCurrentStyles=[];var newCurrentVelocities=[];for(var i=0;i<destStyles.length;i++){var destStyle=destStyles[i];var newCurrentStyle={};var newCurrentVelocity={};var newLastIdealStyle={};var newLastIdealVelocity={};for(var key in destStyle){if(!Object.prototype.hasOwnProperty.call(destStyle,key)){continue}var styleValue=destStyle[key];if(typeof styleValue==="number"){newCurrentStyle[key]=styleValue;newCurrentVelocity[key]=0;newLastIdealStyle[key]=styleValue;newLastIdealVelocity[key]=0}else{var newLastIdealStyleValue=_this.state.lastIdealStyles[i][key];var newLastIdealVelocityValue=_this.state.lastIdealVelocities[i][key];for(var j=0;j<framesToCatchUp;j++){var _stepper=_stepper4["default"](msPerFrame/1e3,newLastIdealStyleValue,newLastIdealVelocityValue,styleValue.val,styleValue.stiffness,styleValue.damping,styleValue.precision);newLastIdealStyleValue=_stepper[0];newLastIdealVelocityValue=_stepper[1]}var _stepper2=_stepper4["default"](msPerFrame/1e3,newLastIdealStyleValue,newLastIdealVelocityValue,styleValue.val,styleValue.stiffness,styleValue.damping,styleValue.precision);var nextIdealX=_stepper2[0];var nextIdealV=_stepper2[1];newCurrentStyle[key]=newLastIdealStyleValue+(nextIdealX-newLastIdealStyleValue)*currentFrameCompletion;newCurrentVelocity[key]=newLastIdealVelocityValue+(nextIdealV-newLastIdealVelocityValue)*currentFrameCompletion;newLastIdealStyle[key]=newLastIdealStyleValue;newLastIdealVelocity[key]=newLastIdealVelocityValue}}newCurrentStyles[i]=newCurrentStyle;newCurrentVelocities[i]=newCurrentVelocity;newLastIdealStyles[i]=newLastIdealStyle;newLastIdealVelocities[i]=newLastIdealVelocity}_this.animationID=null;_this.accumulatedTime-=framesToCatchUp*msPerFrame;_this.setState({currentStyles:newCurrentStyles,currentVelocities:newCurrentVelocities,lastIdealStyles:newLastIdealStyles,lastIdealVelocities:newLastIdealVelocities});_this.unreadPropStyles=null;_this.startAnimationIfNecessary()})},componentDidMount:function componentDidMount(){this.prevTime=_performanceNow2["default"]();this.startAnimationIfNecessary()},componentWillReceiveProps:function componentWillReceiveProps(props){if(this.unreadPropStyles!=null){this.clearUnreadPropStyle(this.unreadPropStyles)}this.unreadPropStyles=props.styles(this.state.lastIdealStyles);if(this.animationID==null){this.prevTime=_performanceNow2["default"]();this.startAnimationIfNecessary()}},componentWillUnmount:function componentWillUnmount(){if(this.animationID!=null){_raf2["default"].cancel(this.animationID);this.animationID=null}},render:function render(){var renderedChildren=this.props.children(this.state.currentStyles);return renderedChildren&&_react2["default"].Children.only(renderedChildren)}});exports["default"]=StaggeredMotion;module.exports=exports["default"]},{"./mapToZero":264,"./shouldStopAnimation":269,"./stepper":271,"./stripStyle":272,"create-react-class":5,"performance-now":251,"prop-types":257,raf:259,react:297}],263:[function(require,module,exports){"use strict";exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _mapToZero=require("./mapToZero");var _mapToZero2=_interopRequireDefault(_mapToZero);var _stripStyle=require("./stripStyle");var _stripStyle2=_interopRequireDefault(_stripStyle);var _stepper3=require("./stepper");var _stepper4=_interopRequireDefault(_stepper3);var _mergeDiff=require("./mergeDiff");var _mergeDiff2=_interopRequireDefault(_mergeDiff);var _performanceNow=require("performance-now");var _performanceNow2=_interopRequireDefault(_performanceNow);var _raf=require("raf");var _raf2=_interopRequireDefault(_raf);var _shouldStopAnimation=require("./shouldStopAnimation");var _shouldStopAnimation2=_interopRequireDefault(_shouldStopAnimation);var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _createReactClass=require("create-react-class");var _createReactClass2=_interopRequireDefault(_createReactClass);var msPerFrame=1e3/60;function rehydrateStyles(mergedPropsStyles,unreadPropStyles,plainStyles){var cUnreadPropStyles=unreadPropStyles;if(cUnreadPropStyles==null){return mergedPropsStyles.map(function(mergedPropsStyle,i){return{key:mergedPropsStyle.key,data:mergedPropsStyle.data,style:plainStyles[i]}})}return mergedPropsStyles.map(function(mergedPropsStyle,i){for(var j=0;j<cUnreadPropStyles.length;j++){if(cUnreadPropStyles[j].key===mergedPropsStyle.key){return{key:cUnreadPropStyles[j].key,data:cUnreadPropStyles[j].data,style:plainStyles[i]}}}return{key:mergedPropsStyle.key,data:mergedPropsStyle.data,style:plainStyles[i]}})}function shouldStopAnimationAll(currentStyles,destStyles,currentVelocities,mergedPropsStyles){if(mergedPropsStyles.length!==destStyles.length){return false}for(var i=0;i<mergedPropsStyles.length;i++){if(mergedPropsStyles[i].key!==destStyles[i].key){return false}}for(var i=0;i<mergedPropsStyles.length;i++){if(!_shouldStopAnimation2["default"](currentStyles[i],destStyles[i].style,currentVelocities[i])){return false}}return true}function mergeAndSync(willEnter,willLeave,didLeave,oldMergedPropsStyles,destStyles,oldCurrentStyles,oldCurrentVelocities,oldLastIdealStyles,oldLastIdealVelocities){var newMergedPropsStyles=_mergeDiff2["default"](oldMergedPropsStyles,destStyles,function(oldIndex,oldMergedPropsStyle){var leavingStyle=willLeave(oldMergedPropsStyle);if(leavingStyle==null){didLeave({key:oldMergedPropsStyle.key,data:oldMergedPropsStyle.data});return null}if(_shouldStopAnimation2["default"](oldCurrentStyles[oldIndex],leavingStyle,oldCurrentVelocities[oldIndex])){didLeave({key:oldMergedPropsStyle.key,data:oldMergedPropsStyle.data});return null}return{key:oldMergedPropsStyle.key,data:oldMergedPropsStyle.data,style:leavingStyle}});var newCurrentStyles=[];var newCurrentVelocities=[];var newLastIdealStyles=[];var newLastIdealVelocities=[];for(var i=0;i<newMergedPropsStyles.length;i++){var newMergedPropsStyleCell=newMergedPropsStyles[i];var foundOldIndex=null;for(var j=0;j<oldMergedPropsStyles.length;j++){if(oldMergedPropsStyles[j].key===newMergedPropsStyleCell.key){foundOldIndex=j;break}}if(foundOldIndex==null){var plainStyle=willEnter(newMergedPropsStyleCell);newCurrentStyles[i]=plainStyle;newLastIdealStyles[i]=plainStyle;var velocity=_mapToZero2["default"](newMergedPropsStyleCell.style);newCurrentVelocities[i]=velocity;newLastIdealVelocities[i]=velocity}else{newCurrentStyles[i]=oldCurrentStyles[foundOldIndex];newLastIdealStyles[i]=oldLastIdealStyles[foundOldIndex];newCurrentVelocities[i]=oldCurrentVelocities[foundOldIndex];newLastIdealVelocities[i]=oldLastIdealVelocities[foundOldIndex]}}return[newMergedPropsStyles,newCurrentStyles,newCurrentVelocities,newLastIdealStyles,newLastIdealVelocities]}var TransitionMotion=_createReactClass2["default"]({propTypes:{defaultStyles:_propTypes2["default"].arrayOf(_propTypes2["default"].shape({key:_propTypes2["default"].string.isRequired,data:_propTypes2["default"].any,style:_propTypes2["default"].objectOf(_propTypes2["default"].number).isRequired})),styles:_propTypes2["default"].oneOfType([_propTypes2["default"].func,_propTypes2["default"].arrayOf(_propTypes2["default"].shape({key:_propTypes2["default"].string.isRequired,data:_propTypes2["default"].any,style:_propTypes2["default"].objectOf(_propTypes2["default"].oneOfType([_propTypes2["default"].number,_propTypes2["default"].object])).isRequired}))]).isRequired,children:_propTypes2["default"].func.isRequired,willEnter:_propTypes2["default"].func,willLeave:_propTypes2["default"].func,didLeave:_propTypes2["default"].func},getDefaultProps:function getDefaultProps(){return{willEnter:function willEnter(styleThatEntered){return _stripStyle2["default"](styleThatEntered.style)},willLeave:function willLeave(){return null},didLeave:function didLeave(){}}},getInitialState:function getInitialState(){var _props=this.props;var defaultStyles=_props.defaultStyles;var styles=_props.styles;var willEnter=_props.willEnter;var willLeave=_props.willLeave;var didLeave=_props.didLeave;var destStyles=typeof styles==="function"?styles(defaultStyles):styles;var oldMergedPropsStyles=undefined;if(defaultStyles==null){oldMergedPropsStyles=destStyles}else{oldMergedPropsStyles=defaultStyles.map(function(defaultStyleCell){for(var i=0;i<destStyles.length;i++){if(destStyles[i].key===defaultStyleCell.key){return destStyles[i]}}return defaultStyleCell})}var oldCurrentStyles=defaultStyles==null?destStyles.map(function(s){return _stripStyle2["default"](s.style)}):defaultStyles.map(function(s){return _stripStyle2["default"](s.style)});var oldCurrentVelocities=defaultStyles==null?destStyles.map(function(s){return _mapToZero2["default"](s.style)}):defaultStyles.map(function(s){return _mapToZero2["default"](s.style)});var _mergeAndSync=mergeAndSync(willEnter,willLeave,didLeave,oldMergedPropsStyles,destStyles,oldCurrentStyles,oldCurrentVelocities,oldCurrentStyles,oldCurrentVelocities);var mergedPropsStyles=_mergeAndSync[0];var currentStyles=_mergeAndSync[1];var currentVelocities=_mergeAndSync[2];var lastIdealStyles=_mergeAndSync[3];var lastIdealVelocities=_mergeAndSync[4];return{currentStyles:currentStyles,currentVelocities:currentVelocities,lastIdealStyles:lastIdealStyles,lastIdealVelocities:lastIdealVelocities,mergedPropsStyles:mergedPropsStyles}},unmounting:false,animationID:null,prevTime:0,accumulatedTime:0,unreadPropStyles:null,clearUnreadPropStyle:function clearUnreadPropStyle(unreadPropStyles){var _mergeAndSync2=mergeAndSync(this.props.willEnter,this.props.willLeave,this.props.didLeave,this.state.mergedPropsStyles,unreadPropStyles,this.state.currentStyles,this.state.currentVelocities,this.state.lastIdealStyles,this.state.lastIdealVelocities);var mergedPropsStyles=_mergeAndSync2[0];var currentStyles=_mergeAndSync2[1];var currentVelocities=_mergeAndSync2[2];var lastIdealStyles=_mergeAndSync2[3];var lastIdealVelocities=_mergeAndSync2[4];for(var i=0;i<unreadPropStyles.length;i++){var unreadPropStyle=unreadPropStyles[i].style;var dirty=false;for(var key in unreadPropStyle){if(!Object.prototype.hasOwnProperty.call(unreadPropStyle,key)){continue}var styleValue=unreadPropStyle[key];if(typeof styleValue==="number"){if(!dirty){dirty=true;currentStyles[i]=_extends({},currentStyles[i]);currentVelocities[i]=_extends({},currentVelocities[i]);lastIdealStyles[i]=_extends({},lastIdealStyles[i]);lastIdealVelocities[i]=_extends({},lastIdealVelocities[i]);mergedPropsStyles[i]={key:mergedPropsStyles[i].key,data:mergedPropsStyles[i].data,style:_extends({},mergedPropsStyles[i].style)}}currentStyles[i][key]=styleValue;currentVelocities[i][key]=0;lastIdealStyles[i][key]=styleValue;lastIdealVelocities[i][key]=0;mergedPropsStyles[i].style[key]=styleValue}}}this.setState({currentStyles:currentStyles,currentVelocities:currentVelocities,mergedPropsStyles:mergedPropsStyles,lastIdealStyles:lastIdealStyles,lastIdealVelocities:lastIdealVelocities})},startAnimationIfNecessary:function startAnimationIfNecessary(){var _this=this;if(this.unmounting){return}this.animationID=_raf2["default"](function(timestamp){if(_this.unmounting){return}var propStyles=_this.props.styles;var destStyles=typeof propStyles==="function"?propStyles(rehydrateStyles(_this.state.mergedPropsStyles,_this.unreadPropStyles,_this.state.lastIdealStyles)):propStyles;if(shouldStopAnimationAll(_this.state.currentStyles,destStyles,_this.state.currentVelocities,_this.state.mergedPropsStyles)){_this.animationID=null;_this.accumulatedTime=0;return}var currentTime=timestamp||_performanceNow2["default"]();var timeDelta=currentTime-_this.prevTime;_this.prevTime=currentTime;_this.accumulatedTime=_this.accumulatedTime+timeDelta;if(_this.accumulatedTime>msPerFrame*10){_this.accumulatedTime=0}if(_this.accumulatedTime===0){_this.animationID=null;_this.startAnimationIfNecessary();return}var currentFrameCompletion=(_this.accumulatedTime-Math.floor(_this.accumulatedTime/msPerFrame)*msPerFrame)/msPerFrame;var framesToCatchUp=Math.floor(_this.accumulatedTime/msPerFrame);var _mergeAndSync3=mergeAndSync(_this.props.willEnter,_this.props.willLeave,_this.props.didLeave,_this.state.mergedPropsStyles,destStyles,_this.state.currentStyles,_this.state.currentVelocities,_this.state.lastIdealStyles,_this.state.lastIdealVelocities);var newMergedPropsStyles=_mergeAndSync3[0];var newCurrentStyles=_mergeAndSync3[1];var newCurrentVelocities=_mergeAndSync3[2];var newLastIdealStyles=_mergeAndSync3[3];var newLastIdealVelocities=_mergeAndSync3[4];for(var i=0;i<newMergedPropsStyles.length;i++){var newMergedPropsStyle=newMergedPropsStyles[i].style;var newCurrentStyle={};var newCurrentVelocity={};var newLastIdealStyle={};var newLastIdealVelocity={};for(var key in newMergedPropsStyle){if(!Object.prototype.hasOwnProperty.call(newMergedPropsStyle,key)){continue}var styleValue=newMergedPropsStyle[key];if(typeof styleValue==="number"){newCurrentStyle[key]=styleValue;newCurrentVelocity[key]=0;newLastIdealStyle[key]=styleValue;newLastIdealVelocity[key]=0}else{var newLastIdealStyleValue=newLastIdealStyles[i][key];var newLastIdealVelocityValue=newLastIdealVelocities[i][key];for(var j=0;j<framesToCatchUp;j++){var _stepper=_stepper4["default"](msPerFrame/1e3,newLastIdealStyleValue,newLastIdealVelocityValue,styleValue.val,styleValue.stiffness,styleValue.damping,styleValue.precision);newLastIdealStyleValue=_stepper[0];newLastIdealVelocityValue=_stepper[1]}var _stepper2=_stepper4["default"](msPerFrame/1e3,newLastIdealStyleValue,newLastIdealVelocityValue,styleValue.val,styleValue.stiffness,styleValue.damping,styleValue.precision);var nextIdealX=_stepper2[0];var nextIdealV=_stepper2[1];newCurrentStyle[key]=newLastIdealStyleValue+(nextIdealX-newLastIdealStyleValue)*currentFrameCompletion;newCurrentVelocity[key]=newLastIdealVelocityValue+(nextIdealV-newLastIdealVelocityValue)*currentFrameCompletion;newLastIdealStyle[key]=newLastIdealStyleValue;newLastIdealVelocity[key]=newLastIdealVelocityValue}}newLastIdealStyles[i]=newLastIdealStyle;newLastIdealVelocities[i]=newLastIdealVelocity;newCurrentStyles[i]=newCurrentStyle;newCurrentVelocities[i]=newCurrentVelocity}_this.animationID=null;_this.accumulatedTime-=framesToCatchUp*msPerFrame;_this.setState({currentStyles:newCurrentStyles,currentVelocities:newCurrentVelocities,lastIdealStyles:newLastIdealStyles,lastIdealVelocities:newLastIdealVelocities,mergedPropsStyles:newMergedPropsStyles});_this.unreadPropStyles=null;_this.startAnimationIfNecessary()})},componentDidMount:function componentDidMount(){this.prevTime=_performanceNow2["default"]();this.startAnimationIfNecessary()},componentWillReceiveProps:function componentWillReceiveProps(props){if(this.unreadPropStyles){this.clearUnreadPropStyle(this.unreadPropStyles)}var styles=props.styles;if(typeof styles==="function"){this.unreadPropStyles=styles(rehydrateStyles(this.state.mergedPropsStyles,this.unreadPropStyles,this.state.lastIdealStyles))}else{this.unreadPropStyles=styles}if(this.animationID==null){this.prevTime=_performanceNow2["default"]();this.startAnimationIfNecessary()}},componentWillUnmount:function componentWillUnmount(){this.unmounting=true;if(this.animationID!=null){_raf2["default"].cancel(this.animationID);this.animationID=null}},render:function render(){var hydratedStyles=rehydrateStyles(this.state.mergedPropsStyles,this.unreadPropStyles,this.state.currentStyles);var renderedChildren=this.props.children(hydratedStyles);return renderedChildren&&_react2["default"].Children.only(renderedChildren)}});exports["default"]=TransitionMotion;module.exports=exports["default"]},{"./mapToZero":264,
"./mergeDiff":265,"./shouldStopAnimation":269,"./stepper":271,"./stripStyle":272,"create-react-class":5,"performance-now":251,"prop-types":257,raf:259,react:297}],264:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=mapToZero;function mapToZero(obj){var ret={};for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){ret[key]=0}}return ret}module.exports=exports["default"]},{}],265:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=mergeDiff;function mergeDiff(prev,next,onRemove){var prevKeyIndex={};for(var i=0;i<prev.length;i++){prevKeyIndex[prev[i].key]=i}var nextKeyIndex={};for(var i=0;i<next.length;i++){nextKeyIndex[next[i].key]=i}var ret=[];for(var i=0;i<next.length;i++){ret[i]=next[i]}for(var i=0;i<prev.length;i++){if(!Object.prototype.hasOwnProperty.call(nextKeyIndex,prev[i].key)){var fill=onRemove(i,prev[i]);if(fill!=null){ret.push(fill)}}}return ret.sort(function(a,b){var nextOrderA=nextKeyIndex[a.key];var nextOrderB=nextKeyIndex[b.key];var prevOrderA=prevKeyIndex[a.key];var prevOrderB=prevKeyIndex[b.key];if(nextOrderA!=null&&nextOrderB!=null){return nextKeyIndex[a.key]-nextKeyIndex[b.key]}else if(prevOrderA!=null&&prevOrderB!=null){return prevKeyIndex[a.key]-prevKeyIndex[b.key]}else if(nextOrderA!=null){for(var i=0;i<next.length;i++){var pivot=next[i].key;if(!Object.prototype.hasOwnProperty.call(prevKeyIndex,pivot)){continue}if(nextOrderA<nextKeyIndex[pivot]&&prevOrderB>prevKeyIndex[pivot]){return-1}else if(nextOrderA>nextKeyIndex[pivot]&&prevOrderB<prevKeyIndex[pivot]){return 1}}return 1}for(var i=0;i<next.length;i++){var pivot=next[i].key;if(!Object.prototype.hasOwnProperty.call(prevKeyIndex,pivot)){continue}if(nextOrderB<nextKeyIndex[pivot]&&prevOrderA>prevKeyIndex[pivot]){return 1}else if(nextOrderB>nextKeyIndex[pivot]&&prevOrderA<prevKeyIndex[pivot]){return-1}}return-1})}module.exports=exports["default"]},{}],266:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]={noWobble:{stiffness:170,damping:26},gentle:{stiffness:120,damping:14},wobbly:{stiffness:180,damping:12},stiff:{stiffness:210,damping:20}};module.exports=exports["default"]},{}],267:[function(require,module,exports){"use strict";exports.__esModule=true;function _interopRequire(obj){return obj&&obj.__esModule?obj["default"]:obj}var _Motion=require("./Motion");exports.Motion=_interopRequire(_Motion);var _StaggeredMotion=require("./StaggeredMotion");exports.StaggeredMotion=_interopRequire(_StaggeredMotion);var _TransitionMotion=require("./TransitionMotion");exports.TransitionMotion=_interopRequire(_TransitionMotion);var _spring=require("./spring");exports.spring=_interopRequire(_spring);var _presets=require("./presets");exports.presets=_interopRequire(_presets);var _stripStyle=require("./stripStyle");exports.stripStyle=_interopRequire(_stripStyle);var _reorderKeys=require("./reorderKeys");exports.reorderKeys=_interopRequire(_reorderKeys)},{"./Motion":261,"./StaggeredMotion":262,"./TransitionMotion":263,"./presets":266,"./reorderKeys":268,"./spring":270,"./stripStyle":272}],268:[function(require,module,exports){(function(process){"use strict";exports.__esModule=true;exports["default"]=reorderKeys;var hasWarned=false;function reorderKeys(){if(process.env.NODE_ENV==="development"){if(!hasWarned){hasWarned=true;console.error("`reorderKeys` has been removed, since it is no longer needed for TransitionMotion's new styles array API.")}}}module.exports=exports["default"]}).call(this,require("_process"))},{_process:252}],269:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=shouldStopAnimation;function shouldStopAnimation(currentStyle,style,currentVelocity){for(var key in style){if(!Object.prototype.hasOwnProperty.call(style,key)){continue}if(currentVelocity[key]!==0){return false}var styleValue=typeof style[key]==="number"?style[key]:style[key].val;if(currentStyle[key]!==styleValue){return false}}return true}module.exports=exports["default"]},{}],270:[function(require,module,exports){"use strict";exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports["default"]=spring;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _presets=require("./presets");var _presets2=_interopRequireDefault(_presets);var defaultConfig=_extends({},_presets2["default"].noWobble,{precision:.01});function spring(val,config){return _extends({},defaultConfig,config,{val:val})}module.exports=exports["default"]},{"./presets":266}],271:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=stepper;var reusedTuple=[0,0];function stepper(secondPerFrame,x,v,destX,k,b,precision){var Fspring=-k*(x-destX);var Fdamper=-b*v;var a=Fspring+Fdamper;var newV=v+a*secondPerFrame;var newX=x+newV*secondPerFrame;if(Math.abs(newV)<precision&&Math.abs(newX-destX)<precision){reusedTuple[0]=destX;reusedTuple[1]=0;return reusedTuple}reusedTuple[0]=newX;reusedTuple[1]=newV;return reusedTuple}module.exports=exports["default"]},{}],272:[function(require,module,exports){"use strict";exports.__esModule=true;exports["default"]=stripStyle;function stripStyle(style){var ret={};for(var key in style){if(!Object.prototype.hasOwnProperty.call(style,key)){continue}ret[key]=typeof style[key]==="number"?style[key]:style[key].val}return ret}module.exports=exports["default"]},{}],273:[function(require,module,exports){"use strict";function escape(key){var escapeRegex=/[=:]/g;var escaperLookup={"=":"=0",":":"=2"};var escapedString=(""+key).replace(escapeRegex,function(match){return escaperLookup[match]});return"$"+escapedString}function unescape(key){var unescapeRegex=/(=0|=2)/g;var unescaperLookup={"=0":"=","=2":":"};var keySubstring=key[0]==="."&&key[1]==="$"?key.substring(2):key.substring(1);return(""+keySubstring).replace(unescapeRegex,function(match){return unescaperLookup[match]})}var KeyEscapeUtils={escape:escape,unescape:unescape};module.exports=KeyEscapeUtils},{}],274:[function(require,module,exports){(function(process){"use strict";var _prodInvariant=require("./reactProdInvariant");var invariant=require("fbjs/lib/invariant");var oneArgumentPooler=function(copyFieldsFrom){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,copyFieldsFrom);return instance}else{return new Klass(copyFieldsFrom)}};var twoArgumentPooler=function(a1,a2){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2);return instance}else{return new Klass(a1,a2)}};var threeArgumentPooler=function(a1,a2,a3){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2,a3);return instance}else{return new Klass(a1,a2,a3)}};var fourArgumentPooler=function(a1,a2,a3,a4){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2,a3,a4);return instance}else{return new Klass(a1,a2,a3,a4)}};var standardReleaser=function(instance){var Klass=this;!(instance instanceof Klass)?process.env.NODE_ENV!=="production"?invariant(false,"Trying to release an instance into a pool of a different type."):_prodInvariant("25"):void 0;instance.destructor();if(Klass.instancePool.length<Klass.poolSize){Klass.instancePool.push(instance)}};var DEFAULT_POOL_SIZE=10;var DEFAULT_POOLER=oneArgumentPooler;var addPoolingTo=function(CopyConstructor,pooler){var NewKlass=CopyConstructor;NewKlass.instancePool=[];NewKlass.getPooled=pooler||DEFAULT_POOLER;if(!NewKlass.poolSize){NewKlass.poolSize=DEFAULT_POOL_SIZE}NewKlass.release=standardReleaser;return NewKlass};var PooledClass={addPoolingTo:addPoolingTo,oneArgumentPooler:oneArgumentPooler,twoArgumentPooler:twoArgumentPooler,threeArgumentPooler:threeArgumentPooler,fourArgumentPooler:fourArgumentPooler};module.exports=PooledClass}).call(this,require("_process"))},{"./reactProdInvariant":295,_process:252,"fbjs/lib/invariant":140}],275:[function(require,module,exports){(function(process){"use strict";var _assign=require("object-assign");var ReactChildren=require("./ReactChildren");var ReactComponent=require("./ReactComponent");var ReactPureComponent=require("./ReactPureComponent");var ReactClass=require("./ReactClass");var ReactDOMFactories=require("./ReactDOMFactories");var ReactElement=require("./ReactElement");var ReactPropTypes=require("./ReactPropTypes");var ReactVersion=require("./ReactVersion");var onlyChild=require("./onlyChild");var warning=require("fbjs/lib/warning");var createElement=ReactElement.createElement;var createFactory=ReactElement.createFactory;var cloneElement=ReactElement.cloneElement;if(process.env.NODE_ENV!=="production"){var canDefineProperty=require("./canDefineProperty");var ReactElementValidator=require("./ReactElementValidator");var didWarnPropTypesDeprecated=false;createElement=ReactElementValidator.createElement;createFactory=ReactElementValidator.createFactory;cloneElement=ReactElementValidator.cloneElement}var __spread=_assign;if(process.env.NODE_ENV!=="production"){var warned=false;__spread=function(){process.env.NODE_ENV!=="production"?warning(warned,"React.__spread is deprecated and should not be used. Use "+"Object.assign directly or another helper function with similar "+"semantics. You may be seeing this warning due to your compiler. "+"See https://fb.me/react-spread-deprecation for more details."):void 0;warned=true;return _assign.apply(null,arguments)}}var React={Children:{map:ReactChildren.map,forEach:ReactChildren.forEach,count:ReactChildren.count,toArray:ReactChildren.toArray,only:onlyChild},Component:ReactComponent,PureComponent:ReactPureComponent,createElement:createElement,cloneElement:cloneElement,isValidElement:ReactElement.isValidElement,PropTypes:ReactPropTypes,createClass:ReactClass.createClass,createFactory:createFactory,createMixin:function(mixin){return mixin},DOM:ReactDOMFactories,version:ReactVersion,__spread:__spread};if(process.env.NODE_ENV!=="production"){if(canDefineProperty){Object.defineProperty(React,"PropTypes",{get:function(){process.env.NODE_ENV!=="production"?warning(didWarnPropTypesDeprecated,"Accessing PropTypes via the main React package is deprecated. Use "+"the prop-types package from npm instead."):void 0;didWarnPropTypesDeprecated=true;return ReactPropTypes}})}}module.exports=React}).call(this,require("_process"))},{"./ReactChildren":276,"./ReactClass":277,"./ReactComponent":278,"./ReactDOMFactories":281,"./ReactElement":282,"./ReactElementValidator":284,"./ReactPropTypes":287,"./ReactPureComponent":289,"./ReactVersion":290,"./canDefineProperty":291,"./onlyChild":294,_process:252,"fbjs/lib/warning":142,"object-assign":249}],276:[function(require,module,exports){"use strict";var PooledClass=require("./PooledClass");var ReactElement=require("./ReactElement");var emptyFunction=require("fbjs/lib/emptyFunction");var traverseAllChildren=require("./traverseAllChildren");var twoArgumentPooler=PooledClass.twoArgumentPooler;var fourArgumentPooler=PooledClass.fourArgumentPooler;var userProvidedKeyEscapeRegex=/\/+/g;function escapeUserProvidedKey(text){return(""+text).replace(userProvidedKeyEscapeRegex,"$&/")}function ForEachBookKeeping(forEachFunction,forEachContext){this.func=forEachFunction;this.context=forEachContext;this.count=0}ForEachBookKeeping.prototype.destructor=function(){this.func=null;this.context=null;this.count=0};PooledClass.addPoolingTo(ForEachBookKeeping,twoArgumentPooler);function forEachSingleChild(bookKeeping,child,name){var func=bookKeeping.func,context=bookKeeping.context;func.call(context,child,bookKeeping.count++)}function forEachChildren(children,forEachFunc,forEachContext){if(children==null){return children}var traverseContext=ForEachBookKeeping.getPooled(forEachFunc,forEachContext);traverseAllChildren(children,forEachSingleChild,traverseContext);ForEachBookKeeping.release(traverseContext)}function MapBookKeeping(mapResult,keyPrefix,mapFunction,mapContext){this.result=mapResult;this.keyPrefix=keyPrefix;this.func=mapFunction;this.context=mapContext;this.count=0}MapBookKeeping.prototype.destructor=function(){this.result=null;this.keyPrefix=null;this.func=null;this.context=null;this.count=0};PooledClass.addPoolingTo(MapBookKeeping,fourArgumentPooler);function mapSingleChildIntoContext(bookKeeping,child,childKey){var result=bookKeeping.result,keyPrefix=bookKeeping.keyPrefix,func=bookKeeping.func,context=bookKeeping.context;var mappedChild=func.call(context,child,bookKeeping.count++);if(Array.isArray(mappedChild)){mapIntoWithKeyPrefixInternal(mappedChild,result,childKey,emptyFunction.thatReturnsArgument)}else if(mappedChild!=null){if(ReactElement.isValidElement(mappedChild)){mappedChild=ReactElement.cloneAndReplaceKey(mappedChild,keyPrefix+(mappedChild.key&&(!child||child.key!==mappedChild.key)?escapeUserProvidedKey(mappedChild.key)+"/":"")+childKey)}result.push(mappedChild)}}function mapIntoWithKeyPrefixInternal(children,array,prefix,func,context){var escapedPrefix="";if(prefix!=null){escapedPrefix=escapeUserProvidedKey(prefix)+"/"}var traverseContext=MapBookKeeping.getPooled(array,escapedPrefix,func,context);traverseAllChildren(children,mapSingleChildIntoContext,traverseContext);MapBookKeeping.release(traverseContext)}function mapChildren(children,func,context){if(children==null){return children}var result=[];mapIntoWithKeyPrefixInternal(children,result,null,func,context);return result}function forEachSingleChildDummy(traverseContext,child,name){return null}function countChildren(children,context){return traverseAllChildren(children,forEachSingleChildDummy,null)}function toArray(children){var result=[];mapIntoWithKeyPrefixInternal(children,result,null,emptyFunction.thatReturnsArgument);return result}var ReactChildren={forEach:forEachChildren,map:mapChildren,mapIntoWithKeyPrefixInternal:mapIntoWithKeyPrefixInternal,count:countChildren,toArray:toArray};module.exports=ReactChildren},{"./PooledClass":274,"./ReactElement":282,"./traverseAllChildren":296,"fbjs/lib/emptyFunction":138}],277:[function(require,module,exports){(function(process){"use strict";var _prodInvariant=require("./reactProdInvariant"),_assign=require("object-assign");var ReactComponent=require("./ReactComponent");var ReactElement=require("./ReactElement");var ReactPropTypeLocationNames=require("./ReactPropTypeLocationNames");var ReactNoopUpdateQueue=require("./ReactNoopUpdateQueue");var emptyObject=require("fbjs/lib/emptyObject");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var MIXINS_KEY="mixins";function identity(fn){return fn}var injectedMixins=[];var ReactClassInterface={mixins:"DEFINE_MANY",statics:"DEFINE_MANY",propTypes:"DEFINE_MANY",contextTypes:"DEFINE_MANY",childContextTypes:"DEFINE_MANY",getDefaultProps:"DEFINE_MANY_MERGED",getInitialState:"DEFINE_MANY_MERGED",getChildContext:"DEFINE_MANY_MERGED",render:"DEFINE_ONCE",componentWillMount:"DEFINE_MANY",componentDidMount:"DEFINE_MANY",componentWillReceiveProps:"DEFINE_MANY",shouldComponentUpdate:"DEFINE_ONCE",componentWillUpdate:"DEFINE_MANY",componentDidUpdate:"DEFINE_MANY",componentWillUnmount:"DEFINE_MANY",updateComponent:"OVERRIDE_BASE"};var RESERVED_SPEC_KEYS={displayName:function(Constructor,displayName){Constructor.displayName=displayName},mixins:function(Constructor,mixins){if(mixins){for(var i=0;i<mixins.length;i++){mixSpecIntoComponent(Constructor,mixins[i])}}},childContextTypes:function(Constructor,childContextTypes){if(process.env.NODE_ENV!=="production"){validateTypeDef(Constructor,childContextTypes,"childContext")}Constructor.childContextTypes=_assign({},Constructor.childContextTypes,childContextTypes)},contextTypes:function(Constructor,contextTypes){if(process.env.NODE_ENV!=="production"){validateTypeDef(Constructor,contextTypes,"context")}Constructor.contextTypes=_assign({},Constructor.contextTypes,contextTypes)},getDefaultProps:function(Constructor,getDefaultProps){if(Constructor.getDefaultProps){Constructor.getDefaultProps=createMergedResultFunction(Constructor.getDefaultProps,getDefaultProps)}else{Constructor.getDefaultProps=getDefaultProps}},propTypes:function(Constructor,propTypes){if(process.env.NODE_ENV!=="production"){validateTypeDef(Constructor,propTypes,"prop")}Constructor.propTypes=_assign({},Constructor.propTypes,propTypes)},statics:function(Constructor,statics){mixStaticSpecIntoComponent(Constructor,statics)},autobind:function(){}};function validateTypeDef(Constructor,typeDef,location){for(var propName in typeDef){if(typeDef.hasOwnProperty(propName)){process.env.NODE_ENV!=="production"?warning(typeof typeDef[propName]==="function","%s: %s type `%s` is invalid; it must be a function, usually from "+"React.PropTypes.",Constructor.displayName||"ReactClass",ReactPropTypeLocationNames[location],propName):void 0}}}function validateMethodOverride(isAlreadyDefined,name){var specPolicy=ReactClassInterface.hasOwnProperty(name)?ReactClassInterface[name]:null;if(ReactClassMixin.hasOwnProperty(name)){!(specPolicy==="OVERRIDE_BASE")?process.env.NODE_ENV!=="production"?invariant(false,"ReactClassInterface: You are attempting to override `%s` from your class specification. Ensure that your method names do not overlap with React methods.",name):_prodInvariant("73",name):void 0}if(isAlreadyDefined){!(specPolicy==="DEFINE_MANY"||specPolicy==="DEFINE_MANY_MERGED")?process.env.NODE_ENV!=="production"?invariant(false,"ReactClassInterface: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",name):_prodInvariant("74",name):void 0}}function mixSpecIntoComponent(Constructor,spec){if(!spec){if(process.env.NODE_ENV!=="production"){var typeofSpec=typeof spec;var isMixinValid=typeofSpec==="object"&&spec!==null;process.env.NODE_ENV!=="production"?warning(isMixinValid,"%s: You're attempting to include a mixin that is either null "+"or not an object. Check the mixins included by the component, "+"as well as any mixins they include themselves. "+"Expected object but got %s.",Constructor.displayName||"ReactClass",spec===null?null:typeofSpec):void 0}return}!(typeof spec!=="function")?process.env.NODE_ENV!=="production"?invariant(false,"ReactClass: You're attempting to use a component class or function as a mixin. Instead, just use a regular object."):_prodInvariant("75"):void 0;!!ReactElement.isValidElement(spec)?process.env.NODE_ENV!=="production"?invariant(false,"ReactClass: You're attempting to use a component as a mixin. Instead, just use a regular object."):_prodInvariant("76"):void 0;var proto=Constructor.prototype;var autoBindPairs=proto.__reactAutoBindPairs;if(spec.hasOwnProperty(MIXINS_KEY)){RESERVED_SPEC_KEYS.mixins(Constructor,spec.mixins)}for(var name in spec){if(!spec.hasOwnProperty(name)){continue}if(name===MIXINS_KEY){continue}var property=spec[name];var isAlreadyDefined=proto.hasOwnProperty(name);validateMethodOverride(isAlreadyDefined,name);if(RESERVED_SPEC_KEYS.hasOwnProperty(name)){RESERVED_SPEC_KEYS[name](Constructor,property)}else{var isReactClassMethod=ReactClassInterface.hasOwnProperty(name);var isFunction=typeof property==="function";var shouldAutoBind=isFunction&&!isReactClassMethod&&!isAlreadyDefined&&spec.autobind!==false;if(shouldAutoBind){autoBindPairs.push(name,property);proto[name]=property}else{if(isAlreadyDefined){var specPolicy=ReactClassInterface[name];!(isReactClassMethod&&(specPolicy==="DEFINE_MANY_MERGED"||specPolicy==="DEFINE_MANY"))?process.env.NODE_ENV!=="production"?invariant(false,"ReactClass: Unexpected spec policy %s for key %s when mixing in component specs.",specPolicy,name):_prodInvariant("77",specPolicy,name):void 0;if(specPolicy==="DEFINE_MANY_MERGED"){proto[name]=createMergedResultFunction(proto[name],property)}else if(specPolicy==="DEFINE_MANY"){proto[name]=createChainedFunction(proto[name],property)}}else{proto[name]=property;if(process.env.NODE_ENV!=="production"){if(typeof property==="function"&&spec.displayName){proto[name].displayName=spec.displayName+"_"+name}}}}}}}function mixStaticSpecIntoComponent(Constructor,statics){if(!statics){return}for(var name in statics){var property=statics[name];if(!statics.hasOwnProperty(name)){continue}var isReserved=name in RESERVED_SPEC_KEYS;!!isReserved?process.env.NODE_ENV!=="production"?invariant(false,'ReactClass: You are attempting to define a reserved property, `%s`, that shouldn\'t be on the "statics" key. Define it as an instance property instead; it will still be accessible on the constructor.',name):_prodInvariant("78",name):void 0;var isInherited=name in Constructor;!!isInherited?process.env.NODE_ENV!=="production"?invariant(false,"ReactClass: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",name):_prodInvariant("79",name):void 0;Constructor[name]=property}}function mergeIntoWithNoDuplicateKeys(one,two){!(one&&two&&typeof one==="object"&&typeof two==="object")?process.env.NODE_ENV!=="production"?invariant(false,"mergeIntoWithNoDuplicateKeys(): Cannot merge non-objects."):_prodInvariant("80"):void 0;for(var key in two){if(two.hasOwnProperty(key)){!(one[key]===undefined)?process.env.NODE_ENV!=="production"?invariant(false,"mergeIntoWithNoDuplicateKeys(): Tried to merge two objects with the same key: `%s`. This conflict may be due to a mixin; in particular, this may be caused by two getInitialState() or getDefaultProps() methods returning objects with clashing keys.",key):_prodInvariant("81",key):void 0;one[key]=two[key]}}return one}function createMergedResultFunction(one,two){return function mergedResult(){var a=one.apply(this,arguments);var b=two.apply(this,arguments);if(a==null){return b}else if(b==null){return a}var c={};mergeIntoWithNoDuplicateKeys(c,a);mergeIntoWithNoDuplicateKeys(c,b);return c}}function createChainedFunction(one,two){return function chainedFunction(){one.apply(this,arguments);two.apply(this,arguments)}}function bindAutoBindMethod(component,method){var boundMethod=method.bind(component);if(process.env.NODE_ENV!=="production"){boundMethod.__reactBoundContext=component;boundMethod.__reactBoundMethod=method;boundMethod.__reactBoundArguments=null;var componentName=component.constructor.displayName;var _bind=boundMethod.bind;boundMethod.bind=function(newThis){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}if(newThis!==component&&newThis!==null){process.env.NODE_ENV!=="production"?warning(false,"bind(): React component methods may only be bound to the "+"component instance. See %s",componentName):void 0}else if(!args.length){process.env.NODE_ENV!=="production"?warning(false,"bind(): You are binding a component method to the component. "+"React does this for you automatically in a high-performance "+"way, so you can safely remove this call. See %s",componentName):void 0;return boundMethod}var reboundMethod=_bind.apply(boundMethod,arguments);reboundMethod.__reactBoundContext=component;reboundMethod.__reactBoundMethod=method;reboundMethod.__reactBoundArguments=args;return reboundMethod}}return boundMethod}function bindAutoBindMethods(component){var pairs=component.__reactAutoBindPairs;for(var i=0;i<pairs.length;i+=2){var autoBindKey=pairs[i];var method=pairs[i+1];component[autoBindKey]=bindAutoBindMethod(component,method)}}var ReactClassMixin={replaceState:function(newState,callback){this.updater.enqueueReplaceState(this,newState);if(callback){this.updater.enqueueCallback(this,callback,"replaceState")}},isMounted:function(){return this.updater.isMounted(this)}};var ReactClassComponent=function(){};_assign(ReactClassComponent.prototype,ReactComponent.prototype,ReactClassMixin);var didWarnDeprecated=false;var ReactClass={createClass:function(spec){if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(didWarnDeprecated,"%s: React.createClass is deprecated and will be removed in version 16. "+"Use plain JavaScript classes instead. If you're not yet ready to "+"migrate, create-react-class is available on npm as a "+"drop-in replacement.",spec&&spec.displayName||"A Component"):void 0;didWarnDeprecated=true}var Constructor=identity(function(props,context,updater){if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(this instanceof Constructor,"Something is calling a React component directly. Use a factory or "+"JSX instead. See: https://fb.me/react-legacyfactory"):void 0}if(this.__reactAutoBindPairs.length){bindAutoBindMethods(this)}this.props=props;this.context=context;this.refs=emptyObject;this.updater=updater||ReactNoopUpdateQueue;this.state=null;var initialState=this.getInitialState?this.getInitialState():null;if(process.env.NODE_ENV!=="production"){if(initialState===undefined&&this.getInitialState._isMockFunction){initialState=null}}!(typeof initialState==="object"&&!Array.isArray(initialState))?process.env.NODE_ENV!=="production"?invariant(false,"%s.getInitialState(): must return an object or null",Constructor.displayName||"ReactCompositeComponent"):_prodInvariant("82",Constructor.displayName||"ReactCompositeComponent"):void 0;this.state=initialState});Constructor.prototype=new ReactClassComponent;Constructor.prototype.constructor=Constructor;Constructor.prototype.__reactAutoBindPairs=[];injectedMixins.forEach(mixSpecIntoComponent.bind(null,Constructor));mixSpecIntoComponent(Constructor,spec);if(Constructor.getDefaultProps){Constructor.defaultProps=Constructor.getDefaultProps()}if(process.env.NODE_ENV!=="production"){if(Constructor.getDefaultProps){Constructor.getDefaultProps.isReactClassApproved={}}if(Constructor.prototype.getInitialState){Constructor.prototype.getInitialState.isReactClassApproved={}}}!Constructor.prototype.render?process.env.NODE_ENV!=="production"?invariant(false,"createClass(...): Class specification must implement a `render` method."):_prodInvariant("83"):void 0;if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(!Constructor.prototype.componentShouldUpdate,"%s has a method called "+"componentShouldUpdate(). Did you mean shouldComponentUpdate()? "+"The name is phrased as a question because the function is "+"expected to return a value.",spec.displayName||"A component"):void 0;process.env.NODE_ENV!=="production"?warning(!Constructor.prototype.componentWillRecieveProps,"%s has a method called "+"componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",spec.displayName||"A component"):void 0}for(var methodName in ReactClassInterface){if(!Constructor.prototype[methodName]){Constructor.prototype[methodName]=null}}return Constructor},injection:{injectMixin:function(mixin){injectedMixins.push(mixin)}}};module.exports=ReactClass}).call(this,require("_process"))},{"./ReactComponent":278,"./ReactElement":282,"./ReactNoopUpdateQueue":285,"./ReactPropTypeLocationNames":286,"./reactProdInvariant":295,_process:252,"fbjs/lib/emptyObject":139,"fbjs/lib/invariant":140,"fbjs/lib/warning":142,"object-assign":249}],278:[function(require,module,exports){(function(process){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactNoopUpdateQueue=require("./ReactNoopUpdateQueue");var canDefineProperty=require("./canDefineProperty");var emptyObject=require("fbjs/lib/emptyObject");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");function ReactComponent(props,context,updater){this.props=props;this.context=context;this.refs=emptyObject;this.updater=updater||ReactNoopUpdateQueue}ReactComponent.prototype.isReactComponent={};ReactComponent.prototype.setState=function(partialState,callback){!(typeof partialState==="object"||typeof partialState==="function"||partialState==null)?process.env.NODE_ENV!=="production"?invariant(false,"setState(...): takes an object of state variables to update or a function which returns an object of state variables."):_prodInvariant("85"):void 0;this.updater.enqueueSetState(this,partialState);if(callback){this.updater.enqueueCallback(this,callback,"setState")}};ReactComponent.prototype.forceUpdate=function(callback){this.updater.enqueueForceUpdate(this);if(callback){this.updater.enqueueCallback(this,callback,"forceUpdate")}};if(process.env.NODE_ENV!=="production"){var deprecatedAPIs={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in "+"componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see "+"https://github.com/facebook/react/issues/3236)."]};var defineDeprecationWarning=function(methodName,info){if(canDefineProperty){Object.defineProperty(ReactComponent.prototype,methodName,{get:function(){process.env.NODE_ENV!=="production"?warning(false,"%s(...) is deprecated in plain JavaScript React classes. %s",info[0],info[1]):void 0;return undefined}})}};for(var fnName in deprecatedAPIs){if(deprecatedAPIs.hasOwnProperty(fnName)){defineDeprecationWarning(fnName,deprecatedAPIs[fnName])}}}module.exports=ReactComponent}).call(this,require("_process"))},{"./ReactNoopUpdateQueue":285,"./canDefineProperty":291,"./reactProdInvariant":295,_process:252,"fbjs/lib/emptyObject":139,"fbjs/lib/invariant":140,"fbjs/lib/warning":142}],279:[function(require,module,exports){(function(process){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactCurrentOwner=require("./ReactCurrentOwner");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");function isNative(fn){var funcToString=Function.prototype.toString;var hasOwnProperty=Object.prototype.hasOwnProperty;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");try{var source=funcToString.call(fn);return reIsNative.test(source)}catch(err){return false}}var canUseCollections=typeof Array.from==="function"&&typeof Map==="function"&&isNative(Map)&&Map.prototype!=null&&typeof Map.prototype.keys==="function"&&isNative(Map.prototype.keys)&&typeof Set==="function"&&isNative(Set)&&Set.prototype!=null&&typeof Set.prototype.keys==="function"&&isNative(Set.prototype.keys);var setItem;var getItem;var removeItem;var getItemIDs;var addRoot;var removeRoot;var getRootIDs;if(canUseCollections){var itemMap=new Map;var rootIDSet=new Set;setItem=function(id,item){itemMap.set(id,item)};getItem=function(id){return itemMap.get(id)};removeItem=function(id){itemMap["delete"](id)};getItemIDs=function(){return Array.from(itemMap.keys())};addRoot=function(id){rootIDSet.add(id)};removeRoot=function(id){rootIDSet["delete"](id)};getRootIDs=function(){return Array.from(rootIDSet.keys())}}else{var itemByKey={};var rootByKey={};var getKeyFromID=function(id){return"."+id};var getIDFromKey=function(key){return parseInt(key.substr(1),10)};setItem=function(id,item){var key=getKeyFromID(id);itemByKey[key]=item};getItem=function(id){var key=getKeyFromID(id);return itemByKey[key]};removeItem=function(id){var key=getKeyFromID(id);delete itemByKey[key]};getItemIDs=function(){return Object.keys(itemByKey).map(getIDFromKey)};addRoot=function(id){var key=getKeyFromID(id);rootByKey[key]=true};removeRoot=function(id){var key=getKeyFromID(id);delete rootByKey[key]};getRootIDs=function(){return Object.keys(rootByKey).map(getIDFromKey)}}var unmountedIDs=[];function purgeDeep(id){var item=getItem(id);if(item){var childIDs=item.childIDs;removeItem(id);childIDs.forEach(purgeDeep)}}function describeComponentFrame(name,source,ownerName){return"\n    in "+(name||"Unknown")+(source?" (at "+source.fileName.replace(/^.*[\\\/]/,"")+":"+source.lineNumber+")":ownerName?" (created by "+ownerName+")":"")}function getDisplayName(element){if(element==null){return"#empty"}else if(typeof element==="string"||typeof element==="number"){return"#text"
}else if(typeof element.type==="string"){return element.type}else{return element.type.displayName||element.type.name||"Unknown"}}function describeID(id){var name=ReactComponentTreeHook.getDisplayName(id);var element=ReactComponentTreeHook.getElement(id);var ownerID=ReactComponentTreeHook.getOwnerID(id);var ownerName;if(ownerID){ownerName=ReactComponentTreeHook.getDisplayName(ownerID)}process.env.NODE_ENV!=="production"?warning(element,"ReactComponentTreeHook: Missing React element for debugID %s when "+"building stack",id):void 0;return describeComponentFrame(name,element&&element._source,ownerName)}var ReactComponentTreeHook={onSetChildren:function(id,nextChildIDs){var item=getItem(id);!item?process.env.NODE_ENV!=="production"?invariant(false,"Item must have been set"):_prodInvariant("144"):void 0;item.childIDs=nextChildIDs;for(var i=0;i<nextChildIDs.length;i++){var nextChildID=nextChildIDs[i];var nextChild=getItem(nextChildID);!nextChild?process.env.NODE_ENV!=="production"?invariant(false,"Expected hook events to fire for the child before its parent includes it in onSetChildren()."):_prodInvariant("140"):void 0;!(nextChild.childIDs!=null||typeof nextChild.element!=="object"||nextChild.element==null)?process.env.NODE_ENV!=="production"?invariant(false,"Expected onSetChildren() to fire for a container child before its parent includes it in onSetChildren()."):_prodInvariant("141"):void 0;!nextChild.isMounted?process.env.NODE_ENV!=="production"?invariant(false,"Expected onMountComponent() to fire for the child before its parent includes it in onSetChildren()."):_prodInvariant("71"):void 0;if(nextChild.parentID==null){nextChild.parentID=id}!(nextChild.parentID===id)?process.env.NODE_ENV!=="production"?invariant(false,"Expected onBeforeMountComponent() parent and onSetChildren() to be consistent (%s has parents %s and %s).",nextChildID,nextChild.parentID,id):_prodInvariant("142",nextChildID,nextChild.parentID,id):void 0}},onBeforeMountComponent:function(id,element,parentID){var item={element:element,parentID:parentID,text:null,childIDs:[],isMounted:false,updateCount:0};setItem(id,item)},onBeforeUpdateComponent:function(id,element){var item=getItem(id);if(!item||!item.isMounted){return}item.element=element},onMountComponent:function(id){var item=getItem(id);!item?process.env.NODE_ENV!=="production"?invariant(false,"Item must have been set"):_prodInvariant("144"):void 0;item.isMounted=true;var isRoot=item.parentID===0;if(isRoot){addRoot(id)}},onUpdateComponent:function(id){var item=getItem(id);if(!item||!item.isMounted){return}item.updateCount++},onUnmountComponent:function(id){var item=getItem(id);if(item){item.isMounted=false;var isRoot=item.parentID===0;if(isRoot){removeRoot(id)}}unmountedIDs.push(id)},purgeUnmountedComponents:function(){if(ReactComponentTreeHook._preventPurging){return}for(var i=0;i<unmountedIDs.length;i++){var id=unmountedIDs[i];purgeDeep(id)}unmountedIDs.length=0},isMounted:function(id){var item=getItem(id);return item?item.isMounted:false},getCurrentStackAddendum:function(topElement){var info="";if(topElement){var name=getDisplayName(topElement);var owner=topElement._owner;info+=describeComponentFrame(name,topElement._source,owner&&owner.getName())}var currentOwner=ReactCurrentOwner.current;var id=currentOwner&&currentOwner._debugID;info+=ReactComponentTreeHook.getStackAddendumByID(id);return info},getStackAddendumByID:function(id){var info="";while(id){info+=describeID(id);id=ReactComponentTreeHook.getParentID(id)}return info},getChildIDs:function(id){var item=getItem(id);return item?item.childIDs:[]},getDisplayName:function(id){var element=ReactComponentTreeHook.getElement(id);if(!element){return null}return getDisplayName(element)},getElement:function(id){var item=getItem(id);return item?item.element:null},getOwnerID:function(id){var element=ReactComponentTreeHook.getElement(id);if(!element||!element._owner){return null}return element._owner._debugID},getParentID:function(id){var item=getItem(id);return item?item.parentID:null},getSource:function(id){var item=getItem(id);var element=item?item.element:null;var source=element!=null?element._source:null;return source},getText:function(id){var element=ReactComponentTreeHook.getElement(id);if(typeof element==="string"){return element}else if(typeof element==="number"){return""+element}else{return null}},getUpdateCount:function(id){var item=getItem(id);return item?item.updateCount:0},getRootIDs:getRootIDs,getRegisteredIDs:getItemIDs};module.exports=ReactComponentTreeHook}).call(this,require("_process"))},{"./ReactCurrentOwner":280,"./reactProdInvariant":295,_process:252,"fbjs/lib/invariant":140,"fbjs/lib/warning":142}],280:[function(require,module,exports){"use strict";var ReactCurrentOwner={current:null};module.exports=ReactCurrentOwner},{}],281:[function(require,module,exports){(function(process){"use strict";var ReactElement=require("./ReactElement");var createDOMFactory=ReactElement.createFactory;if(process.env.NODE_ENV!=="production"){var ReactElementValidator=require("./ReactElementValidator");createDOMFactory=ReactElementValidator.createFactory}var ReactDOMFactories={a:createDOMFactory("a"),abbr:createDOMFactory("abbr"),address:createDOMFactory("address"),area:createDOMFactory("area"),article:createDOMFactory("article"),aside:createDOMFactory("aside"),audio:createDOMFactory("audio"),b:createDOMFactory("b"),base:createDOMFactory("base"),bdi:createDOMFactory("bdi"),bdo:createDOMFactory("bdo"),big:createDOMFactory("big"),blockquote:createDOMFactory("blockquote"),body:createDOMFactory("body"),br:createDOMFactory("br"),button:createDOMFactory("button"),canvas:createDOMFactory("canvas"),caption:createDOMFactory("caption"),cite:createDOMFactory("cite"),code:createDOMFactory("code"),col:createDOMFactory("col"),colgroup:createDOMFactory("colgroup"),data:createDOMFactory("data"),datalist:createDOMFactory("datalist"),dd:createDOMFactory("dd"),del:createDOMFactory("del"),details:createDOMFactory("details"),dfn:createDOMFactory("dfn"),dialog:createDOMFactory("dialog"),div:createDOMFactory("div"),dl:createDOMFactory("dl"),dt:createDOMFactory("dt"),em:createDOMFactory("em"),embed:createDOMFactory("embed"),fieldset:createDOMFactory("fieldset"),figcaption:createDOMFactory("figcaption"),figure:createDOMFactory("figure"),footer:createDOMFactory("footer"),form:createDOMFactory("form"),h1:createDOMFactory("h1"),h2:createDOMFactory("h2"),h3:createDOMFactory("h3"),h4:createDOMFactory("h4"),h5:createDOMFactory("h5"),h6:createDOMFactory("h6"),head:createDOMFactory("head"),header:createDOMFactory("header"),hgroup:createDOMFactory("hgroup"),hr:createDOMFactory("hr"),html:createDOMFactory("html"),i:createDOMFactory("i"),iframe:createDOMFactory("iframe"),img:createDOMFactory("img"),input:createDOMFactory("input"),ins:createDOMFactory("ins"),kbd:createDOMFactory("kbd"),keygen:createDOMFactory("keygen"),label:createDOMFactory("label"),legend:createDOMFactory("legend"),li:createDOMFactory("li"),link:createDOMFactory("link"),main:createDOMFactory("main"),map:createDOMFactory("map"),mark:createDOMFactory("mark"),menu:createDOMFactory("menu"),menuitem:createDOMFactory("menuitem"),meta:createDOMFactory("meta"),meter:createDOMFactory("meter"),nav:createDOMFactory("nav"),noscript:createDOMFactory("noscript"),object:createDOMFactory("object"),ol:createDOMFactory("ol"),optgroup:createDOMFactory("optgroup"),option:createDOMFactory("option"),output:createDOMFactory("output"),p:createDOMFactory("p"),param:createDOMFactory("param"),picture:createDOMFactory("picture"),pre:createDOMFactory("pre"),progress:createDOMFactory("progress"),q:createDOMFactory("q"),rp:createDOMFactory("rp"),rt:createDOMFactory("rt"),ruby:createDOMFactory("ruby"),s:createDOMFactory("s"),samp:createDOMFactory("samp"),script:createDOMFactory("script"),section:createDOMFactory("section"),select:createDOMFactory("select"),small:createDOMFactory("small"),source:createDOMFactory("source"),span:createDOMFactory("span"),strong:createDOMFactory("strong"),style:createDOMFactory("style"),sub:createDOMFactory("sub"),summary:createDOMFactory("summary"),sup:createDOMFactory("sup"),table:createDOMFactory("table"),tbody:createDOMFactory("tbody"),td:createDOMFactory("td"),textarea:createDOMFactory("textarea"),tfoot:createDOMFactory("tfoot"),th:createDOMFactory("th"),thead:createDOMFactory("thead"),time:createDOMFactory("time"),title:createDOMFactory("title"),tr:createDOMFactory("tr"),track:createDOMFactory("track"),u:createDOMFactory("u"),ul:createDOMFactory("ul"),var:createDOMFactory("var"),video:createDOMFactory("video"),wbr:createDOMFactory("wbr"),circle:createDOMFactory("circle"),clipPath:createDOMFactory("clipPath"),defs:createDOMFactory("defs"),ellipse:createDOMFactory("ellipse"),g:createDOMFactory("g"),image:createDOMFactory("image"),line:createDOMFactory("line"),linearGradient:createDOMFactory("linearGradient"),mask:createDOMFactory("mask"),path:createDOMFactory("path"),pattern:createDOMFactory("pattern"),polygon:createDOMFactory("polygon"),polyline:createDOMFactory("polyline"),radialGradient:createDOMFactory("radialGradient"),rect:createDOMFactory("rect"),stop:createDOMFactory("stop"),svg:createDOMFactory("svg"),text:createDOMFactory("text"),tspan:createDOMFactory("tspan")};module.exports=ReactDOMFactories}).call(this,require("_process"))},{"./ReactElement":282,"./ReactElementValidator":284,_process:252}],282:[function(require,module,exports){(function(process){"use strict";var _assign=require("object-assign");var ReactCurrentOwner=require("./ReactCurrentOwner");var warning=require("fbjs/lib/warning");var canDefineProperty=require("./canDefineProperty");var hasOwnProperty=Object.prototype.hasOwnProperty;var REACT_ELEMENT_TYPE=require("./ReactElementSymbol");var RESERVED_PROPS={key:true,ref:true,__self:true,__source:true};var specialPropKeyWarningShown,specialPropRefWarningShown;function hasValidRef(config){if(process.env.NODE_ENV!=="production"){if(hasOwnProperty.call(config,"ref")){var getter=Object.getOwnPropertyDescriptor(config,"ref").get;if(getter&&getter.isReactWarning){return false}}}return config.ref!==undefined}function hasValidKey(config){if(process.env.NODE_ENV!=="production"){if(hasOwnProperty.call(config,"key")){var getter=Object.getOwnPropertyDescriptor(config,"key").get;if(getter&&getter.isReactWarning){return false}}}return config.key!==undefined}function defineKeyPropWarningGetter(props,displayName){var warnAboutAccessingKey=function(){if(!specialPropKeyWarningShown){specialPropKeyWarningShown=true;process.env.NODE_ENV!=="production"?warning(false,"%s: `key` is not a prop. Trying to access it will result "+"in `undefined` being returned. If you need to access the same "+"value within the child component, you should pass it as a different "+"prop. (https://fb.me/react-special-props)",displayName):void 0}};warnAboutAccessingKey.isReactWarning=true;Object.defineProperty(props,"key",{get:warnAboutAccessingKey,configurable:true})}function defineRefPropWarningGetter(props,displayName){var warnAboutAccessingRef=function(){if(!specialPropRefWarningShown){specialPropRefWarningShown=true;process.env.NODE_ENV!=="production"?warning(false,"%s: `ref` is not a prop. Trying to access it will result "+"in `undefined` being returned. If you need to access the same "+"value within the child component, you should pass it as a different "+"prop. (https://fb.me/react-special-props)",displayName):void 0}};warnAboutAccessingRef.isReactWarning=true;Object.defineProperty(props,"ref",{get:warnAboutAccessingRef,configurable:true})}var ReactElement=function(type,key,ref,self,source,owner,props){var element={$$typeof:REACT_ELEMENT_TYPE,type:type,key:key,ref:ref,props:props,_owner:owner};if(process.env.NODE_ENV!=="production"){element._store={};if(canDefineProperty){Object.defineProperty(element._store,"validated",{configurable:false,enumerable:false,writable:true,value:false});Object.defineProperty(element,"_self",{configurable:false,enumerable:false,writable:false,value:self});Object.defineProperty(element,"_source",{configurable:false,enumerable:false,writable:false,value:source})}else{element._store.validated=false;element._self=self;element._source=source}if(Object.freeze){Object.freeze(element.props);Object.freeze(element)}}return element};ReactElement.createElement=function(type,config,children){var propName;var props={};var key=null;var ref=null;var self=null;var source=null;if(config!=null){if(hasValidRef(config)){ref=config.ref}if(hasValidKey(config)){key=""+config.key}self=config.__self===undefined?null:config.__self;source=config.__source===undefined?null:config.__source;for(propName in config){if(hasOwnProperty.call(config,propName)&&!RESERVED_PROPS.hasOwnProperty(propName)){props[propName]=config[propName]}}}var childrenLength=arguments.length-2;if(childrenLength===1){props.children=children}else if(childrenLength>1){var childArray=Array(childrenLength);for(var i=0;i<childrenLength;i++){childArray[i]=arguments[i+2]}if(process.env.NODE_ENV!=="production"){if(Object.freeze){Object.freeze(childArray)}}props.children=childArray}if(type&&type.defaultProps){var defaultProps=type.defaultProps;for(propName in defaultProps){if(props[propName]===undefined){props[propName]=defaultProps[propName]}}}if(process.env.NODE_ENV!=="production"){if(key||ref){if(typeof props.$$typeof==="undefined"||props.$$typeof!==REACT_ELEMENT_TYPE){var displayName=typeof type==="function"?type.displayName||type.name||"Unknown":type;if(key){defineKeyPropWarningGetter(props,displayName)}if(ref){defineRefPropWarningGetter(props,displayName)}}}}return ReactElement(type,key,ref,self,source,ReactCurrentOwner.current,props)};ReactElement.createFactory=function(type){var factory=ReactElement.createElement.bind(null,type);factory.type=type;return factory};ReactElement.cloneAndReplaceKey=function(oldElement,newKey){var newElement=ReactElement(oldElement.type,newKey,oldElement.ref,oldElement._self,oldElement._source,oldElement._owner,oldElement.props);return newElement};ReactElement.cloneElement=function(element,config,children){var propName;var props=_assign({},element.props);var key=element.key;var ref=element.ref;var self=element._self;var source=element._source;var owner=element._owner;if(config!=null){if(hasValidRef(config)){ref=config.ref;owner=ReactCurrentOwner.current}if(hasValidKey(config)){key=""+config.key}var defaultProps;if(element.type&&element.type.defaultProps){defaultProps=element.type.defaultProps}for(propName in config){if(hasOwnProperty.call(config,propName)&&!RESERVED_PROPS.hasOwnProperty(propName)){if(config[propName]===undefined&&defaultProps!==undefined){props[propName]=defaultProps[propName]}else{props[propName]=config[propName]}}}}var childrenLength=arguments.length-2;if(childrenLength===1){props.children=children}else if(childrenLength>1){var childArray=Array(childrenLength);for(var i=0;i<childrenLength;i++){childArray[i]=arguments[i+2]}props.children=childArray}return ReactElement(element.type,key,ref,self,source,owner,props)};ReactElement.isValidElement=function(object){return typeof object==="object"&&object!==null&&object.$$typeof===REACT_ELEMENT_TYPE};module.exports=ReactElement}).call(this,require("_process"))},{"./ReactCurrentOwner":280,"./ReactElementSymbol":283,"./canDefineProperty":291,_process:252,"fbjs/lib/warning":142,"object-assign":249}],283:[function(require,module,exports){"use strict";var REACT_ELEMENT_TYPE=typeof Symbol==="function"&&Symbol["for"]&&Symbol["for"]("react.element")||60103;module.exports=REACT_ELEMENT_TYPE},{}],284:[function(require,module,exports){(function(process){"use strict";var ReactCurrentOwner=require("./ReactCurrentOwner");var ReactComponentTreeHook=require("./ReactComponentTreeHook");var ReactElement=require("./ReactElement");var checkReactTypeSpec=require("./checkReactTypeSpec");var canDefineProperty=require("./canDefineProperty");var getIteratorFn=require("./getIteratorFn");var warning=require("fbjs/lib/warning");function getDeclarationErrorAddendum(){if(ReactCurrentOwner.current){var name=ReactCurrentOwner.current.getName();if(name){return" Check the render method of `"+name+"`."}}return""}function getSourceInfoErrorAddendum(elementProps){if(elementProps!==null&&elementProps!==undefined&&elementProps.__source!==undefined){var source=elementProps.__source;var fileName=source.fileName.replace(/^.*[\\\/]/,"");var lineNumber=source.lineNumber;return" Check your code at "+fileName+":"+lineNumber+"."}return""}var ownerHasKeyUseWarning={};function getCurrentComponentErrorInfo(parentType){var info=getDeclarationErrorAddendum();if(!info){var parentName=typeof parentType==="string"?parentType:parentType.displayName||parentType.name;if(parentName){info=" Check the top-level render call using <"+parentName+">."}}return info}function validateExplicitKey(element,parentType){if(!element._store||element._store.validated||element.key!=null){return}element._store.validated=true;var memoizer=ownerHasKeyUseWarning.uniqueKey||(ownerHasKeyUseWarning.uniqueKey={});var currentComponentErrorInfo=getCurrentComponentErrorInfo(parentType);if(memoizer[currentComponentErrorInfo]){return}memoizer[currentComponentErrorInfo]=true;var childOwner="";if(element&&element._owner&&element._owner!==ReactCurrentOwner.current){childOwner=" It was passed a child from "+element._owner.getName()+"."}process.env.NODE_ENV!=="production"?warning(false,'Each child in an array or iterator should have a unique "key" prop.'+"%s%s See https://fb.me/react-warning-keys for more information.%s",currentComponentErrorInfo,childOwner,ReactComponentTreeHook.getCurrentStackAddendum(element)):void 0}function validateChildKeys(node,parentType){if(typeof node!=="object"){return}if(Array.isArray(node)){for(var i=0;i<node.length;i++){var child=node[i];if(ReactElement.isValidElement(child)){validateExplicitKey(child,parentType)}}}else if(ReactElement.isValidElement(node)){if(node._store){node._store.validated=true}}else if(node){var iteratorFn=getIteratorFn(node);if(iteratorFn){if(iteratorFn!==node.entries){var iterator=iteratorFn.call(node);var step;while(!(step=iterator.next()).done){if(ReactElement.isValidElement(step.value)){validateExplicitKey(step.value,parentType)}}}}}}function validatePropTypes(element){var componentClass=element.type;if(typeof componentClass!=="function"){return}var name=componentClass.displayName||componentClass.name;if(componentClass.propTypes){checkReactTypeSpec(componentClass.propTypes,element.props,"prop",name,element,null)}if(typeof componentClass.getDefaultProps==="function"){process.env.NODE_ENV!=="production"?warning(componentClass.getDefaultProps.isReactClassApproved,"getDefaultProps is only used on classic React.createClass "+"definitions. Use a static property named `defaultProps` instead."):void 0}}var ReactElementValidator={createElement:function(type,props,children){var validType=typeof type==="string"||typeof type==="function";if(!validType){if(typeof type!=="function"&&typeof type!=="string"){var info="";if(type===undefined||typeof type==="object"&&type!==null&&Object.keys(type).length===0){info+=" You likely forgot to export your component from the file "+"it's defined in."}var sourceInfo=getSourceInfoErrorAddendum(props);if(sourceInfo){info+=sourceInfo}else{info+=getDeclarationErrorAddendum()}info+=ReactComponentTreeHook.getCurrentStackAddendum();process.env.NODE_ENV!=="production"?warning(false,"React.createElement: type is invalid -- expected a string (for "+"built-in components) or a class/function (for composite "+"components) but got: %s.%s",type==null?type:typeof type,info):void 0}}var element=ReactElement.createElement.apply(this,arguments);if(element==null){return element}if(validType){for(var i=2;i<arguments.length;i++){validateChildKeys(arguments[i],type)}}validatePropTypes(element);return element},createFactory:function(type){var validatedFactory=ReactElementValidator.createElement.bind(null,type);validatedFactory.type=type;if(process.env.NODE_ENV!=="production"){if(canDefineProperty){Object.defineProperty(validatedFactory,"type",{enumerable:false,get:function(){process.env.NODE_ENV!=="production"?warning(false,"Factory.type is deprecated. Access the class directly "+"before passing it to createFactory."):void 0;Object.defineProperty(this,"type",{value:type});return type}})}}return validatedFactory},cloneElement:function(element,props,children){var newElement=ReactElement.cloneElement.apply(this,arguments);for(var i=2;i<arguments.length;i++){validateChildKeys(arguments[i],newElement.type)}validatePropTypes(newElement);return newElement}};module.exports=ReactElementValidator}).call(this,require("_process"))},{"./ReactComponentTreeHook":279,"./ReactCurrentOwner":280,"./ReactElement":282,"./canDefineProperty":291,"./checkReactTypeSpec":292,"./getIteratorFn":293,_process:252,"fbjs/lib/warning":142}],285:[function(require,module,exports){(function(process){"use strict";var warning=require("fbjs/lib/warning");function warnNoop(publicInstance,callerName){if(process.env.NODE_ENV!=="production"){var constructor=publicInstance.constructor;process.env.NODE_ENV!=="production"?warning(false,"%s(...): Can only update a mounted or mounting component. "+"This usually means you called %s() on an unmounted component. "+"This is a no-op. Please check the code for the %s component.",callerName,callerName,constructor&&(constructor.displayName||constructor.name)||"ReactClass"):void 0}}var ReactNoopUpdateQueue={isMounted:function(publicInstance){return false},enqueueCallback:function(publicInstance,callback){},enqueueForceUpdate:function(publicInstance){warnNoop(publicInstance,"forceUpdate")},enqueueReplaceState:function(publicInstance,completeState){warnNoop(publicInstance,"replaceState")},enqueueSetState:function(publicInstance,partialState){warnNoop(publicInstance,"setState")}};module.exports=ReactNoopUpdateQueue}).call(this,require("_process"))},{_process:252,"fbjs/lib/warning":142}],286:[function(require,module,exports){(function(process){"use strict";var ReactPropTypeLocationNames={};if(process.env.NODE_ENV!=="production"){ReactPropTypeLocationNames={prop:"prop",context:"context",childContext:"child context"}}module.exports=ReactPropTypeLocationNames}).call(this,require("_process"))},{_process:252}],287:[function(require,module,exports){"use strict";var _require=require("./ReactElement"),isValidElement=_require.isValidElement;var factory=require("prop-types/factory");module.exports=factory(isValidElement)},{"./ReactElement":282,"prop-types/factory":254}],288:[function(require,module,exports){"use strict";var ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";module.exports=ReactPropTypesSecret},{}],289:[function(require,module,exports){"use strict";var _assign=require("object-assign");var ReactComponent=require("./ReactComponent");var ReactNoopUpdateQueue=require("./ReactNoopUpdateQueue");var emptyObject=require("fbjs/lib/emptyObject");function ReactPureComponent(props,context,updater){this.props=props;this.context=context;this.refs=emptyObject;this.updater=updater||ReactNoopUpdateQueue}function ComponentDummy(){}ComponentDummy.prototype=ReactComponent.prototype;ReactPureComponent.prototype=new ComponentDummy;ReactPureComponent.prototype.constructor=ReactPureComponent;_assign(ReactPureComponent.prototype,ReactComponent.prototype);ReactPureComponent.prototype.isPureReactComponent=true;module.exports=ReactPureComponent},{"./ReactComponent":278,"./ReactNoopUpdateQueue":285,"fbjs/lib/emptyObject":139,"object-assign":249}],290:[function(require,module,exports){"use strict";module.exports="15.5.4"},{}],291:[function(require,module,exports){(function(process){"use strict";var canDefineProperty=false;if(process.env.NODE_ENV!=="production"){try{Object.defineProperty({},"x",{get:function(){}});canDefineProperty=true}catch(x){}}module.exports=canDefineProperty}).call(this,require("_process"))},{_process:252}],292:[function(require,module,exports){(function(process){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactPropTypeLocationNames=require("./ReactPropTypeLocationNames");var ReactPropTypesSecret=require("./ReactPropTypesSecret");var invariant=require("fbjs/lib/invariant");var warning=require("fbjs/lib/warning");var ReactComponentTreeHook;if(typeof process!=="undefined"&&process.env&&process.env.NODE_ENV==="test"){ReactComponentTreeHook=require("./ReactComponentTreeHook")}var loggedTypeFailures={};function checkReactTypeSpec(typeSpecs,values,location,componentName,element,debugID){for(var typeSpecName in typeSpecs){if(typeSpecs.hasOwnProperty(typeSpecName)){var error;try{!(typeof typeSpecs[typeSpecName]==="function")?process.env.NODE_ENV!=="production"?invariant(false,"%s: %s type `%s` is invalid; it must be a function, usually from React.PropTypes.",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName):_prodInvariant("84",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName):void 0;error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret)}catch(ex){error=ex}process.env.NODE_ENV!=="production"?warning(!error||error instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker "+"function must return `null` or an `Error` but returned a %s. "+"You may have forgotten to pass an argument to the type checker "+"creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and "+"shape all require an argument).",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName,typeof error):void 0;if(error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=true;var componentStackInfo="";if(process.env.NODE_ENV!=="production"){if(!ReactComponentTreeHook){ReactComponentTreeHook=require("./ReactComponentTreeHook")}if(debugID!==null){componentStackInfo=ReactComponentTreeHook.getStackAddendumByID(debugID)}else if(element!==null){componentStackInfo=ReactComponentTreeHook.getCurrentStackAddendum(element)}}process.env.NODE_ENV!=="production"?warning(false,"Failed %s type: %s%s",location,error.message,componentStackInfo):void 0}}}}module.exports=checkReactTypeSpec}).call(this,require("_process"))},{"./ReactComponentTreeHook":279,"./ReactPropTypeLocationNames":286,"./ReactPropTypesSecret":288,"./reactProdInvariant":295,_process:252,"fbjs/lib/invariant":140,"fbjs/lib/warning":142}],293:[function(require,module,exports){"use strict";var ITERATOR_SYMBOL=typeof Symbol==="function"&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn==="function"){return iteratorFn}}module.exports=getIteratorFn},{}],294:[function(require,module,exports){(function(process){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactElement=require("./ReactElement");var invariant=require("fbjs/lib/invariant");function onlyChild(children){!ReactElement.isValidElement(children)?process.env.NODE_ENV!=="production"?invariant(false,"React.Children.only expected to receive a single React element child."):_prodInvariant("143"):void 0;return children}module.exports=onlyChild}).call(this,require("_process"))},{"./ReactElement":282,"./reactProdInvariant":295,_process:252,"fbjs/lib/invariant":140}],295:[function(require,module,exports){"use strict";function reactProdInvariant(code){var argCount=arguments.length-1;var message="Minified React error #"+code+"; visit "+"http://facebook.github.io/react/docs/error-decoder.html?invariant="+code;for(var argIdx=0;argIdx<argCount;argIdx++){message+="&args[]="+encodeURIComponent(arguments[argIdx+1])}message+=" for the full message or use the non-minified dev environment"+" for full errors and additional helpful warnings.";var error=new Error(message);error.name="Invariant Violation";error.framesToPop=1;throw error}module.exports=reactProdInvariant},{}],296:[function(require,module,exports){(function(process){"use strict";var _prodInvariant=require("./reactProdInvariant");var ReactCurrentOwner=require("./ReactCurrentOwner");var REACT_ELEMENT_TYPE=require("./ReactElementSymbol");var getIteratorFn=require("./getIteratorFn");var invariant=require("fbjs/lib/invariant");var KeyEscapeUtils=require("./KeyEscapeUtils");var warning=require("fbjs/lib/warning");var SEPARATOR=".";var SUBSEPARATOR=":";var didWarnAboutMaps=false;function getComponentKey(component,index){if(component&&typeof component==="object"&&component.key!=null){return KeyEscapeUtils.escape(component.key)}return index.toString(36)}function traverseAllChildrenImpl(children,nameSoFar,callback,traverseContext){var type=typeof children;if(type==="undefined"||type==="boolean"){children=null}if(children===null||type==="string"||type==="number"||type==="object"&&children.$$typeof===REACT_ELEMENT_TYPE){callback(traverseContext,children,nameSoFar===""?SEPARATOR+getComponentKey(children,0):nameSoFar);return 1}var child;var nextName;var subtreeCount=0;var nextNamePrefix=nameSoFar===""?SEPARATOR:nameSoFar+SUBSEPARATOR;if(Array.isArray(children)){for(var i=0;i<children.length;i++){child=children[i];nextName=nextNamePrefix+getComponentKey(child,i);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}else{var iteratorFn=getIteratorFn(children);if(iteratorFn){var iterator=iteratorFn.call(children);var step;if(iteratorFn!==children.entries){var ii=0;while(!(step=iterator.next()).done){child=step.value;nextName=nextNamePrefix+getComponentKey(child,ii++);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}else{if(process.env.NODE_ENV!=="production"){var mapsAsChildrenAddendum="";if(ReactCurrentOwner.current){var mapsAsChildrenOwnerName=ReactCurrentOwner.current.getName();if(mapsAsChildrenOwnerName){mapsAsChildrenAddendum=" Check the render method of `"+mapsAsChildrenOwnerName+"`."}}process.env.NODE_ENV!=="production"?warning(didWarnAboutMaps,"Using Maps as children is not yet fully supported. It is an "+"experimental feature that might be removed. Convert it to a "+"sequence / iterable of keyed ReactElements instead.%s",mapsAsChildrenAddendum):void 0;didWarnAboutMaps=true}while(!(step=iterator.next()).done){var entry=step.value;if(entry){child=entry[1];nextName=nextNamePrefix+KeyEscapeUtils.escape(entry[0])+SUBSEPARATOR+getComponentKey(child,0);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}}}else if(type==="object"){var addendum="";if(process.env.NODE_ENV!=="production"){addendum=" If you meant to render a collection of children, use an array "+"instead or wrap the object using createFragment(object) from the "+"React add-ons.";if(children._isReactElement){addendum=" It looks like you're using an element created by a different "+"version of React. Make sure to use only one copy of React."}if(ReactCurrentOwner.current){var name=ReactCurrentOwner.current.getName();if(name){addendum+=" Check the render method of `"+name+"`."}}}var childrenString=String(children);!false?process.env.NODE_ENV!=="production"?invariant(false,"Objects are not valid as a React child (found: %s).%s",childrenString==="[object Object]"?"object with keys {"+Object.keys(children).join(", ")+"}":childrenString,addendum):_prodInvariant("31",childrenString==="[object Object]"?"object with keys {"+Object.keys(children).join(", ")+"}":childrenString,addendum):void 0}}return subtreeCount}function traverseAllChildren(children,callback,traverseContext){if(children==null){return 0}return traverseAllChildrenImpl(children,"",callback,traverseContext)}module.exports=traverseAllChildren}).call(this,require("_process"))},{"./KeyEscapeUtils":273,"./ReactCurrentOwner":280,"./ReactElementSymbol":283,"./getIteratorFn":293,"./reactProdInvariant":295,_process:252,"fbjs/lib/invariant":140,"fbjs/lib/warning":142}],297:[function(require,module,exports){"use strict";module.exports=require("./lib/React")},{"./lib/React":275}],
298:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],299:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],300:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":299,_process:252,inherits:298}],301:[function(require,module,exports){(function(global){WebGLDebugUtils=function(){if(typeof window=="undefined"){window=global}var log=function(msg){if(window.console&&window.console.log){window.console.log(msg)}};var error=function(msg){if(window.console&&window.console.error){window.console.error(msg)}else{log(msg)}};var glValidEnumContexts={enable:{1:{0:true}},disable:{1:{0:true}},getParameter:{1:{0:true}},drawArrays:{3:{0:true}},drawElements:{4:{0:true,2:true}},createShader:{1:{0:true}},getShaderParameter:{2:{1:true}},getProgramParameter:{2:{1:true}},getShaderPrecisionFormat:{2:{0:true,1:true}},getVertexAttrib:{2:{1:true}},vertexAttribPointer:{6:{2:true}},bindTexture:{2:{0:true}},activeTexture:{1:{0:true}},getTexParameter:{2:{0:true,1:true}},texParameterf:{3:{0:true,1:true}},texParameteri:{3:{0:true,1:true,2:true}},texImage2D:{9:{0:true,2:true,6:true,7:true},6:{0:true,2:true,3:true,4:true}},texSubImage2D:{9:{0:true,6:true,7:true},7:{0:true,4:true,5:true}},copyTexImage2D:{8:{0:true,2:true}},copyTexSubImage2D:{8:{0:true}},generateMipmap:{1:{0:true}},compressedTexImage2D:{7:{0:true,2:true}},compressedTexSubImage2D:{8:{0:true,6:true}},bindBuffer:{2:{0:true}},bufferData:{3:{0:true,2:true}},bufferSubData:{3:{0:true}},getBufferParameter:{2:{0:true,1:true}},pixelStorei:{2:{0:true,1:true}},readPixels:{7:{4:true,5:true}},bindRenderbuffer:{2:{0:true}},bindFramebuffer:{2:{0:true}},checkFramebufferStatus:{1:{0:true}},framebufferRenderbuffer:{4:{0:true,1:true,2:true}},framebufferTexture2D:{5:{0:true,1:true,2:true}},getFramebufferAttachmentParameter:{3:{0:true,1:true,2:true}},getRenderbufferParameter:{2:{0:true,1:true}},renderbufferStorage:{4:{0:true,1:true}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:true}},blendFunc:{2:{0:true,1:true}},blendFuncSeparate:{4:{0:true,1:true,2:true,3:true}},blendEquation:{1:{0:true}},blendEquationSeparate:{2:{0:true,1:true}},stencilFunc:{3:{0:true}},stencilFuncSeparate:{4:{0:true,1:true}},stencilMaskSeparate:{2:{0:true}},stencilOp:{3:{0:true,1:true,2:true}},stencilOpSeparate:{4:{0:true,1:true,2:true,3:true}},cullFace:{1:{0:true}},frontFace:{1:{0:true}},drawArraysInstancedANGLE:{4:{0:true}},drawElementsInstancedANGLE:{5:{0:true,2:true}},blendEquationEXT:{1:{0:true}}};var glEnums=null;var enumStringToValue=null;function init(ctx){if(glEnums==null){glEnums={};enumStringToValue={};for(var propertyName in ctx){if(typeof ctx[propertyName]=="number"){glEnums[ctx[propertyName]]=propertyName;enumStringToValue[propertyName]=ctx[propertyName]}}}}function checkInit(){if(glEnums==null){throw"WebGLDebugUtils.init(ctx) not called"}}function mightBeEnum(value){checkInit();return glEnums[value]!==undefined}function glEnumToString(value){checkInit();var name=glEnums[value];return name!==undefined?"gl."+name:"/*UNKNOWN WebGL ENUM*/ 0x"+value.toString(16)+""}function glFunctionArgToString(functionName,numArgs,argumentIndex,value){var funcInfo=glValidEnumContexts[functionName];if(funcInfo!==undefined){var funcInfo=funcInfo[numArgs];if(funcInfo!==undefined){if(funcInfo[argumentIndex]){if(typeof funcInfo[argumentIndex]==="object"&&funcInfo[argumentIndex]["enumBitwiseOr"]!==undefined){var enums=funcInfo[argumentIndex]["enumBitwiseOr"];var orResult=0;var orEnums=[];for(var i=0;i<enums.length;++i){var enumValue=enumStringToValue[enums[i]];if((value&enumValue)!==0){orResult|=enumValue;orEnums.push(glEnumToString(enumValue))}}if(orResult===value){return orEnums.join(" | ")}else{return glEnumToString(value)}}else{return glEnumToString(value)}}}}if(value===null){return"null"}else if(value===undefined){return"undefined"}else{return value.toString()}}function glFunctionArgsToString(functionName,args){var argStr="";var numArgs=args.length;for(var ii=0;ii<numArgs;++ii){argStr+=(ii==0?"":", ")+glFunctionArgToString(functionName,numArgs,ii,args[ii])}return argStr}function makePropertyWrapper(wrapper,original,propertyName){wrapper.__defineGetter__(propertyName,function(){return original[propertyName]});wrapper.__defineSetter__(propertyName,function(value){original[propertyName]=value})}function makeFunctionWrapper(original,functionName){var f=original[functionName];return function(){var result=f.apply(original,arguments);return result}}function makeDebugContext(ctx,opt_onErrorFunc,opt_onFunc,opt_err_ctx){opt_err_ctx=opt_err_ctx||ctx;init(ctx);opt_onErrorFunc=opt_onErrorFunc||function(err,functionName,args){var argStr="";var numArgs=args.length;for(var ii=0;ii<numArgs;++ii){argStr+=(ii==0?"":", ")+glFunctionArgToString(functionName,numArgs,ii,args[ii])}error("WebGL error "+glEnumToString(err)+" in "+functionName+"("+argStr+")")};var glErrorShadow={};function makeErrorWrapper(ctx,functionName){return function(){if(opt_onFunc){opt_onFunc(functionName,arguments)}var result=ctx[functionName].apply(ctx,arguments);var err=opt_err_ctx.getError();if(err!=0){glErrorShadow[err]=true;opt_onErrorFunc(err,functionName,arguments)}return result}}var wrapper={};for(var propertyName in ctx){if(typeof ctx[propertyName]=="function"){if(propertyName!="getExtension"){wrapper[propertyName]=makeErrorWrapper(ctx,propertyName)}else{var wrapped=makeErrorWrapper(ctx,propertyName);wrapper[propertyName]=function(){var result=wrapped.apply(ctx,arguments);return makeDebugContext(result,opt_onErrorFunc,opt_onFunc,opt_err_ctx)}}}else{makePropertyWrapper(wrapper,ctx,propertyName)}}wrapper.getError=function(){for(var err in glErrorShadow){if(glErrorShadow.hasOwnProperty(err)){if(glErrorShadow[err]){glErrorShadow[err]=false;return err}}}return ctx.NO_ERROR};return wrapper}function resetToInitialState(ctx){var numAttribs=ctx.getParameter(ctx.MAX_VERTEX_ATTRIBS);var tmp=ctx.createBuffer();ctx.bindBuffer(ctx.ARRAY_BUFFER,tmp);for(var ii=0;ii<numAttribs;++ii){ctx.disableVertexAttribArray(ii);ctx.vertexAttribPointer(ii,4,ctx.FLOAT,false,0,0);ctx.vertexAttrib1f(ii,0)}ctx.deleteBuffer(tmp);var numTextureUnits=ctx.getParameter(ctx.MAX_TEXTURE_IMAGE_UNITS);for(var ii=0;ii<numTextureUnits;++ii){ctx.activeTexture(ctx.TEXTURE0+ii);ctx.bindTexture(ctx.TEXTURE_CUBE_MAP,null);ctx.bindTexture(ctx.TEXTURE_2D,null)}ctx.activeTexture(ctx.TEXTURE0);ctx.useProgram(null);ctx.bindBuffer(ctx.ARRAY_BUFFER,null);ctx.bindBuffer(ctx.ELEMENT_ARRAY_BUFFER,null);ctx.bindFramebuffer(ctx.FRAMEBUFFER,null);ctx.bindRenderbuffer(ctx.RENDERBUFFER,null);ctx.disable(ctx.BLEND);ctx.disable(ctx.CULL_FACE);ctx.disable(ctx.DEPTH_TEST);ctx.disable(ctx.DITHER);ctx.disable(ctx.SCISSOR_TEST);ctx.blendColor(0,0,0,0);ctx.blendEquation(ctx.FUNC_ADD);ctx.blendFunc(ctx.ONE,ctx.ZERO);ctx.clearColor(0,0,0,0);ctx.clearDepth(1);ctx.clearStencil(-1);ctx.colorMask(true,true,true,true);ctx.cullFace(ctx.BACK);ctx.depthFunc(ctx.LESS);ctx.depthMask(true);ctx.depthRange(0,1);ctx.frontFace(ctx.CCW);ctx.hint(ctx.GENERATE_MIPMAP_HINT,ctx.DONT_CARE);ctx.lineWidth(1);ctx.pixelStorei(ctx.PACK_ALIGNMENT,4);ctx.pixelStorei(ctx.UNPACK_ALIGNMENT,4);ctx.pixelStorei(ctx.UNPACK_FLIP_Y_WEBGL,false);ctx.pixelStorei(ctx.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(ctx.UNPACK_COLORSPACE_CONVERSION_WEBGL){ctx.pixelStorei(ctx.UNPACK_COLORSPACE_CONVERSION_WEBGL,ctx.BROWSER_DEFAULT_WEBGL)}ctx.polygonOffset(0,0);ctx.sampleCoverage(1,false);ctx.scissor(0,0,ctx.canvas.width,ctx.canvas.height);ctx.stencilFunc(ctx.ALWAYS,0,4294967295);ctx.stencilMask(4294967295);ctx.stencilOp(ctx.KEEP,ctx.KEEP,ctx.KEEP);ctx.viewport(0,0,ctx.canvas.width,ctx.canvas.height);ctx.clear(ctx.COLOR_BUFFER_BIT|ctx.DEPTH_BUFFER_BIT|ctx.STENCIL_BUFFER_BIT);while(ctx.getError());}function makeLostContextSimulatingCanvas(canvas){var unwrappedContext_;var wrappedContext_;var onLost_=[];var onRestored_=[];var wrappedContext_={};var contextId_=1;var contextLost_=false;var resourceId_=0;var resourceDb_=[];var numCallsToLoseContext_=0;var numCalls_=0;var canRestore_=false;var restoreTimeout_=0;var glErrorShadow_={};canvas.getContext=function(f){return function(){var ctx=f.apply(canvas,arguments);if(ctx instanceof WebGLRenderingContext){if(ctx!=unwrappedContext_){if(unwrappedContext_){throw"got different context"}unwrappedContext_=ctx;wrappedContext_=makeLostContextSimulatingContext(unwrappedContext_)}return wrappedContext_}return ctx}}(canvas.getContext);function wrapEvent(listener){if(typeof listener=="function"){return listener}else{return function(info){listener.handleEvent(info)}}}var addOnContextLostListener=function(listener){onLost_.push(wrapEvent(listener))};var addOnContextRestoredListener=function(listener){onRestored_.push(wrapEvent(listener))};function wrapAddEventListener(canvas){var f=canvas.addEventListener;canvas.addEventListener=function(type,listener,bubble){switch(type){case"webglcontextlost":addOnContextLostListener(listener);break;case"webglcontextrestored":addOnContextRestoredListener(listener);break;default:f.apply(canvas,arguments)}}}wrapAddEventListener(canvas);canvas.loseContext=function(){if(!contextLost_){contextLost_=true;numCallsToLoseContext_=0;++contextId_;while(unwrappedContext_.getError());clearErrors();glErrorShadow_[unwrappedContext_.CONTEXT_LOST_WEBGL]=true;var event=makeWebGLContextEvent("context lost");var callbacks=onLost_.slice();setTimeout(function(){for(var ii=0;ii<callbacks.length;++ii){callbacks[ii](event)}if(restoreTimeout_>=0){setTimeout(function(){canvas.restoreContext()},restoreTimeout_)}},0)}};canvas.restoreContext=function(){if(contextLost_){if(onRestored_.length){setTimeout(function(){if(!canRestore_){throw"can not restore. webglcontestlost listener did not call event.preventDefault"}freeResources();resetToInitialState(unwrappedContext_);contextLost_=false;numCalls_=0;canRestore_=false;var callbacks=onRestored_.slice();var event=makeWebGLContextEvent("context restored");for(var ii=0;ii<callbacks.length;++ii){callbacks[ii](event)}},0)}}};canvas.loseContextInNCalls=function(numCalls){if(contextLost_){throw"You can not ask a lost contet to be lost"}numCallsToLoseContext_=numCalls_+numCalls};canvas.getNumCalls=function(){return numCalls_};canvas.setRestoreTimeout=function(timeout){restoreTimeout_=timeout};function isWebGLObject(obj){return obj instanceof WebGLBuffer||obj instanceof WebGLFramebuffer||obj instanceof WebGLProgram||obj instanceof WebGLRenderbuffer||obj instanceof WebGLShader||obj instanceof WebGLTexture}function checkResources(args){for(var ii=0;ii<args.length;++ii){var arg=args[ii];if(isWebGLObject(arg)){return arg.__webglDebugContextLostId__==contextId_}}return true}function clearErrors(){var k=Object.keys(glErrorShadow_);for(var ii=0;ii<k.length;++ii){delete glErrorShadow_[k]}}function loseContextIfTime(){++numCalls_;if(!contextLost_){if(numCallsToLoseContext_==numCalls_){canvas.loseContext()}}}function makeLostContextFunctionWrapper(ctx,functionName){var f=ctx[functionName];return function(){loseContextIfTime();if(!contextLost_){var result=f.apply(ctx,arguments);return result}}}function freeResources(){for(var ii=0;ii<resourceDb_.length;++ii){var resource=resourceDb_[ii];if(resource instanceof WebGLBuffer){unwrappedContext_.deleteBuffer(resource)}else if(resource instanceof WebGLFramebuffer){unwrappedContext_.deleteFramebuffer(resource)}else if(resource instanceof WebGLProgram){unwrappedContext_.deleteProgram(resource)}else if(resource instanceof WebGLRenderbuffer){unwrappedContext_.deleteRenderbuffer(resource)}else if(resource instanceof WebGLShader){unwrappedContext_.deleteShader(resource)}else if(resource instanceof WebGLTexture){unwrappedContext_.deleteTexture(resource)}}}function makeWebGLContextEvent(statusMessage){return{statusMessage:statusMessage,preventDefault:function(){canRestore_=true}}}return canvas;function makeLostContextSimulatingContext(ctx){for(var propertyName in ctx){if(typeof ctx[propertyName]=="function"){wrappedContext_[propertyName]=makeLostContextFunctionWrapper(ctx,propertyName)}else{makePropertyWrapper(wrappedContext_,ctx,propertyName)}}wrappedContext_.getError=function(){loseContextIfTime();if(!contextLost_){var err;while(err=unwrappedContext_.getError()){glErrorShadow_[err]=true}}for(var err in glErrorShadow_){if(glErrorShadow_[err]){delete glErrorShadow_[err];return err}}return wrappedContext_.NO_ERROR};var creationFunctions=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];for(var ii=0;ii<creationFunctions.length;++ii){var functionName=creationFunctions[ii];wrappedContext_[functionName]=function(f){return function(){loseContextIfTime();if(contextLost_){return null}var obj=f.apply(ctx,arguments);obj.__webglDebugContextLostId__=contextId_;resourceDb_.push(obj);return obj}}(ctx[functionName])}var functionsThatShouldReturnNull=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(var ii=0;ii<functionsThatShouldReturnNull.length;++ii){var functionName=functionsThatShouldReturnNull[ii];wrappedContext_[functionName]=function(f){return function(){loseContextIfTime();if(contextLost_){return null}return f.apply(ctx,arguments)}}(wrappedContext_[functionName])}var isFunctions=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(var ii=0;ii<isFunctions.length;++ii){var functionName=isFunctions[ii];wrappedContext_[functionName]=function(f){return function(){loseContextIfTime();if(contextLost_){return false}return f.apply(ctx,arguments)}}(wrappedContext_[functionName])}wrappedContext_.checkFramebufferStatus=function(f){return function(){loseContextIfTime();if(contextLost_){return wrappedContext_.FRAMEBUFFER_UNSUPPORTED}return f.apply(ctx,arguments)}}(wrappedContext_.checkFramebufferStatus);wrappedContext_.getAttribLocation=function(f){return function(){loseContextIfTime();if(contextLost_){return-1}return f.apply(ctx,arguments)}}(wrappedContext_.getAttribLocation);wrappedContext_.getVertexAttribOffset=function(f){return function(){loseContextIfTime();if(contextLost_){return 0}return f.apply(ctx,arguments)}}(wrappedContext_.getVertexAttribOffset);wrappedContext_.isContextLost=function(){return contextLost_};return wrappedContext_}}return{init:init,mightBeEnum:mightBeEnum,glEnumToString:glEnumToString,glFunctionArgToString:glFunctionArgToString,glFunctionArgsToString:glFunctionArgsToString,makeDebugContext:makeDebugContext,makeLostContextSimulatingCanvas:makeLostContextSimulatingCanvas,resetToInitialState:resetToInitialState}}();module.exports=WebGLDebugUtils}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],302:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AnimationPropType=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _d3Interpolate=require("d3-interpolate");var _reactMotion=require("react-motion");var _pureRenderComponent=require("./pure-render-component");var _pureRenderComponent2=_interopRequireDefault(_pureRenderComponent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ANIMATION_PROPTYPES=_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.shape({stiffness:_propTypes2.default.number,damping:_propTypes2.default.number}),_propTypes2.default.bool]);var propTypes={animatedProps:_propTypes2.default.arrayOf(_propTypes2.default.string).isRequired,animation:ANIMATION_PROPTYPES,onStart:_propTypes2.default.func,onEnd:_propTypes2.default.func};function getAnimationStyle(){var animationStyle=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_reactMotion.presets.noWobble;if(typeof animationStyle==="string"){return _reactMotion.presets[animationStyle]||_reactMotion.presets.noWobble}var damping=animationStyle.damping,stiffness=animationStyle.stiffness;return _extends({damping:damping||_reactMotion.presets.noWobble.damping,stiffness:stiffness||_reactMotion.presets.noWobble.stiffness},animationStyle)}var Animation=function(_PureRenderComponent){_inherits(Animation,_PureRenderComponent);function Animation(props){_classCallCheck(this,Animation);var _this=_possibleConstructorReturn(this,(Animation.__proto__||Object.getPrototypeOf(Animation)).call(this,props));_this._updateInterpolator(props);_this._renderChildren=_this._renderChildren.bind(_this);_this._motionEndHandler=_this._motionEndHandler.bind(_this);return _this}_createClass(Animation,[{key:"componentWillUpdate",value:function componentWillUpdate(props){this._updateInterpolator(this.props,props);if(props.onStart){props.onStart()}}},{key:"_updateInterpolator",value:function _updateInterpolator(oldProps,newProps){this._interpolator=(0,_d3Interpolate.interpolate)(this._extractAnimatedPropValues(oldProps),newProps?this._extractAnimatedPropValues(newProps):null)}},{key:"_extractAnimatedPropValues",value:function _extractAnimatedPropValues(props){var animatedProps=props.animatedProps,otherProps=_objectWithoutProperties(props,["animatedProps"]);return animatedProps.reduce(function(result,animatedPropName){if(otherProps.hasOwnProperty(animatedPropName)){result[animatedPropName]=otherProps[animatedPropName]}return result},{})}},{key:"_renderChildren",value:function _renderChildren(_ref){var i=_ref.i;var children=this.props.children;var interpolator=this._interpolator;var child=_react2.default.Children.only(children);var interpolatedProps=interpolator?interpolator(i):interpolator;var data=interpolatedProps&&interpolatedProps.data||null;if(data&&child.props._data){data=data.map(function(row,index){var correspondingCell=child.props._data[index];return _extends({},row,{parent:correspondingCell.parent,children:correspondingCell.children})})}return _react2.default.cloneElement(child,_extends({},child.props,interpolatedProps,{data:data||child.props.data||null,_animation:Math.random()}))}},{key:"_motionEndHandler",value:function _motionEndHandler(){if(this.props.onEnd){this.props.onEnd()}}},{key:"render",value:function render(){var animationStyle=getAnimationStyle(this.props.animation);var defaultStyle={i:0};var style={i:(0,_reactMotion.spring)(1,animationStyle)};var key=Math.random();return _react2.default.createElement(_reactMotion.Motion,_extends({defaultStyle:defaultStyle,style:style,key:key},{onRest:this._motionEndHandler}),this._renderChildren)}}]);return Animation}(_pureRenderComponent2.default);Animation.propTypes=propTypes;Animation.displayName="Animation";exports.default=Animation;var AnimationPropType=exports.AnimationPropType=ANIMATION_PROPTYPES},{"./pure-render-component":353,"d3-interpolate":12,"prop-types":257,react:297,"react-motion":267}],303:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ScaleUtils=exports.AxisUtils=exports.makeWidthFlexible=exports.Sunburst=exports.Sankey=exports.RadialChart=exports.Treemap=exports.ContinuousSizeLegend=exports.ContinuousColorLegend=exports.SearchableDiscreteColorLegend=exports.DiscreteColorLegend=exports.Voronoi=exports.HorizontalGridLines=exports.VerticalGridLines=exports.GridLines=exports.CircularGridLines=exports.YAxis=exports.XAxis=exports.XYPlot=exports.Crosshair=exports.Hint=exports.LineMarkSeriesGL=exports.LineMarkSeriesCanvas=exports.LineMarkSeries=exports.ArcSeries=exports.AreaSeries=exports.HeatmapSeries=exports.MarkSeriesCanvas=exports.MarkSeriesGL=exports.MarkSeries=exports.RectSeriesCanvas=exports.RectSeries=exports.PolygonSeries=exports.LabelSeries=exports.HorizontalRectSeriesCanvas=exports.HorizontalRectSeries=exports.VerticalRectSeriesCanvas=exports.VerticalRectSeries=exports.VerticalBarSeriesCanvas=exports.VerticalBarSeries=exports.HorizontalBarSeriesCanvas=exports.HorizontalBarSeries=exports.LineSeriesGL=exports.LineSeriesCanvas=exports.LineSeries=exports.AbstractSeries=undefined;var _abstractSeries=require("./plot/series/abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _lineSeries=require("./plot/series/line-series");var _lineSeries2=_interopRequireDefault(_lineSeries);var _lineSeriesCanvas=require("./plot/series/line-series-canvas")
;var _lineSeriesCanvas2=_interopRequireDefault(_lineSeriesCanvas);var _lineSeriesGl=require("./plot/series/line-series-gl");var _lineSeriesGl2=_interopRequireDefault(_lineSeriesGl);var _horizontalBarSeries=require("./plot/series/horizontal-bar-series");var _horizontalBarSeries2=_interopRequireDefault(_horizontalBarSeries);var _horizontalBarSeriesCanvas=require("./plot/series/horizontal-bar-series-canvas");var _horizontalBarSeriesCanvas2=_interopRequireDefault(_horizontalBarSeriesCanvas);var _verticalBarSeries=require("./plot/series/vertical-bar-series");var _verticalBarSeries2=_interopRequireDefault(_verticalBarSeries);var _verticalBarSeriesCanvas=require("./plot/series/vertical-bar-series-canvas");var _verticalBarSeriesCanvas2=_interopRequireDefault(_verticalBarSeriesCanvas);var _verticalRectSeries=require("./plot/series/vertical-rect-series");var _verticalRectSeries2=_interopRequireDefault(_verticalRectSeries);var _verticalRectSeriesCanvas=require("./plot/series/vertical-rect-series-canvas");var _verticalRectSeriesCanvas2=_interopRequireDefault(_verticalRectSeriesCanvas);var _horizontalRectSeries=require("./plot/series/horizontal-rect-series");var _horizontalRectSeries2=_interopRequireDefault(_horizontalRectSeries);var _horizontalRectSeriesCanvas=require("./plot/series/horizontal-rect-series-canvas");var _horizontalRectSeriesCanvas2=_interopRequireDefault(_horizontalRectSeriesCanvas);var _labelSeries=require("./plot/series/label-series");var _labelSeries2=_interopRequireDefault(_labelSeries);var _polygonSeries=require("./plot/series/polygon-series");var _polygonSeries2=_interopRequireDefault(_polygonSeries);var _rectSeries=require("./plot/series/rect-series");var _rectSeries2=_interopRequireDefault(_rectSeries);var _rectSeriesCanvas=require("./plot/series/rect-series-canvas");var _rectSeriesCanvas2=_interopRequireDefault(_rectSeriesCanvas);var _markSeries=require("./plot/series/mark-series");var _markSeries2=_interopRequireDefault(_markSeries);var _markSeriesGl=require("./plot/series/mark-series-gl");var _markSeriesGl2=_interopRequireDefault(_markSeriesGl);var _markSeriesCanvas=require("./plot/series/mark-series-canvas");var _markSeriesCanvas2=_interopRequireDefault(_markSeriesCanvas);var _heatmapSeries=require("./plot/series/heatmap-series");var _heatmapSeries2=_interopRequireDefault(_heatmapSeries);var _areaSeries=require("./plot/series/area-series");var _areaSeries2=_interopRequireDefault(_areaSeries);var _arcSeries=require("./plot/series/arc-series");var _arcSeries2=_interopRequireDefault(_arcSeries);var _lineMarkSeries=require("./plot/series/line-mark-series");var _lineMarkSeries2=_interopRequireDefault(_lineMarkSeries);var _lineMarkSeriesCanvas=require("./plot/series/line-mark-series-canvas");var _lineMarkSeriesCanvas2=_interopRequireDefault(_lineMarkSeriesCanvas);var _lineMarkSeriesGl=require("./plot/series/line-mark-series-gl");var _lineMarkSeriesGl2=_interopRequireDefault(_lineMarkSeriesGl);var _hint=require("./plot/hint");var _hint2=_interopRequireDefault(_hint);var _crosshair=require("./plot/crosshair");var _crosshair2=_interopRequireDefault(_crosshair);var _xyPlot=require("./plot/xy-plot");var _xyPlot2=_interopRequireDefault(_xyPlot);var _xAxis=require("./plot/axis/x-axis");var _xAxis2=_interopRequireDefault(_xAxis);var _yAxis=require("./plot/axis/y-axis");var _yAxis2=_interopRequireDefault(_yAxis);var _circularGridLines=require("./plot/circular-grid-lines");var _circularGridLines2=_interopRequireDefault(_circularGridLines);var _gridLines=require("./plot/grid-lines");var _gridLines2=_interopRequireDefault(_gridLines);var _verticalGridLines=require("./plot/vertical-grid-lines");var _verticalGridLines2=_interopRequireDefault(_verticalGridLines);var _horizontalGridLines=require("./plot/horizontal-grid-lines");var _horizontalGridLines2=_interopRequireDefault(_horizontalGridLines);var _voronoi=require("./plot/voronoi");var _voronoi2=_interopRequireDefault(_voronoi);var _discreteColorLegend=require("./legends/discrete-color-legend");var _discreteColorLegend2=_interopRequireDefault(_discreteColorLegend);var _searchableDiscreteColorLegend=require("./legends/searchable-discrete-color-legend");var _searchableDiscreteColorLegend2=_interopRequireDefault(_searchableDiscreteColorLegend);var _continuousColorLegend=require("./legends/continuous-color-legend");var _continuousColorLegend2=_interopRequireDefault(_continuousColorLegend);var _continuousSizeLegend=require("./legends/continuous-size-legend");var _continuousSizeLegend2=_interopRequireDefault(_continuousSizeLegend);var _treemap=require("./treemap");var _treemap2=_interopRequireDefault(_treemap);var _radialChart=require("./radial-chart");var _radialChart2=_interopRequireDefault(_radialChart);var _sankey=require("./sankey");var _sankey2=_interopRequireDefault(_sankey);var _sunburst=require("./sunburst");var _sunburst2=_interopRequireDefault(_sunburst);var _makeVisFlexible=require("./make-vis-flexible");var _makeVisFlexible2=_interopRequireDefault(_makeVisFlexible);var _axisUtils=require("./utils/axis-utils");var _axisUtils2=_interopRequireDefault(_axisUtils);var _scalesUtils=require("./utils/scales-utils");var _scalesUtils2=_interopRequireDefault(_scalesUtils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.AbstractSeries=_abstractSeries2.default;exports.LineSeries=_lineSeries2.default;exports.LineSeriesCanvas=_lineSeriesCanvas2.default;exports.LineSeriesGL=_lineSeriesGl2.default;exports.HorizontalBarSeries=_horizontalBarSeries2.default;exports.HorizontalBarSeriesCanvas=_horizontalBarSeriesCanvas2.default;exports.VerticalBarSeries=_verticalBarSeries2.default;exports.VerticalBarSeriesCanvas=_verticalBarSeriesCanvas2.default;exports.VerticalRectSeries=_verticalRectSeries2.default;exports.VerticalRectSeriesCanvas=_verticalRectSeriesCanvas2.default;exports.HorizontalRectSeries=_horizontalRectSeries2.default;exports.HorizontalRectSeriesCanvas=_horizontalRectSeriesCanvas2.default;exports.LabelSeries=_labelSeries2.default;exports.PolygonSeries=_polygonSeries2.default;exports.RectSeries=_rectSeries2.default;exports.RectSeriesCanvas=_rectSeriesCanvas2.default;exports.MarkSeries=_markSeries2.default;exports.MarkSeriesGL=_markSeriesGl2.default;exports.MarkSeriesCanvas=_markSeriesCanvas2.default;exports.HeatmapSeries=_heatmapSeries2.default;exports.AreaSeries=_areaSeries2.default;exports.ArcSeries=_arcSeries2.default;exports.LineMarkSeries=_lineMarkSeries2.default;exports.LineMarkSeriesCanvas=_lineMarkSeriesCanvas2.default;exports.LineMarkSeriesGL=_lineMarkSeriesGl2.default;exports.Hint=_hint2.default;exports.Crosshair=_crosshair2.default;exports.XYPlot=_xyPlot2.default;exports.XAxis=_xAxis2.default;exports.YAxis=_yAxis2.default;exports.CircularGridLines=_circularGridLines2.default;exports.GridLines=_gridLines2.default;exports.VerticalGridLines=_verticalGridLines2.default;exports.HorizontalGridLines=_horizontalGridLines2.default;exports.Voronoi=_voronoi2.default;exports.DiscreteColorLegend=_discreteColorLegend2.default;exports.SearchableDiscreteColorLegend=_searchableDiscreteColorLegend2.default;exports.ContinuousColorLegend=_continuousColorLegend2.default;exports.ContinuousSizeLegend=_continuousSizeLegend2.default;exports.Treemap=_treemap2.default;exports.RadialChart=_radialChart2.default;exports.Sankey=_sankey2.default;exports.Sunburst=_sunburst2.default;exports.makeWidthFlexible=_makeVisFlexible2.default;exports.AxisUtils=_axisUtils2.default;exports.ScaleUtils=_scalesUtils2.default},{"./legends/continuous-color-legend":304,"./legends/continuous-size-legend":305,"./legends/discrete-color-legend":307,"./legends/searchable-discrete-color-legend":308,"./make-vis-flexible":309,"./plot/axis/x-axis":314,"./plot/axis/y-axis":315,"./plot/circular-grid-lines":316,"./plot/crosshair":317,"./plot/grid-lines":318,"./plot/hint":319,"./plot/horizontal-grid-lines":320,"./plot/series/abstract-series":321,"./plot/series/arc-series":322,"./plot/series/area-series":323,"./plot/series/heatmap-series":328,"./plot/series/horizontal-bar-series":330,"./plot/series/horizontal-bar-series-canvas":329,"./plot/series/horizontal-rect-series":332,"./plot/series/horizontal-rect-series-canvas":331,"./plot/series/label-series":333,"./plot/series/line-mark-series":336,"./plot/series/line-mark-series-canvas":334,"./plot/series/line-mark-series-gl":335,"./plot/series/line-series":339,"./plot/series/line-series-canvas":337,"./plot/series/line-series-gl":338,"./plot/series/mark-series":342,"./plot/series/mark-series-canvas":340,"./plot/series/mark-series-gl":341,"./plot/series/polygon-series":343,"./plot/series/rect-series":345,"./plot/series/rect-series-canvas":344,"./plot/series/vertical-bar-series":347,"./plot/series/vertical-bar-series-canvas":346,"./plot/series/vertical-rect-series":349,"./plot/series/vertical-rect-series-canvas":348,"./plot/vertical-grid-lines":350,"./plot/voronoi":351,"./plot/xy-plot":352,"./radial-chart":354,"./sankey":355,"./sunburst":356,"./treemap":358,"./utils/axis-utils":360,"./utils/scales-utils":364}],304:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _theme=require("../theme");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var propTypes={className:_propTypes2.default.string,height:_propTypes2.default.number,endColor:_propTypes2.default.string,endTitle:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]).isRequired,midColor:_propTypes2.default.string,midTitle:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),startColor:_propTypes2.default.string,startTitle:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]).isRequired,width:_propTypes2.default.number};var defaultProps={className:"",startColor:_theme.CONTINUOUS_COLOR_RANGE[0],endColor:_theme.CONTINUOUS_COLOR_RANGE[1]};function ContinuousColorLegend(_ref){var startColor=_ref.startColor,midColor=_ref.midColor,endColor=_ref.endColor,startTitle=_ref.startTitle,midTitle=_ref.midTitle,endTitle=_ref.endTitle,height=_ref.height,width=_ref.width,className=_ref.className;var colors=[startColor];if(midColor){colors.push(midColor)}colors.push(endColor);return _react2.default.createElement("div",{className:"rv-continuous-color-legend "+className,style:{width:width,height:height}},_react2.default.createElement("div",{className:"rv-gradient",style:{background:"linear-gradient(to right, "+colors.join(",")+")"}}),_react2.default.createElement("div",{className:"rv-legend-titles"},_react2.default.createElement("span",{className:"rv-legend-titles__left"},startTitle),_react2.default.createElement("span",{className:"rv-legend-titles__right"},endTitle),midTitle?_react2.default.createElement("span",{className:"rv-legend-titles__center"},midTitle):null))}ContinuousColorLegend.displayName="ContinuousColorLegend";ContinuousColorLegend.propTypes=propTypes;ContinuousColorLegend.defaultProps=defaultProps;exports.default=ContinuousColorLegend},{"../theme":357,"prop-types":257,react:297}],305:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var propTypes={className:_propTypes2.default.string,circlesTotal:_propTypes2.default.number,endSize:_propTypes2.default.number,endTitle:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]).isRequired,height:_propTypes2.default.number,startSize:_propTypes2.default.number,startTitle:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]).isRequired,width:_propTypes2.default.number};var defaultProps={circlesTotal:10,className:"",endSize:20,startSize:2};function ContinuousSizeLegend(_ref){var startTitle=_ref.startTitle,endTitle=_ref.endTitle,startSize=_ref.startSize,endSize=_ref.endSize,circlesTotal=_ref.circlesTotal,height=_ref.height,width=_ref.width,className=_ref.className;var circles=[];var step=(endSize-startSize)/(circlesTotal-1);for(var i=0;i<circlesTotal;i++){var size=step*i+startSize;circles.push(_react2.default.createElement("div",{key:i,className:"rv-bubble",style:{width:size,height:size,borderRadius:size/2}}));circles.push(" ")}return _react2.default.createElement("div",{className:"rv-continuous-size-legend "+className,style:{width:width,height:height}},_react2.default.createElement("div",{className:"rv-bubbles",style:{height:endSize}},circles,_react2.default.createElement("div",{className:"rv-spacer"})),_react2.default.createElement("div",{className:"rv-legend-titles"},_react2.default.createElement("span",{className:"rv-legend-titles__left"},startTitle),_react2.default.createElement("span",{className:"rv-legend-titles__right"},endTitle)))}ContinuousSizeLegend.displayName="ContinuousSizeLegend";ContinuousSizeLegend.propTypes=propTypes;ContinuousSizeLegend.defaultProps=defaultProps;exports.default=ContinuousSizeLegend},{"prop-types":257,react:297}],306:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var propTypes={title:_propTypes2.default.string.isRequired,color:_propTypes2.default.string.isRequired,disabled:_propTypes2.default.bool,onClick:_propTypes2.default.func,orientation:_propTypes2.default.oneOf(["vertical","horizontal"]).isRequired};var defaultProps={disabled:false};function DiscreteColorLegendItem(_ref){var onClick=_ref.onClick,title=_ref.title,color=_ref.color,disabled=_ref.disabled,orientation=_ref.orientation;var className="rv-discrete-color-legend-item "+orientation;if(disabled){className+=" disabled"}if(onClick){className+=" clickable"}return _react2.default.createElement("div",{className:className,onClick:onClick},_react2.default.createElement("span",{className:"rv-discrete-color-legend-item__color",style:disabled?null:{background:color}}),_react2.default.createElement("span",{className:"rv-discrete-color-legend-item__title"},title))}DiscreteColorLegendItem.propTypes=propTypes;DiscreteColorLegendItem.defaultProps=defaultProps;DiscreteColorLegendItem.displayName="DiscreteColorLegendItem";exports.default=DiscreteColorLegendItem},{"prop-types":257,react:297}],307:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _discreteColorLegendItem=require("./discrete-color-legend-item");var _discreteColorLegendItem2=_interopRequireDefault(_discreteColorLegendItem);var _theme=require("../theme");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var propTypes={className:_propTypes2.default.string,items:_propTypes2.default.arrayOf(_propTypes2.default.oneOfType([_propTypes2.default.shape({title:_propTypes2.default.string.isRequired,color:_propTypes2.default.string,disabled:_propTypes2.default.bool}),_propTypes2.default.string.isRequired])).isRequired,onItemClick:_propTypes2.default.func,height:_propTypes2.default.number,width:_propTypes2.default.number,orientation:_propTypes2.default.oneOf(["vertical","horizontal"])};var defaultProps={className:"",colors:_theme.DISCRETE_COLOR_RANGE,orientation:"vertical"};function fillItemsWithDefaults(items){return items.map(function(item,i){return{title:item.title?item.title:item,color:item.color?item.color:_theme.DISCRETE_COLOR_RANGE[i%_theme.DISCRETE_COLOR_RANGE.length],disabled:Boolean(item.disabled)}})}function DiscreteColorLegend(_ref){var initialItems=_ref.items,width=_ref.width,height=_ref.height,onItemClick=_ref.onItemClick,orientation=_ref.orientation,className=_ref.className;var updatedItems=fillItemsWithDefaults(initialItems);return _react2.default.createElement("div",{className:"rv-discrete-color-legend "+orientation+" "+className,style:{width:width,height:height}},updatedItems.map(function(item,i){return _react2.default.createElement(_discreteColorLegendItem2.default,_extends({},item,{orientation:orientation,key:i,onClick:onItemClick?function(){return onItemClick(initialItems[i],i)}:null}))}))}DiscreteColorLegend.displayName="DiscreteColorLegendItem";DiscreteColorLegend.propTypes=propTypes;DiscreteColorLegend.defaultProps=defaultProps;exports.default=DiscreteColorLegend},{"../theme":357,"./discrete-color-legend-item":306,"prop-types":257,react:297}],308:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _discreteColorLegend=require("./discrete-color-legend");var _discreteColorLegend2=_interopRequireDefault(_discreteColorLegend);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var propTypes=_extends({},_discreteColorLegend2.default.propTypes,{searchText:_propTypes2.default.string,onSearchChange:_propTypes2.default.func,searchPlaceholder:_propTypes2.default.string,searchFn:_propTypes2.default.func});var defaultProps={className:"",searchText:"",searchFn:function searchFn(items,s){return items.filter(function(item){return String(item.title||item).toLowerCase().indexOf(s)!==-1})}};function SearchableDiscreteColorLegend(props){var items=props.items,onItemClick=props.onItemClick,searchFn=props.searchFn,onSearchChange=props.onSearchChange,searchText=props.searchText,searchPlaceholder=props.searchPlaceholder,width=props.width,height=props.height,className=props.className;var onChange=onSearchChange?function(_ref){var value=_ref.target.value;return onSearchChange(value)}:null;var filteredItems=searchFn(items,searchText);return _react2.default.createElement("div",{className:"rv-search-wrapper "+className,style:{width:width,height:height}},_react2.default.createElement("form",{className:"rv-search-wrapper__form"},_react2.default.createElement("input",{type:"search",placeholder:searchPlaceholder,className:"rv-search-wrapper__form__input",value:searchText,onChange:onChange})),_react2.default.createElement("div",{className:"rv-search-wrapper__contents"},_react2.default.createElement(_discreteColorLegend2.default,{items:filteredItems,onItemClick:onItemClick})))}SearchableDiscreteColorLegend.propTypes=propTypes;SearchableDiscreteColorLegend.defaultProps=defaultProps;SearchableDiscreteColorLegend.displayName="SearchableDiscreteColorLegend";exports.default=SearchableDiscreteColorLegend},{"./discrete-color-legend":307,"prop-types":257,react:297}],309:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.default=makeVisFlexible;var _react=require("react");var _react2=_interopRequireDefault(_react);var _window=require("global/window");var _window2=_interopRequireDefault(_window);var _reactUtils=require("./utils/react-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CONTAINER_REF="container";var resizeSubscribers=[];var DEBOUNCE_DURATION=100;var timeoutId=null;function debounceEmitResize(){_window2.default.clearTimeout(timeoutId);timeoutId=_window2.default.setTimeout(emitResize,DEBOUNCE_DURATION)}function emitResize(){resizeSubscribers.forEach(function(cb){return cb()})}function subscribeToDebouncedResize(cb){resizeSubscribers.push(cb);if(resizeSubscribers.length===1){_window2.default.addEventListener("resize",debounceEmitResize)}return function unsubscribe(){removeSubscriber(cb);if(resizeSubscribers.length===0){_window2.default.clearTimeout(timeoutId);_window2.default.removeEventListener("resize",debounceEmitResize)}}}function removeSubscriber(cb){var index=resizeSubscribers.indexOf(cb);if(index>-1){resizeSubscribers.splice(index,1)}}function makeVisFlexible(Component){var ResultClass=function(_React$Component){_inherits(ResultClass,_React$Component);_createClass(ResultClass,null,[{key:"propTypes",get:function get(){var _Component$propTypes=Component.propTypes,width=_Component$propTypes.width,otherPropTypes=_objectWithoutProperties(_Component$propTypes,["width"]);return otherPropTypes}}]);function ResultClass(props){_classCallCheck(this,ResultClass);var _this=_possibleConstructorReturn(this,(ResultClass.__proto__||Object.getPrototypeOf(ResultClass)).call(this,props));_this.state={width:0};_this._onResize=_this._onResize.bind(_this);return _this}_createClass(ResultClass,[{key:"_onResize",value:function _onResize(){var containerElement=(0,_reactUtils.getDOMNode)(this.refs[CONTAINER_REF]);var offsetWidth=containerElement.offsetWidth;if(this.state.width!==offsetWidth){this.setState({width:offsetWidth})}}},{key:"componentDidMount",value:function componentDidMount(){this._onResize();this.cancelSubscription=subscribeToDebouncedResize(this._onResize)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(){this._onResize()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.cancelSubscription()}},{key:"render",value:function render(){var width=this.state.width;var props=_extends({},this.props,{animation:width===0?null:this.props.animation});return _react2.default.createElement("div",{ref:CONTAINER_REF},_react2.default.createElement(Component,_extends({width:width},props)))}}]);return ResultClass}(_react2.default.Component);ResultClass.displayName="Flexible"+Component.displayName;return ResultClass}},{"./utils/react-utils":363,"global/window":154,react:297}],310:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _axisUtils=require("../../utils/axis-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var LEFT=_axisUtils.ORIENTATION.LEFT,RIGHT=_axisUtils.ORIENTATION.RIGHT,TOP=_axisUtils.ORIENTATION.TOP,BOTTOM=_axisUtils.ORIENTATION.BOTTOM;var propTypes={width:_propTypes2.default.number.isRequired,height:_propTypes2.default.number.isRequired,orientation:_propTypes2.default.oneOf([LEFT,RIGHT,TOP,BOTTOM]).isRequired};function AxisLine(_ref){var orientation=_ref.orientation,width=_ref.width,height=_ref.height;var lineProps=void 0;if(orientation===LEFT){lineProps={x1:width,x2:width,y1:0,y2:height}}else if(orientation===RIGHT){lineProps={x1:0,x2:0,y1:0,y2:height}}else if(orientation===TOP){lineProps={x1:0,x2:width,y1:height,y2:height}}else{lineProps={x1:0,x2:width,y1:0,y2:0}}return _react2.default.createElement("line",_extends({},lineProps,{className:"rv-xy-plot__axis__line"}))}AxisLine.displayName="AxisLine";AxisLine.propTypes=propTypes;exports.default=AxisLine},{"../../utils/axis-utils":360,"prop-types":257,react:297}],311:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _axisUtils=require("../../utils/axis-utils");var _scalesUtils=require("../../utils/scales-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LEFT=_axisUtils.ORIENTATION.LEFT,RIGHT=_axisUtils.ORIENTATION.RIGHT,TOP=_axisUtils.ORIENTATION.TOP,BOTTOM=_axisUtils.ORIENTATION.BOTTOM;var propTypes={width:_propTypes2.default.number.isRequired,height:_propTypes2.default.number.isRequired,orientation:_propTypes2.default.oneOf([LEFT,RIGHT,TOP,BOTTOM]).isRequired};function _getTickFormatFn(scale,tickTotal,tickFormat){return!tickFormat?scale.tickFormat?scale.tickFormat(tickTotal):function(v){return v}:tickFormat}var AxisTicks=function(_React$Component){_inherits(AxisTicks,_React$Component);function AxisTicks(){_classCallCheck(this,AxisTicks);return _possibleConstructorReturn(this,(AxisTicks.__proto__||Object.getPrototypeOf(AxisTicks)).apply(this,arguments))}_createClass(AxisTicks,[{key:"_isAxisVertical",value:function _isAxisVertical(){var orientation=this.props.orientation;return orientation===LEFT||orientation===RIGHT}},{key:"_areTicksWrapped",value:function _areTicksWrapped(){var orientation=this.props.orientation;return orientation===LEFT||orientation===TOP}},{key:"_getTickContainerPropsGetterFn",value:function _getTickContainerPropsGetterFn(){if(this._isAxisVertical()){return function(pos){return{transform:"translate(0, "+pos+")"}}}return function(pos){return{transform:"translate("+pos+", 0)"}}}},{key:"_getTickLineProps",value:function _getTickLineProps(){var _ref;var _props=this.props,tickSize=_props.tickSize,_props$tickSizeOuter=_props.tickSizeOuter,tickSizeOuter=_props$tickSizeOuter===undefined?tickSize:_props$tickSizeOuter,_props$tickSizeInner=_props.tickSizeInner,tickSizeInner=_props$tickSizeInner===undefined?tickSize:_props$tickSizeInner;var isVertical=this._isAxisVertical();var tickXAttr=isVertical?"y":"x";var tickYAttr=isVertical?"x":"y";var wrap=this._areTicksWrapped()?-1:1;return _ref={},_defineProperty(_ref,tickXAttr+"1",0),_defineProperty(_ref,tickXAttr+"2",0),_defineProperty(_ref,tickYAttr+"1",-wrap*tickSizeInner),_defineProperty(_ref,tickYAttr+"2",wrap*tickSizeOuter),_ref}},{key:"_getTickLabelProps",value:function _getTickLabelProps(){var _props2=this.props,orientation=_props2.orientation,tickLabelAngle=_props2.tickLabelAngle,tickSize=_props2.tickSize,_props2$tickSizeOuter=_props2.tickSizeOuter,tickSizeOuter=_props2$tickSizeOuter===undefined?tickSize:_props2$tickSizeOuter,_props2$tickPadding=_props2.tickPadding,tickPadding=_props2$tickPadding===undefined?tickSize:_props2$tickPadding;var textAnchor=void 0;if(orientation===LEFT||orientation===BOTTOM&&tickLabelAngle){textAnchor="end"}else if(orientation===RIGHT||orientation===TOP&&tickLabelAngle){textAnchor="start"}else{textAnchor="middle"}var isVertical=this._isAxisVertical();var wrap=this._areTicksWrapped()?-1:1;var labelOffset=wrap*(tickSizeOuter+tickPadding);var transform=(isVertical?"translate("+labelOffset+", 0)":"translate(0, "+labelOffset+")")+(tickLabelAngle?" rotate("+tickLabelAngle+")":"");var dy=orientation===TOP||tickLabelAngle?"0":orientation===BOTTOM?"0.72em":"0.32em";return{textAnchor:textAnchor,dy:dy,transform:transform}}},{key:"render",value:function render(){var _props3=this.props,attr=_props3.attr,orientation=_props3.orientation,width=_props3.width,height=_props3.height,tickFormat=_props3.tickFormat,tickTotal=_props3.tickTotal,tickValues=_props3.tickValues;var x=orientation===LEFT?width:0;var y=orientation===TOP?height:0;var scale=(0,_scalesUtils.getAttributeScale)(this.props,attr);var values=(0,_axisUtils.getTickValues)(scale,tickTotal,tickValues);var tickFormatFn=_getTickFormatFn(scale,tickTotal,tickFormat);var translateFn=this._getTickContainerPropsGetterFn();var pathProps=this._getTickLineProps();var textProps=this._getTickLabelProps();var ticks=values.map(function(v,i){var pos=scale(v);var text=tickFormatFn(v);return _react2.default.createElement("g",_extends({key:i},translateFn(pos,0),{className:"rv-xy-plot__axis__tick"}),_react2.default.createElement("line",_extends({},pathProps,{className:"rv-xy-plot__axis__tick__line"})),_react2.default.createElement("text",_extends({},textProps,{
className:"rv-xy-plot__axis__tick__text"}),text))});return _react2.default.createElement("g",{transform:"translate("+x+", "+y+")",className:"rv-xy-plot__axis__ticks"},ticks)}}]);return AxisTicks}(_react2.default.Component);AxisTicks.displayName="AxisTicks";AxisTicks.propTypes=propTypes;AxisTicks.requiresSVG=true;exports.default=AxisTicks},{"../../utils/axis-utils":360,"../../utils/scales-utils":364,"prop-types":257,react:297}],312:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _axisUtils=require("../../utils/axis-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var ADJUSTMENT_FOR_TEXT_SIZE=16;var LEFT=_axisUtils.ORIENTATION.LEFT,RIGHT=_axisUtils.ORIENTATION.RIGHT,TOP=_axisUtils.ORIENTATION.TOP,BOTTOM=_axisUtils.ORIENTATION.BOTTOM;var transformation=function transformation(width,height){var _ref;return _ref={},_defineProperty(_ref,LEFT,{x:ADJUSTMENT_FOR_TEXT_SIZE,y:0,rotation:-90,textAnchor:"end"}),_defineProperty(_ref,RIGHT,{x:ADJUSTMENT_FOR_TEXT_SIZE*-.5,y:height,rotation:-90,textAnchor:"start"}),_defineProperty(_ref,TOP,{x:0,y:ADJUSTMENT_FOR_TEXT_SIZE,rotation:0,textAnchor:"start"}),_defineProperty(_ref,BOTTOM,{x:width,y:-6,rotation:0,textAnchor:"end"}),_ref};var propTypes={width:_propTypes2.default.number.isRequired,height:_propTypes2.default.number.isRequired,orientation:_propTypes2.default.oneOf([LEFT,RIGHT,TOP,BOTTOM]).isRequired,title:_propTypes2.default.string.isRequired};function AxisTitle(_ref2){var orientation=_ref2.orientation,width=_ref2.width,height=_ref2.height,title=_ref2.title;var outerGroupTranslateX=orientation===LEFT?width:0;var outerGroupTranslateY=orientation===TOP?height:0;var outerGroupTransform="translate("+outerGroupTranslateX+", "+outerGroupTranslateY+")";var _transformation$orien=transformation(width,height)[orientation],x=_transformation$orien.x,y=_transformation$orien.y,rotation=_transformation$orien.rotation,textAnchor=_transformation$orien.textAnchor;var innerGroupTransform="translate("+x+", "+y+") rotate("+rotation+")";return _react2.default.createElement("g",{transform:outerGroupTransform,className:"rv-xy-plot__axis__title"},_react2.default.createElement("g",{style:{textAnchor:textAnchor},transform:innerGroupTransform},_react2.default.createElement("text",null,title)))}AxisTitle.displayName="AxisTitle";AxisTitle.propTypes=propTypes;exports.default=AxisTitle},{"../../utils/axis-utils":360,"prop-types":257,react:297}],313:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _animation=require("../../animation");var _animation2=_interopRequireDefault(_animation);var _pureRenderComponent=require("../../pure-render-component");var _pureRenderComponent2=_interopRequireDefault(_pureRenderComponent);var _axisUtils=require("../../utils/axis-utils");var _axisLine=require("./axis-line");var _axisLine2=_interopRequireDefault(_axisLine);var _axisTicks=require("./axis-ticks");var _axisTicks2=_interopRequireDefault(_axisTicks);var _axisTitle=require("./axis-title");var _axisTitle2=_interopRequireDefault(_axisTitle);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var animatedProps=["xRange","yRange","xDomain","yDomain","width","height","marginLeft","marginTop","marginRight","marginBottom","tickSize","tickTotal","tickSizeInner","tickSizeOuter"];var LEFT=_axisUtils.ORIENTATION.LEFT,RIGHT=_axisUtils.ORIENTATION.RIGHT,TOP=_axisUtils.ORIENTATION.TOP,BOTTOM=_axisUtils.ORIENTATION.BOTTOM;var propTypes={orientation:_propTypes2.default.oneOf([LEFT,RIGHT,TOP,BOTTOM]),attr:_propTypes2.default.string.isRequired,width:_propTypes2.default.number,height:_propTypes2.default.number,top:_propTypes2.default.number,left:_propTypes2.default.number,title:_propTypes2.default.string,className:_propTypes2.default.string,hideTicks:_propTypes2.default.bool,hideLine:_propTypes2.default.bool,tickLabelAngle:_propTypes2.default.number,tickSize:_propTypes2.default.number,tickSizeInner:_propTypes2.default.number,tickSizeOuter:_propTypes2.default.number,tickPadding:_propTypes2.default.number,tickValues:_propTypes2.default.array,tickFormat:_propTypes2.default.func,tickTotal:_propTypes2.default.number,marginTop:_propTypes2.default.number,marginBottom:_propTypes2.default.number,marginLeft:_propTypes2.default.number,marginRight:_propTypes2.default.number,innerWidth:_propTypes2.default.number,innerHeight:_propTypes2.default.number};var defaultProps={className:"",tickSize:6,tickPadding:8,orientation:BOTTOM};var predefinedClassName="rv-xy-plot__axis";var VERTICAL_CLASS_NAME="rv-xy-plot__axis--vertical";var HORIZONTAL_CLASS_NAME="rv-xy-plot__axis--horizontal";var Axis=function(_PureRenderComponent){_inherits(Axis,_PureRenderComponent);function Axis(){_classCallCheck(this,Axis);return _possibleConstructorReturn(this,(Axis.__proto__||Object.getPrototypeOf(Axis)).apply(this,arguments))}_createClass(Axis,[{key:"_getDefaultAxisProps",value:function _getDefaultAxisProps(){var _props=this.props,innerWidth=_props.innerWidth,innerHeight=_props.innerHeight,marginTop=_props.marginTop,marginBottom=_props.marginBottom,marginLeft=_props.marginLeft,marginRight=_props.marginRight,orientation=_props.orientation;if(orientation===BOTTOM){return{tickTotal:(0,_axisUtils.getTicksTotalFromSize)(innerWidth),top:innerHeight+marginTop,left:marginLeft,width:innerWidth,height:marginBottom}}else if(orientation===TOP){return{tickTotal:(0,_axisUtils.getTicksTotalFromSize)(innerWidth),top:0,left:marginLeft,width:innerWidth,height:marginTop}}else if(orientation===LEFT){return{tickTotal:(0,_axisUtils.getTicksTotalFromSize)(innerHeight),top:marginTop,left:0,width:marginLeft,height:innerHeight}}return{tickTotal:(0,_axisUtils.getTicksTotalFromSize)(innerHeight),top:marginTop,left:marginLeft+innerWidth,width:marginRight,height:innerHeight}}},{key:"render",value:function render(){var animation=this.props.animation;if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:animatedProps}),_react2.default.createElement(Axis,_extends({},this.props,{animation:null})))}var props=_extends({},this._getDefaultAxisProps(),this.props);var className=props.className,height=props.height,hideLine=props.hideLine,hideTicks=props.hideTicks,left=props.left,orientation=props.orientation,title=props.title,top=props.top,width=props.width;var isVertical=[LEFT,RIGHT].indexOf(orientation)>-1;var axisClassName=isVertical?VERTICAL_CLASS_NAME:HORIZONTAL_CLASS_NAME;return _react2.default.createElement("g",{transform:"translate("+left+","+top+")",className:predefinedClassName+" "+axisClassName+" "+className},!hideLine&&_react2.default.createElement(_axisLine2.default,{height:height,width:width,orientation:orientation}),!hideTicks&&_react2.default.createElement(_axisTicks2.default,props),title?_react2.default.createElement(_axisTitle2.default,{title:title,height:height,width:width,orientation:orientation}):null)}}]);return Axis}(_pureRenderComponent2.default);Axis.displayName="Axis";Axis.propTypes=propTypes;Axis.defaultProps=defaultProps;Axis.requiresSVG=true;exports.default=Axis},{"../../animation":302,"../../pure-render-component":353,"../../utils/axis-utils":360,"./axis-line":310,"./axis-ticks":311,"./axis-title":312,"prop-types":257,react:297}],314:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _axisUtils=require("../../utils/axis-utils");var _axis=require("./axis");var _axis2=_interopRequireDefault(_axis);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TOP=_axisUtils.ORIENTATION.TOP,BOTTOM=_axisUtils.ORIENTATION.BOTTOM;var propTypes=_extends({},_axis2.default.propTypes,{orientation:_propTypes2.default.oneOf([TOP,BOTTOM])});var defaultProps={orientation:BOTTOM,attr:"x"};function XAxis(props){return _react2.default.createElement(_axis2.default,props)}XAxis.displayName="XAxis";XAxis.propTypes=propTypes;XAxis.defaultProps=defaultProps;XAxis.requiresSVG=true;exports.default=XAxis},{"../../utils/axis-utils":360,"./axis":313,"prop-types":257,react:297}],315:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _axisUtils=require("../../utils/axis-utils");var _axis=require("./axis");var _axis2=_interopRequireDefault(_axis);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var LEFT=_axisUtils.ORIENTATION.LEFT,RIGHT=_axisUtils.ORIENTATION.RIGHT;var propTypes=_extends({},_axis2.default.propTypes,{orientation:_propTypes2.default.oneOf([LEFT,RIGHT])});var defaultProps={orientation:LEFT,attr:"y"};function YAxis(props){return _react2.default.createElement(_axis2.default,props)}YAxis.displayName="YAxis";YAxis.propTypes=propTypes;YAxis.defaultProps=defaultProps;YAxis.requiresSVG=true;exports.default=YAxis},{"../../utils/axis-utils":360,"./axis":313,"prop-types":257,react:297}],316:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _pureRenderComponent=require("../pure-render-component");var _pureRenderComponent2=_interopRequireDefault(_pureRenderComponent);var _scalesUtils=require("../utils/scales-utils");var _animation=require("../animation");var _animation2=_interopRequireDefault(_animation);var _axisUtils=require("../utils/axis-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var animatedProps=["xRange","yRange","xDomain","yDomain","width","height","marginLeft","marginTop","marginRight","marginBottom","tickTotal"];var CircularGridLines=function(_PureRenderComponent){_inherits(CircularGridLines,_PureRenderComponent);function CircularGridLines(){_classCallCheck(this,CircularGridLines);return _possibleConstructorReturn(this,(CircularGridLines.__proto__||Object.getPrototypeOf(CircularGridLines)).apply(this,arguments))}_createClass(CircularGridLines,[{key:"_getDefaultProps",value:function _getDefaultProps(){var _props=this.props,innerWidth=_props.innerWidth,innerHeight=_props.innerHeight,marginTop=_props.marginTop,marginLeft=_props.marginLeft;return{left:marginLeft,top:marginTop,width:innerWidth,height:innerHeight,tickTotal:(0,_axisUtils.getTicksTotalFromSize)(Math.min(innerWidth,innerHeight))}}},{key:"render",value:function render(){var _props2=this.props,animation=_props2.animation,centerX=_props2.centerX,centerY=_props2.centerY;if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:animatedProps}),_react2.default.createElement(CircularGridLines,_extends({},this.props,{animation:null})))}var props=_extends({},this._getDefaultProps(),this.props);var tickTotal=props.tickTotal,tickValues=props.tickValues,marginLeft=props.marginLeft,marginTop=props.marginTop,rRange=props.rRange;var xScale=(0,_scalesUtils.getAttributeScale)(props,"x");var yScale=(0,_scalesUtils.getAttributeScale)(props,"y");var values=(0,_axisUtils.getTickValues)(xScale,tickTotal,tickValues);return _react2.default.createElement("g",{transform:"translate("+(xScale(centerX)+marginLeft)+","+(yScale(centerY)+marginTop)+")",className:"rv-xy-plot__circular-grid-lines"},values.reduce(function(res,value,index){var radius=xScale(value);if(rRange&&(radius<rRange[0]||radius>rRange[1])){return res}return res.concat([_react2.default.createElement("circle",_extends({cx:0,cy:0,r:radius},{key:index,className:"rv-xy-plot__circular-grid-lines__line"}))])},[]))}}]);return CircularGridLines}(_pureRenderComponent2.default);CircularGridLines.displayName="CircularGridLines";CircularGridLines.propTypes={centerX:_propTypes2.default.number,centerY:_propTypes2.default.number,width:_propTypes2.default.number,height:_propTypes2.default.number,top:_propTypes2.default.number,left:_propTypes2.default.number,rRange:_propTypes2.default.arrayOf(_propTypes2.default.number),tickValues:_propTypes2.default.arrayOf(_propTypes2.default.number),tickTotal:_propTypes2.default.number,animation:_animation.AnimationPropType,marginTop:_propTypes2.default.number,marginBottom:_propTypes2.default.number,marginLeft:_propTypes2.default.number,marginRight:_propTypes2.default.number,innerWidth:_propTypes2.default.number,innerHeight:_propTypes2.default.number};CircularGridLines.defaultProps={centerX:0,centerY:0};CircularGridLines.requiresSVG=true;exports.default=CircularGridLines},{"../animation":302,"../pure-render-component":353,"../utils/axis-utils":360,"../utils/scales-utils":364,"prop-types":257,react:297}],317:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _pureRenderComponent=require("../pure-render-component");var _pureRenderComponent2=_interopRequireDefault(_pureRenderComponent);var _scalesUtils=require("../utils/scales-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function defaultTitleFormat(values){var value=getFirstNonEmptyValue(values);if(value){return{title:"x",value:value.x}}}function defaultItemsFormat(values){return values.map(function(v,i){if(v){return{value:v.y,title:i}}})}function getFirstNonEmptyValue(values){return(values||[]).find(function(v){return Boolean(v)})}var Crosshair=function(_PureRenderComponent){_inherits(Crosshair,_PureRenderComponent);function Crosshair(){_classCallCheck(this,Crosshair);return _possibleConstructorReturn(this,(Crosshair.__proto__||Object.getPrototypeOf(Crosshair)).apply(this,arguments))}_createClass(Crosshair,[{key:"_renderCrosshairTitle",value:function _renderCrosshairTitle(){var _props=this.props,values=_props.values,titleFormat=_props.titleFormat;var titleItem=titleFormat(values);if(!titleItem){return null}return _react2.default.createElement("div",{className:"rv-crosshair__title",key:"title"},_react2.default.createElement("span",{className:"rv-crosshair__title__title"},titleItem.title),": ",_react2.default.createElement("span",{className:"rv-crosshair__title__value"},titleItem.value))}},{key:"_renderCrosshairItems",value:function _renderCrosshairItems(){var _props2=this.props,values=_props2.values,itemsFormat=_props2.itemsFormat;var items=itemsFormat(values);if(!items){return null}return items.filter(function(i){return i}).map(function renderValue(item,i){return _react2.default.createElement("div",{className:"rv-crosshair__item",key:"item"+i},_react2.default.createElement("span",{className:"rv-crosshair__item__title"},item.title),": ",_react2.default.createElement("span",{className:"rv-crosshair__item__value"},item.value))})}},{key:"render",value:function render(){var _props3=this.props,children=_props3.children,values=_props3.values,marginTop=_props3.marginTop,marginLeft=_props3.marginLeft,innerWidth=_props3.innerWidth,innerHeight=_props3.innerHeight;var value=getFirstNonEmptyValue(values);if(!value){return null}var x=(0,_scalesUtils.getAttributeFunctor)(this.props,"x");var innerLeft=x(value);var _props$orientation=this.props.orientation,orientation=_props$orientation===undefined?innerLeft>innerWidth/2?"left":"right":_props$orientation;var left=marginLeft+innerLeft;var top=marginTop;var innerClassName="rv-crosshair__inner rv-crosshair__inner--"+orientation;return _react2.default.createElement("div",{className:"rv-crosshair",style:{left:left+"px",top:top+"px"}},_react2.default.createElement("div",{className:"rv-crosshair__line",style:{height:innerHeight+"px"}}),_react2.default.createElement("div",{className:innerClassName},children?children:_react2.default.createElement("div",{className:"rv-crosshair__inner__content"},_react2.default.createElement("div",null,this._renderCrosshairTitle(),this._renderCrosshairItems()))))}}],[{key:"propTypes",get:function get(){return{values:_propTypes2.default.array,series:_propTypes2.default.object,innerWidth:_propTypes2.default.number,innerHeight:_propTypes2.default.number,marginLeft:_propTypes2.default.number,marginTop:_propTypes2.default.number,orientation:_propTypes2.default.oneOf(["left","right"]),itemsFormat:_propTypes2.default.func,titleFormat:_propTypes2.default.func}}},{key:"defaultProps",get:function get(){return{titleFormat:defaultTitleFormat,itemsFormat:defaultItemsFormat}}}]);return Crosshair}(_pureRenderComponent2.default);Crosshair.displayName="Crosshair";exports.default=Crosshair},{"../pure-render-component":353,"../utils/scales-utils":364,"prop-types":257,react:297}],318:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _pureRenderComponent=require("../pure-render-component");var _pureRenderComponent2=_interopRequireDefault(_pureRenderComponent);var _scalesUtils=require("../utils/scales-utils");var _animation=require("../animation");var _animation2=_interopRequireDefault(_animation);var _axisUtils=require("../utils/axis-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VERTICAL=_axisUtils.DIRECTION.VERTICAL,HORIZONTAL=_axisUtils.DIRECTION.HORIZONTAL;var propTypes={direction:_propTypes2.default.oneOf([VERTICAL,HORIZONTAL]),attr:_propTypes2.default.string.isRequired,width:_propTypes2.default.number,height:_propTypes2.default.number,top:_propTypes2.default.number,left:_propTypes2.default.number,tickValues:_propTypes2.default.array,tickTotal:_propTypes2.default.number,animation:_animation.AnimationPropType,marginTop:_propTypes2.default.number,marginBottom:_propTypes2.default.number,marginLeft:_propTypes2.default.number,marginRight:_propTypes2.default.number,innerWidth:_propTypes2.default.number,innerHeight:_propTypes2.default.number};var defaultProps={direction:VERTICAL};var animatedProps=["xRange","yRange","xDomain","yDomain","width","height","marginLeft","marginTop","marginRight","marginBottom","tickTotal"];var GridLines=function(_PureRenderComponent){_inherits(GridLines,_PureRenderComponent);function GridLines(){_classCallCheck(this,GridLines);return _possibleConstructorReturn(this,(GridLines.__proto__||Object.getPrototypeOf(GridLines)).apply(this,arguments))}_createClass(GridLines,[{key:"_getDefaultProps",value:function _getDefaultProps(){var _props=this.props,innerWidth=_props.innerWidth,innerHeight=_props.innerHeight,marginTop=_props.marginTop,marginLeft=_props.marginLeft,direction=_props.direction;return{left:marginLeft,top:marginTop,width:innerWidth,height:innerHeight,tickTotal:(0,_axisUtils.getTicksTotalFromSize)(direction===VERTICAL?innerWidth:innerHeight)}}},{key:"render",value:function render(){var animation=this.props.animation;if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:animatedProps}),_react2.default.createElement(GridLines,_extends({},this.props,{animation:null})))}var props=_extends({},this._getDefaultProps(),this.props);var attr=props.attr,direction=props.direction,width=props.width,height=props.height,tickTotal=props.tickTotal,tickValues=props.tickValues,top=props.top,left=props.left;var isVertical=direction===VERTICAL;var tickXAttr=isVertical?"y":"x";var tickYAttr=isVertical?"x":"y";var length=isVertical?height:width;var scale=(0,_scalesUtils.getAttributeScale)(props,attr);var values=(0,_axisUtils.getTickValues)(scale,tickTotal,tickValues);return _react2.default.createElement("g",{transform:"translate("+left+","+top+")",className:"rv-xy-plot__grid-lines"},values.map(function(v,i){var _pathProps;var pos=scale(v);var pathProps=(_pathProps={},_defineProperty(_pathProps,tickYAttr+"1",pos),_defineProperty(_pathProps,tickYAttr+"2",pos),_defineProperty(_pathProps,tickXAttr+"1",0),_defineProperty(_pathProps,tickXAttr+"2",length),_pathProps);return _react2.default.createElement("line",_extends({},pathProps,{key:i,className:"rv-xy-plot__grid-lines__line"}))}))}}]);return GridLines}(_pureRenderComponent2.default);GridLines.displayName="GridLines";GridLines.defaultProps=defaultProps;GridLines.propTypes=propTypes;GridLines.requiresSVG=true;exports.default=GridLines},{"../animation":302,"../pure-render-component":353,"../utils/axis-utils":360,"../utils/scales-utils":364,"prop-types":257,react:297}],319:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _pureRenderComponent=require("../pure-render-component");var _pureRenderComponent2=_interopRequireDefault(_pureRenderComponent);var _scalesUtils=require("../utils/scales-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ALIGN={AUTO:"auto",LEFT:"left",RIGHT:"right",LEFT_EDGE:"leftEdge",RIGHT_EDGE:"rightEdge",BOTTOM:"bottom",TOP:"top",BOTTOM_EDGE:"bottomEdge",TOP_EDGE:"topEdge"};var ORIENTATION={BOTTOM_LEFT:"bottomleft",BOTTOM_RIGHT:"bottomright",TOP_LEFT:"topleft",TOP_RIGHT:"topright"};function defaultFormat(value){return Object.keys(value).map(function getProp(key){return{title:key,value:value[key]}})}var Hint=function(_PureRenderComponent){_inherits(Hint,_PureRenderComponent);function Hint(){_classCallCheck(this,Hint);return _possibleConstructorReturn(this,(Hint.__proto__||Object.getPrototypeOf(Hint)).apply(this,arguments))}_createClass(Hint,[{key:"_getCSSRight",value:function _getCSSRight(x){if(x===undefined||x===null){return{right:0}}var _props=this.props,innerWidth=_props.innerWidth,marginRight=_props.marginRight;return{right:marginRight+innerWidth-x}}},{key:"_getCSSLeft",value:function _getCSSLeft(x){if(x===undefined||x===null){return{left:0}}var marginLeft=this.props.marginLeft;return{left:marginLeft+x}}},{key:"_getCSSBottom",value:function _getCSSBottom(y){if(y===undefined||y===null){return{bottom:0}}var _props2=this.props,innerHeight=_props2.innerHeight,marginBottom=_props2.marginBottom;return{bottom:marginBottom+innerHeight-y}}},{key:"_getCSSTop",value:function _getCSSTop(y){if(y===undefined||y===null){return{top:0}}var marginTop=this.props.marginTop;return{top:marginTop+y}}},{key:"_mapOrientationToAlign",value:function _mapOrientationToAlign(orientation){switch(orientation){case ORIENTATION.BOTTOM_LEFT:return{horizontal:ALIGN.LEFT,vertical:ALIGN.BOTTOM};case ORIENTATION.BOTTOM_RIGHT:return{horizontal:ALIGN.RIGHT,vertical:ALIGN.BOTTOM};case ORIENTATION.TOP_LEFT:return{horizontal:ALIGN.LEFT,vertical:ALIGN.TOP};case ORIENTATION.TOP_RIGHT:return{horizontal:ALIGN.RIGHT,vertical:ALIGN.TOP};default:break}}},{key:"_getAlign",value:function _getAlign(x,y){
var _props3=this.props,innerWidth=_props3.innerWidth,innerHeight=_props3.innerHeight,orientation=_props3.orientation,_props3$align=_props3.align,horizontal=_props3$align.horizontal,vertical=_props3$align.vertical;var align=orientation?this._mapOrientationToAlign(orientation):{horizontal:horizontal,vertical:vertical};if(horizontal===ALIGN.AUTO){align.horizontal=x>innerWidth/2?ALIGN.LEFT:ALIGN.RIGHT}if(vertical===ALIGN.AUTO){align.vertical=y>innerHeight/2?ALIGN.TOP:ALIGN.BOTTOM}return align}},{key:"_getAlignStyle",value:function _getAlignStyle(align,x,y){return _extends({},this._getXCSS(align.horizontal,x),this._getYCSS(align.vertical,y))}},{key:"_getYCSS",value:function _getYCSS(verticalAlign,y){switch(verticalAlign){case ALIGN.TOP_EDGE:return this._getCSSTop(null);case ALIGN.BOTTOM_EDGE:return this._getCSSBottom(null);case ALIGN.BOTTOM:return this._getCSSTop(y);case ALIGN.TOP:default:return this._getCSSBottom(y)}}},{key:"_getXCSS",value:function _getXCSS(horizontal,x){switch(horizontal){case ALIGN.LEFT_EDGE:return this._getCSSLeft(null);case ALIGN.RIGHT_EDGE:return this._getCSSRight(null);case ALIGN.LEFT:return this._getCSSRight(x);case ALIGN.RIGHT:default:return this._getCSSLeft(x)}}},{key:"_getAlignClassNames",value:function _getAlignClassNames(align){var orientation=this.props.orientation;var orientationClass=orientation?"rv-hint--orientation-"+orientation:"";return orientationClass+" rv-hint--horizontalAlign-"+align.horizontal+"\n     rv-hint--verticalAlign-"+align.vertical}},{key:"_getPositionInfo",value:function _getPositionInfo(){var _props4=this.props,value=_props4.value,getAlignStyle=_props4.getAlignStyle;var x=(0,_scalesUtils.getAttributeFunctor)(this.props,"x")(value);var y=(0,_scalesUtils.getAttributeFunctor)(this.props,"y")(value);var align=this._getAlign(x,y);return{style:getAlignStyle?getAlignStyle(align,x,y):this._getAlignStyle(align,x,y),className:this._getAlignClassNames(align)}}},{key:"render",value:function render(){var _props5=this.props,value=_props5.value,format=_props5.format,children=_props5.children;var _getPositionInfo2=this._getPositionInfo(),style=_getPositionInfo2.style,className=_getPositionInfo2.className;return _react2.default.createElement("div",{className:"rv-hint "+className,style:_extends({},style,{position:"absolute"})},children?children:_react2.default.createElement("div",{className:"rv-hint__content"},format(value).map(function(formattedProp,i){return _react2.default.createElement("div",{key:"rv-hint"+i},_react2.default.createElement("span",{className:"rv-hint__title"},formattedProp.title),": ",_react2.default.createElement("span",{className:"rv-hint__value"},formattedProp.value))})))}}],[{key:"propTypes",get:function get(){return{marginTop:_propTypes2.default.number,marginLeft:_propTypes2.default.number,innerWidth:_propTypes2.default.number,innerHeight:_propTypes2.default.number,scales:_propTypes2.default.object,value:_propTypes2.default.object,format:_propTypes2.default.func,align:_propTypes2.default.shape({horizontal:_propTypes2.default.oneOf([ALIGN.AUTO,ALIGN.LEFT,ALIGN.RIGHT,ALIGN.LEFT_EDGE,ALIGN.RIGHT_EDGE]),vertical:_propTypes2.default.oneOf([ALIGN.AUTO,ALIGN.BOTTOM,ALIGN.TOP,ALIGN.BOTTOM_EDGE,ALIGN.TOP_EDGE])}),getAlignStyle:_propTypes2.default.func,orientation:_propTypes2.default.oneOf([ORIENTATION.BOTTOM_LEFT,ORIENTATION.BOTTOM_RIGHT,ORIENTATION.TOP_LEFT,ORIENTATION.TOP_RIGHT])}}},{key:"defaultProps",get:function get(){return{format:defaultFormat,align:{horizontal:ALIGN.AUTO,vertical:ALIGN.AUTO}}}}]);return Hint}(_pureRenderComponent2.default);Hint.displayName="Hint";Hint.ORIENTATION=ORIENTATION;Hint.ALIGN=ALIGN;exports.default=Hint},{"../pure-render-component":353,"../utils/scales-utils":364,"prop-types":257,react:297}],320:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _axisUtils=require("../utils/axis-utils");var _gridLines=require("./grid-lines");var _gridLines2=_interopRequireDefault(_gridLines);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var HORIZONTAL=_axisUtils.DIRECTION.HORIZONTAL;var propTypes=_extends({},_gridLines2.default.propTypes,{direction:_propTypes2.default.oneOf([HORIZONTAL])});var defaultProps={direction:HORIZONTAL,attr:"y"};function HorizontalGridLines(props){return _react2.default.createElement(_gridLines2.default,props)}HorizontalGridLines.displayName="HorizontalGridLines";HorizontalGridLines.propTypes=propTypes;HorizontalGridLines.defaultProps=defaultProps;HorizontalGridLines.requiresSVG=true;exports.default=HorizontalGridLines},{"../utils/axis-utils":360,"./grid-lines":318,"prop-types":257,react:297}],321:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _d3Voronoi=require("d3-voronoi");var _pureRenderComponent=require("../../pure-render-component");var _pureRenderComponent2=_interopRequireDefault(_pureRenderComponent);var _animation=require("../../animation");var _scalesUtils=require("../../utils/scales-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var propTypes=_extends({},(0,_scalesUtils.getScalePropTypesByAttribute)("x"),(0,_scalesUtils.getScalePropTypesByAttribute)("y"),(0,_scalesUtils.getScalePropTypesByAttribute)("size"),(0,_scalesUtils.getScalePropTypesByAttribute)("opacity"),(0,_scalesUtils.getScalePropTypesByAttribute)("color"),{width:_propTypes2.default.number,height:_propTypes2.default.number,data:_propTypes2.default.array,onValueMouseOver:_propTypes2.default.func,onValueMouseOut:_propTypes2.default.func,onValueClick:_propTypes2.default.func,onSeriesMouseOver:_propTypes2.default.func,onSeriesMouseOut:_propTypes2.default.func,onSeriesClick:_propTypes2.default.func,onNearestX:_propTypes2.default.func,onNearestXY:_propTypes2.default.func,animation:_animation.AnimationPropType});var defaultProps={className:""};var AbstractSeries=function(_PureRenderComponent){_inherits(AbstractSeries,_PureRenderComponent);function AbstractSeries(props){_classCallCheck(this,AbstractSeries);var _this=_possibleConstructorReturn(this,(AbstractSeries.__proto__||Object.getPrototypeOf(AbstractSeries)).call(this,props));_this._seriesMouseOverHandler=_this._seriesMouseOverHandler.bind(_this);_this._valueMouseOverHandler=_this._valueMouseOverHandler.bind(_this);_this._seriesMouseOutHandler=_this._seriesMouseOutHandler.bind(_this);_this._valueMouseOutHandler=_this._valueMouseOutHandler.bind(_this);_this._seriesClickHandler=_this._seriesClickHandler.bind(_this);_this._valueClickHandler=_this._valueClickHandler.bind(_this);return _this}_createClass(AbstractSeries,[{key:"_valueMouseOverHandler",value:function _valueMouseOverHandler(d,event){var _props=this.props,onValueMouseOver=_props.onValueMouseOver,onSeriesMouseOver=_props.onSeriesMouseOver;if(onValueMouseOver){onValueMouseOver(d,{event:event})}if(onSeriesMouseOver){onSeriesMouseOver({event:event})}}},{key:"_seriesMouseOverHandler",value:function _seriesMouseOverHandler(event){var onSeriesMouseOver=this.props.onSeriesMouseOver;if(onSeriesMouseOver){onSeriesMouseOver({event:event})}}},{key:"_valueMouseOutHandler",value:function _valueMouseOutHandler(d,event){var _props2=this.props,onValueMouseOut=_props2.onValueMouseOut,onSeriesMouseOut=_props2.onSeriesMouseOut;if(onValueMouseOut){onValueMouseOut(d,{event:event})}if(onSeriesMouseOut){onSeriesMouseOut({event:event})}}},{key:"_seriesMouseOutHandler",value:function _seriesMouseOutHandler(event){var onSeriesMouseOut=this.props.onSeriesMouseOut;if(onSeriesMouseOut){onSeriesMouseOut({event:event})}}},{key:"_valueClickHandler",value:function _valueClickHandler(d,event){var _props3=this.props,onValueClick=_props3.onValueClick,onSeriesClick=_props3.onSeriesClick;if(onValueClick){onValueClick(d,{event:event})}if(onSeriesClick){onSeriesClick({event:event})}}},{key:"_seriesClickHandler",value:function _seriesClickHandler(event){var onSeriesClick=this.props.onSeriesClick;if(onSeriesClick){onSeriesClick({event:event})}}},{key:"_getAttributeFunctor",value:function _getAttributeFunctor(attr){return(0,_scalesUtils.getAttributeFunctor)(this.props,attr)}},{key:"_getAttr0Functor",value:function _getAttr0Functor(attr){return(0,_scalesUtils.getAttr0Functor)(this.props,attr)}},{key:"_getAttributeValue",value:function _getAttributeValue(attr){return(0,_scalesUtils.getAttributeValue)(this.props,attr)}},{key:"_getScaleDistance",value:function _getScaleDistance(attr){var scaleObject=(0,_scalesUtils.getScaleObjectFromProps)(this.props,attr);return scaleObject?scaleObject.distance:0}},{key:"_getXYCoordinateInContainer",value:function _getXYCoordinateInContainer(event){var _props4=this.props,_props4$marginTop=_props4.marginTop,marginTop=_props4$marginTop===undefined?0:_props4$marginTop,_props4$marginLeft=_props4.marginLeft,marginLeft=_props4$marginLeft===undefined?0:_props4$marginLeft;var _event$nativeEvent=event.nativeEvent,clientX=_event$nativeEvent.clientX,clientY=_event$nativeEvent.clientY,currentTarget=event.currentTarget;var rect=currentTarget.getBoundingClientRect();return{x:clientX-rect.left-currentTarget.clientLeft-marginLeft,y:clientY-rect.top-currentTarget.clientTop-marginTop}}},{key:"_handleNearestX",value:function _handleNearestX(event){var _props5=this.props,onNearestX=_props5.onNearestX,data=_props5.data;var minDistance=Number.POSITIVE_INFINITY;var value=null;var valueIndex=null;var coordinate=this._getXYCoordinateInContainer(event);var xScaleFn=this._getAttributeFunctor("x");data.forEach(function(item,i){var currentCoordinate=xScaleFn(item);var newDistance=Math.abs(coordinate.x-currentCoordinate);if(newDistance<minDistance){minDistance=newDistance;value=item;valueIndex=i}});if(!value){return}onNearestX(value,{innerX:xScaleFn(value),index:valueIndex,event:event.nativeEvent})}},{key:"_handleNearestXY",value:function _handleNearestXY(event){var _props6=this.props,onNearestXY=_props6.onNearestXY,data=_props6.data;var coordinate=this._getXYCoordinateInContainer(event);var xScaleFn=this._getAttributeFunctor("x");var yScaleFn=this._getAttributeFunctor("y");var voronoiInstance=(0,_d3Voronoi.voronoi)().x(xScaleFn).y(yScaleFn);var foundPoint=voronoiInstance(data).find(coordinate.x,coordinate.y);var value=foundPoint.data;if(!value){return}onNearestXY(value,{innerX:foundPoint.x,innerY:foundPoint.y,index:foundPoint.index,event:event.nativeEvent})}},{key:"onParentMouseMove",value:function onParentMouseMove(event){var _props7=this.props,onNearestX=_props7.onNearestX,onNearestXY=_props7.onNearestXY,data=_props7.data;if(!onNearestX&&!onNearestXY||!data){return}if(onNearestXY){this._handleNearestXY(event)}else{this._handleNearestX(event)}}}],[{key:"getParentConfig",value:function getParentConfig(){return{}}},{key:"requiresSVG",get:function get(){return true}}]);return AbstractSeries}(_pureRenderComponent2.default);AbstractSeries.displayName="AbstractSeries";AbstractSeries.propTypes=propTypes;AbstractSeries.defaultProps=defaultProps;exports.default=AbstractSeries},{"../../animation":302,"../../pure-render-component":353,"../../utils/scales-utils":364,"d3-voronoi":23,"prop-types":257}],322:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _animation=require("../../animation");var _animation2=_interopRequireDefault(_animation);var _seriesUtils=require("../../utils/series-utils");var _d3Shape=require("d3-shape");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _scalesUtils=require("../../utils/scales-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var predefinedClassName="rv-xy-plot__series rv-xy-plot__series--arc";var ATTRIBUTES=["radius","angle"];var ArcSeries=function(_AbstractSeries){_inherits(ArcSeries,_AbstractSeries);function ArcSeries(props){_classCallCheck(this,ArcSeries);var _this=_possibleConstructorReturn(this,(ArcSeries.__proto__||Object.getPrototypeOf(ArcSeries)).call(this,props));var scaleProps=_this._getAllScaleProps(props);_this.state={scaleProps:scaleProps};return _this}_createClass(ArcSeries,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){this.setState({scaleProps:this._getAllScaleProps(nextProps)})}},{key:"_getAllScaleProps",value:function _getAllScaleProps(props){var defaultScaleProps=this._getDefaultScaleProps(props);var userScaleProps=(0,_scalesUtils.extractScalePropsFromProps)(props,ATTRIBUTES);var missingScaleProps=(0,_scalesUtils.getMissingScaleProps)(_extends({},defaultScaleProps,userScaleProps),props.data,ATTRIBUTES);return _extends({},defaultScaleProps,userScaleProps,missingScaleProps)}},{key:"_getDefaultScaleProps",value:function _getDefaultScaleProps(props){var innerWidth=props.innerWidth,innerHeight=props.innerHeight;var radius=Math.min(innerWidth/2,innerHeight/2);return{radiusRange:[0,radius],_radiusValue:radius,angleType:"literal"}}},{key:"render",value:function render(){var _this2=this;var _props=this.props,arcClassName=_props.arcClassName,animation=_props.animation,className=_props.className,center=_props.center,data=_props.data,marginLeft=_props.marginLeft,marginTop=_props.marginTop,_props$style=_props.style,style=_props$style===undefined?{}:_props$style;if(!data){return null}if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:_seriesUtils.ANIMATED_SERIES_PROPS}),_react2.default.createElement(ArcSeries,_extends({},this.props,{animation:null})))}var scaleProps=this.state.scaleProps;var radiusDomain=scaleProps.radiusDomain;var radius=(0,_scalesUtils.getAttributeFunctor)(scaleProps,"radius");var radius0=(0,_scalesUtils.getAttr0Functor)(scaleProps,"radius");var angle=(0,_scalesUtils.getAttributeFunctor)(scaleProps,"angle");var angle0=(0,_scalesUtils.getAttr0Functor)(scaleProps,"angle");var fill=this._getAttributeFunctor("fill")||this._getAttributeFunctor("color");var stroke=this._getAttributeFunctor("stroke")||this._getAttributeFunctor("color");var opacity=this._getAttributeFunctor("opacity");var x=this._getAttributeFunctor("x");var y=this._getAttributeFunctor("y");return _react2.default.createElement("g",{className:predefinedClassName+" "+className,onMouseOver:this._seriesMouseOverHandler,onMouseOut:this._seriesMouseOutHandler,onClick:this._seriesClickHandler,ref:"container",transform:"translate("+(marginLeft+x(center))+","+(marginTop+y(center))+")"},data.map(function(row,i){var noRadius=radiusDomain[1]===radiusDomain[0];var arcArg={innerRadius:noRadius?0:radius0(row),outerRadius:radius(row),startAngle:angle0(row)||0,endAngle:angle(row)};var arcedData=(0,_d3Shape.arc)();var rowStyle=row.style||{};return _react2.default.createElement("path",{style:_extends({opacity:opacity&&opacity(row),stroke:stroke&&stroke(row),fill:fill&&fill(row)},style,rowStyle),onClick:function onClick(e){return _this2._valueClickHandler(row,e)},onMouseOver:function onMouseOver(e){return _this2._valueMouseOverHandler(row,e)},onMouseOut:function onMouseOut(e){return _this2._valueMouseOutHandler(row,e)},key:i,className:arcClassName,d:arcedData(arcArg)})}))}}]);return ArcSeries}(_abstractSeries2.default);ArcSeries.propTypes=_extends({},_abstractSeries2.default.propTypes,(0,_scalesUtils.getScalePropTypesByAttribute)("radius"),(0,_scalesUtils.getScalePropTypesByAttribute)("angle"),{center:_propTypes2.default.shape({x:_propTypes2.default.number,y:_propTypes2.default.number}),arcClassName:_propTypes2.default.string});ArcSeries.defaultProps={arcClassName:"",center:{x:0,y:0},className:""};ArcSeries.displayName="ArcSeries";exports.default=ArcSeries},{"../../animation":302,"../../utils/scales-utils":364,"../../utils/series-utils":365,"./abstract-series":321,"d3-shape":20,"prop-types":257,react:297}],323:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _d3Shape=require("d3-shape");var d3Shape=_interopRequireWildcard(_d3Shape);var _animation=require("../../animation");var _animation2=_interopRequireDefault(_animation);var _theme=require("../../theme");var _seriesUtils=require("../../utils/series-utils");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var predefinedClassName="rv-xy-plot__series rv-xy-plot__series--line";var AreaSeries=function(_AbstractSeries){_inherits(AreaSeries,_AbstractSeries);function AreaSeries(){_classCallCheck(this,AreaSeries);return _possibleConstructorReturn(this,(AreaSeries.__proto__||Object.getPrototypeOf(AreaSeries)).apply(this,arguments))}_createClass(AreaSeries,[{key:"_renderArea",value:function _renderArea(data,x,y0,y,curve){var area=d3Shape.area();if(curve!==null){if(typeof curve==="string"&&d3Shape[curve]){area=area.curve(d3Shape[curve])}else if(typeof curve==="function"){area=area.curve(curve)}}area=area.x(x).y0(y0).y1(y);return area(data)}},{key:"render",value:function render(){var _props=this.props,animation=_props.animation,className=_props.className,curve=_props.curve,data=_props.data,marginLeft=_props.marginLeft,marginTop=_props.marginTop;if(!data){return null}if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:_seriesUtils.ANIMATED_SERIES_PROPS}),_react2.default.createElement(AreaSeries,_extends({},this.props,{animation:null})))}var x=this._getAttributeFunctor("x");var y=this._getAttributeFunctor("y");var y0=this._getAttr0Functor("y");var stroke=this._getAttributeValue("stroke")||this._getAttributeValue("color");var fill=this._getAttributeValue("fill")||this._getAttributeValue("color");var newOpacity=this._getAttributeValue("opacity");var opacity=Number.isFinite(newOpacity)?newOpacity:_theme.DEFAULT_OPACITY;var d=this._renderArea(data,x,y0,y,curve);return _react2.default.createElement("path",{d:d,className:predefinedClassName+" "+className,transform:"translate("+marginLeft+","+marginTop+")",onMouseOver:this._seriesMouseOverHandler,onMouseOut:this._seriesMouseOutHandler,onClick:this._seriesClickHandler,style:{opacity:opacity,stroke:stroke,fill:fill}})}}]);return AreaSeries}(_abstractSeries2.default);AreaSeries.displayName="AreaSeries";exports.default=AreaSeries},{"../../animation":302,"../../theme":357,"../../utils/series-utils":365,"./abstract-series":321,"d3-shape":20,react:297}],324:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _d3Color=require("d3-color");var _theme=require("../../theme");var _scalesUtils=require("../../utils/scales-utils");var _seriesUtils=require("../../utils/series-utils");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function getScaleDistance(props,attr){var scaleObject=(0,_scalesUtils.getScaleObjectFromProps)(props,attr);return scaleObject?scaleObject.distance:0}var BarSeriesCanvas=function(_AbstractSeries){_inherits(BarSeriesCanvas,_AbstractSeries);function BarSeriesCanvas(){_classCallCheck(this,BarSeriesCanvas);return _possibleConstructorReturn(this,(BarSeriesCanvas.__proto__||Object.getPrototypeOf(BarSeriesCanvas)).apply(this,arguments))}_createClass(BarSeriesCanvas,[{key:"render",value:function render(){return null}}],[{key:"renderLayer",value:function renderLayer(props,ctx){var data=props.data,linePosAttr=props.linePosAttr,lineSizeAttr=props.lineSizeAttr,valuePosAttr=props.valuePosAttr;if(!data||data.length===0){return}var distance=getScaleDistance(props,linePosAttr);var line=(0,_scalesUtils.getAttributeFunctor)(props,linePosAttr);var value=(0,_scalesUtils.getAttributeFunctor)(props,valuePosAttr);var value0=(0,_scalesUtils.getAttr0Functor)(props,valuePosAttr);var fill=(0,_scalesUtils.getAttributeFunctor)(props,"fill")||(0,_scalesUtils.getAttributeFunctor)(props,"color");var stroke=(0,_scalesUtils.getAttributeFunctor)(props,"stroke")||(0,_scalesUtils.getAttributeFunctor)(props,"color");var opacity=(0,_scalesUtils.getAttributeFunctor)(props,"opacity");var itemSize=distance/2*.85;var _getStackParams=(0,_seriesUtils.getStackParams)(props),sameTypeTotal=_getStackParams.sameTypeTotal,sameTypeIndex=_getStackParams.sameTypeIndex;data.forEach(function(row){var fillColor=(0,_d3Color.rgb)(fill(row));var strokeColor=(0,_d3Color.rgb)(stroke(row));var rowOpacity=opacity(row)||_theme.DEFAULT_OPACITY;var linePos=line(row)-itemSize+itemSize*2/sameTypeTotal*sameTypeIndex;var valuePos=Math.min(value0(row),value(row));var x=valuePosAttr==="x"?valuePos:linePos;var y=valuePosAttr==="y"?valuePos:linePos;var lineSize=itemSize*2/sameTypeTotal;var valueSize=Math.abs(-value0(row)+value(row));var height=lineSizeAttr==="height"?lineSize:valueSize;var width=lineSizeAttr==="width"?lineSize:valueSize;ctx.beginPath();ctx.rect(x,y,width,height);ctx.fillStyle="rgba("+fillColor.r+", "+fillColor.g+", "+fillColor.b+", "+rowOpacity+")";ctx.fill();ctx.strokeStyle="rgba("+strokeColor.r+", "+strokeColor.g+", "+strokeColor.b+", "+rowOpacity+")";ctx.stroke()})}},{key:"requiresSVG",get:function get(){return false}},{key:"isCanvas",get:function get(){return true}}]);return BarSeriesCanvas}(_abstractSeries2.default);BarSeriesCanvas.displayName="BarSeriesCanvas";BarSeriesCanvas.defaultProps={linePosAttr:_propTypes2.default.string.isRequired,valuePosAttr:_propTypes2.default.string.isRequired,lineSizeAttr:_propTypes2.default.string.isRequired,valueSizeAttr:_propTypes2.default.string.isRequired};BarSeriesCanvas.propTypes=_extends({},_abstractSeries2.default.propTypes);exports.default=BarSeriesCanvas},{"../../theme":357,"../../utils/scales-utils":364,"../../utils/series-utils":365,"./abstract-series":321,"d3-color":8,"prop-types":257}],325:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _animation=require("../../animation");var _animation2=_interopRequireDefault(_animation);var _seriesUtils=require("../../utils/series-utils");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var predefinedClassName="rv-xy-plot__series rv-xy-plot__series--bar";var BarSeries=function(_AbstractSeries){_inherits(BarSeries,_AbstractSeries);function BarSeries(){_classCallCheck(this,BarSeries);return _possibleConstructorReturn(this,(BarSeries.__proto__||Object.getPrototypeOf(BarSeries)).apply(this,arguments))}_createClass(BarSeries,[{key:"render",value:function render(){var _this2=this;var _props=this.props,animation=_props.animation,className=_props.className,data=_props.data,linePosAttr=_props.linePosAttr,lineSizeAttr=_props.lineSizeAttr,marginLeft=_props.marginLeft,marginTop=_props.marginTop,valuePosAttr=_props.valuePosAttr,valueSizeAttr=_props.valueSizeAttr;if(!data){return null}
if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:_seriesUtils.ANIMATED_SERIES_PROPS}),_react2.default.createElement(BarSeries,_extends({},this.props,{animation:null})))}var _getStackParams=(0,_seriesUtils.getStackParams)(this.props),sameTypeTotal=_getStackParams.sameTypeTotal,sameTypeIndex=_getStackParams.sameTypeIndex;var distance=this._getScaleDistance(linePosAttr);var lineFunctor=this._getAttributeFunctor(linePosAttr);var valueFunctor=this._getAttributeFunctor(valuePosAttr);var value0Functor=this._getAttr0Functor(valuePosAttr);var fillFunctor=this._getAttributeFunctor("fill")||this._getAttributeFunctor("color");var strokeFunctor=this._getAttributeFunctor("stroke")||this._getAttributeFunctor("color");var opacityFunctor=this._getAttributeFunctor("opacity");var itemSize=distance/2*.85;return _react2.default.createElement("g",{className:predefinedClassName+" "+className,ref:"container",transform:"translate("+marginLeft+","+marginTop+")"},data.map(function(d,i){var _attrs;var attrs=(_attrs={style:{opacity:opacityFunctor&&opacityFunctor(d),stroke:strokeFunctor&&strokeFunctor(d),fill:fillFunctor&&fillFunctor(d)}},_defineProperty(_attrs,linePosAttr,lineFunctor(d)-itemSize+itemSize*2/sameTypeTotal*sameTypeIndex),_defineProperty(_attrs,lineSizeAttr,itemSize*2/sameTypeTotal),_defineProperty(_attrs,valuePosAttr,Math.min(value0Functor(d),valueFunctor(d))),_defineProperty(_attrs,valueSizeAttr,Math.abs(-value0Functor(d)+valueFunctor(d))),_defineProperty(_attrs,"onClick",function onClick(e){return _this2._valueClickHandler(d,e)}),_defineProperty(_attrs,"onMouseOver",function onMouseOver(e){return _this2._valueMouseOverHandler(d,e)}),_defineProperty(_attrs,"onMouseOut",function onMouseOut(e){return _this2._valueMouseOutHandler(d,e)}),_defineProperty(_attrs,"key",i),_attrs);return _react2.default.createElement("rect",attrs)}))}}],[{key:"propTypes",get:function get(){return _extends({},_abstractSeries2.default.propTypes,{linePosAttr:_propTypes2.default.string,valuePosAttr:_propTypes2.default.string,lineSizeAttr:_propTypes2.default.string,valueSizeAttr:_propTypes2.default.string,cluster:_propTypes2.default.string})}}]);return BarSeries}(_abstractSeries2.default);BarSeries.displayName="BarSeries";exports.default=BarSeries},{"../../animation":302,"../../utils/series-utils":365,"./abstract-series":321,"prop-types":257,react:297}],326:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CanvasWrapper=function(_Component){_inherits(CanvasWrapper,_Component);function CanvasWrapper(){_classCallCheck(this,CanvasWrapper);return _possibleConstructorReturn(this,(CanvasWrapper.__proto__||Object.getPrototypeOf(CanvasWrapper)).apply(this,arguments))}_createClass(CanvasWrapper,[{key:"componentDidMount",value:function componentDidMount(){this.drawChildren(this.props,this.refs.canvas.getContext("2d"))}},{key:"componentWillUpdate",value:function componentWillUpdate(nextProps){this.drawChildren(nextProps,this.refs.canvas.getContext("2d"))}},{key:"drawChildren",value:function drawChildren(props,ctx){var children=props.children,innerHeight=props.innerHeight,innerWidth=props.innerWidth;if(!ctx){return}ctx.clearRect(0,0,innerWidth,innerHeight);children.forEach(function(layer){return layer.type.renderLayer(layer.props,ctx)})}},{key:"render",value:function render(){var _props=this.props,marginLeft=_props.marginLeft,marginTop=_props.marginTop,innerHeight=_props.innerHeight,innerWidth=_props.innerWidth;return _react2.default.createElement("div",{style:{left:marginLeft,top:marginTop},className:"rv-xy-canvas"},_react2.default.createElement("canvas",{className:"rv-xy-canvas-element",height:innerHeight,width:innerWidth,ref:"canvas"}))}}]);return CanvasWrapper}(_react.Component);CanvasWrapper.displayName="CanvasWrapper";CanvasWrapper.propTypes={marginLeft:_propTypes2.default.number.isRequired,marginTop:_propTypes2.default.number.isRequired,innerHeight:_propTypes2.default.number.isRequired,innerWidth:_propTypes2.default.number.isRequired};exports.default=CanvasWrapper},{"prop-types":257,react:297}],327:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _deck=require("deck.gl");var _deck2=_interopRequireDefault(_deck);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DeckGLWrapper=function(_Component){_inherits(DeckGLWrapper,_Component);function DeckGLWrapper(){_classCallCheck(this,DeckGLWrapper);return _possibleConstructorReturn(this,(DeckGLWrapper.__proto__||Object.getPrototypeOf(DeckGLWrapper)).apply(this,arguments))}_createClass(DeckGLWrapper,[{key:"render",value:function render(){var _props=this.props,children=_props.children,marginLeft=_props.marginLeft,marginTop=_props.marginTop,marginBottom=_props.marginBottom,marginRight=_props.marginRight,innerHeight=_props.innerHeight,innerWidth=_props.innerWidth;var width=innerWidth+marginLeft+marginRight;var height=innerHeight+marginTop+marginBottom;var glViewport=new _deck.OrthographicViewport({width:width||0,height:height||0,left:-marginLeft,top:-marginTop});if(!innerHeight||!innerWidth){return null}var layers=children.reduce(function(res,layer){if(!layer.type.renderLayer){var trueLayer=layer.props.children;return res.concat(trueLayer.type.renderLayer(trueLayer.props))}return res.concat(layer.type.renderLayer(layer.props))},[]);return _react2.default.createElement(_deck2.default,{width:width,height:height,viewport:glViewport,style:{position:"absolute",top:0,left:0},layers:layers})}}]);return DeckGLWrapper}(_react.Component);DeckGLWrapper.displayName="DeckGLWrapper";DeckGLWrapper.propTypes={marginLeft:_propTypes2.default.number.isRequired,marginTop:_propTypes2.default.number.isRequired,marginBottom:_propTypes2.default.number.isRequired,marginRight:_propTypes2.default.number.isRequired,innerHeight:_propTypes2.default.number.isRequired,innerWidth:_propTypes2.default.number.isRequired};exports.default=DeckGLWrapper},{"deck.gl":32,"prop-types":257,react:297}],328:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _animation=require("../../animation");var _animation2=_interopRequireDefault(_animation);var _seriesUtils=require("../../utils/series-utils");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var predefinedClassName="rv-xy-plot__series rv-xy-plot__series--heatmap";var HeatmapSeries=function(_AbstractSeries){_inherits(HeatmapSeries,_AbstractSeries);function HeatmapSeries(){_classCallCheck(this,HeatmapSeries);return _possibleConstructorReturn(this,(HeatmapSeries.__proto__||Object.getPrototypeOf(HeatmapSeries)).apply(this,arguments))}_createClass(HeatmapSeries,[{key:"render",value:function render(){var _this2=this;var _props=this.props,animation=_props.animation,className=_props.className,data=_props.data,marginLeft=_props.marginLeft,marginTop=_props.marginTop;if(!data){return null}if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:_seriesUtils.ANIMATED_SERIES_PROPS}),_react2.default.createElement(HeatmapSeries,_extends({},this.props,{animation:null})))}var xFunctor=this._getAttributeFunctor("x");var yFunctor=this._getAttributeFunctor("y");var opacityFunctor=this._getAttributeFunctor("opacity");var fillFunctor=this._getAttributeFunctor("fill")||this._getAttributeFunctor("color");var strokeFunctor=this._getAttributeFunctor("stroke")||this._getAttributeFunctor("color");var xDistance=this._getScaleDistance("x");var yDistance=this._getScaleDistance("y");return _react2.default.createElement("g",{className:predefinedClassName+" "+className,ref:"container",transform:"translate("+marginLeft+","+marginTop+")"},data.map(function(d,i){var attrs={style:{stroke:strokeFunctor&&strokeFunctor(d),fill:fillFunctor&&fillFunctor(d),opacity:opacityFunctor&&opacityFunctor(d)},x:xFunctor(d)-xDistance/2,y:yFunctor(d)-yDistance/2,width:xDistance,height:yDistance,key:i,onClick:function onClick(e){return _this2._valueClickHandler(d,e)},onMouseOver:function onMouseOver(e){return _this2._valueMouseOverHandler(d,e)},onMouseOut:function onMouseOut(e){return _this2._valueMouseOutHandler(d,e)}};return _react2.default.createElement("rect",attrs)}))}}],[{key:"getParentConfig",value:function getParentConfig(attr){var isDomainAdjustmentNeeded=attr==="x"||attr==="y";return{isDomainAdjustmentNeeded:isDomainAdjustmentNeeded}}}]);return HeatmapSeries}(_abstractSeries2.default);HeatmapSeries.propTypes=_extends({},_abstractSeries2.default.propTypes);HeatmapSeries.displayName="HeatmapSeries";exports.default=HeatmapSeries},{"../../animation":302,"../../utils/series-utils":365,"./abstract-series":321,react:297}],329:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _barSeriesCanvas=require("./bar-series-canvas");var _barSeriesCanvas2=_interopRequireDefault(_barSeriesCanvas);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HorizontalBarSeriesCanvas=function(_AbstractSeries){_inherits(HorizontalBarSeriesCanvas,_AbstractSeries);function HorizontalBarSeriesCanvas(){_classCallCheck(this,HorizontalBarSeriesCanvas);return _possibleConstructorReturn(this,(HorizontalBarSeriesCanvas.__proto__||Object.getPrototypeOf(HorizontalBarSeriesCanvas)).apply(this,arguments))}_createClass(HorizontalBarSeriesCanvas,[{key:"render",value:function render(){return null}}],[{key:"getParentConfig",value:function getParentConfig(attr){var isDomainAdjustmentNeeded=attr==="y";var zeroBaseValue=attr==="x";return{isDomainAdjustmentNeeded:isDomainAdjustmentNeeded,zeroBaseValue:zeroBaseValue}}},{key:"renderLayer",value:function renderLayer(props,ctx){_barSeriesCanvas2.default.renderLayer(_extends({},props,{linePosAttr:"y",valuePosAttr:"x",lineSizeAttr:"height",valueSizeAttr:"width"}),ctx)}},{key:"requiresSVG",get:function get(){return false}},{key:"isCanvas",get:function get(){return true}}]);return HorizontalBarSeriesCanvas}(_abstractSeries2.default);HorizontalBarSeriesCanvas.displayName="HorizontalBarSeriesCanvas";HorizontalBarSeriesCanvas.propTypes=_extends({},_abstractSeries2.default.propTypes);exports.default=HorizontalBarSeriesCanvas},{"./abstract-series":321,"./bar-series-canvas":324}],330:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _barSeries=require("./bar-series");var _barSeries2=_interopRequireDefault(_barSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HorizontalBarSeries=function(_AbstractSeries){_inherits(HorizontalBarSeries,_AbstractSeries);function HorizontalBarSeries(){_classCallCheck(this,HorizontalBarSeries);return _possibleConstructorReturn(this,(HorizontalBarSeries.__proto__||Object.getPrototypeOf(HorizontalBarSeries)).apply(this,arguments))}_createClass(HorizontalBarSeries,[{key:"render",value:function render(){return _react2.default.createElement(_barSeries2.default,_extends({},this.props,{linePosAttr:"y",valuePosAttr:"x",lineSizeAttr:"height",valueSizeAttr:"width"}))}}],[{key:"getParentConfig",value:function getParentConfig(attr){var isDomainAdjustmentNeeded=attr==="y";var zeroBaseValue=attr==="x";return{isDomainAdjustmentNeeded:isDomainAdjustmentNeeded,zeroBaseValue:zeroBaseValue}}}]);return HorizontalBarSeries}(_abstractSeries2.default);HorizontalBarSeries.displayName="HorizontalBarSeries";exports.default=HorizontalBarSeries},{"./abstract-series":321,"./bar-series":325,react:297}],331:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _rectSeriesCanvas=require("./rect-series-canvas");var _rectSeriesCanvas2=_interopRequireDefault(_rectSeriesCanvas);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HorizontalRectSeriesCanvas=function(_AbstractSeries){_inherits(HorizontalRectSeriesCanvas,_AbstractSeries);function HorizontalRectSeriesCanvas(){_classCallCheck(this,HorizontalRectSeriesCanvas);return _possibleConstructorReturn(this,(HorizontalRectSeriesCanvas.__proto__||Object.getPrototypeOf(HorizontalRectSeriesCanvas)).apply(this,arguments))}_createClass(HorizontalRectSeriesCanvas,[{key:"render",value:function render(){return null}}],[{key:"getParentConfig",value:function getParentConfig(attr){var isDomainAdjustmentNeeded=attr==="y";var zeroBaseValue=attr==="x";return{isDomainAdjustmentNeeded:isDomainAdjustmentNeeded,zeroBaseValue:zeroBaseValue}}},{key:"renderLayer",value:function renderLayer(props,ctx){_rectSeriesCanvas2.default.renderLayer(_extends({},props,{linePosAttr:"y",valuePosAttr:"x",lineSizeAttr:"height",valueSizeAttr:"width"}),ctx)}},{key:"requiresSVG",get:function get(){return false}},{key:"isCanvas",get:function get(){return true}}]);return HorizontalRectSeriesCanvas}(_abstractSeries2.default);HorizontalRectSeriesCanvas.displayName="HorizontalRectSeriesCanvas";HorizontalRectSeriesCanvas.propTypes=_extends({},_abstractSeries2.default.propTypes);exports.default=HorizontalRectSeriesCanvas},{"./abstract-series":321,"./rect-series-canvas":344}],332:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _rectSeries=require("./rect-series");var _rectSeries2=_interopRequireDefault(_rectSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HorizontalRectSeries=function(_AbstractSeries){_inherits(HorizontalRectSeries,_AbstractSeries);function HorizontalRectSeries(){_classCallCheck(this,HorizontalRectSeries);return _possibleConstructorReturn(this,(HorizontalRectSeries.__proto__||Object.getPrototypeOf(HorizontalRectSeries)).apply(this,arguments))}_createClass(HorizontalRectSeries,[{key:"render",value:function render(){return _react2.default.createElement(_rectSeries2.default,_extends({},this.props,{linePosAttr:"y",valuePosAttr:"x",lineSizeAttr:"height",valueSizeAttr:"width"}))}}],[{key:"getParentConfig",value:function getParentConfig(attr){var isDomainAdjustmentNeeded=attr==="y";var zeroBaseValue=attr==="x";return{isDomainAdjustmentNeeded:isDomainAdjustmentNeeded,zeroBaseValue:zeroBaseValue}}}]);return HorizontalRectSeries}(_abstractSeries2.default);HorizontalRectSeries.displayName="HorizontalRectSeries";exports.default=HorizontalRectSeries},{"./abstract-series":321,"./rect-series":345,react:297}],333:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _animation=require("../../animation");var _animation2=_interopRequireDefault(_animation);var _seriesUtils=require("../../utils/series-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var predefinedClassName="rv-xy-plot__series rv-xy-plot__series--label";var LabelSeries=function(_AbstractSeries){_inherits(LabelSeries,_AbstractSeries);function LabelSeries(){_classCallCheck(this,LabelSeries);return _possibleConstructorReturn(this,(LabelSeries.__proto__||Object.getPrototypeOf(LabelSeries)).apply(this,arguments))}_createClass(LabelSeries,[{key:"render",value:function render(){var _this2=this;var _props=this.props,animation=_props.animation,allowOffsetToBeReversed=_props.allowOffsetToBeReversed,className=_props.className,data=_props.data,marginLeft=_props.marginLeft,marginTop=_props.marginTop,xRange=_props.xRange,yRange=_props.yRange;if(!data){return null}if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:_seriesUtils.ANIMATED_SERIES_PROPS}),_react2.default.createElement(LabelSeries,_extends({},this.props,{animation:null})))}var xFunctor=this._getAttributeFunctor("x");var yFunctor=this._getAttributeFunctor("y");return _react2.default.createElement("g",{className:predefinedClassName+" "+className,ref:"container",transform:"translate("+marginLeft+","+marginTop+")"},data.reduce(function(res,d,i){var label=d.label,style=d.style,xOffset=d.xOffset,yOffset=d.yOffset;if(!label){return res}var xVal=xFunctor(d);var yVal=yFunctor(d);var leftOfMiddle=xVal<(xRange[1]-xRange[0])/2;var aboveMiddle=yVal<Math.abs(yRange[1]-yRange[0])/2;var attrs=_extends({alignmentBaseline:aboveMiddle?"text-before-edge":"text-after-edge",className:"rv-xy-plot__series--label-text",key:i,onClick:function onClick(e){return _this2._valueClickHandler(d,e)},onMouseOver:function onMouseOver(e){return _this2._valueMouseOverHandler(d,e)},onMouseOut:function onMouseOut(e){return _this2._valueMouseOutHandler(d,e)},textAnchor:leftOfMiddle?"start":"end",x:xVal+(allowOffsetToBeReversed&&leftOfMiddle?-1:1)*(xOffset||0),y:yVal+(allowOffsetToBeReversed&&aboveMiddle?-1:1)*(yOffset||0)},style);return res.concat([_react2.default.createElement("text",attrs,label)])},[]))}}]);return LabelSeries}(_abstractSeries2.default);LabelSeries.PropTypes={animation:_propTypes2.default.bool,allowOffsetToBeReversed:_propTypes2.default.bool,className:_propTypes2.default.string,data:_propTypes2.default.arrayOf(_propTypes2.default.shape({x:_propTypes2.default.number.isRequired,y:_propTypes2.default.number.isRequired,label:_propTypes2.default.string.isRequired,xOffset:_propTypes2.default.number,yOffset:_propTypes2.default.number,style:_propTypes2.default.object})).isRequired,marginLeft:_propTypes2.default.number,marginTop:_propTypes2.default.number,xRange:_propTypes2.default.arrayOf(_propTypes2.default.number),yRange:_propTypes2.default.arrayOf(_propTypes2.default.number)};exports.default=LabelSeries},{"../../animation":302,"../../utils/series-utils":365,"./abstract-series":321,"prop-types":257,react:297}],334:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _markSeriesCanvas=require("./mark-series-canvas");var _markSeriesCanvas2=_interopRequireDefault(_markSeriesCanvas)
;var _lineSeriesCanvas=require("./line-series-canvas");var _lineSeriesCanvas2=_interopRequireDefault(_lineSeriesCanvas);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LineMarkSeriesCanvas=function(_AbstractSeries){_inherits(LineMarkSeriesCanvas,_AbstractSeries);function LineMarkSeriesCanvas(){_classCallCheck(this,LineMarkSeriesCanvas);return _possibleConstructorReturn(this,(LineMarkSeriesCanvas.__proto__||Object.getPrototypeOf(LineMarkSeriesCanvas)).apply(this,arguments))}_createClass(LineMarkSeriesCanvas,[{key:"render",value:function render(){return null}}],[{key:"renderLayer",value:function renderLayer(props,ctx){_lineSeriesCanvas2.default.renderLayer(props,ctx);_markSeriesCanvas2.default.renderLayer(props,ctx)}},{key:"requiresSVG",get:function get(){return false}},{key:"isCanvas",get:function get(){return true}}]);return LineMarkSeriesCanvas}(_abstractSeries2.default);LineMarkSeriesCanvas.displayName="LineMarkSeriesCanvas";LineMarkSeriesCanvas.propTypes=_extends({},_abstractSeries2.default.propTypes);exports.default=LineMarkSeriesCanvas},{"./abstract-series":321,"./line-series-canvas":337,"./mark-series-canvas":340}],335:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _lineSeriesGl=require("./line-series-gl");var _lineSeriesGl2=_interopRequireDefault(_lineSeriesGl);var _markSeriesGl=require("./mark-series-gl");var _markSeriesGl2=_interopRequireDefault(_markSeriesGl);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LineMarkSeriesGL=function(_AbstractSeries){_inherits(LineMarkSeriesGL,_AbstractSeries);function LineMarkSeriesGL(){_classCallCheck(this,LineMarkSeriesGL);return _possibleConstructorReturn(this,(LineMarkSeriesGL.__proto__||Object.getPrototypeOf(LineMarkSeriesGL)).apply(this,arguments))}_createClass(LineMarkSeriesGL,[{key:"render",value:function render(){return null}}],[{key:"renderLayer",value:function renderLayer(props){return[_lineSeriesGl2.default.renderLayer(_extends({},props,{seriesId:props.seriesId+"-line"})),_markSeriesGl2.default.renderLayer(_extends({},props,{seriesId:props.seriesId+"-mark"}))]}},{key:"requiresSVG",get:function get(){return false}},{key:"isDeckGL",get:function get(){return true}},{key:"defaultProps",get:function get(){return _lineSeriesGl2.default.defaultProps}}]);return LineMarkSeriesGL}(_abstractSeries2.default);LineMarkSeriesGL.displayName="LineMarkSeriesGL";exports.default=LineMarkSeriesGL},{"./abstract-series":321,"./line-series-gl":338,"./mark-series-gl":341}],336:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _lineSeries=require("./line-series");var _lineSeries2=_interopRequireDefault(_lineSeries);var _markSeries=require("./mark-series");var _markSeries2=_interopRequireDefault(_markSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LineMarkSeries=function(_AbstractSeries){_inherits(LineMarkSeries,_AbstractSeries);function LineMarkSeries(){_classCallCheck(this,LineMarkSeries);return _possibleConstructorReturn(this,(LineMarkSeries.__proto__||Object.getPrototypeOf(LineMarkSeries)).apply(this,arguments))}_createClass(LineMarkSeries,[{key:"render",value:function render(){return _react2.default.createElement("g",{className:"rv-xy-plot__series rv-xy-plot__series--linemark"},_react2.default.createElement(_lineSeries2.default,this.props),_react2.default.createElement(_markSeries2.default,this.props))}}],[{key:"defaultProps",get:function get(){return _lineSeries2.default.defaultProps}}]);return LineMarkSeries}(_abstractSeries2.default);LineMarkSeries.displayName="LineMarkSeries";exports.default=LineMarkSeries},{"./abstract-series":321,"./line-series":339,"./mark-series":342,react:297}],337:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _d3Color=require("d3-color");var _theme=require("../../theme");var _scalesUtils=require("../../utils/scales-utils");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LineSeriesCanvas=function(_AbstractSeries){_inherits(LineSeriesCanvas,_AbstractSeries);function LineSeriesCanvas(){_classCallCheck(this,LineSeriesCanvas);return _possibleConstructorReturn(this,(LineSeriesCanvas.__proto__||Object.getPrototypeOf(LineSeriesCanvas)).apply(this,arguments))}_createClass(LineSeriesCanvas,[{key:"render",value:function render(){return null}}],[{key:"renderLayer",value:function renderLayer(props,ctx){var data=props.data,strokeWidth=props.strokeWidth,strokeDasharray=props.strokeDasharray;if(!data||data.length===0){return}var x=(0,_scalesUtils.getAttributeFunctor)(props,"x");var y=(0,_scalesUtils.getAttributeFunctor)(props,"y");var stroke=(0,_scalesUtils.getAttributeValue)(props,"stroke")||(0,_scalesUtils.getAttributeValue)(props,"color");var strokeColor=(0,_d3Color.rgb)(stroke);var newOpacity=(0,_scalesUtils.getAttributeValue)(props,"opacity");var opacity=Number.isFinite(newOpacity)?newOpacity:_theme.DEFAULT_OPACITY;ctx.beginPath();ctx.moveTo(x(data[0]),y(data[0]));data.forEach(function(row){return ctx.lineTo(x(row),y(row))});ctx.strokeStyle="rgba("+strokeColor.r+", "+strokeColor.g+", "+strokeColor.b+", "+opacity+")";ctx.lineWidth=strokeWidth;if(strokeDasharray){ctx.setLineDash(strokeDasharray)}ctx.stroke();ctx.lineWidth=1}},{key:"requiresSVG",get:function get(){return false}},{key:"isCanvas",get:function get(){return true}}]);return LineSeriesCanvas}(_abstractSeries2.default);LineSeriesCanvas.displayName="LineSeriesCanvas";LineSeriesCanvas.defaultProps={strokeWidth:_propTypes2.default.number,strokeDasharray:_propTypes2.default.string};LineSeriesCanvas.propTypes=_extends({},_abstractSeries2.default.propTypes,{strokeWidth:1});exports.default=LineSeriesCanvas},{"../../theme":357,"../../utils/scales-utils":364,"./abstract-series":321,"d3-color":8,"prop-types":257}],338:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _deck=require("deck.gl");var _d3Color=require("d3-color");var _theme=require("../../theme");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _scalesUtils=require("../../utils/scales-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LineSeriesGL=function(_AbstractSeries){_inherits(LineSeriesGL,_AbstractSeries);function LineSeriesGL(){_classCallCheck(this,LineSeriesGL);return _possibleConstructorReturn(this,(LineSeriesGL.__proto__||Object.getPrototypeOf(LineSeriesGL)).apply(this,arguments))}_createClass(LineSeriesGL,[{key:"render",value:function render(){return null}}],[{key:"renderLayer",value:function renderLayer(props){var data=props.data,opacity=props.opacity,seriesId=props.seriesId,strokeWidth=props.strokeWidth,onValueMouseOver=props.onValueMouseOver,onValueClick=props.onValueClick,fp64=props.fp64;var x=(0,_scalesUtils.getAttributeFunctor)(props,"x");var y=(0,_scalesUtils.getAttributeFunctor)(props,"y");var fill=(0,_scalesUtils.getAttributeFunctor)(props,"fill")||(0,_scalesUtils.getAttributeFunctor)(props,"color");var opacityScale=(0,_scalesUtils.getAttributeFunctor)(props,"opacity");return new _deck.PathLayer({id:seriesId,data:[data],getPath:function getPath(p){return p.map(function(row){return[x(row),y(row)]})},getColor:function getColor(p){var color=(0,_d3Color.rgb)(fill(p));return[color.r,color.g,color.b,(opacityScale(p)||_theme.DEFAULT_OPACITY)*255]},getWidth:function getWidth(p){return Number(strokeWidth)||1},opacity:opacity||_theme.DEFAULT_OPACITY,projectionMode:_deck.COORDINATE_SYSTEM.IDENTITY,pickable:true,onHover:function onHover(row){return onValueMouseOver(row.object)},onClick:function onClick(row){return onValueClick(row.object)},fp64:fp64})}},{key:"requiresSVG",get:function get(){return false}},{key:"isDeckGL",get:function get(){return true}}]);return LineSeriesGL}(_abstractSeries2.default);LineSeriesGL.displayName="LineSeriesGL";LineSeriesGL.defaultProps={onValueMouseOver:function onValueMouseOver(){},onValueClick:function onValueClick(){},fp64:false};LineSeriesGL.propTypes=_extends({},_abstractSeries2.default.propTypes,{seriesId:_propTypes2.default.string.isRequired});exports.default=LineSeriesGL},{"../../theme":357,"../../utils/scales-utils":364,"./abstract-series":321,"d3-color":8,"deck.gl":32,"prop-types":257}],339:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _d3Shape=require("d3-shape");var d3Shape=_interopRequireWildcard(_d3Shape);var _animation=require("../../animation");var _animation2=_interopRequireDefault(_animation);var _theme=require("../../theme");var _seriesUtils=require("../../utils/series-utils");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var predefinedClassName="rv-xy-plot__series rv-xy-plot__series--line";var STROKE_STYLES={dashed:"6, 2",solid:null};var defaultProps={strokeStyle:"solid",opacity:1,curve:null};var propTypes=_extends({},_abstractSeries2.default.propTypes,{strokeStyle:_propTypes2.default.oneOf(Object.keys(STROKE_STYLES)),curve:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.func])});var LineSeries=function(_AbstractSeries){_inherits(LineSeries,_AbstractSeries);function LineSeries(){_classCallCheck(this,LineSeries);return _possibleConstructorReturn(this,(LineSeries.__proto__||Object.getPrototypeOf(LineSeries)).apply(this,arguments))}_createClass(LineSeries,[{key:"_renderLine",value:function _renderLine(data,x,y,curve){var line=d3Shape.line();if(curve!==null){if(typeof curve==="string"&&d3Shape[curve]){line=line.curve(d3Shape[curve])}else if(typeof curve==="function"){line=line.curve(curve)}}line=line.x(x).y(y);return line(data)}},{key:"render",value:function render(){var _props=this.props,animation=_props.animation,className=_props.className,data=_props.data;if(!data){return null}if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:_seriesUtils.ANIMATED_SERIES_PROPS}),_react2.default.createElement(LineSeries,_extends({},this.props,{animation:null})))}var _props2=this.props,strokeDasharray=_props2.strokeDasharray,strokeStyle=_props2.strokeStyle,strokeWidth=_props2.strokeWidth,marginLeft=_props2.marginLeft,marginTop=_props2.marginTop,curve=_props2.curve;var x=this._getAttributeFunctor("x");var y=this._getAttributeFunctor("y");var stroke=this._getAttributeValue("stroke")||this._getAttributeValue("color");var newOpacity=this._getAttributeValue("opacity");var opacity=Number.isFinite(newOpacity)?newOpacity:_theme.DEFAULT_OPACITY;var d=this._renderLine(data,x,y,curve);return _react2.default.createElement("path",{d:d,className:predefinedClassName+" "+className,transform:"translate("+marginLeft+","+marginTop+")",onMouseOver:this._seriesMouseOverHandler,onMouseOut:this._seriesMouseOutHandler,onClick:this._seriesClickHandler,style:{opacity:opacity,strokeDasharray:STROKE_STYLES[strokeStyle]||strokeDasharray,strokeWidth:strokeWidth,stroke:stroke}})}}]);return LineSeries}(_abstractSeries2.default);LineSeries.displayName="LineSeries";LineSeries.defaultProps=defaultProps;LineSeries.propTypes=propTypes;exports.default=LineSeries},{"../../animation":302,"../../theme":357,"../../utils/series-utils":365,"./abstract-series":321,"d3-shape":20,"prop-types":257,react:297}],340:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _d3Color=require("d3-color");var _theme=require("../../theme");var _scalesUtils=require("../../utils/scales-utils");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MarkSeriesCanvas=function(_AbstractSeries){_inherits(MarkSeriesCanvas,_AbstractSeries);function MarkSeriesCanvas(){_classCallCheck(this,MarkSeriesCanvas);return _possibleConstructorReturn(this,(MarkSeriesCanvas.__proto__||Object.getPrototypeOf(MarkSeriesCanvas)).apply(this,arguments))}_createClass(MarkSeriesCanvas,[{key:"render",value:function render(){return null}}],[{key:"renderLayer",value:function renderLayer(props,ctx){var data=props.data;var x=(0,_scalesUtils.getAttributeFunctor)(props,"x");var y=(0,_scalesUtils.getAttributeFunctor)(props,"y");var size=(0,_scalesUtils.getAttributeFunctor)(props,"size")||function(p){return _theme.DEFAULT_SIZE};var fill=(0,_scalesUtils.getAttributeFunctor)(props,"fill")||(0,_scalesUtils.getAttributeFunctor)(props,"color");var stroke=(0,_scalesUtils.getAttributeFunctor)(props,"stroke")||(0,_scalesUtils.getAttributeFunctor)(props,"color");var opacity=(0,_scalesUtils.getAttributeFunctor)(props,"opacity");data.forEach(function(row){var fillColor=(0,_d3Color.rgb)(fill(row));var strokeColor=(0,_d3Color.rgb)(stroke(row));var rowOpacity=opacity(row)||_theme.DEFAULT_OPACITY;ctx.beginPath();ctx.arc(x(row),y(row),size(row),0,2*Math.PI);ctx.fillStyle="rgba("+fillColor.r+", "+fillColor.g+", "+fillColor.b+", "+rowOpacity+")";ctx.fill();ctx.strokeStyle="rgba("+strokeColor.r+", "+strokeColor.g+", "+strokeColor.b+", "+rowOpacity+")";ctx.stroke()})}},{key:"requiresSVG",get:function get(){return false}},{key:"isCanvas",get:function get(){return true}}]);return MarkSeriesCanvas}(_abstractSeries2.default);MarkSeriesCanvas.displayName="MarkSeriesCanvas";MarkSeriesCanvas.defaultProps={};MarkSeriesCanvas.propTypes=_extends({},_abstractSeries2.default.propTypes);exports.default=MarkSeriesCanvas},{"../../theme":357,"../../utils/scales-utils":364,"./abstract-series":321,"d3-color":8}],341:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _deck=require("deck.gl");var _d3Color=require("d3-color");var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _theme=require("../../theme");var _scalesUtils=require("../../utils/scales-utils");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MarkSeriesGL=function(_AbstractSeries){_inherits(MarkSeriesGL,_AbstractSeries);function MarkSeriesGL(){_classCallCheck(this,MarkSeriesGL);return _possibleConstructorReturn(this,(MarkSeriesGL.__proto__||Object.getPrototypeOf(MarkSeriesGL)).apply(this,arguments))}_createClass(MarkSeriesGL,[{key:"render",value:function render(){return null}}],[{key:"renderLayer",value:function renderLayer(props){var data=props.data,_renderKey=props._renderKey,seriesId=props.seriesId,colorDomain=props.colorDomain,colorRange=props.colorRange,sizeDomain=props.sizeDomain,sizeRange=props.sizeRange,outline=props.outline;var xFunctor=(0,_scalesUtils.getAttributeFunctor)(props,"x");var yFunctor=(0,_scalesUtils.getAttributeFunctor)(props,"y");var sizeFunctor=(0,_scalesUtils.getAttributeFunctor)(props,"size")||function(p){return _theme.DEFAULT_SIZE};var fillFunctor=(0,_scalesUtils.getAttributeFunctor)(props,"fill")||(0,_scalesUtils.getAttributeFunctor)(props,"color");var opacityFunctor=(0,_scalesUtils.getAttributeFunctor)(props,"opacity");return new _deck.ScatterplotLayer({id:seriesId,data:data,getPosition:function getPosition(p){return[xFunctor(p),yFunctor(p)]},getRadius:function getRadius(p){return sizeFunctor(p)},getColor:function getColor(p){var color=(0,_d3Color.rgb)(fillFunctor(p));return[color.r,color.g,color.b,(opacityFunctor(p)||_theme.DEFAULT_OPACITY)*255]},opacity:1,outline:outline,projectionMode:_deck.COORDINATE_SYSTEM.IDENTITY,updateTriggers:{getPosition:_renderKey,getColor:colorDomain.concat(colorRange).concat([_renderKey]).join(""),getRadius:sizeDomain.concat(sizeRange).concat([_renderKey]).join("")},radiusMinPixels:2,pickable:true,onHover:function onHover(row){return props.onValueMouseOver(row.object)},onClick:function onClick(row){return props.onValueClick(row.object)}})}},{key:"requiresSVG",get:function get(){return false}},{key:"isDeckGL",get:function get(){return true}}]);return MarkSeriesGL}(_abstractSeries2.default);MarkSeriesGL.displayName="MarkSeriesGL";MarkSeriesGL.defaultProps={onValueMouseOver:function onValueMouseOver(){},onValueClick:function onValueClick(){},outline:false};MarkSeriesGL.propTypes=_extends({},_abstractSeries2.default.propTypes,{seriesId:_propTypes2.default.string.isRequired,outline:_propTypes2.default.bool});exports.default=MarkSeriesGL},{"../../theme":357,"../../utils/scales-utils":364,"./abstract-series":321,"d3-color":8,"deck.gl":32,"prop-types":257}],342:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _animation=require("../../animation");var _animation2=_interopRequireDefault(_animation);var _seriesUtils=require("../../utils/series-utils");var _theme=require("../../theme");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var predefinedClassName="rv-xy-plot__series rv-xy-plot__series--mark";var DEFAULT_STROKE_WIDTH=1;var MarkSeries=function(_AbstractSeries){_inherits(MarkSeries,_AbstractSeries);function MarkSeries(){_classCallCheck(this,MarkSeries);return _possibleConstructorReturn(this,(MarkSeries.__proto__||Object.getPrototypeOf(MarkSeries)).apply(this,arguments))}_createClass(MarkSeries,[{key:"render",value:function render(){var _this2=this;var _props=this.props,animation=_props.animation,className=_props.className,data=_props.data,marginLeft=_props.marginLeft,marginTop=_props.marginTop,strokeWidth=_props.strokeWidth;if(!data){return null}if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{
animatedProps:_seriesUtils.ANIMATED_SERIES_PROPS}),_react2.default.createElement(MarkSeries,_extends({},this.props,{animation:null})))}var sizeFunctor=this._getAttributeFunctor("size");var opacityFunctor=this._getAttributeFunctor("opacity");var fillFunctor=this._getAttributeFunctor("fill")||this._getAttributeFunctor("color");var strokeFunctor=this._getAttributeFunctor("stroke")||this._getAttributeFunctor("color");var xFunctor=this._getAttributeFunctor("x");var yFunctor=this._getAttributeFunctor("y");return _react2.default.createElement("g",{className:predefinedClassName+" "+className,ref:"container",transform:"translate("+marginLeft+","+marginTop+")"},data.map(function(d,i){var attrs={r:sizeFunctor?sizeFunctor(d):_theme.DEFAULT_SIZE,cx:xFunctor(d),cy:yFunctor(d),style:{opacity:opacityFunctor?opacityFunctor(d):_theme.DEFAULT_OPACITY,stroke:strokeFunctor&&strokeFunctor(d),fill:fillFunctor&&fillFunctor(d),strokeWidth:strokeWidth||DEFAULT_STROKE_WIDTH},key:i,onClick:function onClick(e){return _this2._valueClickHandler(d,e)},onMouseOver:function onMouseOver(e){return _this2._valueMouseOverHandler(d,e)},onMouseOut:function onMouseOut(e){return _this2._valueMouseOutHandler(d,e)}};return _react2.default.createElement("circle",attrs)}))}}]);return MarkSeries}(_abstractSeries2.default);MarkSeries.displayName="MarkSeries";MarkSeries.propTypes=_extends({},_abstractSeries2.default.propTypes,{strokeWidth:_propTypes2.default.number});exports.default=MarkSeries},{"../../animation":302,"../../theme":357,"../../utils/series-utils":365,"./abstract-series":321,"prop-types":257,react:297}],343:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _animation=require("../../animation");var _animation2=_interopRequireDefault(_animation);var _seriesUtils=require("../../utils/series-utils");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var predefinedClassName="rv-xy-plot__series rv-xy-plot__series--polygon";var DEFAULT_COLOR="#12939A";var generatePath=function generatePath(data,xFunctor,yFunctor){return data.reduce(function(res,row,i){return res+" "+(i?"L":"M")+xFunctor(row)+" "+yFunctor(row)},"")+" Z"};var PolygonSeries=function(_AbstractSeries){_inherits(PolygonSeries,_AbstractSeries);function PolygonSeries(){_classCallCheck(this,PolygonSeries);return _possibleConstructorReturn(this,(PolygonSeries.__proto__||Object.getPrototypeOf(PolygonSeries)).apply(this,arguments))}_createClass(PolygonSeries,[{key:"render",value:function render(){var _props=this.props,animation=_props.animation,color=_props.color,className=_props.className,data=_props.data,marginLeft=_props.marginLeft,marginTop=_props.marginTop,style=_props.style;if(!data){return null}if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:_seriesUtils.ANIMATED_SERIES_PROPS}),_react2.default.createElement(PolygonSeries,_extends({},this.props,{animation:null})))}var xFunctor=this._getAttributeFunctor("x");var yFunctor=this._getAttributeFunctor("y");return _react2.default.createElement("path",{className:predefinedClassName+" "+className,onMouseOver:this._seriesMouseOverHandler,onMouseOut:this._seriesMouseOutHandler,onClick:this._seriesClickHandler,fill:color||DEFAULT_COLOR,style:style,d:generatePath(data,xFunctor,yFunctor),transform:"translate("+marginLeft+","+marginTop+")",ref:"container"})}}],[{key:"propTypes",get:function get(){return _extends({},_abstractSeries2.default.propTypes)}}]);return PolygonSeries}(_abstractSeries2.default);PolygonSeries.displayName="PolygonSeries";exports.default=PolygonSeries},{"../../animation":302,"../../utils/series-utils":365,"./abstract-series":321,react:297}],344:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _d3Color=require("d3-color");var _theme=require("../../theme");var _scalesUtils=require("../../utils/scales-utils");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var RectSeriesCanvas=function(_AbstractSeries){_inherits(RectSeriesCanvas,_AbstractSeries);function RectSeriesCanvas(){_classCallCheck(this,RectSeriesCanvas);return _possibleConstructorReturn(this,(RectSeriesCanvas.__proto__||Object.getPrototypeOf(RectSeriesCanvas)).apply(this,arguments))}_createClass(RectSeriesCanvas,[{key:"render",value:function render(){return null}}],[{key:"renderLayer",value:function renderLayer(props,ctx){var data=props.data,linePosAttr=props.linePosAttr,lineSizeAttr=props.lineSizeAttr,valuePosAttr=props.valuePosAttr;if(!data||data.length===0){return}var line=(0,_scalesUtils.getAttributeFunctor)(props,linePosAttr);var line0=(0,_scalesUtils.getAttr0Functor)(props,linePosAttr);var value=(0,_scalesUtils.getAttributeFunctor)(props,valuePosAttr);var value0=(0,_scalesUtils.getAttr0Functor)(props,valuePosAttr);var fill=(0,_scalesUtils.getAttributeFunctor)(props,"fill")||(0,_scalesUtils.getAttributeFunctor)(props,"color");var stroke=(0,_scalesUtils.getAttributeFunctor)(props,"stroke")||(0,_scalesUtils.getAttributeFunctor)(props,"color");var opacity=(0,_scalesUtils.getAttributeFunctor)(props,"opacity");data.forEach(function(row){var fillColor=(0,_d3Color.rgb)(fill(row));var strokeColor=(0,_d3Color.rgb)(stroke(row));var rowOpacity=opacity(row)||_theme.DEFAULT_OPACITY;var linePos=line0(row);var valuePos=Math.min(value0(row),value(row));var x=valuePosAttr==="x"?valuePos:linePos;var y=valuePosAttr==="y"?valuePos:linePos;var lineSize=Math.abs(line(row)-line0(row));var valueSize=Math.abs(-value0(row)+value(row));var height=lineSizeAttr==="height"?lineSize:valueSize;var width=lineSizeAttr==="width"?lineSize:valueSize;ctx.beginPath();ctx.rect(x,y,width,height);ctx.fillStyle="rgba("+fillColor.r+", "+fillColor.g+", "+fillColor.b+", "+rowOpacity+")";ctx.fill();ctx.strokeStyle="rgba("+strokeColor.r+", "+strokeColor.g+", "+strokeColor.b+", "+rowOpacity+")";ctx.stroke()})}},{key:"requiresSVG",get:function get(){return false}},{key:"isCanvas",get:function get(){return true}}]);return RectSeriesCanvas}(_abstractSeries2.default);RectSeriesCanvas.displayName="RectSeriesCanvas";RectSeriesCanvas.defaultProps={linePosAttr:_propTypes2.default.string.isRequired,valuePosAttr:_propTypes2.default.string.isRequired,lineSizeAttr:_propTypes2.default.string.isRequired,valueSizeAttr:_propTypes2.default.string.isRequired};RectSeriesCanvas.propTypes=_extends({},_abstractSeries2.default.propTypes);exports.default=RectSeriesCanvas},{"../../theme":357,"../../utils/scales-utils":364,"./abstract-series":321,"d3-color":8,"prop-types":257}],345:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _animation=require("../../animation");var _animation2=_interopRequireDefault(_animation);var _seriesUtils=require("../../utils/series-utils");var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var predefinedClassName="rv-xy-plot__series rv-xy-plot__series--rect";var RectSeries=function(_AbstractSeries){_inherits(RectSeries,_AbstractSeries);function RectSeries(){_classCallCheck(this,RectSeries);return _possibleConstructorReturn(this,(RectSeries.__proto__||Object.getPrototypeOf(RectSeries)).apply(this,arguments))}_createClass(RectSeries,[{key:"render",value:function render(){var _this2=this;var _props=this.props,animation=_props.animation,className=_props.className,data=_props.data,linePosAttr=_props.linePosAttr,lineSizeAttr=_props.lineSizeAttr,marginLeft=_props.marginLeft,marginTop=_props.marginTop,valuePosAttr=_props.valuePosAttr,valueSizeAttr=_props.valueSizeAttr;if(!data){return null}if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:_seriesUtils.ANIMATED_SERIES_PROPS}),_react2.default.createElement(RectSeries,_extends({},this.props,{animation:null})))}var lineFunctor=this._getAttributeFunctor(linePosAttr);var line0Functor=this._getAttr0Functor(linePosAttr);var valueFunctor=this._getAttributeFunctor(valuePosAttr);var value0Functor=this._getAttr0Functor(valuePosAttr);var fillFunctor=this._getAttributeFunctor("fill")||this._getAttributeFunctor("color");var strokeFunctor=this._getAttributeFunctor("stroke")||this._getAttributeFunctor("color");var opacityFunctor=this._getAttributeFunctor("opacity");return _react2.default.createElement("g",{className:predefinedClassName+" "+className,ref:"container",transform:"translate("+marginLeft+","+marginTop+")"},data.map(function(d,i){var _attrs;var attrs=(_attrs={style:{opacity:opacityFunctor&&opacityFunctor(d),stroke:strokeFunctor&&strokeFunctor(d),fill:fillFunctor&&fillFunctor(d)}},_defineProperty(_attrs,linePosAttr,line0Functor(d)),_defineProperty(_attrs,lineSizeAttr,Math.abs(lineFunctor(d)-line0Functor(d))),_defineProperty(_attrs,valuePosAttr,Math.min(value0Functor(d),valueFunctor(d))),_defineProperty(_attrs,valueSizeAttr,Math.abs(-value0Functor(d)+valueFunctor(d))),_defineProperty(_attrs,"onClick",function onClick(e){return _this2._valueClickHandler(d,e)}),_defineProperty(_attrs,"onMouseOver",function onMouseOver(e){return _this2._valueMouseOverHandler(d,e)}),_defineProperty(_attrs,"onMouseOut",function onMouseOut(e){return _this2._valueMouseOutHandler(d,e)}),_defineProperty(_attrs,"key",i),_attrs);return _react2.default.createElement("rect",attrs)}))}}],[{key:"propTypes",get:function get(){return _extends({},_abstractSeries2.default.propTypes,{linePosAttr:_propTypes2.default.string,valuePosAttr:_propTypes2.default.string,lineSizeAttr:_propTypes2.default.string,valueSizeAttr:_propTypes2.default.string})}}]);return RectSeries}(_abstractSeries2.default);RectSeries.displayName="RectSeries";exports.default=RectSeries},{"../../animation":302,"../../utils/series-utils":365,"./abstract-series":321,"prop-types":257,react:297}],346:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _barSeriesCanvas=require("./bar-series-canvas");var _barSeriesCanvas2=_interopRequireDefault(_barSeriesCanvas);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HorizontalBarSeriesCanvas=function(_AbstractSeries){_inherits(HorizontalBarSeriesCanvas,_AbstractSeries);function HorizontalBarSeriesCanvas(){_classCallCheck(this,HorizontalBarSeriesCanvas);return _possibleConstructorReturn(this,(HorizontalBarSeriesCanvas.__proto__||Object.getPrototypeOf(HorizontalBarSeriesCanvas)).apply(this,arguments))}_createClass(HorizontalBarSeriesCanvas,[{key:"render",value:function render(){return null}}],[{key:"getParentConfig",value:function getParentConfig(attr){var isDomainAdjustmentNeeded=attr==="x";var zeroBaseValue=attr==="y";return{isDomainAdjustmentNeeded:isDomainAdjustmentNeeded,zeroBaseValue:zeroBaseValue}}},{key:"renderLayer",value:function renderLayer(props,ctx){_barSeriesCanvas2.default.renderLayer(_extends({},props,{linePosAttr:"x",valuePosAttr:"y",lineSizeAttr:"width",valueSizeAttr:"height"}),ctx)}},{key:"requiresSVG",get:function get(){return false}},{key:"isCanvas",get:function get(){return true}}]);return HorizontalBarSeriesCanvas}(_abstractSeries2.default);HorizontalBarSeriesCanvas.displayName="HorizontalBarSeriesCanvas";HorizontalBarSeriesCanvas.propTypes=_extends({},_abstractSeries2.default.propTypes);exports.default=HorizontalBarSeriesCanvas},{"./abstract-series":321,"./bar-series-canvas":324}],347:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _barSeries=require("./bar-series");var _barSeries2=_interopRequireDefault(_barSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VerticalBarSeries=function(_AbstractSeries){_inherits(VerticalBarSeries,_AbstractSeries);function VerticalBarSeries(){_classCallCheck(this,VerticalBarSeries);return _possibleConstructorReturn(this,(VerticalBarSeries.__proto__||Object.getPrototypeOf(VerticalBarSeries)).apply(this,arguments))}_createClass(VerticalBarSeries,[{key:"render",value:function render(){return _react2.default.createElement(_barSeries2.default,_extends({},this.props,{linePosAttr:"x",valuePosAttr:"y",lineSizeAttr:"width",valueSizeAttr:"height"}))}}],[{key:"getParentConfig",value:function getParentConfig(attr){var isDomainAdjustmentNeeded=attr==="x";var zeroBaseValue=attr==="y";return{isDomainAdjustmentNeeded:isDomainAdjustmentNeeded,zeroBaseValue:zeroBaseValue}}}]);return VerticalBarSeries}(_abstractSeries2.default);VerticalBarSeries.displayName="VerticalBarSeries";exports.default=VerticalBarSeries},{"./abstract-series":321,"./bar-series":325,react:297}],348:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _rectSeriesCanvas=require("./rect-series-canvas");var _rectSeriesCanvas2=_interopRequireDefault(_rectSeriesCanvas);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HorizontalRectSeriesCanvas=function(_AbstractSeries){_inherits(HorizontalRectSeriesCanvas,_AbstractSeries);function HorizontalRectSeriesCanvas(){_classCallCheck(this,HorizontalRectSeriesCanvas);return _possibleConstructorReturn(this,(HorizontalRectSeriesCanvas.__proto__||Object.getPrototypeOf(HorizontalRectSeriesCanvas)).apply(this,arguments))}_createClass(HorizontalRectSeriesCanvas,[{key:"render",value:function render(){return null}}],[{key:"getParentConfig",value:function getParentConfig(attr){var isDomainAdjustmentNeeded=attr==="x";var zeroBaseValue=attr==="y";return{isDomainAdjustmentNeeded:isDomainAdjustmentNeeded,zeroBaseValue:zeroBaseValue}}},{key:"renderLayer",value:function renderLayer(props,ctx){_rectSeriesCanvas2.default.renderLayer(_extends({},props,{linePosAttr:"x",valuePosAttr:"y",lineSizeAttr:"width",valueSizeAttr:"height"}),ctx)}},{key:"requiresSVG",get:function get(){return false}},{key:"isCanvas",get:function get(){return true}}]);return HorizontalRectSeriesCanvas}(_abstractSeries2.default);HorizontalRectSeriesCanvas.displayName="HorizontalRectSeriesCanvas";HorizontalRectSeriesCanvas.propTypes=_extends({},_abstractSeries2.default.propTypes);exports.default=HorizontalRectSeriesCanvas},{"./abstract-series":321,"./rect-series-canvas":344}],349:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _abstractSeries=require("./abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _rectSeries=require("./rect-series");var _rectSeries2=_interopRequireDefault(_rectSeries);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VerticalRectSeries=function(_AbstractSeries){_inherits(VerticalRectSeries,_AbstractSeries);function VerticalRectSeries(){_classCallCheck(this,VerticalRectSeries);return _possibleConstructorReturn(this,(VerticalRectSeries.__proto__||Object.getPrototypeOf(VerticalRectSeries)).apply(this,arguments))}_createClass(VerticalRectSeries,[{key:"render",value:function render(){return _react2.default.createElement(_rectSeries2.default,_extends({},this.props,{linePosAttr:"x",valuePosAttr:"y",lineSizeAttr:"width",valueSizeAttr:"height"}))}}],[{key:"getParentConfig",value:function getParentConfig(attr){var isDomainAdjustmentNeeded=attr==="x";var zeroBaseValue=attr==="y";return{isDomainAdjustmentNeeded:isDomainAdjustmentNeeded,zeroBaseValue:zeroBaseValue}}}]);return VerticalRectSeries}(_abstractSeries2.default);VerticalRectSeries.displayName="VerticalRectSeries";exports.default=VerticalRectSeries},{"./abstract-series":321,"./rect-series":345,react:297}],350:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _gridLines=require("./grid-lines");var _gridLines2=_interopRequireDefault(_gridLines);var _axisUtils=require("../utils/axis-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var VERTICAL=_axisUtils.DIRECTION.VERTICAL;var propTypes=_extends({},_gridLines2.default.propTypes,{direction:_propTypes2.default.oneOf([VERTICAL])});var defaultProps={direction:VERTICAL,attr:"x"};function VerticalGridLines(props){return _react2.default.createElement(_gridLines2.default,props)}VerticalGridLines.displayName="VerticalGridLines";VerticalGridLines.propTypes=propTypes;VerticalGridLines.defaultProps=defaultProps;VerticalGridLines.requiresSVG=true;exports.default=VerticalGridLines},{"../utils/axis-utils":360,"./grid-lines":318,"prop-types":257,react:297}],351:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _d3Voronoi=require("d3-voronoi");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var NOOP=function NOOP(f){return f};function Voronoi(_ref){var className=_ref.className,extent=_ref.extent,nodes=_ref.nodes,onBlur=_ref.onBlur,_onClick=_ref.onClick,onHover=_ref.onHover,polygonStyle=_ref.polygonStyle,style=_ref.style,x=_ref.x,y=_ref.y;var voronoiInstance=(0,_d3Voronoi.voronoi)().x(x).y(y).extent(extent);return _react2.default.createElement("g",{className:className+" rv-voronoi",style:style},voronoiInstance.polygons(nodes).map(function(d,i){return _react2.default.createElement("path",{className:"rv-voronoi__cell",d:"M"+d.join("L")+"Z",onClick:function onClick(){return _onClick(d.data)},onMouseOver:function onMouseOver(){return onHover(d.data)},onMouseOut:function onMouseOut(){return onBlur(d.data)},fill:"none",style:_extends({pointerEvents:"all"},polygonStyle),key:i})}))}Voronoi.requiresSVG=true;Voronoi.defaultProps={className:"",onBlur:NOOP,onClick:NOOP,onHover:NOOP,x:function x(d){return d.x},y:function y(d){return d.y}};Voronoi.propTypes={className:_propTypes2.default.string,extent:_propTypes2.default.arrayOf(_propTypes2.default.arrayOf(_propTypes2.default.number)).isRequired,nodes:_propTypes2.default.arrayOf(_propTypes2.default.object).isRequired,onBlur:_propTypes2.default.func,onClick:_propTypes2.default.func,onHover:_propTypes2.default.func,x:_propTypes2.default.func,y:_propTypes2.default.func};exports.default=Voronoi},{"d3-voronoi":23,"prop-types":257,react:297}],352:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _deepEqual=require("deep-equal");var _deepEqual2=_interopRequireDefault(_deepEqual)
;var _scalesUtils=require("../utils/scales-utils");var _seriesUtils=require("../utils/series-utils");var _chartUtils=require("../utils/chart-utils");var _animation=require("../animation");var _theme=require("../theme");var _deckGlWrapper=require("./series/deck-gl-wrapper");var _deckGlWrapper2=_interopRequireDefault(_deckGlWrapper);var _canvasWrapper=require("./series/canvas-wrapper");var _canvasWrapper2=_interopRequireDefault(_canvasWrapper);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ATTRIBUTES=["x","y","radius","angle","color","fill","stroke","opacity","size"];var DEFAULT_MARGINS={left:40,right:10,top:10,bottom:40};function cleanseData(data){return data.map(function(series){if(!Array.isArray(series)){return series}return series.map(function(row){return _extends({},row,{parent:null})})})}function checkIfMixinsAreEqual(nextScaleMixins,scaleMixins){var newMixins=_extends({},nextScaleMixins,{_allData:cleanseData(nextScaleMixins._allData)});var oldMixins=_extends({},scaleMixins,{_allData:cleanseData(scaleMixins._allData)});return(0,_deepEqual2.default)(newMixins,oldMixins)}var XYPlot=function(_React$Component){_inherits(XYPlot,_React$Component);_createClass(XYPlot,null,[{key:"propTypes",get:function get(){return{animation:_animation.AnimationPropType,className:_propTypes2.default.string,height:_propTypes2.default.number.isRequired,margin:_chartUtils.MarginPropType,onMouseDown:_propTypes2.default.func,onMouseEnter:_propTypes2.default.func,onMouseLeave:_propTypes2.default.func,onMouseMove:_propTypes2.default.func,stackBy:_propTypes2.default.oneOf(ATTRIBUTES),width:_propTypes2.default.number.isRequired}}},{key:"defaultProps",get:function get(){return{className:""}}}]);function XYPlot(props){_classCallCheck(this,XYPlot);var _this=_possibleConstructorReturn(this,(XYPlot.__proto__||Object.getPrototypeOf(XYPlot)).call(this,props));_this._mouseDownHandler=_this._mouseDownHandler.bind(_this);_this._mouseLeaveHandler=_this._mouseLeaveHandler.bind(_this);_this._mouseEnterHandler=_this._mouseEnterHandler.bind(_this);_this._mouseMoveHandler=_this._mouseMoveHandler.bind(_this);var stackBy=props.stackBy;var children=(0,_seriesUtils.getSeriesChildren)(props.children);var data=(0,_seriesUtils.getStackedData)(children,stackBy);_this.state={scaleMixins:_this._getScaleMixins(data,props),data:data};return _this}_createClass(XYPlot,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){var children=(0,_seriesUtils.getSeriesChildren)(nextProps.children);var nextData=(0,_seriesUtils.getStackedData)(children,nextProps.stackBy);var scaleMixins=this.state.scaleMixins;var nextScaleMixins=this._getScaleMixins(nextData,nextProps);if(!checkIfMixinsAreEqual(nextScaleMixins,scaleMixins)){this.setState({scaleMixins:nextScaleMixins,data:nextData})}}},{key:"_mouseDownHandler",value:function _mouseDownHandler(event){var _this2=this;var _props=this.props,onMouseDown=_props.onMouseDown,children=_props.children;if(onMouseDown){onMouseDown(event)}var seriesChildren=(0,_seriesUtils.getSeriesChildren)(children);seriesChildren.forEach(function(child,index){var component=_this2.refs["series"+index];if(component&&component.onParentMouseDown){component.onParentMouseDown(event)}})}},{key:"_mouseMoveHandler",value:function _mouseMoveHandler(event){var _this3=this;var _props2=this.props,onMouseMove=_props2.onMouseMove,children=_props2.children;if(onMouseMove){onMouseMove(event)}var seriesChildren=(0,_seriesUtils.getSeriesChildren)(children);seriesChildren.forEach(function(child,index){var component=_this3.refs["series"+index];if(component&&component.onParentMouseMove){component.onParentMouseMove(event)}})}},{key:"_mouseLeaveHandler",value:function _mouseLeaveHandler(event){var onMouseLeave=this.props.onMouseLeave;if(onMouseLeave){onMouseLeave({event:event})}}},{key:"_mouseEnterHandler",value:function _mouseEnterHandler(event){var onMouseEnter=this.props.onMouseEnter;if(onMouseEnter){onMouseEnter({event:event})}}},{key:"_getDefaultScaleProps",value:function _getDefaultScaleProps(props){var _getInnerDimensions=(0,_chartUtils.getInnerDimensions)(props,DEFAULT_MARGINS),innerWidth=_getInnerDimensions.innerWidth,innerHeight=_getInnerDimensions.innerHeight;return{xRange:[0,innerWidth],yRange:[innerHeight,0],colorRange:_theme.CONTINUOUS_COLOR_RANGE,opacityType:_theme.OPACITY_TYPE,sizeRange:_theme.SIZE_RANGE}}},{key:"_getScaleMixins",value:function _getScaleMixins(data,props){var _ref;var filteredData=data.filter(function(d){return d});var allData=(_ref=[]).concat.apply(_ref,_toConsumableArray(filteredData));var defaultScaleProps=this._getDefaultScaleProps(props);var userScaleProps=(0,_scalesUtils.extractScalePropsFromProps)(props,ATTRIBUTES);var missingScaleProps=(0,_scalesUtils.getMissingScaleProps)(_extends({},defaultScaleProps,userScaleProps),allData,ATTRIBUTES);var children=(0,_seriesUtils.getSeriesChildren)(props.children);var zeroBaseProps={};var adjustBy=new Set;var adjustWhat=new Set;children.forEach(function(child,index){if(!child||!data[index]){return}ATTRIBUTES.forEach(function(attr){var _child$type$getParent=child.type.getParentConfig(attr,child.props),isDomainAdjustmentNeeded=_child$type$getParent.isDomainAdjustmentNeeded,zeroBaseValue=_child$type$getParent.zeroBaseValue;if(isDomainAdjustmentNeeded){adjustBy.add(attr);adjustWhat.add(index)}if(zeroBaseValue){zeroBaseProps[attr+"BaseValue"]=0}})});return _extends({},defaultScaleProps,zeroBaseProps,userScaleProps,missingScaleProps,{_allData:data,_adjustBy:Array.from(adjustBy),_adjustWhat:Array.from(adjustWhat),_stackBy:props.stackBy})}},{key:"_isPlotEmpty",value:function _isPlotEmpty(){var data=this.state.data;return!data||!data.length||!data.some(function(series){return series&&series.some(function(d){return d})})}},{key:"_getClonedChildComponents",value:function _getClonedChildComponents(){var animation=this.props.animation;var _state=this.state,scaleMixins=_state.scaleMixins,data=_state.data;var dimensions=(0,_chartUtils.getInnerDimensions)(this.props,DEFAULT_MARGINS);var children=_react2.default.Children.toArray(this.props.children);var seriesProps=(0,_seriesUtils.getSeriesPropsFromChildren)(children);return children.map(function(child,index){var dataProps=null;if(seriesProps[index]){var seriesIndex=seriesProps[index].seriesIndex;dataProps={data:data[seriesIndex]}}return _react2.default.cloneElement(child,_extends({},dimensions,{animation:animation},seriesProps[index],scaleMixins,child.props,dataProps))})}},{key:"renderDeckGlComponents",value:function renderDeckGlComponents(components,props){var componentsToRender=components.filter(function(c){return c&&!c.type.requiresSVG&&c.type.isDeckGL});if(componentsToRender.length===0){return null}var animation=componentsToRender.some(function(layer){return layer.props.animation});var _componentsToRender$=componentsToRender[0].props,marginLeft=_componentsToRender$.marginLeft,marginTop=_componentsToRender$.marginTop,marginBottom=_componentsToRender$.marginBottom,marginRight=_componentsToRender$.marginRight,innerHeight=_componentsToRender$.innerHeight,innerWidth=_componentsToRender$.innerWidth;return _react2.default.createElement(_deckGlWrapper2.default,{animation:animation,marginLeft:marginLeft,marginTop:marginTop,marginBottom:marginBottom,marginRight:marginRight,innerHeight:innerHeight,innerWidth:innerWidth},componentsToRender)}},{key:"renderCanvasComponents",value:function renderCanvasComponents(components,props){var componentsToRender=components.filter(function(c){return c&&!c.type.requiresSVG&&c.type.isCanvas});if(componentsToRender.length===0){return null}var _componentsToRender$2=componentsToRender[0].props,marginLeft=_componentsToRender$2.marginLeft,marginTop=_componentsToRender$2.marginTop,marginBottom=_componentsToRender$2.marginBottom,marginRight=_componentsToRender$2.marginRight,innerHeight=_componentsToRender$2.innerHeight,innerWidth=_componentsToRender$2.innerWidth;return _react2.default.createElement(_canvasWrapper2.default,{marginLeft:marginLeft,marginTop:marginTop,marginBottom:marginBottom,marginRight:marginRight,innerHeight:innerHeight,innerWidth:innerWidth},componentsToRender)}},{key:"render",value:function render(){var _props3=this.props,className=_props3.className,width=_props3.width,height=_props3.height;if(this._isPlotEmpty()){return _react2.default.createElement("div",{className:"rv-xy-plot "+className,style:{width:width+"px",height:height+"px"}})}var components=this._getClonedChildComponents();return _react2.default.createElement("div",{style:{width:width+"px",height:height+"px"},className:"rv-xy-plot "+className},_react2.default.createElement("svg",{className:"rv-xy-plot__inner",width:width,height:height,onMouseDown:this._mouseDownHandler,onMouseMove:this._mouseMoveHandler,onMouseLeave:this._mouseLeaveHandler,onMouseEnter:this._mouseEnterHandler},components.filter(function(c){return c&&c.type.requiresSVG&&!c.type.isDeckGL})),this.renderCanvasComponents(components,this.props),this.renderDeckGlComponents(components,this.props),components.filter(function(c){return c&&!c.type.requiresSVG}))}}]);return XYPlot}(_react2.default.Component);XYPlot.displayName="XYPlot";exports.default=XYPlot},{"../animation":302,"../theme":357,"../utils/chart-utils":361,"../utils/scales-utils":364,"../utils/series-utils":365,"./series/canvas-wrapper":326,"./series/deck-gl-wrapper":327,"deep-equal":134,"prop-types":257,react:297}],353:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _reactAddonsShallowCompare=require("react-addons-shallow-compare");var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PureRenderComponent=function(_React$Component){_inherits(PureRenderComponent,_React$Component);function PureRenderComponent(props){_classCallCheck(this,PureRenderComponent);return _possibleConstructorReturn(this,(PureRenderComponent.__proto__||Object.getPrototypeOf(PureRenderComponent)).call(this,props))}_createClass(PureRenderComponent,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps,nextState){return(0,_reactAddonsShallowCompare2.default)(this,nextProps,nextState)}}]);return PureRenderComponent}(_react2.default.Component);exports.default=PureRenderComponent},{react:297,"react-addons-shallow-compare":260}],354:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _d3Shape=require("d3-shape");var _animation=require("../animation");var _arcSeries=require("../plot/series/arc-series");var _arcSeries2=_interopRequireDefault(_arcSeries);var _labelSeries=require("../plot/series/label-series");var _labelSeries2=_interopRequireDefault(_labelSeries);var _xyPlot=require("../plot/xy-plot");var _xyPlot2=_interopRequireDefault(_xyPlot);var _theme=require("../theme");var _chartUtils=require("../utils/chart-utils");var _seriesUtils=require("../utils/series-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var predefinedClassName="rv-radial-chart";var DEFAULT_RADIUS_MARGIN=15;function getWedgesToRender(_ref){var data=_ref.data;var pie=(0,_d3Shape.pie)().sort(null).value(function(d){return d.angle});var pieData=pie(data).reverse();return pieData.map(function(row,index){return _extends({},row.data,{angle0:row.startAngle,angle:row.endAngle,radius0:row.data.innerRadius||0,radius:row.data.radius||1,color:row.data.color||index})})}function generateLabels(mappedData){return mappedData.reduce(function(res,row){var angle=row.angle,angle0=row.angle0,radius=row.radius,label=row.label,subLabel=row.subLabel;var centeredAngle=(angle+angle0)/2;var updatedAngle=-1*centeredAngle+Math.PI/2;var newLabels=[];if(row.label){newLabels.push({angle:updatedAngle,radius:radius*1.1,label:label,style:{fontSize:"12px"}})}if(subLabel){newLabels.push({angle:updatedAngle,radius:radius*1.1,label:subLabel,yOffset:12,style:{fontSize:"10px"}})}return res.concat(newLabels)},[])}function getMaxRadius(width,height){return Math.min(width,height)/2-DEFAULT_RADIUS_MARGIN}var RadialChart=function(_Component){_inherits(RadialChart,_Component);function RadialChart(){_classCallCheck(this,RadialChart);return _possibleConstructorReturn(this,(RadialChart.__proto__||Object.getPrototypeOf(RadialChart)).apply(this,arguments))}_createClass(RadialChart,[{key:"render",value:function render(){var _props=this.props,animation=_props.animation,className=_props.className,children=_props.children,data=_props.data,height=_props.height,hideRootNode=_props.hideRootNode,width=_props.width,colorType=_props.colorType,radius=_props.radius,innerRadius=_props.innerRadius,showLabels=_props.showLabels,margin=_props.margin,onMouseLeave=_props.onMouseLeave,onMouseEnter=_props.onMouseEnter,labelsAboveChildren=_props.labelsAboveChildren;var mappedData=getWedgesToRender({data:data,height:height,hideRootNode:hideRootNode,width:width});var radialDomain=(0,_seriesUtils.getRadialDomain)(mappedData);var arcProps=_extends({colorType:colorType},this.props,{animation:animation,radiusDomain:[0,radialDomain],data:mappedData,radiusNoFallBack:true,arcClassName:"rv-radial-chart__series--pie__slice"});if(radius){arcProps.radiusDomain=[0,1];arcProps.radiusRange=[innerRadius||0,radius];arcProps.radiusType="linear"}var maxRadius=radius?radius:getMaxRadius(width,height);var defaultMargin=(0,_chartUtils.getRadialLayoutMargin)(width,height,maxRadius);return _react2.default.createElement(_xyPlot2.default,{height:height,width:width,margin:_extends({},margin,defaultMargin),className:className+" "+predefinedClassName,onMouseLeave:onMouseLeave,onMouseEnter:onMouseEnter,xDomain:[-radialDomain,radialDomain],yDomain:[-radialDomain,radialDomain]},_react2.default.createElement(_arcSeries2.default,arcProps),showLabels&&!labelsAboveChildren&&_react2.default.createElement(_labelSeries2.default,{data:generateLabels(mappedData)}),children,showLabels&&labelsAboveChildren&&_react2.default.createElement(_labelSeries2.default,{data:generateLabels(mappedData)}))}}]);return RadialChart}(_react.Component);RadialChart.displayName="RadialChart";RadialChart.PropTypes={animation:_animation.AnimationPropType,className:_propTypes2.default.string,colorType:_propTypes2.default.string,data:_propTypes2.default.object.isRequired,height:_propTypes2.default.number.isRequired,labelsAboveChildren:_propTypes2.default.bool,margin:_chartUtils.MarginPropType,onValueClick:_propTypes2.default.func,onValueMouseOver:_propTypes2.default.func,onValueMouseOut:_propTypes2.default.func,width:_propTypes2.default.number.isRequired,showLabels:_propTypes2.default.bool};RadialChart.defaultProps={className:"",colorType:"category",colorRange:_theme.DISCRETE_COLOR_RANGE};exports.default=RadialChart},{"../animation":302,"../plot/series/arc-series":322,"../plot/series/label-series":333,"../plot/xy-plot":352,"../theme":357,"../utils/chart-utils":361,"../utils/series-utils":365,"d3-shape":20,"prop-types":257,react:297}],355:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _d3SankeyAlign=require("d3-sankey-align");var _voronoi=require("../plot/voronoi");var _voronoi2=_interopRequireDefault(_voronoi);var _theme=require("../theme");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var NOOP=function NOOP(f){return f};var DEFAULT_LINK_COLOR=_theme.DISCRETE_COLOR_RANGE[1];var DEFAULT_LINK_OPACITY=.7;var DEFAULT_NODE_COLOR=_theme.DISCRETE_COLOR_RANGE[0];var DEFAULT_NODE_OPACITY=1;var Sankey=function(_Component){_inherits(Sankey,_Component);function Sankey(){_classCallCheck(this,Sankey);return _possibleConstructorReturn(this,(Sankey.__proto__||Object.getPrototypeOf(Sankey)).apply(this,arguments))}_createClass(Sankey,[{key:"render",value:function render(){var _props=this.props,align=_props.align,className=_props.className,hasVoronoi=_props.hasVoronoi,height=_props.height,layout=_props.layout,links=_props.links,margin=_props.margin,nodePadding=_props.nodePadding,nodes=_props.nodes,nodeWidth=_props.nodeWidth,onBlur=_props.onBlur,_onClick=_props.onClick,onHover=_props.onHover,width=_props.width;var sankeyInstance=(0,_d3SankeyAlign.sankey)().size([width,height]).nodeWidth(nodeWidth).nodePadding(nodePadding).nodes(nodes).links(links).align(align).layout(layout);var nWidth=sankeyInstance.nodeWidth();var path=sankeyInstance.link();return _react2.default.createElement("svg",{height:height+margin,width:width+margin,className:"rv-sankey "+className},_react2.default.createElement("g",{transform:"translate("+margin/2+", "+margin/2+")"},links.map(function(link,i){return _react2.default.createElement("path",{d:path(link),className:"rv-sankey__link",opacity:Number.isFinite(link.opacity)?link.opacity:DEFAULT_LINK_OPACITY,stroke:link.color||DEFAULT_LINK_COLOR,strokeWidth:Math.max(1,link.dy),fill:"none",key:link.id||link.key||"link-"+i})}),nodes.map(function(node,i){return _react2.default.createElement("g",{transform:"translate("+node.x+", "+node.y+")",className:"rv-sankey__node",opacity:Number.isFinite(node.opacity)?node.opacity:DEFAULT_NODE_OPACITY,key:node.id||node.key||"node-"+i},_react2.default.createElement("rect",{onClick:function onClick(){return _onClick(node)},onMouseOver:function onMouseOver(){return onHover(node)},onMouseOut:function onMouseOut(){return onBlur(node)},fill:node.color||DEFAULT_NODE_COLOR,height:node.dy,width:nWidth}))}),hasVoronoi&&_react2.default.createElement(_voronoi2.default,{className:"rv-sankey__voronoi",extent:[[-margin,-margin],[width+margin,height+margin]],nodes:nodes,onBlur:onBlur,onClick:_onClick,onHover:onHover,x:function x(d){return d.x+d.dx/2},y:function y(d){return d.y+d.dy/2}})))}}]);return Sankey}(_react.Component);Sankey.defaultProps={align:"justify",className:"",hasVoronoi:false,layout:50,margin:20,nodePadding:10,nodeWidth:10,onBlur:NOOP,onClick:NOOP,onHover:NOOP};Sankey.propTypes={align:_propTypes2.default.oneOf(["justify","left","right","center"]),className:_propTypes2.default.string,hasVoronoi:_propTypes2.default.bool,height:_propTypes2.default.number.isRequired,layout:_propTypes2.default.number,links:_propTypes2.default.arrayOf(_propTypes2.default.shape({source:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.object]).isRequired,target:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.object]).isRequired})).isRequired,margin:_propTypes2.default.number,nodePadding:_propTypes2.default.number,nodes:_propTypes2.default.arrayOf(_propTypes2.default.object).isRequired,nodeWidth:_propTypes2.default.number,onBlur:_propTypes2.default.func,onClick:_propTypes2.default.func,onHover:_propTypes2.default.func,width:_propTypes2.default.number.isRequired};exports.default=Sankey},{"../plot/voronoi":351,"../theme":357,"d3-sankey-align":14,"prop-types":257,react:297}],356:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _d3Hierarchy=require("d3-hierarchy");var _d3Scale=require("d3-scale");var _animation=require("../animation");var _arcSeries=require("../plot/series/arc-series");var _arcSeries2=_interopRequireDefault(_arcSeries);var _xyPlot=require("../plot/xy-plot");var _xyPlot2=_interopRequireDefault(_xyPlot);var _seriesUtils=require("../utils/series-utils");var _chartUtils=require("../utils/chart-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function getNodesToRender(_ref){var data=_ref.data,height=_ref.height,hideRootNode=_ref.hideRootNode,width=_ref.width;var partitionFunction=(0,_d3Hierarchy.partition)();var structuredInput=(0,_d3Hierarchy.hierarchy)(data).sum(function(d){return d.size});var radius=Math.min(width,height)/2-10;var x=(0,_d3Scale.scaleLinear)().range([0,2*Math.PI]);var y=(0,_d3Scale.scaleSqrt)().range([0,radius]);return partitionFunction(structuredInput).descendants().reduce(function(res,cell,index){if(hideRootNode&&index===0){return res}return res.concat([_extends({angle0:Math.max(0,Math.min(2*Math.PI,x(cell.x0))),angle:Math.max(0,Math.min(2*Math.PI,x(cell.x1))),radius0:Math.max(0,y(cell.y0)),radius:Math.max(0,y(cell.y1)),depth:cell.depth,parent:cell.parent},cell.data)])},[])}var Sunburst=function(_React$Component){_inherits(Sunburst,_React$Component);function Sunburst(){_classCallCheck(this,Sunburst);return _possibleConstructorReturn(this,(Sunburst.__proto__||Object.getPrototypeOf(Sunburst)).apply(this,arguments))}_createClass(Sunburst,[{key:"render",value:function render(){var _props=this.props,animation=_props.animation,className=_props.className,data=_props.data,height=_props.height,hideRootNode=_props.hideRootNode,width=_props.width,colorType=_props.colorType;var mappedData=getNodesToRender({data:data,height:height,hideRootNode:hideRootNode,width:width});var radialDomain=(0,_seriesUtils.getRadialDomain)(mappedData);var margin=(0,_chartUtils.getRadialLayoutMargin)(width,height,radialDomain);return _react2.default.createElement(_xyPlot2.default,{height:height,width:width,className:className,margin:margin,xDomain:[-radialDomain,radialDomain],yDomain:[-radialDomain,radialDomain]},_react2.default.createElement(_arcSeries2.default,_extends({colorType:colorType},this.props,{animation:animation,radiusDomain:[0,radialDomain],data:animation?mappedData.map(function(row){return _extends({},row,{parent:null,children:null})}):mappedData,_data:animation?mappedData:null})))}}]);return Sunburst}(_react2.default.Component);Sunburst.displayName="Sunburst";Sunburst.PropTypes={animation:_animation.AnimationPropType,className:_propTypes2.default.string,colorType:_propTypes2.default.string,data:_propTypes2.default.object.isRequired,height:_propTypes2.default.number.isRequired,hideRootNode:_propTypes2.default.bool,onValueClick:_propTypes2.default.func,onValueMouseOver:_propTypes2.default.func,onValueMouseOut:_propTypes2.default.func,width:_propTypes2.default.number.isRequired};Sunburst.defaultProps={className:"",colorType:"literal",hideRootNode:false};exports.default=Sunburst},{"../animation":302,"../plot/series/arc-series":322,"../plot/xy-plot":352,"../utils/chart-utils":361,"../utils/series-utils":365,"d3-hierarchy":11,"d3-scale":19,"prop-types":257,react:297}],357:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var DISCRETE_COLOR_RANGE=exports.DISCRETE_COLOR_RANGE=["#12939A","#79C7E3","#1A3177","#FF9833","#EF5D28"];var EXTENDED_DISCRETE_COLOR_RANGE=exports.EXTENDED_DISCRETE_COLOR_RANGE=["#19CDD7","#DDB27C","#88572C","#FF991F","#F15C17","#223F9A","#DA70BF","#125C77","#4DC19C","#776E57","#12939A","#17B8BE","#F6D18A","#B7885E","#FFCB99","#F89570","#829AE3","#E79FD5","#1E96BE","#89DAC1","#B3AD9E"];var CONTINUOUS_COLOR_RANGE=exports.CONTINUOUS_COLOR_RANGE=["#EF5D28","#FF9833"];var SIZE_RANGE=exports.SIZE_RANGE=[1,10];var OPACITY_RANGE=exports.OPACITY_RANGE=[.1,1];var OPACITY_TYPE=exports.OPACITY_TYPE="literal";var DEFAULT_OPACITY=exports.DEFAULT_OPACITY=1;var DEFAULT_SIZE=exports.DEFAULT_SIZE=5;var DEFAULT_COLOR=exports.DEFAULT_COLOR=DISCRETE_COLOR_RANGE[0];var DEFAULT_TICK_SIZE=exports.DEFAULT_TICK_SIZE=7},{}],358:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _d3Hierarchy=require("d3-hierarchy");var _theme=require("../theme");var _animation=require("../animation");var _scalesUtils=require("../utils/scales-utils");var _treemapLeaf=require("./treemap-leaf");var _treemapLeaf2=_interopRequireDefault(_treemapLeaf);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){
throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TREEMAP_TILE_MODES={squarify:_d3Hierarchy.treemapSquarify,resquarify:_d3Hierarchy.treemapResquarify,slice:_d3Hierarchy.treemapSlice,dice:_d3Hierarchy.treemapDice,slicedice:_d3Hierarchy.treemapSliceDice,binary:_d3Hierarchy.treemapBinary};var TREEMAP_LAYOUT_MODES=["circlePack","partition","partition-pivot"];var NOOP=function NOOP(d){return d};var ATTRIBUTES=["opacity","color"];function _getScaleFns(props){var data=props.data;var allData=data.children||[];var compatibleProps=_extends({},props,(0,_scalesUtils.getMissingScaleProps)(props,allData,ATTRIBUTES),{_allData:allData});return{opacity:(0,_scalesUtils.getAttributeFunctor)(compatibleProps,"opacity"),color:(0,_scalesUtils.getAttributeFunctor)(compatibleProps,"color")}}var Treemap=function(_React$Component){_inherits(Treemap,_React$Component);_createClass(Treemap,null,[{key:"propTypes",get:function get(){return{animation:_animation.AnimationPropType,className:_propTypes2.default.string,data:_propTypes2.default.object.isRequired,height:_propTypes2.default.number.isRequired,mode:_propTypes2.default.oneOf(Object.keys(TREEMAP_TILE_MODES).concat(TREEMAP_LAYOUT_MODES)),onLeafClick:_propTypes2.default.func,onLeafMouseOver:_propTypes2.default.func,onLeafMouseOut:_propTypes2.default.func,useCirclePacking:_propTypes2.default.bool,padding:_propTypes2.default.number.isRequired,width:_propTypes2.default.number.isRequired}}},{key:"defaultProps",get:function get(){return{className:"",colorRange:_theme.CONTINUOUS_COLOR_RANGE,_colorValue:_theme.DEFAULT_COLOR,data:{children:[]},mode:"squarify",onLeafClick:NOOP,onLeafMouseOver:NOOP,onLeafMouseOut:NOOP,opacityType:_theme.OPACITY_TYPE,_opacityValue:_theme.DEFAULT_OPACITY,padding:1}}}]);function Treemap(props){_classCallCheck(this,Treemap);var _this=_possibleConstructorReturn(this,(Treemap.__proto__||Object.getPrototypeOf(Treemap)).call(this,props));_this.state={scales:_getScaleFns(props)};return _this}_createClass(Treemap,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(props){this.setState({scales:_getScaleFns(props)})}},{key:"_getNodesToRender",value:function _getNodesToRender(){var _props=this.props,data=_props.data,height=_props.height,width=_props.width,mode=_props.mode,padding=_props.padding;if(data&&(mode==="partition"||mode==="partition-pivot")){var partitionFunction=(0,_d3Hierarchy.partition)().size([width,height]).padding(padding);var structuredInput=(0,_d3Hierarchy.hierarchy)(data).sum(function(d){return d.size});var mappedNodes=partitionFunction(structuredInput).descendants();if(mode==="partition-pivot"){return mappedNodes.map(function(node){return _extends({},node,{x0:node.y0,x1:node.y1,y0:node.x0,y1:node.x1})})}return mappedNodes}if(data&&mode==="circlePack"){var packingFunction=(0,_d3Hierarchy.pack)().size([width,height]).padding(padding);var _structuredInput=(0,_d3Hierarchy.hierarchy)(data).sort(function(a,b){return a.size-b.size}).sum(function(d){return d.size});return packingFunction(_structuredInput).descendants()}if(data){var tileFn=TREEMAP_TILE_MODES[mode];var treemapingFunction=(0,_d3Hierarchy.treemap)(tileFn).tile(tileFn).size([width,height]).padding(padding);var _structuredInput2=(0,_d3Hierarchy.hierarchy)(data).sort(function(a,b){return a.size-b.size}).sum(function(d){return d.size});return treemapingFunction(_structuredInput2).descendants()}return[]}},{key:"render",value:function render(){var _this2=this;var _props2=this.props,animation=_props2.animation,className=_props2.className,height=_props2.height,mode=_props2.mode,width=_props2.width;var nodes=this._getNodesToRender();var useCirclePacking=mode==="circlePack";return _react2.default.createElement("div",{className:"rv-treemap "+(useCirclePacking?"rv-treemap-circle-packed":"")+" "+className,style:{width:width+"px",height:height+"px"}},nodes.map(function(node,index){if(!useCirclePacking&&!index){return null}var nodeProps=_extends({animation:animation,node:node},_this2.props,{x0:useCirclePacking?node.x:node.x0,x1:useCirclePacking?node.x:node.x1,y0:useCirclePacking?node.y:node.y0,y1:useCirclePacking?node.y:node.y1,r:useCirclePacking?node.r:1,scales:_this2.state.scales});return _react2.default.createElement(_treemapLeaf2.default,_extends({},nodeProps,{key:"leaf-"+index}))}))}}]);return Treemap}(_react2.default.Component);Treemap.displayName="Treemap";exports.default=Treemap},{"../animation":302,"../theme":357,"../utils/scales-utils":364,"./treemap-leaf":359,"d3-hierarchy":11,"prop-types":257,react:297}],359:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require("react");var _react2=_interopRequireDefault(_react);var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _animation=require("../animation");var _animation2=_interopRequireDefault(_animation);var _scalesUtils=require("../utils/scales-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ANIMATED_PROPS=["colorRange","colorDomain","color","opacityRange","opacityDomain","opacity","x0","x1","y0","y1","r"];var TreemapLeaf=function(_React$Component){_inherits(TreemapLeaf,_React$Component);function TreemapLeaf(){_classCallCheck(this,TreemapLeaf);return _possibleConstructorReturn(this,(TreemapLeaf.__proto__||Object.getPrototypeOf(TreemapLeaf)).apply(this,arguments))}_createClass(TreemapLeaf,[{key:"render",value:function render(){var _props=this.props,animation=_props.animation,mode=_props.mode,node=_props.node,onLeafClick=_props.onLeafClick,onLeafMouseOver=_props.onLeafMouseOver,onLeafMouseOut=_props.onLeafMouseOut,r=_props.r,scales=_props.scales,x0=_props.x0,x1=_props.x1,y0=_props.y0,y1=_props.y1;if(animation){return _react2.default.createElement(_animation2.default,_extends({},this.props,{animatedProps:ANIMATED_PROPS}),_react2.default.createElement(TreemapLeaf,_extends({},this.props,{animation:null})))}var useCirclePacking=mode==="circlePack";var background=scales.color(node);var opacity=scales.opacity(node);var color=(0,_scalesUtils.getFontColorFromBackground)(background);var title=node.data.title;return _react2.default.createElement("div",{className:"rv-treemap__leaf "+(useCirclePacking?"rv-treemap__leaf--circle":""),onMouseEnter:function onMouseEnter(event){return onLeafMouseOver(node,event)},onMouseLeave:function onMouseLeave(event){return onLeafMouseOut(node,event)},onClick:function onClick(event){return onLeafClick(node,event)},style:{top:useCirclePacking?y0-r:y0,left:useCirclePacking?x0-r:x0,width:useCirclePacking?r*2:x1-x0,height:useCirclePacking?r*2:y1-y0,background:background,opacity:opacity,color:color}},_react2.default.createElement("div",{className:"rv-treemap__leaf__content"},title))}}],[{key:"propTypes",get:function get(){return{animation:_animation.AnimationPropType,height:_propTypes2.default.number.isRequired,mode:_propTypes2.default.string,node:_propTypes2.default.object.isRequired,onLeafClick:_propTypes2.default.func,onLeafMouseOver:_propTypes2.default.func,onLeafMouseOut:_propTypes2.default.func,scales:_propTypes2.default.object.isRequired,width:_propTypes2.default.number.isRequired,r:_propTypes2.default.number.isRequired,x0:_propTypes2.default.number.isRequired,x1:_propTypes2.default.number.isRequired,y0:_propTypes2.default.number.isRequired,y1:_propTypes2.default.number.isRequired}}}]);return TreemapLeaf}(_react2.default.Component);exports.default=TreemapLeaf},{"../animation":302,"../utils/scales-utils":364,"prop-types":257,react:297}],360:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getTicksTotalFromSize=getTicksTotalFromSize;exports.getTickValues=getTickValues;var ORIENTATION=exports.ORIENTATION={TOP:"top",LEFT:"left",RIGHT:"right",BOTTOM:"bottom"};var DIRECTION=exports.DIRECTION={VERTICAL:"vertical",HORIZONTAL:"horizontal"};function getTicksTotalFromSize(size){if(size<700){if(size>300){return 10}return 5}return 20}function getTickValues(scale,tickTotal,tickValues){return!tickValues?scale.ticks?scale.ticks(tickTotal):scale.domain():tickValues}exports.default={DIRECTION:DIRECTION,ORIENTATION:ORIENTATION,getTicksTotalFromSize:getTicksTotalFromSize,getTickValues:getTickValues}},{}],361:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MarginPropType=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.getInnerDimensions=getInnerDimensions;exports.getRadialLayoutMargin=getRadialLayoutMargin;var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getInnerDimensions(props,defaultMargins){var margin=props.margin,width=props.width,height=props.height;var marginProps=_extends({},defaultMargins,typeof margin==="number"?{left:margin,right:margin,top:margin,bottom:margin}:margin);var _marginProps$left=marginProps.left,marginLeft=_marginProps$left===undefined?0:_marginProps$left,_marginProps$top=marginProps.top,marginTop=_marginProps$top===undefined?0:_marginProps$top,_marginProps$right=marginProps.right,marginRight=_marginProps$right===undefined?0:_marginProps$right,_marginProps$bottom=marginProps.bottom,marginBottom=_marginProps$bottom===undefined?0:_marginProps$bottom;return{marginLeft:marginLeft,marginTop:marginTop,marginRight:marginRight,marginBottom:marginBottom,innerHeight:height-marginBottom-marginTop,innerWidth:width-marginLeft-marginRight}}function getRadialLayoutMargin(width,height,radius){var marginX=width/2-radius;var marginY=height/2-radius;return{bottom:marginY,left:marginX,right:marginX,top:marginY}}var MarginPropType=exports.MarginPropType=_propTypes2.default.oneOfType([_propTypes2.default.shape({left:_propTypes2.default.number,top:_propTypes2.default.number,right:_propTypes2.default.number,bottom:_propTypes2.default.number}),_propTypes2.default.number])},{"prop-types":257}],362:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getObjectValueAccessor=getObjectValueAccessor;exports.getUniquePropertyValues=getUniquePropertyValues;exports.addValueToArray=addValueToArray;function getObjectValueAccessor(propertyName){return function(obj){return obj[propertyName]}}function getUniquePropertyValues(arr,propertyName){var setOfValues=new Set(arr.map(getObjectValueAccessor(propertyName)));return Array.from(setOfValues)}function addValueToArray(arr,value){var result=[].concat(arr);if(result[0]>value){result[0]=value}if(result[result.length-1]<value){result[result.length-1]=value}return result}},{}],363:[function(require,module,exports){(function(process){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getDOMNode=exports.isReactDOMSupported=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.warning=warning;exports.warnOnce=warnOnce;var _react=require("react");var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _React$version$split=_react2.default.version.split("."),_React$version$split2=_slicedToArray(_React$version$split,2),major=_React$version$split2[0],minor=_React$version$split2[1];var versionHigherThanThirteen=Number(minor)>13||Number(major)>13;var isReactDOMSupported=exports.isReactDOMSupported=function isReactDOMSupported(){return versionHigherThanThirteen};var getDOMNode=exports.getDOMNode=function getDOMNode(ref){if(!isReactDOMSupported()){return ref&&ref.getDOMNode()}return ref};var USED_MESSAGES={};var HIDDEN_PROCESSES={test:true,production:true};function warning(message){var onlyShowMessageOnce=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(process&&HIDDEN_PROCESSES[process.env.NODE_ENV]){return}if(!onlyShowMessageOnce||!USED_MESSAGES[message]){console.warn(message);USED_MESSAGES[message]=true}}function warnOnce(message){warning(message,true)}}).call(this,require("_process"))},{_process:252,react:297}],364:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _SCALE_FUNCTIONS;exports._getSmallestDistanceIndex=_getSmallestDistanceIndex;exports._getScaleFnFromScaleObject=_getScaleFnFromScaleObject;exports.getDomainByAttr=getDomainByAttr;exports._getScaleDistanceAndAdjustedDomain=_getScaleDistanceAndAdjustedDomain;exports._adjustCategoricalScale=_adjustCategoricalScale;exports.getScaleObjectFromProps=getScaleObjectFromProps;exports.getAttributeScale=getAttributeScale;exports.getAttributeFunctor=getAttributeFunctor;exports.getAttr0Functor=getAttr0Functor;exports.getAttributeValue=getAttributeValue;exports.getScalePropTypesByAttribute=getScalePropTypesByAttribute;exports.extractScalePropsFromProps=extractScalePropsFromProps;exports.getMissingScaleProps=getMissingScaleProps;exports.literalScale=literalScale;exports.getFontColorFromBackground=getFontColorFromBackground;var _d3Scale=require("d3-scale");var _d3Array=require("d3-array");var _d3Collection=require("d3-collection");var _d3Color=require("d3-color");var _propTypes=require("prop-types");var _propTypes2=_interopRequireDefault(_propTypes);var _reactUtils=require("./react-utils");var _dataUtils=require("./data-utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var LINEAR_SCALE_TYPE="linear";var ORDINAL_SCALE_TYPE="ordinal";var CATEGORY_SCALE_TYPE="category";var LITERAL_SCALE_TYPE="literal";var LOG_SCALE_TYPE="log";var TIME_SCALE_TYPE="time";var TIME_UTC_SCALE_TYPE="time-utc";var SCALE_FUNCTIONS=(_SCALE_FUNCTIONS={},_defineProperty(_SCALE_FUNCTIONS,LINEAR_SCALE_TYPE,_d3Scale.scaleLinear),_defineProperty(_SCALE_FUNCTIONS,ORDINAL_SCALE_TYPE,_d3Scale.scalePoint),_defineProperty(_SCALE_FUNCTIONS,CATEGORY_SCALE_TYPE,_d3Scale.scaleOrdinal),_defineProperty(_SCALE_FUNCTIONS,LITERAL_SCALE_TYPE,literalScale),_defineProperty(_SCALE_FUNCTIONS,LOG_SCALE_TYPE,_d3Scale.scaleLog),_defineProperty(_SCALE_FUNCTIONS,TIME_SCALE_TYPE,_d3Scale.scaleTime),_defineProperty(_SCALE_FUNCTIONS,TIME_UTC_SCALE_TYPE,_d3Scale.scaleUtc),_SCALE_FUNCTIONS);function _getSmallestDistanceIndex(values,scaleObject){var scaleFn=_getScaleFnFromScaleObject(scaleObject);var result=0;if(scaleFn){var nextValue=void 0;var currentValue=scaleFn(values[0]);var distance=Infinity;var nextDistance=void 0;for(var i=1;i<values.length;i++){nextValue=scaleFn(values[i]);nextDistance=Math.abs(nextValue-currentValue);if(nextDistance<distance){distance=nextDistance;result=i}currentValue=nextValue}}return result}function _getScaleFnFromScaleObject(scaleObject){if(!scaleObject){return null}var type=scaleObject.type,domain=scaleObject.domain,range=scaleObject.range;var modDomain=domain[0]===domain[1]?domain[0]===0?[-1,0]:[-domain[0],domain[0]]:domain;var scale=SCALE_FUNCTIONS[type]().domain(modDomain).range(range);if(type===ORDINAL_SCALE_TYPE){scale.padding(.5)}return scale}function getDomainByAttr(allData,attr,type){var domain=void 0;var attr0=attr+"0";var values=allData.reduce(function(data,d){var value=d[attr];var value0=d[attr0];if(_isDefined(value)){data.push(value)}if(_isDefined(value0)){data.push(value0)}return data},[]);if(!values.length){return[]}if(type!==ORDINAL_SCALE_TYPE&&type!==CATEGORY_SCALE_TYPE){domain=(0,_d3Array.extent)(values)}else{domain=(0,_d3Collection.set)(values).values()}return domain}function _createScaleObjectForValue(attr,value,type){if(type==="literal"){return{type:"literal",domain:[],range:[value],distance:0,attr:attr,baseValue:undefined,isValue:true}}if(typeof value==="undefined"){return null}return{type:"category",range:[value],domain:[],distance:0,attr:attr,baseValue:undefined,isValue:true}}function _createScaleObjectForFunction(domain,range,type,distance,attr,baseValue){return{domain:domain,range:range,type:type,distance:distance,attr:attr,baseValue:baseValue,isValue:false}}function _collectScaleObjectFromProps(props,attr){var value=props[attr],fallbackValue=props["_"+attr+"Value"],range=props[attr+"Range"],_props$=props[attr+"Distance"],distance=_props$===undefined?0:_props$,baseValue=props[attr+"BaseValue"],_props$2=props[attr+"Type"],type=_props$2===undefined?LINEAR_SCALE_TYPE:_props$2,noFallBack=props[attr+"NoFallBack"];var domain=props[attr+"Domain"];if(!noFallBack&&typeof value!=="undefined"){return _createScaleObjectForValue(attr,value,props[attr+"Type"])}if(typeof baseValue!=="undefined"){domain=(0,_dataUtils.addValueToArray)(domain,baseValue)}if(!range||!domain||!domain.length){return _createScaleObjectForValue(attr,fallbackValue,props[attr+"Type"])}return _createScaleObjectForFunction(domain,range,type,distance,attr,baseValue)}function _computeLeftDomainAdjustment(values){if(values.length>1){return(values[1]-values[0])/2}if(values.length===1){return values[0]-.5}return 0}function _computeRightDomainAdjustment(values){if(values.length>1){return(values[values.length-1]-values[values.length-2])/2}if(values.length===1){return values[0]-.5}return 0}function _computeScaleDistance(values,domain,bestDistIndex,scaleFn){if(values.length>1){var i=Math.max(bestDistIndex,1);return Math.abs(scaleFn(values[i])-scaleFn(values[i-1]))}if(values.length===1){return Math.abs(scaleFn(domain[1])-scaleFn(domain[0]))}return 0}function _getScaleDistanceAndAdjustedDomain(data,scaleObject){var attr=scaleObject.attr,domain=scaleObject.domain;var values=(0,_dataUtils.getUniquePropertyValues)(data,attr);var index=_getSmallestDistanceIndex(values,scaleObject);var adjustedDomain=[].concat(domain);adjustedDomain[0]-=_computeLeftDomainAdjustment(values);adjustedDomain[domain.length-1]+=_computeRightDomainAdjustment(values);if(scaleObject.type===LOG_SCALE_TYPE&&domain[0]<=0){adjustedDomain[0]=Math.min(domain[1]/10,1)}var adjustedScaleFn=_getScaleFnFromScaleObject(_extends({},scaleObject,{domain:adjustedDomain}));var distance=_computeScaleDistance(values,adjustedDomain,index,adjustedScaleFn);return{domain0:adjustedDomain[0],domainN:adjustedDomain[adjustedDomain.length-1],distance:distance}}function _isScaleAdjustmentPossible(props,scaleObject){var attr=scaleObject.attr;var _props$_adjustBy=props._adjustBy,adjustBy=_props$_adjustBy===undefined?[]:_props$_adjustBy,_props$_adjustWhat=props._adjustWhat,adjustWhat=_props$_adjustWhat===undefined?[]:_props$_adjustWhat;return adjustWhat.length&&adjustBy.length&&adjustBy.indexOf(attr)!==-1}function _adjustContinuousScale(props,scaleObject){var allSeriesData=props._allData,_props$_adjustWhat2=props._adjustWhat,adjustWhat=_props$_adjustWhat2===undefined?[]:_props$_adjustWhat2;var domainLength=scaleObject.domain.length;var domain=scaleObject.domain;var scaleDomain0=domain[0];var scaleDomainN=domain[domainLength-1];var scaleDistance=scaleObject.distance;allSeriesData.forEach(function(data,index){if(adjustWhat.indexOf(index)===-1){return}if(data&&data.length){var _getScaleDistanceAndA=_getScaleDistanceAndAdjustedDomain(data,scaleObject),domain0=_getScaleDistanceAndA.domain0,domainN=_getScaleDistanceAndA.domainN,distance=_getScaleDistanceAndA.distance;scaleDomain0=Math.min(scaleDomain0,domain0);scaleDomainN=Math.max(scaleDomainN,domainN);scaleDistance=Math.max(scaleDistance,distance)}});scaleObject.domain=[scaleDomain0].concat(_toConsumableArray(domain.slice(1,-1)),[scaleDomainN]);scaleObject.distance=scaleDistance;return scaleObject}function _adjustCategoricalScale(scaleObject){var scaleFn=_getScaleFnFromScaleObject(scaleObject);var domain=scaleObject.domain,range=scaleObject.range;if(domain.length>1){scaleObject.distance=Math.abs(scaleFn(domain[1])-scaleFn(domain[0]))}else{scaleObject.distance=Math.abs(range[1]-range[0])}return scaleObject}function getScaleObjectFromProps(props,attr){var scaleObject=_collectScaleObjectFromProps(props,attr);if(!scaleObject){return null}if(!_isScaleAdjustmentPossible(props,scaleObject)){return scaleObject}var type=scaleObject.type;if(type===ORDINAL_SCALE_TYPE||type===CATEGORY_SCALE_TYPE){return _adjustCategoricalScale(scaleObject)}return _adjustContinuousScale(props,scaleObject)}function getAttributeScale(props,attr){var scaleObject=getScaleObjectFromProps(props,attr);return _getScaleFnFromScaleObject(scaleObject)}function _getAttrValue(d,attr){return d.data?d.data[attr]:d[attr]}function _isDefined(value){return typeof value!=="undefined"}function getAttributeFunctor(props,attr){var scaleObject=getScaleObjectFromProps(props,attr);if(scaleObject){var scaleFn=_getScaleFnFromScaleObject(scaleObject);return function(d){return scaleFn(_getAttrValue(d,attr))}}return null}function getAttr0Functor(props,attr){var scaleObject=getScaleObjectFromProps(props,attr);if(scaleObject){var attr0=attr+"0";var domain=scaleObject.domain;var _scaleObject$baseValu=scaleObject.baseValue,baseValue=_scaleObject$baseValu===undefined?domain[0]:_scaleObject$baseValu;var scaleFn=_getScaleFnFromScaleObject(scaleObject);return function(d){var value=_getAttrValue(d,attr0);return scaleFn(_isDefined(value)?value:baseValue)}}return null}function getAttributeValue(props,attr){var scaleObject=getScaleObjectFromProps(props,attr);if(scaleObject){if(!scaleObject.isValue){(0,_reactUtils.warning)("[React-vis] Cannot use data defined "+attr+" for this "+"series type. Using fallback value instead.")}return scaleObject.range[0]}return null}function getScalePropTypesByAttribute(attr){var _ref;return _ref={},_defineProperty(_ref,"_"+attr+"Value",_propTypes2.default.any),_defineProperty(_ref,attr+"Domain",_propTypes2.default.array),_defineProperty(_ref,attr+"Range",_propTypes2.default.array),_defineProperty(_ref,attr+"Type",_propTypes2.default.oneOf(Object.keys(SCALE_FUNCTIONS))),_defineProperty(_ref,attr+"Distance",_propTypes2.default.number),_defineProperty(_ref,attr+"BaseValue",_propTypes2.default.any),_ref}function extractScalePropsFromProps(props,attributes){var result={};Object.keys(props).forEach(function(key){var attr=attributes.find(function(a){return key.indexOf(a)===0||key.indexOf("_"+a)===0});if(!attr){return}result[key]=props[key]});return result}function getMissingScaleProps(props,data,attributes){var result={};attributes.forEach(function(attr){if(!props[attr+"Domain"]){result[attr+"Domain"]=getDomainByAttr(data,attr,props[attr+"Type"])}});return result}function literalScale(){function scale(d){return d}function response(){return scale}scale.domain=response;scale.range=response;scale.unknown=response;scale.copy=response;return scale}function getFontColorFromBackground(background){if(background){return(0,_d3Color.hsl)(background).l>.57?"#222":"#fff"}return null}exports.default={extractScalePropsFromProps:extractScalePropsFromProps,getAttributeScale:getAttributeScale,getAttributeFunctor:getAttributeFunctor,getAttr0Functor:getAttr0Functor,getAttributeValue:getAttributeValue,getDomainByAttr:getDomainByAttr,getFontColorFromBackground:getFontColorFromBackground,getMissingScaleProps:getMissingScaleProps,getScaleObjectFromProps:getScaleObjectFromProps,getScalePropTypesByAttribute:getScalePropTypesByAttribute,literalScale:literalScale}},{"./data-utils":362,"./react-utils":363,"d3-array":6,"d3-collection":7,"d3-color":8,"d3-scale":19,"prop-types":257}],365:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ANIMATED_SERIES_PROPS=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.isSeriesChild=isSeriesChild;exports.getSeriesChildren=getSeriesChildren;exports.getStackedData=getStackedData;exports.getSeriesPropsFromChildren=getSeriesPropsFromChildren;exports.getRadialDomain=getRadialDomain;exports.getStackParams=getStackParams;var _react=require("react");var _react2=_interopRequireDefault(_react);var _abstractSeries=require("../plot/series/abstract-series");var _abstractSeries2=_interopRequireDefault(_abstractSeries);var _theme=require("../theme");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function isSeriesChild(child){var prototype=child.type.prototype;return prototype instanceof _abstractSeries2.default}function getSeriesChildren(children){return _react2.default.Children.toArray(children).filter(function(child){return child&&isSeriesChild(child)})}function collectSeriesTypesInfo(children){var result={};children.filter(isSeriesChild).forEach(function(child){var displayName=child.type.displayName;var cluster=child.props.cluster;if(!result[displayName]){result[displayName]={sameTypeTotal:0,sameTypeIndex:0,clusters:new Set}}result[displayName].clusters.add(cluster);result[displayName].sameTypeTotal++});return result}function seriesHasAngleRadius(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(!data){return false}return data.some(function(row){return row.radius&&row.angle})}function prepareData(data){if(!seriesHasAngleRadius(data)){return data}return data.map(function(row){return _extends({},row,{x:row.radius*Math.cos(row.angle),y:row.radius*Math.sin(row.angle)})})}function getStackedData(children,attr){return children.reduce(function(accumulator,series,seriesIndex){if(!series){accumulator.result.push(null);return accumulator}var _series$props=series.props,data=_series$props.data,_series$props$cluster=_series$props.cluster,cluster=_series$props$cluster===undefined?"default":_series$props$cluster;var preppedData=prepareData(data,attr);if(!attr||!preppedData||!preppedData.length){accumulator.result.push(preppedData);return accumulator}var attr0=attr+"0";accumulator.result.push(preppedData.map(function(d,dIndex){var _extends2;if(!accumulator.seriesPointers[cluster]){return _extends({},d)}var prevSeries=accumulator.seriesPointers[cluster].slice().pop();var prevD=accumulator.result[prevSeries][dIndex];return _extends({},d,(_extends2={},_defineProperty(_extends2,attr0,prevD[attr]),_defineProperty(_extends2,attr,prevD[attr]+d[attr]-(d[attr0]||0)),_extends2))}));accumulator.seriesPointers[cluster]=(accumulator.seriesPointers[cluster]||[]).concat([seriesIndex]);return accumulator},{result:[],seriesPointers:{}}).result}function getSeriesPropsFromChildren(children){var result=[];var seriesTypesInfo=collectSeriesTypesInfo(children);var seriesIndex=0;var _opacityValue=_theme.DEFAULT_OPACITY;children.forEach(function(child){var props=void 0;if(isSeriesChild(child)){var seriesTypeInfo=seriesTypesInfo[child.type.displayName];var _colorValue=_theme.DISCRETE_COLOR_RANGE[seriesIndex%_theme.DISCRETE_COLOR_RANGE.length];props=_extends({},seriesTypeInfo,{seriesIndex:seriesIndex,ref:"series"+seriesIndex,_colorValue:_colorValue,_opacityValue:_opacityValue});seriesTypeInfo.sameTypeIndex++;seriesIndex++;if(child.props.cluster){props.cluster=child.props.cluster;props.clusters=Array.from(seriesTypeInfo.clusters);props.sameTypeTotal=props.clusters.length;props.sameTypeIndex=props.clusters.indexOf(child.props.cluster)}}result.push(props)});return result}function getRadialDomain(data){return data.reduce(function(res,row){return Math.max(row.radius,res)},0)}var ANIMATED_SERIES_PROPS=exports.ANIMATED_SERIES_PROPS=["xRange","xDomain","x","yRange","yDomain","y","colorRange","colorDomain","color","opacityRange","opacityDomain","opacity","strokeRange","strokeDomain","stroke","fillRange","fillDomain","fill","width","height","marginLeft","marginTop","marginRight","marginBottom","data","angleDomain","angleRange","angle","radiusDomain","radiusRange","radius","innerRadiusDomain","innerRadiusRange","innerRadius"];function getStackParams(props){var _stackBy=props._stackBy,valuePosAttr=props.valuePosAttr,cluster=props.cluster;var _props$sameTypeTotal=props.sameTypeTotal,sameTypeTotal=_props$sameTypeTotal===undefined?1:_props$sameTypeTotal,_props$sameTypeIndex=props.sameTypeIndex,sameTypeIndex=_props$sameTypeIndex===undefined?0:_props$sameTypeIndex;if(_stackBy===valuePosAttr&&!cluster){sameTypeTotal=1;sameTypeIndex=0}return{sameTypeTotal:sameTypeTotal,sameTypeIndex:sameTypeIndex}}},{"../plot/series/abstract-series":321,"../theme":357,react:297}]},{},[303])(303)});
